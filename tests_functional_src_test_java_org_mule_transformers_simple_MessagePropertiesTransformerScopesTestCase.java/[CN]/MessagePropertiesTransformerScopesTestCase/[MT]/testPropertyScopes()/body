{
  MuleMessage msg=new DefaultMuleMessage("message",muleContext);
  MessagePropertiesTransformer add=new MessagePropertiesTransformer();
  add.setScope(PropertyScope.INVOCATION);
  Map addProps=new HashMap();
  addProps.put("foo","bar");
  addProps.put("foo2","baz");
  add.setAddProperties(addProps);
  add.setMuleContext(muleContext);
  msg=(DefaultMuleMessage)add.transform(msg,null);
  assertEquals("bar",msg.getInvocationProperty("foo"));
  assertNull(msg.getOutboundProperty("foo"));
  assertNull(msg.getProperty("foo",PropertyScope.SESSION));
  MessagePropertiesTransformer deleteWrongScope=new MessagePropertiesTransformer();
  deleteWrongScope.setScope(PropertyScope.OUTBOUND);
  deleteWrongScope.setDeleteProperties(Collections.singletonList("foo"));
  deleteWrongScope.setMuleContext(muleContext);
  msg=(DefaultMuleMessage)deleteWrongScope.transform(msg,null);
  assertEquals("bar",msg.getInvocationProperty("foo"));
  MessagePropertiesTransformer delete=new MessagePropertiesTransformer();
  add.setScope(PropertyScope.INVOCATION);
  delete.setDeleteProperties(Collections.singletonList("foo"));
  delete.setMuleContext(muleContext);
  msg=(DefaultMuleMessage)delete.transform(msg,null);
  assertNull(msg.getInvocationProperty("foo"));
  assertEquals("baz",msg.getInvocationProperty("foo2"));
}
