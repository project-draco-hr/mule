{
  String inbox;
  if (connector.getProtocol().toLowerCase().startsWith("imap")) {
    inbox=endpoint.getEndpointURI().getPath();
    if (inbox.length() == 0) {
      if (connector.getProtocol().toLowerCase().compareTo("imaps") == 0) {
        inbox=((ImapsConnector)connector).getMailboxFolder();
      }
 else {
        inbox=((ImapConnector)connector).getMailboxFolder();
      }
    }
 else {
      inbox=inbox.substring(1);
    }
  }
 else {
    inbox=Pop3Connector.MAILBOX;
  }
  UMOEndpointURI uri=endpoint.getEndpointURI();
  URLName url=new URLName(uri.getScheme(),uri.getHost(),uri.getPort(),inbox,uri.getUsername(),uri.getPassword());
  session=connector.getMailSession(url);
  session.setDebug(logger.isDebugEnabled());
  Store store=session.getStore(url);
  store.connect();
  folder=store.getFolder(inbox);
  if (backupFolder == null) {
    this.backupFolder=MuleManager.getConfiguration().getWorkingDirectory() + "/mail/" + folder.getName();
  }
 else   if (StringUtils.EMPTY.equals(backupFolder)) {
    backupFolder=null;
  }
  if (backupFolder != null && !this.backupFolder.endsWith(File.separator)) {
    this.backupFolder+=File.separator;
  }
}
