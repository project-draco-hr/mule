{
  try {
    Source sourceDoc=this.getXmlSource(src);
    if (sourceDoc == null) {
      return null;
    }
    ResultHolder holder=getResultHolder(returnClass);
    if (holder == null) {
      holder=getResultHolder(src.getClass());
    }
    DefaultErrorListener errorListener=new DefaultErrorListener(this);
    Transformer transformer=null;
    Object result;
    try {
      transformer=(Transformer)transformerPool.borrowObject();
      transformer.setErrorListener(errorListener);
      transformer.setOutputProperty(OutputKeys.ENCODING,encoding);
      if (transformParameters != null) {
        for (Iterator i=transformParameters.entrySet().iterator(); i.hasNext(); ) {
          Map.Entry parameter=(Entry)i.next();
          String key=(String)parameter.getKey();
          transformer.setParameter(key,evaluateTransformParameter(key,parameter.getValue()));
        }
      }
      transformer.transform(sourceDoc,holder.getResult());
      result=holder.getResultObject();
      if (errorListener.isError()) {
        throw errorListener.getException();
      }
    }
  finally {
      if (transformer != null) {
        transformer.clearParameters();
        transformerPool.returnObject(transformer);
      }
    }
    return result;
  }
 catch (  Exception e) {
    throw new TransformerException(this,e);
  }
}
