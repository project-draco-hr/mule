{
  StreamSource source=XsltTransformer.this.getStreamSource();
  String factoryClassName=XsltTransformer.this.getXslTransformerFactory();
  TransformerFactory factory;
  if (StringUtils.isNotEmpty(factoryClassName)) {
    factory=(TransformerFactory)ClassUtils.instanciateClass(factoryClassName,ClassUtils.NO_ARGS,this.getClass());
  }
 else {
    try {
      factory=TransformerFactory.newInstance();
    }
 catch (    TransformerFactoryConfigurationError e) {
      System.setProperty("javax.xml.transform.TransformerFactory",XMLUtils.TRANSFORMER_FACTORY_JDK5);
      factory=TransformerFactory.newInstance();
    }
  }
  factory.setURIResolver(new URIResolver(){
    public Source resolve(    String href,    String base) throws javax.xml.transform.TransformerException {
      try {
        return new StreamSource(IOUtils.getResourceAsStream(href,getClass()));
      }
 catch (      IOException e) {
        throw new javax.xml.transform.TransformerException(e);
      }
    }
  }
);
  return factory.newTransformer(source);
}
