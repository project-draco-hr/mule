{
  MuleClient client=muleContext.getClient();
  BPMS bpms=muleContext.getRegistry().lookupObject(BPMS.class);
  assertNotNull(bpms);
  MuleMessage response=client.send("vm://simple","data",null);
  Object process=response.getPayload();
  String processId=(String)bpms.getId(process);
  assertFalse(processId == null);
  assertEquals("dummyState",bpms.getState(process));
  Map props=new HashMap();
  props.put(Process.PROPERTY_PROCESS_ID,processId);
  response=client.send("vm://simple",null,props);
  process=response.getPayload();
  assertTrue(bpms.hasEnded(process));
}
