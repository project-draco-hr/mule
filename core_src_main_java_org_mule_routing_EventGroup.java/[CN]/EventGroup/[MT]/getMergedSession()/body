{
  MuleEvent lastStoredEvent=retrieveLastStoredEvent();
  MuleSession session=new DefaultMuleSession(lastStoredEvent.getSession());
  for (  Serializable key : events.allKeys()) {
    if (!key.equals(lastStoredEventKey)) {
      MuleEvent event=events.retrieve(key);
      addAndOverrideSessionProperties(session,event);
    }
  }
  addAndOverrideSessionProperties(session,lastStoredEvent);
  return session;
}
