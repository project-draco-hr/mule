{
  DefaultMessageCollection col=new DefaultMessageCollection(muleContext);
  List<MuleMessage> messages=new ArrayList<MuleMessage>();
synchronized (events) {
    for (    Serializable id : events.allKeys()) {
      MuleMessage message=events.retrieve(id).getMessage();
      messages.add(message);
    }
  }
  if (sortByArrival) {
    Collections.sort(messages,new ArrivalOrderMessageComparator());
  }
  col.addMessages(messages);
  return col;
}
