{
synchronized (events) {
    Serializable key=event.getId() + event.getMessage().getCorrelationSequence();
    event.getMessage().setInvocationProperty(MULE_ARRIVAL_ORDER_PROPERTY,++arrivalOrderCounter);
    lastStoredEventKey=key;
    events.store(key,event);
    if (!hasNoCommonRootId) {
      String rootId=event.getMessage().getMessageRootId();
      if (commonRootId == null) {
        commonRootId=rootId;
      }
 else       if (!commonRootId.equals(rootId)) {
        hasNoCommonRootId=true;
        commonRootId=null;
      }
    }
  }
}
