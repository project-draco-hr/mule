{
  InputStream payload=mock(InputStream.class);
  MuleMessage message=MuleMessage.builder().payload(payload).mediaType(APPLICATION_XML_CUSTOM).build();
  MuleRegistry muleRegistry=mock(MuleRegistry.class);
  when(muleContext.getRegistry()).thenReturn(muleRegistry);
  Transformer transformer=mock(Transformer.class);
  when(transformer.transform(anyObject(),anyObject())).thenReturn(TEST);
  when(muleRegistry.lookupTransformer(argThat(any(DataType.class)),argThat(any(DataType.class)))).thenReturn(transformer);
  assertThat(message.getDataType().getMediaType().getPrimaryType(),equalTo(APPLICATION_XML.getPrimaryType()));
  assertThat(message.getDataType().getMediaType().getSubType(),equalTo(APPLICATION_XML.getSubType()));
  assertThat(message.getDataType().getMediaType().getCharset().get(),equalTo(CUSTOM_ENCODING));
}
