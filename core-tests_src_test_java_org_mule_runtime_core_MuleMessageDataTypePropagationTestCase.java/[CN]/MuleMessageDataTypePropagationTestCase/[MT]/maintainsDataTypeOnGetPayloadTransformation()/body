{
  InputStream payload=mock(InputStream.class);
  DefaultMuleMessage muleMessage=new DefaultMuleMessage(payload,buildDefaultEncodingDataType());
  muleMessage.setDataType(DataType.builder().mediaType(APPLICATION_XML).charset(CUSTOM_ENCODING).build());
  MuleRegistry muleRegistry=mock(MuleRegistry.class);
  when(muleContext.getRegistry()).thenReturn(muleRegistry);
  Transformer transformer=mock(Transformer.class);
  when(transformer.transform(anyObject(),anyObject())).thenReturn(TEST);
  when(muleRegistry.lookupTransformer(argThat(any(DataType.class)),argThat(any(DataType.class)))).thenReturn(transformer);
  assertThat(muleMessage.getDataType().getMediaType().getPrimaryType(),equalTo(APPLICATION_XML.getPrimaryType()));
  assertThat(muleMessage.getDataType().getMediaType().getSubType(),equalTo(APPLICATION_XML.getSubType()));
  assertThat(muleMessage.getDataType().getMediaType().getCharset().get(),equalTo(CUSTOM_ENCODING));
}
