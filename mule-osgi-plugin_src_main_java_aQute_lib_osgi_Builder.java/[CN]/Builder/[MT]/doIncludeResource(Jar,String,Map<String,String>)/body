{
  boolean preprocess=false;
  if (name.startsWith("{") && name.endsWith("}")) {
    preprocess=true;
    name=name.substring(1,name.length() - 1).trim();
  }
  if (name.startsWith("@")) {
    extractFromJar(jar,name.substring(1));
  }
 else   if (extra.containsKey("literal")) {
    String literal=(String)extra.get("literal");
    Resource r=new EmbeddedResource(literal.getBytes("UTF-8"),0);
    String x=(String)extra.get("extra");
    if (x != null)     r.setExtra(x);
    jar.putResource(name,r);
  }
 else {
    String source;
    File sourceFile;
    String destinationPath;
    String parts[]=name.split("\\s*=\\s*");
    if (parts.length == 1) {
      source=parts[0];
      sourceFile=getFile(source);
      if (sourceFile.isDirectory())       destinationPath="";
 else       destinationPath=sourceFile.getName();
    }
 else {
      source=parts[1];
      sourceFile=getFile(source);
      destinationPath=parts[0];
    }
    if (destinationPath.endsWith("/"))     destinationPath=destinationPath.substring(0,destinationPath.length() - 1);
    if (!sourceFile.exists()) {
      noSuchFile(jar,name,extra,source,destinationPath);
    }
 else     copy(jar,destinationPath,sourceFile,preprocess,extra);
  }
}
