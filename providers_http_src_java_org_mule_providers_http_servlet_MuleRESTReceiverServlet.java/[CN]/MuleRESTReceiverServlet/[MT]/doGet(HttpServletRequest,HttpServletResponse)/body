{
  try {
    if (httpServletRequest.getParameter("endpoint") != null) {
      UMOEndpoint endpoint=getEndpointForURI(httpServletRequest);
      String timeoutString=httpServletRequest.getParameter("timeout");
      long to=timeout;
      if (timeoutString != null) {
        to=new Long(timeoutString).longValue();
      }
      if (logger.isDebugEnabled()) {
        logger.debug("Making request using endpoint: " + endpoint.toString() + " timeout is: "+ to);
      }
      UMOMessage returnMessage=endpoint.getConnector().getDispatcher("ANY").receive(endpoint.getEndpointURI(),to);
      writeResponse(httpServletResponse,returnMessage);
    }
 else {
      AbstractMessageReceiver receiver=getReceiverForURI(httpServletRequest);
      httpServletRequest.setAttribute(PAYLOAD_PARAMETER_NAME,payloadParameterName);
      UMOMessage message=new MuleMessage(receiver.getConnector().getMessageAdapter(httpServletRequest));
      UMOMessage returnMessage=receiver.routeMessage(message,true);
      writeResponse(httpServletResponse,returnMessage);
    }
  }
 catch (  Exception e) {
    handleException(e,"Failed to route event through Servlet Receiver",httpServletResponse);
  }
}
