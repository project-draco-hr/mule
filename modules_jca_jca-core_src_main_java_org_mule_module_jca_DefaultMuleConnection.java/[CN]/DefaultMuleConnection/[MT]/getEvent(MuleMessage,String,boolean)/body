{
  ImmutableEndpoint endpoint=muleContext.getRegistry().lookupEndpointFactory().getOutboundEndpoint(uri);
  try {
    MuleSession session=new DefaultMuleSession(message,((AbstractConnector)endpoint.getConnector()).getSessionHandler(),muleContext);
    if (credentials != null) {
      message.setProperty(MuleProperties.MULE_USER_PROPERTY,"Plain " + credentials.getToken());
    }
    return new DefaultMuleEvent(message,endpoint,session,synchronous);
  }
 catch (  Exception e) {
    throw new DispatchException(CoreMessages.failedToCreate("Client event"),message,endpoint,e);
  }
}
