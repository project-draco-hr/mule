{
  MuleMessage message=theEvent.getMessage();
  MuleSession session=theEvent.getSession();
  for (  OutboundEndpoint endpoint : endpoints) {
    if (isMatch(message)) {
      try {
        DefaultMuleEvent event=new DefaultMuleEvent(message,endpoint,session,endpoint.isSynchronous());
        if (endpoint.isSynchronous()) {
          MuleEvent resultEvent;
          resultEvent=endpoint.process(event);
          if (resultEvent != null) {
            return resultEvent.getMessage();
          }
 else {
            return null;
          }
        }
 else {
          endpoint.process(event);
          return null;
        }
      }
 catch (      MuleException e) {
        throw new MessagingException(e.getI18nMessage(),message,e);
      }
    }
  }
  throw new RuntimeException("Event not processed");
}
