{
  final MuleApplicationEvent event=new MuleApplicationEvent("MuleEvent from a spring bean","vm://testBean2");
  TestSubscriptionEventBean bean2=(TestSubscriptionEventBean)muleContext.getRegistry().lookupObject("testSubscribingEventBean2");
  assertNotNull(bean2);
  Latch whenFinished=new Latch();
  bean2.setEventCallback(new CountingEventCallback(eventCounter1,NUMBER_OF_MESSAGES,whenFinished));
  this.doPublish(event,NUMBER_OF_MESSAGES);
  whenFinished.await(3000,TimeUnit.MILLISECONDS);
  assertEquals(NUMBER_OF_MESSAGES,eventCounter1.get());
}
