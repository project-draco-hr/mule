{
  TestApplicationEventBean bean=(TestApplicationEventBean)muleContext.getRegistry().lookupObject("testEventSpringBean");
  assertNotNull(bean);
  final Latch whenFinished=new Latch();
  EventCallback callback=new EventCallback(){
    @Override public void eventReceived(    MuleEventContext context,    Object o) throws Exception {
      assertNull(context);
      if (o instanceof TestApplicationEvent) {
        if (eventCounter1.incrementAndGet() == 1) {
          whenFinished.countDown();
        }
      }
    }
  }
;
  bean.setEventCallback(callback);
  ApplicationContext context=((MuleEventMulticaster)muleContext.getRegistry().lookupObject("applicationEventMulticaster")).applicationContext;
  context.publishEvent(new TestApplicationEvent(context));
  whenFinished.await(DEFAULT_LATCH_TIMEOUT,TimeUnit.MILLISECONDS);
  assertEquals(1,eventCounter1.get());
}
