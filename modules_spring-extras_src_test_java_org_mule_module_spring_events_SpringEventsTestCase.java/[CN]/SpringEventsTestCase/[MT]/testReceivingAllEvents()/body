{
  TestAllEventBean bean=(TestAllEventBean)muleContext.getRegistry().lookupObject("testAllEventBean");
  assertNotNull(bean);
  Latch whenFinished=new Latch();
  bean.setEventCallback(new CountingEventCallback(eventCounter1,2,whenFinished));
  MuleClient client=muleContext.getClient();
  client.send("vm://event.multicaster","Test Spring MuleEvent",null);
  ApplicationContext context=((MuleEventMulticaster)muleContext.getRegistry().lookupObject("applicationEventMulticaster")).applicationContext;
  context.publishEvent(new TestApplicationEvent(context));
  whenFinished.await(DEFAULT_LATCH_TIMEOUT,TimeUnit.MILLISECONDS);
  assertEquals(2,eventCounter1.get());
}
