{
  TestSubscriptionEventBean subscriptionBean=(TestSubscriptionEventBean)muleContext.getRegistry().lookupObject("testSubscribingEventBean1");
  assertNotNull(subscriptionBean);
  MuleEventMulticaster multicaster=(MuleEventMulticaster)muleContext.getRegistry().lookupObject(AbstractApplicationContext.APPLICATION_EVENT_MULTICASTER_BEAN_NAME);
  assertNotNull(multicaster);
  Latch whenFinished=new Latch();
  subscriptionBean.setEventCallback(new CountingEventCallback(eventCounter1,1,whenFinished));
  multicaster.removeApplicationListener(subscriptionBean);
  MuleClient client=new MuleClient(muleContext);
  client.send("vm://event.multicaster","Test Spring MuleEvent",null);
  assertEquals(0,eventCounter1.get());
  multicaster.addApplicationListener(subscriptionBean);
  client.send("vm://event.multicaster","Test Spring MuleEvent",null);
  assertTrue(whenFinished.await(3000,TimeUnit.MILLISECONDS));
  assertEquals(1,eventCounter1.get());
  eventCounter1.set(0);
  multicaster.removeAllListeners();
  client.send("vm://event.multicaster","Test Spring MuleEvent",null);
  assertEquals(0,eventCounter1.get());
  multicaster.addApplicationListener(subscriptionBean);
  subscriptionBean.setEventCallback(null);
}
