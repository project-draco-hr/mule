{
  if (multipleSessionsPerConnection) {
    return super.getSession(transacted,topic);
  }
 else {
    UMOTransaction tx=TransactionCoordination.getInstance().getTransaction();
    Session session=getCurrentSession();
    if (session != null) {
      logger.debug("Retrieving jms session from current transaction");
      return session;
    }
    Connection connection=null;
    try {
      connection=createConnection();
    }
 catch (    NamingException e) {
      throw new JMSException("Unable to open new database connection.",e.getMessage());
    }
catch (    InitialisationException e) {
      throw new JMSException("Unable to open new database connection.",e.getMessage());
    }
    logger.debug("Retrieving new jms session from connection");
    session=getJmsSupport().createSession(connection,topic,transacted || tx != null,getAcknowledgementMode(),isNoLocal());
    if (tx != null) {
      logger.debug("Binding session to current transaction");
      try {
        tx.bindResource(connection,session);
      }
 catch (      TransactionException e) {
        throw new RuntimeException("Could not bind session to current transaction",e);
      }
    }
    return session;
  }
}
