{
  MuleEvent event=RequestContext.getEvent();
  if (messageProcessor instanceof MuleContextAware) {
    ((MuleContextAware)messageProcessor).setMuleContext(RequestContext.getEventContext().getMuleContext());
  }
  if (messageProcessor instanceof FlowConstructAware) {
    ((FlowConstructAware)messageProcessor).setFlowConstruct(RequestContext.getEventContext().getFlowConstruct());
  }
  if (!hasBeenInitialized) {
    if (messageProcessor instanceof Initialisable) {
      try {
        ((Initialisable)messageProcessor).initialise();
      }
 catch (      Exception e) {
        logger.error(e.getMessage(),e);
      }
    }
    hasBeenInitialized=true;
  }
  if (!hasBeenStarted) {
    if (messageProcessor instanceof Startable) {
      try {
        ((Startable)messageProcessor).start();
      }
 catch (      Exception e) {
        logger.error(e.getMessage(),e);
      }
    }
    hasBeenStarted=true;
  }
  try {
    event=messageProcessor.process(event);
    restoredAccessToken=event.getMessage().getInvocationProperty("OAuthAccessToken");
    restoredAccessTokenSecret=event.getMessage().getInvocationProperty("OAuthAccessTokenSecret");
  }
 catch (  Exception e) {
    logger.error(e.getMessage(),e);
  }
}
