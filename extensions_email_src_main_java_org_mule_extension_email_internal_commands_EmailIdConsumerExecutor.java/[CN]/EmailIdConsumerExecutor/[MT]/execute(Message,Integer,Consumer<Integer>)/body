{
  if (emailId == null) {
    Object payload=muleMessage.getPayload().getValue();
    if (payload instanceof List) {
      for (      Object o : (List)payload) {
        if (o instanceof Message) {
          emailId=getIdOrFail(((Message)o));
          consumer.accept(emailId);
        }
 else {
          throw new EmailException(NO_ID_ERROR);
        }
      }
      return;
    }
    emailId=getIdOrFail(muleMessage);
  }
  consumer.accept(emailId);
}
