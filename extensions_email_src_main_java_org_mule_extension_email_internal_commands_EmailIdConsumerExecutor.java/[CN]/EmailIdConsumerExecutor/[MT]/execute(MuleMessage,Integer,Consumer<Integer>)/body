{
  if (emailId == null) {
    Object payload=muleMessage.getPayload();
    if (payload instanceof List) {
      for (      Object o : (List)payload) {
        if (o instanceof MuleMessage) {
          emailId=getIdOrFail(((MuleMessage)o));
          consumer.accept(emailId);
        }
 else {
          throw new EmailException("Cannot perform operation, was expecting an emailId or a payload carrying one or more emails");
        }
      }
      return;
    }
    emailId=getIdOrFail(muleMessage);
  }
  consumer.accept(emailId);
}
