{
  if (ClassUtils.isInstance(expectedType.getRawType(),object)) {
    return object;
  }
  Type expectedClass=expectedType.getRawType();
  if (expectedClass instanceof ParameterizedType) {
    expectedClass=((ParameterizedType)expectedClass).getRawType();
  }
  org.mule.api.metadata.DataType sourceDataType=DataTypeFactory.create(object.getClass());
  org.mule.api.metadata.DataType targetDataType=DataTypeFactory.create((Class)expectedClass);
  Transformer transformer;
  try {
    transformer=muleContext.getRegistry().lookupTransformer(sourceDataType,targetDataType);
  }
 catch (  TransformerException e) {
    throw new MessagingException(createStaticMessage(String.format("Expression '%s' was expected to return a value of type '%s' but a '%s' was found instead " + "and no suitable transformer could be located",evaluator.getRawValue(),expectedType.getRawType().getName(),object.getClass().getName())),event,e);
  }
  if (transformer instanceof MessageTransformer) {
    return (T)((MessageTransformer)transformer).transform(object,event);
  }
 else {
    return (T)transformer.transform(object);
  }
}
