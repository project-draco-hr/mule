{
  TransactionalQueueManager transactionalQueueManager=new TransactionalQueueManager();
  transactionalQueueManager.setMuleContext(muleContext);
  transactionalQueueManager.setQueueConfiguration(TEST_QUEUE_NAME,new DefaultQueueConfiguration(0,true));
  transactionalQueueManager.initialise();
  transactionalQueueManager.start();
  MuleEvent testEvent=getTestEvent("echo");
  transactionalQueueManager.getQueueSession().getQueue(TEST_QUEUE_NAME).put(testEvent.getMessage());
  transactionalQueueManager.stop();
  muleContext.start();
  MuleClient client=muleContext.getClient();
  MuleMessage result=client.request("vm://" + TEST_QUEUE_NAME,RECEIVE_TIMEOUT).getRight().get();
  assertNotNull(result);
  assertEquals(getPayloadAsString(testEvent.getMessage()),result.getPayload());
}
