{
  HttpClient client=new HttpClient();
  client.getParams().setAuthenticationPreemptive(true);
  GetMethod get=new GetMethod("http://localhost:4567/index.html");
  get.setDoAuthentication(false);
  try {
    int status=client.executeMethod(get);
    assertEquals(HttpConstants.SC_UNAUTHORIZED,status);
    assertEquals("Registered authentication is set to org.mule.module.acegi.filters.http.HttpBasicAuthenticationFilter " + "but there was no security context on the session. Authentication denied on endpoint " + "http://localhost:4567. Message payload is of type: String",get.getResponseBodyAsString());
  }
  finally {
    get.releaseConnection();
  }
}
