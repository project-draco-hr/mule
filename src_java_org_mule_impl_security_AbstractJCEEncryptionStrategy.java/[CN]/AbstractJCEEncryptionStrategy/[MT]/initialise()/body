{
  if (algorithm == null) {
    throw new InitialisationException(new Message(Messages.X_IS_NULL,"Algorithm"),this);
  }
 else {
    logger.debug("Using encryption algorithm: " + algorithm);
  }
  keySpec=createKeySpec();
  try {
    secretKey=getSecretKey();
    encryptCipher=Cipher.getInstance(getAlgorithm());
    decryptCipher=Cipher.getInstance(getAlgorithm());
    AlgorithmParameterSpec paramSpec=createAlgorithmParameterSpec();
    if (paramSpec != null) {
      encryptCipher.init(Cipher.ENCRYPT_MODE,secretKey,paramSpec);
      decryptCipher.init(Cipher.DECRYPT_MODE,secretKey,paramSpec);
    }
 else {
      encryptCipher.init(Cipher.ENCRYPT_MODE,secretKey);
      decryptCipher.init(Cipher.DECRYPT_MODE,secretKey);
    }
  }
 catch (  Exception e) {
    throw new InitialisationException(new Message(Messages.FAILED_TO_CREATE_X,"encryption ciphers"),e,this);
  }
}
