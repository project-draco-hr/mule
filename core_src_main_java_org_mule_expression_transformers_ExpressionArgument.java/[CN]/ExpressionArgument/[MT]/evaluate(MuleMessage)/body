{
  Object result=muleContext.getExpressionManager().evaluate(getExpression(),getEvaluator(),message,!isOptional());
  if (getReturnClass() != null && result != null) {
    if (!getReturnClass().isInstance(result)) {
      throw new ExpressionRuntimeException(CoreMessages.transformUnexpectedType(result.getClass(),getReturnClass()));
    }
    if (result instanceof Collection && ((Collection)result).size() == 0 && !isOptional()) {
      throw new ExpressionRuntimeException(CoreMessages.expressionEvaluatorReturnedNull(this.getEvaluator(),this.getExpression()));
    }
  }
  return result;
}
