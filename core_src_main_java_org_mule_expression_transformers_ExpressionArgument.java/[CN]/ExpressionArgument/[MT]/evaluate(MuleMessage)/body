{
  Object result=null;
  ClassLoader originalContextClassLoader=Thread.currentThread().getContextClassLoader();
  try {
    Thread.currentThread().setContextClassLoader(expressionEvaluationClassLoader);
    result=muleContext.getExpressionManager().evaluate(getExpression(),getEvaluator(),message,!isOptional());
  }
  finally {
    Thread.currentThread().setContextClassLoader(originalContextClassLoader);
  }
  if (getReturnClass() != null && result != null) {
    if (!getReturnClass().isInstance(result)) {
      throw new ExpressionRuntimeException(CoreMessages.transformUnexpectedType(result.getClass(),getReturnClass()));
    }
    if (result instanceof Collection && ((Collection)result).size() == 0 && !isOptional()) {
      throw new ExpressionRuntimeException(CoreMessages.expressionEvaluatorReturnedNull(this.getEvaluator(),this.getExpression()));
    }
  }
  return result;
}
