{
  Serializable key=generateKey(request);
  MuleEvent cachedResponse=lookupEventInCache(key);
  MuleEvent response;
  if (cachedResponse != null) {
    response=responseGenerator.create(request,cachedResponse);
  }
 else {
    try {
      response=messageProcessor.process(request);
    }
 catch (    Exception e) {
      throw new DefaultMuleException(e);
    }
    if (response == null || consumableFilter.accept(response.getMessage())) {
      MuleEvent responseCopy=response;
      if (response instanceof ThreadSafeAccess) {
        responseCopy=(MuleEvent)((ThreadSafeAccess)response).newThreadCopy();
      }
      store(key,responseCopy);
    }
  }
  return response;
}
