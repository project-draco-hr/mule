{
  if (logger.isDebugEnabled()) {
    logger.debug("parsing: " + elementToString(element));
  }
  if (isBeansNamespace(element)) {
    return handleSpringElements(element,parent);
  }
 else {
    String namespaceUri=element.getNamespaceURI();
    NamespaceHandler handler=getReaderContext().getNamespaceHandlerResolver().resolve(namespaceUri);
    if (handler == null) {
      getReaderContext().error("Unable to locate NamespaceHandler for namespace [" + namespaceUri + "]",element);
      return null;
    }
    boolean atLeastOneChildNotFactory=false;
    BeanDefinition finalChild;
    do {
      ParserContext parserContext=new ParserContext(getReaderContext(),this,parent);
      finalChild=handler.parse(element,parserContext);
      if (parserContext.isNested()) {
        registerBean(element,finalChild);
      }
      boolean isFactory=null != finalChild && null != finalChild.getBeanClassName() && (finalChild.getBeanClassName().equals(MapFactoryBean.class.getName()) || finalChild.getBeanClassName().equals(PropertiesFactoryBean.class.getName()));
      atLeastOneChildNotFactory=atLeastOneChildNotFactory || (!isFactory);
    }
 while (null != finalChild && finalChild.hasAttribute(MULE_REPEAT_PARSE));
    if (isMuleNamespace(element) && atLeastOneChildNotFactory) {
      NodeList list=element.getChildNodes();
      for (int i=0; i < list.getLength(); i++) {
        if (list.item(i) instanceof Element) {
          parseCustomElement((Element)list.item(i),finalChild);
        }
      }
    }
    return finalChild;
  }
}
