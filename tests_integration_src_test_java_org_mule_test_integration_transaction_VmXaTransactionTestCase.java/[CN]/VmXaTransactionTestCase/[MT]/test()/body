{
  for (int i=0; i < new Integer(inboundQueueMaxOutstandingMessages.getValue()); i++) {
    System.out.println("Sending message: " + i);
    muleContext.getClient().dispatch("vm://input?connector=vm-connector-large","message",null);
  }
  Thread.sleep(10000);
  for (int i=0; i < new Integer(inboundQueueMaxOutstandingMessages.getValue()); i++) {
    PollingProber prober=new PollingProber(10000,100);
    prober.check(new Probe(){
      public boolean isSatisfied(){
        MuleMessage request=null;
        try {
          request=muleContext.getClient().request("vm://output?connector=vm-connector-small",100);
        }
 catch (        MuleException e) {
          return false;
        }
        return request != null;
      }
      public String describeFailure(){
        return "Some messages didn't arrive";
      }
    }
);
    System.out.println("Sending message: " + i);
  }
}
