{
  MuleEvent event=mock(MuleEvent.class);
  MuleMessage message=MuleMessage.builder().payload(data).build();
  when(event.getMessage()).thenReturn(message);
  when(event.getExchangePattern()).thenReturn(exchangePattern);
  when(event.getFlowCallStack()).thenReturn(new DefaultFlowCallStack());
  when(event.getError()).thenReturn(empty());
  Pipeline mockFlow=mock(Flow.class);
  when(mockFlow.getProcessingStrategy()).thenReturn(nonBlocking ? new NonBlockingProcessingStrategy() : new DefaultFlowProcessingStrategy());
  when(mockFlow.getMuleContext()).thenReturn(muleContext);
  when(event.getSession()).thenReturn(mock(MuleSession.class));
  when(event.isSynchronous()).thenReturn(synchronous);
  when(event.isAllowNonBlocking()).thenReturn(!synchronous && nonBlocking);
  return event;
}
