{
  boolean sync=true;
  Call call=(Call)msgContext.getProperty("call_object");
  if (call == null) {
    throw new IllegalStateException("The call_object property must be set on the message context to the client Call object");
  }
  if (Boolean.TRUE.equals(call.getProperty("axis.one.way"))) {
    sync=false;
  }
  UMOEvent event=(UMOEvent)call.getProperty(MuleProperties.MULE_EVENT_PROPERTY);
  String uri=msgContext.getStrProp(MessageContext.TRANS_URL);
  UMOEndpoint endpoint=null;
  try {
    endpoint=lookupEndpoint(uri);
  }
 catch (  UMOException e) {
    if (event != null) {
      event.getEndpoint().getConnector().handleException(e);
    }
 else {
      logger.error("Failed to dispatch soap event from Axis Universal transport: " + e.toString(),e);
    }
    return;
  }
  try {
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    msgContext.getRequestMessage().writeTo(baos);
    Map props=new HashMap();
    for (Iterator iterator=msgContext.getPropertyNames(); iterator.hasNext(); ) {
      String name=(String)iterator.next();
      if (!name.equals("call_object") && !name.equals("wsdl.service")) {
        props.put(name,msgContext.getProperty(name));
      }
    }
    props.put("SOAPAction",uri);
    UMOSession session=new MuleSession();
    UMOEvent dispatchEvent=new MuleEvent(new MuleMessage(baos.toByteArray(),props),endpoint,session,sync);
    logger.info("Making Axis soap request on: " + uri);
    if (logger.isDebugEnabled()) {
      logger.debug("Soap request is:\n" + baos.toString());
    }
    if (sync) {
      dispatchEvent.getEndpoint().setRemoteSync(true);
      UMOMessage result=session.sendEvent(dispatchEvent);
      if (result != null) {
        byte[] response=result.getPayloadAsBytes();
        Message responseMessage=new Message(response);
        msgContext.setResponseMessage(responseMessage);
      }
 else {
        logger.warn("No response message was returned from synchronous call to: " + uri);
      }
    }
 else {
      dispatchEvent.getSession().dispatchEvent(dispatchEvent);
    }
  }
 catch (  Exception e) {
    logger.error("Failed to dispatch soap event from Axis Universal transport: " + e.toString());
    if (event != null) {
      event.getEndpoint().getConnector().handleException(e);
    }
 else {
      endpoint.getConnector().handleException(e);
    }
  }
}
