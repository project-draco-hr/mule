{
  MuleClient muleClient=new MuleClient(muleContext);
  DispatchParameters p=new DispatchParameters(INBOUND_ENDPOINT_NAME,OUTBOUND_ENDPOINT_NAME);
  p.setSftpConnector("sftpCustomConnector");
  dispatchAndWaitForDelivery(p);
  SftpClient sftpClientInbound=getSftpClient(muleClient,INBOUND_ENDPOINT_NAME);
  ImmutableEndpoint endpointInbound=(ImmutableEndpoint)muleClient.getProperty(INBOUND_ENDPOINT_NAME);
  try {
    assertFalse("The temp directory should not have been created",tempDirectoryExists(sftpClientInbound,muleClient,INBOUND_ENDPOINT_NAME));
    assertFalse("The file should not exist in the source directory",super.verifyFileExists(sftpClientInbound,endpointInbound.getEndpointURI(),FILE_NAME));
  }
  finally {
    sftpClientInbound.disconnect();
  }
  SftpClient sftpClientOutbound=getSftpClient(muleClient,OUTBOUND_ENDPOINT_NAME);
  ImmutableEndpoint endpointOutbound=(ImmutableEndpoint)muleClient.getProperty(OUTBOUND_ENDPOINT_NAME);
  try {
    assertTrue("The temp directory should have been created",tempDirectoryExists(sftpClientOutbound,muleClient,OUTBOUND_ENDPOINT_NAME));
    assertTrue("The file should exist in the final destination",super.verifyFileExists(sftpClientOutbound,endpointOutbound.getEndpointURI(),FILE_NAME));
  }
  finally {
    sftpClientOutbound.disconnect();
  }
}
