{
  DispatchParameters p=new DispatchParameters(INBOUND_ENDPOINT_NAME,OUTBOUND_ENDPOINT_NAME);
  p.setSftpConnector("sftpCustomConnector");
  dispatchAndWaitForDelivery(p);
  SftpClient sftpClientInbound=getSftpClient(INBOUND_ENDPOINT_NAME);
  ImmutableEndpoint endpointInbound=muleContext.getRegistry().lookupObject(INBOUND_ENDPOINT_NAME);
  try {
    assertFalse("The temp directory should not have been created",tempDirectoryExists(sftpClientInbound,INBOUND_ENDPOINT_NAME));
    assertFalse("The file should not exist in the source directory",super.verifyFileExists(sftpClientInbound,endpointInbound.getEndpointURI(),FILENAME));
  }
  finally {
    sftpClientInbound.disconnect();
  }
  SftpClient sftpClientOutbound=getSftpClient(OUTBOUND_ENDPOINT_NAME);
  ImmutableEndpoint endpointOutbound=muleContext.getRegistry().lookupObject(OUTBOUND_ENDPOINT_NAME);
  try {
    assertTrue("The temp directory should have been created",tempDirectoryExists(sftpClientOutbound,OUTBOUND_ENDPOINT_NAME));
    assertTrue("The file should exist in the final destination",super.verifyFileExists(sftpClientOutbound,endpointOutbound.getEndpointURI(),FILENAME));
  }
  finally {
    sftpClientOutbound.disconnect();
  }
}
