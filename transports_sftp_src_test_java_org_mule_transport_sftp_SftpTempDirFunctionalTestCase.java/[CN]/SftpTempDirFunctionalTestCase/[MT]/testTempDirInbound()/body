{
  MuleClient muleClient=new MuleClient(muleContext);
  DispatchParameters p=new DispatchParameters(INBOUND_ENDPOINT_NAME2,OUTBOUND_ENDPOINT_NAME2);
  p.setSftpConnector("sftpCustomConnectorTempDirInbound");
  dispatchAndWaitForDelivery(p);
  SftpClient sftpClientInbound=getSftpClient(muleClient,INBOUND_ENDPOINT_NAME2);
  ImmutableEndpoint endpointInbound=(ImmutableEndpoint)muleClient.getProperty(INBOUND_ENDPOINT_NAME2);
  try {
    assertTrue("The temp directory should have been created",tempDirectoryExists(sftpClientInbound,muleClient,INBOUND_ENDPOINT_NAME2));
    assertFalse("No file should exist in the temp directory",super.verifyFileExists(sftpClientInbound,endpointInbound.getEndpointURI().getPath() + "/uploading",FILE_NAME));
    assertFalse("The file should not exist in the source directory",super.verifyFileExists(sftpClientInbound,endpointInbound.getEndpointURI(),FILE_NAME));
  }
  finally {
    sftpClientInbound.disconnect();
  }
  SftpClient sftpClientOutbound=getSftpClient(muleClient,OUTBOUND_ENDPOINT_NAME2);
  ImmutableEndpoint endpointOutbound=(ImmutableEndpoint)muleClient.getProperty(OUTBOUND_ENDPOINT_NAME2);
  try {
    assertFalse("The temp directory should not have been created",tempDirectoryExists(sftpClientOutbound,muleClient,OUTBOUND_ENDPOINT_NAME2));
    assertTrue("The file should exist in the final destination : " + FILE_NAME,super.verifyFileExists(sftpClientOutbound,endpointOutbound.getEndpointURI(),FILE_NAME));
  }
  finally {
    sftpClientOutbound.disconnect();
  }
}
