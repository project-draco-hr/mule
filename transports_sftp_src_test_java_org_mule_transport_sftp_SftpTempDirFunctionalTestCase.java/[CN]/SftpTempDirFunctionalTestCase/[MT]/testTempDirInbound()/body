{
  DispatchParameters p=new DispatchParameters(INBOUND_ENDPOINT_NAME2,OUTBOUND_ENDPOINT_NAME2);
  p.setSftpConnector("sftpCustomConnectorTempDirInbound");
  dispatchAndWaitForDelivery(p);
  SftpClient sftpClientInbound=getSftpClient(INBOUND_ENDPOINT_NAME2);
  ImmutableEndpoint endpointInbound=(ImmutableEndpoint)muleContext.getRegistry().lookupObject(INBOUND_ENDPOINT_NAME2);
  try {
    assertTrue("The temp directory should have been created",tempDirectoryExists(sftpClientInbound,INBOUND_ENDPOINT_NAME2));
    assertFalse("No file should exist in the temp directory",super.verifyFileExists(sftpClientInbound,endpointInbound.getEndpointURI().getPath() + "/uploading",FILENAME));
    assertFalse("The file should not exist in the source directory",super.verifyFileExists(sftpClientInbound,endpointInbound.getEndpointURI(),FILENAME));
  }
  finally {
    sftpClientInbound.disconnect();
  }
  SftpClient sftpClientOutbound=getSftpClient(OUTBOUND_ENDPOINT_NAME2);
  ImmutableEndpoint endpointOutbound=muleContext.getRegistry().lookupObject(OUTBOUND_ENDPOINT_NAME2);
  try {
    assertFalse("The temp directory should not have been created",tempDirectoryExists(sftpClientOutbound,OUTBOUND_ENDPOINT_NAME2));
    assertTrue("The file should exist in the final destination : " + FILENAME,super.verifyFileExists(sftpClientOutbound,endpointOutbound.getEndpointURI(),FILENAME));
  }
  finally {
    sftpClientOutbound.disconnect();
  }
}
