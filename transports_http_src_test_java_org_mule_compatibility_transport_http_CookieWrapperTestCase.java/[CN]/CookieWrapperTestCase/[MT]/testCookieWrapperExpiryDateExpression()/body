{
  Date now=new Date();
  cookieWrapper.setName("test");
  cookieWrapper.setValue("test");
  cookieWrapper.setExpiryDate("#[expiryDate]");
  when(mockExpressionManager.isExpression("#[expiryDate]")).thenReturn(true);
  TypedValue typedValue=mock(TypedValue.class);
  when(typedValue.getValue()).thenReturn(now);
  when(mockExpressionManager.evaluate("#[expiryDate]",mockMuleEvent)).thenReturn(typedValue);
  mockParse();
  cookieWrapper.parse(mockMuleEvent,mockExpressionManager);
  Cookie cookie=cookieWrapper.createCookie();
  Date expiryDate=cookie.getExpiryDate();
  assertEquals(0,now.compareTo(expiryDate));
}
