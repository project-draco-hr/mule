{
  final MuleMessage attachmentPart=MuleMessage.builder().payload("this is the attachment").mediaType(MediaType.TEXT).attributes(new PartAttributes("attachment")).build();
  MuleMessage message=MuleMessage.builder().payload(new DefaultMultiPartPayload(MuleMessage.builder().payload(TEST_PAYLOAD).attributes(BODY_ATTRIBUTES).build(),attachmentPart)).build();
  Flow flow=getTestFlow();
  final MuleMessage response=(MuleMessage)mp2a.transform(message,new DefaultMuleEvent(create(flow),message,flow));
  assertThat(response.getOutboundAttachmentNames(),hasSize(1));
  assertThat(response.getOutboundAttachmentNames(),hasItem("attachment"));
  assertThat(response.getPayload(),equalTo(TEST_PAYLOAD));
}
