{
  final InternalMessage attachmentPart=InternalMessage.builder().payload("this is the attachment").mediaType(MediaType.TEXT).attributes(new PartAttributes("attachment")).build();
  InternalMessage message=InternalMessage.builder().payload(new DefaultMultiPartContent(InternalMessage.builder().payload(TEST_PAYLOAD).attributes(BODY_ATTRIBUTES).build(),attachmentPart)).build();
  final InternalMessage response=(InternalMessage)mp2a.transform(message,Event.builder(context).message(message).flow(flow).build());
  assertThat(response.getOutboundAttachmentNames(),hasSize(1));
  assertThat(response.getOutboundAttachmentNames(),hasItem("attachment"));
  assertThat(response.getPayload().getValue(),equalTo(TEST_PAYLOAD));
}
