{
  final MuleMessage attachment1Part=MuleMessage.builder().payload("this is the attachment1").mediaType(MediaType.TEXT).attributes(new PartAttributes("attachment1")).build();
  final MuleMessage attachment2Part=MuleMessage.builder().payload("this is the attachment2").mediaType(MediaType.TEXT).attributes(new PartAttributes("attachment2")).build();
  MuleMessage message=MuleMessage.builder().payload(new DefaultMultiPartPayload(attachment1Part,attachment2Part)).build();
  Flow flow=getTestFlow();
  final MuleMessage response=(MuleMessage)mp2a.transform(message,new DefaultMuleEvent(create(flow),message,flow));
  assertThat(response.getOutboundAttachmentNames(),hasSize(2));
  assertThat(response.getOutboundAttachmentNames(),hasItem("attachment1"));
  assertThat(response.getOutboundAttachmentNames(),hasItem("attachment2"));
  assertThat(response.getPayload(),nullValue());
}
