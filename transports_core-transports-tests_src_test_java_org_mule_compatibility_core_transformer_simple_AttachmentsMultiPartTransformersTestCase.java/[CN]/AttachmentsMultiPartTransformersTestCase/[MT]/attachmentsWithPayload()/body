{
  final DataHandler attDH=mock(DataHandler.class);
  when(attDH.getContentType()).thenReturn(MediaType.TEXT.toRfcString());
  final InternalMessage message=InternalMessage.builder().payload(TEST_PAYLOAD).addInboundAttachment("attachment",attDH).build();
  final InternalMessage response=(InternalMessage)a2mp.transform(message,Event.builder(context).message(message).flow(flow).build());
  assertThat(response.getPayload().getValue(),instanceOf(MultiPartPayload.class));
  assertThat(((MultiPartPayload)response.getPayload().getValue()).getParts(),hasSize(2));
  assertThat(((DefaultMultiPartPayload)response.getPayload().getValue()).hasBodyPart(),is(true));
  assertThat(((MultiPartPayload)response.getPayload().getValue()).getPartNames(),hasItem("attachment"));
}
