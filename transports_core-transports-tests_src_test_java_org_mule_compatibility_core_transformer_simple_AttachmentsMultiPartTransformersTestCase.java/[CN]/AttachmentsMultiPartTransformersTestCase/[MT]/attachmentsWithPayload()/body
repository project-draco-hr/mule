{
  final DataHandler attDH=mock(DataHandler.class);
  when(attDH.getContentType()).thenReturn(MediaType.TEXT.toRfcString());
  final MuleMessage message=MuleMessage.builder().payload(TEST_PAYLOAD).addInboundAttachment("attachment",attDH).build();
  final MuleMessage response=(MuleMessage)a2mp.transform(message,new DefaultMuleEvent(context,message,flow));
  assertThat(response.getPayload(),instanceOf(MultiPartPayload.class));
  assertThat(((MultiPartPayload)response.getPayload()).getParts(),hasSize(2));
  assertThat(((DefaultMultiPartPayload)response.getPayload()).hasBodyPart(),is(true));
  assertThat(((MultiPartPayload)response.getPayload()).getPartNames(),hasItem("attachment"));
}
