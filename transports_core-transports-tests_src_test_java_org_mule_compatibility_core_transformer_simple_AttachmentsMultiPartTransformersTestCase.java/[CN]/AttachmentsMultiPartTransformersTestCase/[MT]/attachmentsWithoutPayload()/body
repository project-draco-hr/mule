{
  final DataHandler attDH=mock(DataHandler.class);
  when(attDH.getContentType()).thenReturn(MediaType.TEXT.toRfcString());
  final InternalMessage message=InternalMessage.builder().nullPayload().addInboundAttachment("attachment",attDH).build();
  final InternalMessage response=(InternalMessage)a2mp.transform(message,Event.builder(context).message(message).flow(flow).build());
  assertThat(response.getPayload().getValue(),instanceOf(MultiPartContent.class));
  assertThat(((MultiPartContent)response.getPayload().getValue()).getParts(),hasSize(1));
  assertThat(((DefaultMultiPartContent)response.getPayload().getValue()).hasBodyPart(),is(false));
  assertThat(((MultiPartContent)response.getPayload().getValue()).getPartNames(),hasItem("attachment"));
}
