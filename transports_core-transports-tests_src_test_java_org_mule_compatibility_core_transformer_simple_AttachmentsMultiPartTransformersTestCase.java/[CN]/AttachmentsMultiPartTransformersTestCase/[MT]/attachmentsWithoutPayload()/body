{
  final DataHandler attDH=mock(DataHandler.class);
  when(attDH.getContentType()).thenReturn(MediaType.TEXT.toRfcString());
  final MuleMessage message=MuleMessage.builder().nullPayload().addInboundAttachment("attachment",attDH).build();
  Flow flow=getTestFlow();
  final MuleMessage response=(MuleMessage)a2mp.transform(message,new DefaultMuleEvent(create(flow),message,flow));
  assertThat(response.getPayload(),instanceOf(MultiPartPayload.class));
  assertThat(((MultiPartPayload)response.getPayload()).getParts(),hasSize(1));
  assertThat(((DefaultMultiPartPayload)response.getPayload()).hasBodyPart(),is(false));
  assertThat(((MultiPartPayload)response.getPayload()).getPartNames(),hasItem("attachment"));
}
