{
  File pluginDir=getAppPluginsFolder(APP_NAME);
  pluginDir.mkdirs();
  final File pluginFile=new ApplicationPluginFileBuilder("plugin").usingLibrary("lib/echo-test.jar").getArtifactFile();
  copyFile(pluginFile,new File(pluginDir,"plugin1.zip"));
  copyFile(pluginFile,new File(pluginDir,"plugin2.zip"));
  final ApplicationPluginDescriptorFactory pluginDescriptorFactory=mock(ApplicationPluginDescriptorFactory.class);
  final ApplicationDescriptorFactory applicationDescriptorFactory=new ApplicationDescriptorFactory(pluginDescriptorFactory);
  final ApplicationPluginDescriptor expectedPluginDescriptor1=mock(ApplicationPluginDescriptor.class);
  final ApplicationPluginDescriptor expectedPluginDescriptor2=mock(ApplicationPluginDescriptor.class);
  when(pluginDescriptorFactory.create(any())).thenReturn(expectedPluginDescriptor1).thenReturn(expectedPluginDescriptor2);
  ApplicationDescriptor desc=applicationDescriptorFactory.create(getAppFolder(APP_NAME));
  Set<ApplicationPluginDescriptor> plugins=desc.getPlugins();
  assertThat(plugins.size(),equalTo(2));
  assertThat(plugins,hasItem(equalTo(expectedPluginDescriptor1)));
  assertThat(plugins,hasItem(equalTo(expectedPluginDescriptor2)));
}
