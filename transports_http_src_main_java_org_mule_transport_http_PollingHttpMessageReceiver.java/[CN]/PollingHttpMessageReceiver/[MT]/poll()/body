{
  MuleContext muleContext=connector.getMuleContext();
  MuleMessage request=new DefaultMuleMessage("",muleContext);
  if (etag != null && checkEtag) {
    Map<String,String> customHeaders=Collections.singletonMap(HttpConstants.HEADER_IF_NONE_MATCH,etag);
    request.setProperty(HttpConnector.HTTP_CUSTOM_HEADERS_MAP_PROPERTY,customHeaders);
  }
  request.setOutboundProperty(HttpConnector.HTTP_METHOD_PROPERTY,"GET");
  MuleSession session=new DefaultMuleSession((Service)flowConstruct,connector.getMuleContext());
  if (outboundEndpoint == null) {
    EndpointBuilder endpointBuilder=new EndpointURIEndpointBuilder(endpoint);
    endpointBuilder.setTransformers(Collections.<Transformer>emptyList());
    endpointBuilder.setResponseTransformers(Collections.<Transformer>emptyList());
    endpointBuilder.setExchangePattern(MessageExchangePattern.REQUEST_RESPONSE);
    outboundEndpoint=muleContext.getRegistry().lookupEndpointFactory().getOutboundEndpoint(endpointBuilder);
  }
  MuleEvent event=new DefaultMuleEvent(request,outboundEndpoint,session);
  MuleEvent result=outboundEndpoint.process(event);
  MuleMessage message=null;
  if (result != null) {
    message=result.getMessage();
  }
  if (message.getIntProperty(HttpConstants.HEADER_CONTENT_LENGTH,-1) == 0 && discardEmptyContent) {
    if (logger.isDebugEnabled()) {
      logger.debug("Received empty message and ignoring from: " + endpoint.getEndpointURI());
    }
    return;
  }
  int status=message.getIntProperty(HttpConnector.HTTP_STATUS_PROPERTY,0);
  etag=message.getStringProperty(HttpConstants.HEADER_ETAG,null);
  if ((status != HttpConstants.SC_NOT_MODIFIED || !checkEtag)) {
    routeMessage(message);
  }
}
