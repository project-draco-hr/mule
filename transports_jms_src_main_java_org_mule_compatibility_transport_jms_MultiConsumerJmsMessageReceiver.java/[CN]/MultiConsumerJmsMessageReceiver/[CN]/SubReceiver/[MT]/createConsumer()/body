{
  subLogger.debug("SUB createConsumer()");
  boolean sessionCreated=false;
  try {
    JmsSupport jmsSupport=jmsConnector.getJmsSupport();
    boolean topic=jmsConnector.getTopicResolver().isTopic(endpoint,true);
    if (session == null) {
      sessionCreated=true;
      session=jmsConnector.getSession(endpoint);
    }
    Destination dest=jmsSupport.createDestination(session,endpoint);
    String selector=null;
    JmsSelectorFilter selectorFilter=jmsConnector.getSelector(endpoint);
    if (selectorFilter != null) {
      selector=selectorFilter.getExpression();
    }
 else {
      if (endpoint.getProperties() != null) {
        selector=(String)endpoint.getProperties().get(JmsConstants.JMS_SELECTOR_PROPERTY);
      }
    }
    String tempDurable=(String)endpoint.getProperties().get(JmsConstants.DURABLE_PROPERTY);
    boolean durable=jmsConnector.isDurable();
    if (tempDurable != null) {
      durable=Boolean.valueOf(tempDurable);
    }
    String durableName=(String)endpoint.getProperties().get(JmsConstants.DURABLE_NAME_PROPERTY);
    if (durableName == null && durable && topic) {
      durableName="mule." + jmsConnector.getName() + "."+ endpoint.getEndpointURI().getAddress();
      logger.debug("Jms Connector for this receiver is durable but no durable name has been specified. Defaulting to: " + durableName);
    }
    try {
      consumer=jmsSupport.createConsumer(session,dest,selector,jmsConnector.isNoLocal(),durableName,topic,endpoint);
    }
 catch (    Exception e) {
      if (sessionCreated) {
        jmsConnector.closeQuietly(session);
      }
      throw e;
    }
  }
 catch (  JMSException e) {
    throw new EndpointConnectException(e,MultiConsumerJmsMessageReceiver.this);
  }
}
