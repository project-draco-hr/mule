{
  DefaultMuleContext context=(DefaultMuleContext)new DefaultMuleContextFactory().createMuleContext();
  context.getRegistry().registerObject("Test Transaction Manager Factory",new TestTransactionManagerFactory());
  assertThat(context.getRegistry().lookupObject(MuleProperties.OBJECT_TRANSACTION_MANAGER),is(IsNull.nullValue()));
  TransactionManager transactionManager=context.getTransactionManager();
  assertThat(transactionManager,not(is(IsNull.nullValue())));
  assertThat((TransactionManager)context.getRegistry().lookupObject(MuleProperties.OBJECT_TRANSACTION_MANAGER),is(CoreMatchers.sameInstance(transactionManager)));
}
