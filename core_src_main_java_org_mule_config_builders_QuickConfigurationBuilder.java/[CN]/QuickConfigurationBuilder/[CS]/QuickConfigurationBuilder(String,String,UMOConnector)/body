{
  if (RegistryContext.getRegistry() == null) {
    TransientRegistry registry=TransientRegistry.createNew();
    RegistryContext.setRegistry(registry);
  }
  managementContext=RegistryContext.getRegistry().getManagementContext();
  if (serverConnector != null) {
    managementContext.getRegistry().registerConnector(serverConnector);
  }
  if (!StringUtils.isBlank(serverUrl)) {
    MuleAdminAgent agent=new MuleAdminAgent();
    agent.setServerUri(serverUrl);
    agent.setName("Mule Admin Agent");
    managementContext.getRegistry().registerAgent(agent);
  }
  String defaultModelName=UMOModel.DEFAULT_MODEL_NAME + "-qbuilder";
  if (managementContext.getRegistry().lookupModel(defaultModelName) == null) {
    if (!MODEL_NOT_SET.equals(modeltype)) {
      model=ModelFactory.createModel(modeltype);
    }
 else {
      model=ModelFactory.createModel("seda");
    }
    model.setName(defaultModelName);
    managementContext.getRegistry().registerModel(model);
  }
  managementContext.getRegistry().initialise();
}
