{
  Object impl=descriptor.getImplementation();
  Object component;
  if (impl instanceof String) {
    impl=new ContainerKeyPair(null,impl);
  }
  if (impl instanceof ContainerKeyPair) {
    component=descriptor.getManagementContext().getRegistry().lookupObject(((ContainerKeyPair)impl).getKey(),Object.class);
    if (descriptor.isSingleton()) {
      descriptor.setImplementation(component);
    }
  }
 else {
    component=impl;
  }
  try {
    BeanUtils.populate(component,descriptor.getProperties());
  }
 catch (  Exception e) {
    throw new InitialisationException(new Message(Messages.FAILED_TO_SET_PROPERTIES_ON_X,"Component '" + descriptor.getName() + "'"),e,descriptor);
  }
  if (descriptor instanceof MuleDescriptor) {
    ((MuleDescriptor)descriptor).fireInitialisationCallbacks(component);
  }
  return component;
}
