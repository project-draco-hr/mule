{
  if (payload instanceof Packet) {
    packet=(Packet)payload;
    for (    String name : packet.getPropertyNames()) {
      this.setProperty(name,packet.getProperty(name));
    }
    if (packet instanceof Message) {
      Message msg=(Message)packet;
      this.setProperty("subject",StringUtils.defaultIfEmpty(msg.getSubject(),DEFAULT_SUBJECT));
      this.setProperty("thread",StringUtils.defaultIfEmpty(msg.getThread(),DEFAULT_THREAD));
    }
  }
 else {
    throw new MessageTypeNotSupportedException(payload,getClass());
  }
}
