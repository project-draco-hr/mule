{
  CxfMessageReceiver cxfReceiver=(CxfMessageReceiver)receiver;
  Server server=cxfReceiver.getServer();
  uriToServer.put(server.getEndpoint().getEndpointInfo().getAddress(),server);
  SedaService c=new SedaService();
  c.setName(CXF_SERVICE_COMPONENT_NAME + server.getEndpoint().getService().getName() + c.hashCode());
  c.setModel(muleContext.getRegistry().lookupSystemModel());
  CxfServiceComponent svcComponent=new CxfServiceComponent(this,(CxfMessageReceiver)receiver);
  svcComponent.setBus(bus);
  c.setComponent(new DefaultJavaComponent(new SingletonObjectFactory(svcComponent)));
  String endpoint=receiver.getEndpointURI().getAddress();
  String scheme=ep.getScheme().toLowerCase();
  InboundEndpoint originalEndpoint=receiver.getEndpoint();
  boolean sync=originalEndpoint.isSynchronous();
  if (scheme.equals("http") || scheme.equals("https") || scheme.equals("ssl")|| scheme.equals("tcp")|| scheme.equals("servlet")) {
    originalEndpoint.getProperties().put(HttpConnector.HTTP_METHOD_PROPERTY,"POST");
    originalEndpoint.getProperties().put(HttpConstants.HEADER_CONTENT_TYPE,"text/xml");
  }
  QName serviceName=server.getEndpoint().getEndpointInfo().getName();
  EndpointBuilder protocolEndpointBuilder=new EndpointURIEndpointBuilder(endpoint,muleContext);
  protocolEndpointBuilder.setSynchronous(sync);
  protocolEndpointBuilder.setName(ep.getScheme() + ":" + serviceName.getLocalPart());
  EndpointBuilder receiverEndpointBuilder=new EndpointURIEndpointBuilder(originalEndpoint,muleContext);
  EndpointBuilder transformerEndpoint;
  if (cxfReceiver.isApplyTransformersToProtocol()) {
    transformerEndpoint=protocolEndpointBuilder;
    receiverEndpointBuilder.setTransformers(null);
    receiverEndpointBuilder.setResponseTransformers(null);
  }
 else {
    transformerEndpoint=receiverEndpointBuilder;
  }
  transformerEndpoint.setTransformers(originalEndpoint.getTransformers());
  transformerEndpoint.setResponseTransformers(originalEndpoint.getResponseTransformers());
  EndpointBuilder filterEndpoint;
  if (cxfReceiver.isApplyFiltersToProtocol()) {
    filterEndpoint=protocolEndpointBuilder;
    receiverEndpointBuilder.setFilter(null);
  }
 else {
    filterEndpoint=receiverEndpointBuilder;
  }
  filterEndpoint.setFilter(originalEndpoint.getFilter());
  EndpointBuilder secFilterEndpoint;
  if (cxfReceiver.isApplySecurityToProtocol()) {
    secFilterEndpoint=protocolEndpointBuilder;
    receiverEndpointBuilder.setSecurityFilter(null);
  }
 else {
    secFilterEndpoint=receiverEndpointBuilder;
  }
  secFilterEndpoint.setSecurityFilter(originalEndpoint.getSecurityFilter());
  InboundEndpoint protocolEndpoint=muleContext.getRegistry().lookupEndpointFactory().getInboundEndpoint(protocolEndpointBuilder);
  InboundEndpoint receiverEndpoint=muleContext.getRegistry().lookupEndpointFactory().getInboundEndpoint(receiverEndpointBuilder);
  receiver.setEndpoint(receiverEndpoint);
  c.setInboundRouter(new DefaultInboundRouterCollection());
  c.getInboundRouter().addEndpoint(protocolEndpoint);
  services.add(c);
}
