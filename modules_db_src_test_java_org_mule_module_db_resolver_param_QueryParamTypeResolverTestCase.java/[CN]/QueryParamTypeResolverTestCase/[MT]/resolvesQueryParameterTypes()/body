{
  final String sqlText="select * from test where id = ?";
  ParameterMetaData parameterMetaData=new ParameterMetaDataBuilder().withParameter(1,DbTypes.INTEGER_DB_TYPE).build();
  PreparedStatement preparedStatement=mock(PreparedStatement.class);
  when(preparedStatement.getParameterMetaData()).thenReturn(parameterMetaData);
  DbConnection connection=new DbConnectionBuilder().preparing(sqlText,preparedStatement).build();
  QueryTemplate queryTemplate=new QueryTemplate(sqlText,QueryType.SELECT,Collections.<org.mule.module.db.domain.param.QueryParam>singletonList(new DefaultInputQueryParam(1,UnknownDbType.getInstance(),"7","param1")));
  DbTypeManager dbTypeManager=new DbTypeManagerBuilder().on(connection).managing(DbTypes.INTEGER_DB_TYPE).build();
  QueryParamTypeResolver paramTypeResolver=new QueryParamTypeResolver(dbTypeManager);
  Map<Integer,DbType> parameterTypes=paramTypeResolver.getParameterTypes(connection,queryTemplate);
  assertThat(parameterTypes.size(),equalTo(1));
  assertThat(parameterTypes.get(1),equalTo(DbTypes.INTEGER_DB_TYPE));
}
