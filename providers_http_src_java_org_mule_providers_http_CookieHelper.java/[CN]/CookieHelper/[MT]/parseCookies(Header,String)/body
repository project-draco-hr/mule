{
  List cookies=new ArrayList();
  CookieSpec cookieSpec=getCookieSpec(spec);
  HeaderElement[] headerElements=header.getElements();
  for (int j=0; j < headerElements.length; j++) {
    HeaderElement headerElement=headerElements[j];
    NameValuePair[] headerElementParameters=headerElement.getParameters();
    Cookie cookie=new Cookie();
    for (int k=0; k < headerElementParameters.length; k++) {
      NameValuePair nameValuePair=headerElementParameters[k];
      cookieSpec.parseAttribute(nameValuePair,cookie);
    }
    if (cookie.isExpired()) {
      if (logger.isDebugEnabled()) {
        logger.debug("Cookie: " + cookie.toString() + " has expired, not adding it.");
      }
    }
 else {
      cookies.add(cookie);
    }
  }
  return (Cookie[])cookies.toArray(new Cookie[cookies.size()]);
}
