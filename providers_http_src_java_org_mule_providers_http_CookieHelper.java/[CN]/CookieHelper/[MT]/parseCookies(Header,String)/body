{
  CookieSpec cookieSpec=getCookieSpec(spec);
  List cookies=new ArrayList();
  Cookie cookie=null;
  HeaderElement headerElement=null;
  NameValuePair nameValuePair=null;
  for (int j=0; j < header.getElements().length; j++) {
    cookie=new Cookie();
    headerElement=header.getElements()[j];
    for (int k=0; k < headerElement.getParameters().length; k++) {
      nameValuePair=headerElement.getParameters()[k];
      cookieSpec.parseAttribute(nameValuePair,cookie);
    }
    if (cookie.isExpired()) {
      if (logger.isDebugEnabled()) {
        logger.debug("Cookie: " + cookie.toString() + " has expired removing it");
      }
    }
 else {
      cookies.add(cookie);
    }
  }
  return (Cookie[])cookies.toArray(new Cookie[cookies.size()]);
}
