{
  String value=(String)message.get(Message.ENDPOINT_ADDRESS);
  String pathInfo=(String)message.get(Message.PATH_INFO);
  String queryString=(String)message.get(Message.QUERY_STRING);
  String result=value != null ? value : getTargetOrEndpoint();
  if (null != pathInfo && !result.endsWith(pathInfo)) {
    result=result + pathInfo;
  }
  if (queryString != null) {
    result=result + "?" + queryString;
  }
  return result;
}
