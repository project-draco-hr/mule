{
  final CountDownLatch countDown=new CountDownLatch(2);
  EventCallback callback=new EventCallback(){
    public void eventReceived(    MuleEventContext context,    Object component) throws Exception {
      int index=(int)countDown.getCount() - 1;
      assertEquals(context.getMessage().getProperty(FileConnector.PROPERTY_ORIGINAL_FILENAME),FILE_NAMES[index]);
      countDown.countDown();
    }
  }
;
  ((FunctionalTestComponent)muleContext.getRegistry().lookupService(COMPONENT_NAME).getComponentFactory().getInstance()).setEventCallback(callback);
  muleContext.getRegistry().lookupConnector(FILE_CONNECTOR_NAME).stop();
  File f1=FileUtils.newFile(PATH + FILE_NAMES[0]);
  assertTrue(f1.createNewFile());
  Thread.sleep(1000);
  File f2=FileUtils.newFile(PATH + FILE_NAMES[1]);
  assertTrue(f2.createNewFile());
  Thread.sleep(1000);
  muleContext.getRegistry().lookupConnector(FILE_CONNECTOR_NAME).start();
  assertTrue(countDown.await(TIMEOUT,TimeUnit.MILLISECONDS));
}
