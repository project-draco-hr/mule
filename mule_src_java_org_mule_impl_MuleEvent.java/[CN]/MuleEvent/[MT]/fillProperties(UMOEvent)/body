{
  if (previousEvent != null && previousEvent.getProperties() != null) {
    properties=previousEvent.getProperties();
  }
 else {
    properties=new HashMap();
  }
  if (endpoint != null && endpoint.getProperties() != null) {
    properties.putAll(endpoint.getProperties());
    if (endpoint.getEndpointURI().getParams() != null) {
      properties.putAll(endpoint.getEndpointURI().getParams());
    }
  }
  properties.putAll(message.getProperties());
  setCredentials();
}
