{
  final Latch latch=new Latch();
  OrderManagerBean subscriptionBean=(OrderManagerBean)muleContext.getRegistry().lookupObject("orderManagerBean");
  assertNotNull(subscriptionBean);
  EventCallback callback=new EventCallback(){
    public void eventReceived(    MuleEventContext context,    Object o) throws Exception {
      eventCount.incrementAndGet();
      latch.release();
    }
  }
;
  subscriptionBean.setEventCallback(callback);
  MuleClient client=new MuleClient(muleContext);
  Order order=new Order("Sausage and Mash");
  client.send("jms://orders.queue",order,null);
  assertTrue(latch.await(RECEIVE_TIMEOUT,TimeUnit.MILLISECONDS));
  MuleMessage result=client.request("jms://processed.queue",10000);
  assertEquals(1,eventCount.get());
  assertNotNull(result);
  assertEquals("Order 'Sausage and Mash' Processed",result.getPayloadAsString());
}
