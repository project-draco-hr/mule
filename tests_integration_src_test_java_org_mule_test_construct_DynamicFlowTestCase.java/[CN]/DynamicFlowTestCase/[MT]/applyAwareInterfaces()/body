{
  Flow flow=getFlow("dynamicFlow");
  UberAwareMessageProcessor awareMessageProcessor=new UberAwareMessageProcessor();
  flow.dynamicPipeline(null).injectBefore(awareMessageProcessor).resetAndUpdate();
  final MuleEvent muleEvent=runFlow("dynamicFlow","source->");
  MuleMessage result=muleEvent.getMessage();
  assertEquals("source->(pre)(static)",getPayloadAsString(result));
  assertNotNull(awareMessageProcessor.getFlowConstruct());
  assertNotNull(awareMessageProcessor.getMuleContext());
}
