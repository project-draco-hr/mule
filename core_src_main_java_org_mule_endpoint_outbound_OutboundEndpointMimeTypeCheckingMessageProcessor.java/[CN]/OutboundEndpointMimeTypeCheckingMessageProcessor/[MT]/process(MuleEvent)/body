{
  String endpointMimeType=endpoint.getMimeType();
  if (endpointMimeType != null) {
    MuleMessage message=event.getMessage();
    String contentType=message.getProperty(MuleProperties.CONTENT_TYPE_PROPERTY,PropertyScope.OUTBOUND);
    if (contentType == null) {
      message.setProperty(MuleProperties.CONTENT_TYPE_PROPERTY,endpointMimeType,PropertyScope.OUTBOUND);
    }
 else {
      try {
        MimeType mt=new MimeType(contentType);
        String messageMimeType=mt.getPrimaryType() + "/" + mt.getSubType();
        if (!messageMimeType.equals(endpointMimeType)) {
          throw new MessagingException(CoreMessages.unexpectedMIMEType(messageMimeType,endpointMimeType),event.getMessage());
        }
      }
 catch (      MimeTypeParseException ex) {
        throw new MessagingException(CoreMessages.illegalMIMEType(contentType),event.getMessage(),ex);
      }
    }
  }
  return event;
}
