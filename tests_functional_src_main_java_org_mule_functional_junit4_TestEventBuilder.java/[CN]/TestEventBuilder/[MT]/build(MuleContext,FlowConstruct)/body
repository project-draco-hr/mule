{
  final Builder messageBuilder;
  if (payload instanceof MuleMessage) {
    messageBuilder=MuleMessage.builder((MuleMessage)payload);
  }
 else {
    messageBuilder=MuleMessage.builder().payload(payload);
  }
  messageBuilder.mediaType(mediaType).inboundProperties(inboundProperties).outboundProperties(outboundProperties).inboundAttachments(inboundAttachments);
  if (attributes != null) {
    messageBuilder.attributes(attributes);
  }
  final MuleMessage muleMessage=messageBuilder.build();
  DefaultMuleEvent event=new DefaultMuleEvent(create(flow,sourceCorrelationId),(MuleMessage)spyTransformer.transform(muleMessage),URI.create("none"),"none",exchangePattern,flow,new DefaultMuleSession(),muleContext.getConfiguration().getDefaultResponseTimeout(),null,null,transacted,null,replyToHandler);
  for (  Entry<String,Attachment> outboundAttachmentEntry : outboundAttachments.entrySet()) {
    outboundAttachmentEntry.getValue().addOutboundTo(event,outboundAttachmentEntry.getKey());
  }
  for (  Entry<String,Object> sessionPropertyEntry : sessionProperties.entrySet()) {
    event.getSession().setProperty(sessionPropertyEntry.getKey(),sessionPropertyEntry.getValue());
  }
  for (  Entry<String,Object> flowVarEntry : flowVariables.entrySet()) {
    event.setFlowVariable(flowVarEntry.getKey(),flowVarEntry.getValue());
  }
  return (MuleEvent)spyTransformer.transform(event);
}
