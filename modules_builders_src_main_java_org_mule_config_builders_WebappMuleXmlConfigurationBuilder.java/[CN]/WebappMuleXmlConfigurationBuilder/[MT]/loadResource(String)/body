{
  String resourcePath=resource;
  InputStream is=null;
  if (webappClasspath != null) {
    resourcePath=new File(webappClasspath,resource).getPath();
    is=context.getResourceAsStream(resourcePath);
  }
  if (is == null) {
    is=Thread.currentThread().getContextClassLoader().getResourceAsStream(resource);
  }
  if (logger.isDebugEnabled()) {
    if (is != null) {
      logger.debug("Resource " + resource + " is found in Servlet Context.");
    }
 else {
      logger.debug("Resource " + resourcePath + " is not found in Servlet Context, loading from classpath or as external file");
    }
  }
  if (is == null && webappClasspath != null) {
    resourcePath=FileUtils.newFile(webappClasspath,resource).getPath();
    try {
      is=IOUtils.getResourceAsStream(resourcePath,getClass());
    }
 catch (    IOException ex) {
      logger.debug("Resource " + resourcePath + " is not found in filesystem "+ ex);
    }
  }
  if (is == null) {
    try {
      logger.debug("Resource " + resourcePath + " not found in Servlet Context, loading from classpath");
      is=IOUtils.getResourceAsStream(resource,getClass());
    }
 catch (    IOException ioex) {
      throw new ConfigurationException(CoreMessages.cannotLoadFromClasspath(resource),ioex);
    }
  }
  return is;
}
