{
  TestSecurityNotificationListener securityNotificationListener=new TestSecurityNotificationListener();
  muleContext.registerListener(securityNotificationListener);
  receiver=createTestMessageReceiver(null,new TestSecurityFilter(false),null,null,false,null);
  responseEvent=createTestResponseEvent(receiver);
  MuleMessage result=receiver.routeMessage(inMessage);
  assertMessageNotSent();
  assertNotNull(result);
  assertEquals(TestSecurityFilter.SECURITY_EXCEPTION_MESSAGE,result.getPayloadAsString());
  assertNotNull(result.getExceptionPayload());
  assertTrue(result.getExceptionPayload().getException() instanceof TestSecurityFilter.StaticMessageUnauthorisedException);
  assertTrue(securityNotificationListener.latch.await(RECEIVE_TIMEOUT,TimeUnit.MILLISECONDS));
  assertEquals(SecurityNotification.SECURITY_AUTHENTICATION_FAILED,securityNotificationListener.securityNotification.getAction());
  assertEquals(securityNotificationListener.securityNotification.getResourceIdentifier(),TestSecurityFilter.StaticMessageUnauthorisedException.class.getName());
}
