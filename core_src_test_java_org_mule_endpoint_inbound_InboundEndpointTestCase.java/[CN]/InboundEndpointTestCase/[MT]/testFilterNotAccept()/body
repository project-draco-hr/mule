{
  endpoint=createTestInboundEndpoint(new TestFilter(false),null,null,null,MessageExchangePattern.REQUEST_RESPONSE,null);
  endpoint.setListener(inboundListener);
  requestEvent=createTestRequestEvent(endpoint);
  responseEvent=createTestResponseEvent(endpoint);
  MessageProcessor mpChain=((AbstractEndpoint)endpoint).getMessageProcessorChain(requestEvent.getFlowConstruct());
  result=mpChain.process(requestEvent);
  assertNotNull(result);
  assertNotNull("Filter should have thrown a FilterException",result.getMessage().getExceptionPayload());
  assertTrue(result.getMessage().getExceptionPayload().getException() instanceof FilterUnacceptedException);
  assertMessageNotSent();
}
