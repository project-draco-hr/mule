{
  endpoint=createTestInboundEndpoint(null,null,null,null,false,null);
  endpoint.setListener(inboundListener);
  requestEvent=createTestRequestEvent(endpoint);
  responseEvent=createTestResponseEvent(endpoint);
  responseEvent.getMessage().setExceptionPayload(new DefaultExceptionPayload(new RuntimeException()));
  MessageProcessor mpChain=((AbstractEndpoint)endpoint).getMessageProcessorChain();
  result=mpChain.process(requestEvent);
  assertMessageSentSame(false);
  assertEquals(responseEvent.getMessage(),result.getMessage());
  assertEquals(500,result.getMessage().getIntProperty("status",0));
}
