{
  if (ConnectionFactoryWrapper.logger.isDebugEnabled()) {
    ConnectionFactoryWrapper.logger.debug("Invoking " + method);
  }
  Transaction tx=TransactionCoordination.getInstance().getTransaction();
  if (method.getName().equals("createSession")) {
    if (tx != null) {
      XASession xas=((XAConnection)xaConnection).createXASession();
      return Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),new Class[]{Session.class,XaTransaction.MuleXaObject.class},new SessionInvocationHandler(xas));
    }
 else {
      return ((XAConnection)xaConnection).createSession(false,Session.AUTO_ACKNOWLEDGE);
    }
  }
 else   if (method.getName().equals("createQueueSession")) {
    if (tx != null) {
      XAQueueSession xaqs=((XAQueueConnection)xaConnection).createXAQueueSession();
      return Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),new Class[]{QueueSession.class,XaTransaction.MuleXaObject.class},new SessionInvocationHandler(xaqs));
    }
 else {
      return ((XAQueueConnection)xaConnection).createQueueSession(false,Session.AUTO_ACKNOWLEDGE);
    }
  }
 else   if (method.getName().equals("createTopicSession")) {
    if (tx != null) {
      XATopicSession xats=((XATopicConnection)xaConnection).createXATopicSession();
      return Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),new Class[]{TopicSession.class,XaTransaction.MuleXaObject.class},new SessionInvocationHandler(xats));
    }
 else {
      return ((XATopicConnection)xaConnection).createTopicSession(false,Session.AUTO_ACKNOWLEDGE);
    }
  }
 else {
    return method.invoke(xaConnection,args);
  }
}
