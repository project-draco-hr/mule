{
  if (!connector.isStarted()) {
    logger.warn("Servlet container has not yet initialised, ignoring event: " + event.getMessage().getPayload());
    return;
  }
  Channel chan=bayeux.getChannel(channel);
  if (chan != null) {
    if (chan.getSubscribers().size() > 0 && cacheMessages && !messageCache.isEmpty()) {
      while (!messageCache.isEmpty()) {
        for (        Client client : chan.getSubscribers()) {
          deliver(client,channel,messageCache.remove());
        }
      }
    }
    Object data=event.transformMessage();
    for (    Client client : chan.getSubscribers()) {
      deliver(client,channel,data);
    }
  }
 else   if (cacheMessages) {
    Object data=event.transformMessage();
    if (logger.isTraceEnabled()) {
      logger.trace("There are no clients waiting, adding message to cache: " + data);
    }
    messageCache.add(data);
  }
}
