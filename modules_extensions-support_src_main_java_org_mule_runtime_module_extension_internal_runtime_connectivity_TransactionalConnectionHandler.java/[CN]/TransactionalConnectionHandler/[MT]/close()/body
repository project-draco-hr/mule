{
  ConnectionHandler<T> connectionHandler=resource.getConnectionHandler();
  checkArgument(connectionHandler instanceof ConnectionHandlerAdapter,"connectionHandlerAdapter was expected");
  if (!resource.isTransactionResolved()) {
    try {
      resource.rollback();
    }
 catch (    Exception e) {
      throw new TransactionException(e);
    }
  }
  ((ConnectionHandlerAdapter)connectionHandler).close();
}
