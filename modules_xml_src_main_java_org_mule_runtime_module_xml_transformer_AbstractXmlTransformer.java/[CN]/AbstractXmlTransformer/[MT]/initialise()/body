{
  xmlInputFactory=XMLInputFactory.newInstance();
  if (!acceptExternalEntities) {
    xmlInputFactory.setProperty(IS_SUPPORTING_EXTERNAL_ENTITIES,false);
    useStaxSource=true;
  }
  xmlInputFactory.setProperty(IS_SUPPORTING_EXTERNAL_ENTITIES,acceptExternalEntities);
  useStaxSource=!acceptExternalEntities;
  xmlInputFactory.setProperty(IS_REPLACING_ENTITY_REFERENCES,expandInternalEntities);
  if (acceptExternalEntities && !expandInternalEntities) {
    logger.warn("External entities are enabled (acceptExternalEntities=true) but won't be expanded in the XML body because expandInternalEntities=false");
  }
  xmlOutputFactory=XMLOutputFactory.newInstance();
  this.doInitialise();
}
