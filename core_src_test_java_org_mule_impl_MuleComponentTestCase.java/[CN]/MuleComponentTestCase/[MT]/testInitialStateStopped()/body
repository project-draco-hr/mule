{
  managementContext.getRegistry().registerConnector(getTestConnector(),managementContext);
  UMODescriptor d=MuleTestUtils.createDescriptor(Orange.class.getName(),"orangeComponent","test://in","test://out",null,managementContext);
  d.setInitialState(ImmutableMuleDescriptor.INITIAL_STATE_STOPPED);
  managementContext.getRegistry().registerService(d,managementContext);
  final UMOComponent c=managementContext.getRegistry().lookupSystemModel().getComponent("orangeComponent");
  assertFalse(c.isStarted());
  AbstractConnector connector=(AbstractConnector)managementContext.getRegistry().lookupConnector("testConnector");
  assertTrue(connector.isStarted());
  assertTrue(connector.getReceivers().isEmpty());
  c.start();
  assertTrue(connector.isStarted());
  assertFalse(connector.getReceivers().isEmpty());
  assertTrue(c.isStarted());
  Iterator it=connector.getReceivers().values().iterator();
  while (it.hasNext()) {
    assertTrue(((UMOMessageReceiver)it.next()).isConnected());
  }
}
