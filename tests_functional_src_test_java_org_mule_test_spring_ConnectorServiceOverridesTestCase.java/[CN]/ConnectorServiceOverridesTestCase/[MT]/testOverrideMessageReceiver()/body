{
  TestConnector connector=lookupDummyConnector();
  InboundEndpoint endpoint=getTestInboundEndpoint("foo");
  endpoint.getTransactionConfig().setAction(MuleTransactionConfig.ACTION_ALWAYS_BEGIN);
  endpoint.getTransactionConfig().setFactory(new XaTransactionFactory());
  TransportServiceDescriptor serviceDescriptor=connector.getServiceDescriptor();
  MessageReceiver receiver=serviceDescriptor.createMessageReceiver(connector,getTestFlow(),endpoint);
  assertEquals(TestMessageReceiver.class,receiver.getClass());
}
