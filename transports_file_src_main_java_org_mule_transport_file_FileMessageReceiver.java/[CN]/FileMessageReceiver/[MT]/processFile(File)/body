{
  boolean checkFileAge=((FileConnector)connector).getCheckFileAge();
  if (checkFileAge) {
    long fileAge=((FileConnector)connector).getFileAge();
    long lastMod=sourceFile.lastModified();
    long now=System.currentTimeMillis();
    long thisFileAge=now - lastMod;
    if (thisFileAge < fileAge) {
      if (logger.isDebugEnabled()) {
        logger.debug("The file has not aged enough yet, will return nothing for: " + sourceFile);
      }
      return;
    }
  }
  if (!attemptFileLock(sourceFile)) {
    return;
  }
  File destinationFile=null;
  String sourceFileOriginalName=sourceFile.getName();
  MessageAdapter msgAdapter=null;
  FileInputStream fileIn=null;
  try {
    fileIn=new ReceiverFileInputStream(sourceFile,moveDir != null);
    msgAdapter=connector.getMessageAdapter(fileIn);
  }
 catch (  FileNotFoundException e) {
    logger.error("File being read disappeared!",e);
    return;
  }
  msgAdapter.setProperty(FileConnector.PROPERTY_ORIGINAL_FILENAME,sourceFileOriginalName);
  FileConnector fc=((FileConnector)connector);
  if (!fc.isStreaming() || (fc.isStreaming() && !fc.isAutoDelete())) {
    moveAndDelete(sourceFile,destinationFile,sourceFileOriginalName,msgAdapter,fileIn);
  }
 else {
    this.routeMessage(new DefaultMuleMessage(msgAdapter),endpoint.isSynchronous());
  }
}
