{
  DocumentBuilderFactory factory=DocumentBuilderFactory.newInstance();
  if (logger.isDebugEnabled()) {
    logger.debug("Using JAXP provider [" + factory.getClass().getName() + "]");
  }
  Document doc=factory.newDocumentBuilder().newDocument();
  XMLReader documentReader=createDocumentReader(validationMode,namespaceAware);
  SAXSource xmlSource=new SAXSource(createAnnotator(entityResolver,errorHandler,doc,documentReader),inputSource);
  createSaxToDomTransformer(validationMode).transform(xmlSource,new DOMResult(doc));
  return doc;
}
