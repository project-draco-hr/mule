{
  if (initialised.get()) {
    logger.debug("Already initialised: " + toString());
    return;
  }
  this.managementContext=managementContext;
  if (endpointEncoding == null) {
    endpointEncoding=RegistryContext.getConfiguration().getDefaultEncoding();
  }
  if (connector == null) {
    if (endpointUri.getConnectorName() != null) {
      connector=managementContext.getRegistry().lookupConnector(endpointUri.getConnectorName());
      if (connector == null) {
        throw new IllegalArgumentException("Connector not found: " + endpointUri.getConnectorName());
      }
    }
 else {
      try {
        connector=TransportFactory.getOrCreateConnectorByProtocol(this);
        if (connector == null) {
          throw new InitialisationException(new Message(Messages.CONNECTOR_WITH_PROTOCOL_X_NOT_REGISTERED,endpointUri.getScheme()),this);
        }
      }
 catch (      TransportFactoryException e) {
        throw new InitialisationException(new Message(Messages.FAILED_TO_CREATE_CONNECTOR_FROM_URI_X,endpointUri),e,this);
      }
    }
    if (endpointUri.getEndpointName() != null && name == null) {
      name=endpointUri.getEndpointName();
    }
  }
  name=ObjectNameHelper.getEndpointName(this);
  String sync=endpointUri.getParams().getProperty("synchronous",null);
  if (sync != null) {
    synchronous=Boolean.valueOf(sync);
  }
  if (properties != null && endpointUri.getParams() != null) {
    properties.putAll(endpointUri.getParams());
  }
  if (endpointUri.getTransformers() != null) {
    try {
      transformer=MuleObjectHelper.getTransformer(endpointUri.getTransformers(),",");
    }
 catch (    MuleException e) {
      throw new InitialisationException(e,this);
    }
  }
  if (transformer == null) {
    if (connector instanceof AbstractConnector) {
      if (UMOEndpoint.ENDPOINT_TYPE_SENDER.equals(type)) {
        transformer=((AbstractConnector)connector).getDefaultOutboundTransformer();
      }
 else       if (UMOEndpoint.ENDPOINT_TYPE_SENDER_AND_RECEIVER.equals(type)) {
        transformer=((AbstractConnector)connector).getDefaultOutboundTransformer();
        responseTransformer=((AbstractConnector)connector).getDefaultResponseTransformer();
      }
 else {
        transformer=((AbstractConnector)connector).getDefaultInboundTransformer();
      }
    }
  }
  if (transformer != null) {
    transformer.setEndpoint(this);
  }
  if (endpointUri.getResponseTransformers() != null) {
    try {
      responseTransformer=MuleObjectHelper.getTransformer(endpointUri.getResponseTransformers(),",");
    }
 catch (    MuleException e) {
      throw new InitialisationException(e,this);
    }
  }
  if (responseTransformer == null) {
    if (connector instanceof AbstractConnector) {
      responseTransformer=((AbstractConnector)connector).getDefaultResponseTransformer();
    }
  }
  if (responseTransformer != null) {
    responseTransformer.setEndpoint(this);
  }
  if (securityFilter != null) {
    securityFilter.setEndpoint(this);
    securityFilter.initialise(managementContext);
  }
  String rs=(String)endpointUri.getParams().remove("remoteSync");
  if (rs != null) {
    remoteSync=Boolean.valueOf(rs);
  }
  String rsTimeout=(String)endpointUri.getParams().remove("remoteSyncTimeout");
  if (rsTimeout != null) {
    remoteSyncTimeout=Integer.valueOf(rsTimeout);
  }
  if (connectionStrategy == null) {
    connectionStrategy=new SingleAttemptConnectionStrategy();
  }
  initialised.set(true);
  try {
    register();
    if (transformer != null && transformer.getRegistryId() == null)     transformer.register();
    if (responseTransformer != null && responseTransformer.getRegistryId() == null)     responseTransformer.register();
  }
 catch (  RegistrationException re) {
    logger.warn(re);
  }
}
