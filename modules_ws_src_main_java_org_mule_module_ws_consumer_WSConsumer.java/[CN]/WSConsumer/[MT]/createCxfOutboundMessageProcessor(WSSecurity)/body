{
  ProxyClientMessageProcessorBuilder cxfBuilder=new ProxyClientMessageProcessorBuilder();
  Map<String,Object> outConfigProperties=new HashMap<>();
  Map<String,Object> inConfigProperties=new HashMap<>();
  cxfBuilder.setMtomEnabled(mtomEnabled);
  cxfBuilder.setMuleContext(muleContext);
  cxfBuilder.setSoapVersion(soapVersion.getVersion());
  if (security != null && security.hasStrategies()) {
    for (    SecurityStrategy strategy : security.getStrategies()) {
      strategy.apply(outConfigProperties,inConfigProperties);
    }
    if (cxfBuilder.getOutInterceptors() == null) {
      cxfBuilder.setOutInterceptors(new ArrayList<Interceptor<? extends Message>>());
    }
    if (cxfBuilder.getInInterceptors() == null) {
      cxfBuilder.setInInterceptors(new ArrayList<Interceptor<? extends Message>>());
    }
    if (!outConfigProperties.isEmpty()) {
      cxfBuilder.getOutInterceptors().add(new WSS4JOutInterceptor(outConfigProperties));
    }
    if (!inConfigProperties.isEmpty()) {
      cxfBuilder.getInInterceptors().add(new WSS4JInInterceptor(inConfigProperties));
    }
  }
  CxfOutboundMessageProcessor cxfOutboundMessageProcessor=cxfBuilder.build();
  cxfOutboundMessageProcessor.getClient().getInInterceptors().add(new CheckFaultInterceptor());
  cxfOutboundMessageProcessor.getClient().getInInterceptors().add(new NamespaceSaverStaxInterceptor());
  cxfOutboundMessageProcessor.getClient().getInInterceptors().add(new NamespaceRestorerStaxInterceptor());
  if (soapAction != null) {
    cxfOutboundMessageProcessor.getClient().getOutInterceptors().add(new SoapActionInterceptor(soapAction));
  }
  cxfOutboundMessageProcessor.getClient().getOutInterceptors().add(new InputSoapHeadersInterceptor(muleContext));
  cxfOutboundMessageProcessor.getClient().getInInterceptors().add(new OutputSoapHeadersInterceptor(muleContext));
  return cxfOutboundMessageProcessor;
}
