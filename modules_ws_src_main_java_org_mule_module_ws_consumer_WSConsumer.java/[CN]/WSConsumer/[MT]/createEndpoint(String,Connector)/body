{
  if (connector != null) {
    String protocol=new MuleEndpointURI(address,muleContext).getScheme();
    if (!connector.supportsProtocol(protocol)) {
      throw new IllegalStateException(String.format("Connector %s does not support protocol: %s",connector,protocol));
    }
  }
  EndpointBuilder builder=muleContext.getEndpointFactory().getEndpointBuilder(address);
  builder.setConnector(connector);
  return muleContext.getEndpointFactory().getOutboundEndpoint(builder);
}
