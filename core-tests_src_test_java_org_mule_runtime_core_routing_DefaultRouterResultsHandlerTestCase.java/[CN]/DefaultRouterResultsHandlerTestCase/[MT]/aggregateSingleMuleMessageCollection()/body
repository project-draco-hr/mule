{
  MuleMessage message1=MuleMessage.builder().payload("test event A").build();
  MuleEvent event1=MuleEvent.builder(context).message(message1).flow(flow).addFlowVariable("key1","value1").build();
  MuleMessage message2=MuleMessage.builder().payload("test event B").build();
  MuleMessage message3=MuleMessage.builder().payload("test event C").build();
  List<MuleMessage> list=new ArrayList<>();
  list.add(message2);
  list.add(message3);
  MuleMessage messageCollection=MuleMessage.builder().payload(list).build();
  MuleEvent event2=MuleEvent.builder(context).message(messageCollection).flow(flow).addFlowVariable("key2","value2").build();
  MuleEvent result=resultsHandler.aggregateResults(Collections.<MuleEvent>singletonList(event2),event1);
  assertSame(event2,result);
  assertThat(result.getFlowVariableNames(),not(contains("key1")));
  assertThat(result.getFlowVariable("key2"),equalTo("value2"));
}
