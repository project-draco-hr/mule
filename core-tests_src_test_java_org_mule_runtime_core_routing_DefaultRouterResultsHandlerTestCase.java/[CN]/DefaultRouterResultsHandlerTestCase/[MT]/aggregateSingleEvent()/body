{
  MuleMessage message1=new DefaultMuleMessage("test event A");
  MuleEvent event1=new DefaultMuleEvent(message1,flow);
  event1.setFlowVariable("key1","value1");
  event1.getSession().setProperty("key","value");
  MuleMessage message2=new DefaultMuleMessage("test event B");
  MuleEvent event2=new DefaultMuleEvent(message2,flow);
  event2.setFlowVariable("key2","value2");
  event2.getSession().setProperty("key","valueNEW");
  event2.getSession().setProperty("key1","value1");
  MuleEvent result=resultsHandler.aggregateResults(Collections.<MuleEvent>singletonList(event2),event1);
  assertSame(event2,result);
  assertNull(result.getFlowVariable("key1"));
  assertEquals("value2",result.getFlowVariable("key2"));
  assertEquals("valueNEW",result.getSession().getProperty("key"));
  assertEquals("value1",result.getSession().getProperty("key1"));
}
