{
  if (backupFolder != null) {
    String filename=msg.getFileName();
    if (filename == null) {
      Address[] from=msg.getFrom();
      if (from != null && from.length > 0) {
        filename=from[0] instanceof InternetAddress ? ((InternetAddress)from[0]).getAddress() : from[0].toString();
      }
 else {
        filename="(no from address)";
      }
      filename+="[" + UUID.getUUID() + "]";
    }
    filename=FileUtils.prepareWinFilename(filename);
    filename=backupFolder + filename + ".msg";
    if (logger.isDebugEnabled()) {
      logger.debug("Writing message to: " + filename);
    }
    File f=FileUtils.createFile(filename);
    FileOutputStream fos=new FileOutputStream(f);
    msg.writeTo(fos);
  }
}
