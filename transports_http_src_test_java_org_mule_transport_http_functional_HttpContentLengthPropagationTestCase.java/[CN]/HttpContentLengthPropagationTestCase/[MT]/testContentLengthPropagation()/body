{
  InputStream is=Thread.currentThread().getContextClassLoader().getResourceAsStream(NAME_PAYLOAD);
  assertNotNull("Payload test file not found.",is);
  byte[] fileContents=IOUtils.toByteArray(is);
  MuleClient client=muleContext.getClient();
  MuleMessage result=client.send(((InboundEndpoint)muleContext.getRegistry().lookupObject("httpEndpoint")).getAddress(),new DefaultMuleMessage(fileContents,muleContext));
  XsltTransformer trans=new XsltTransformer();
  trans.setMuleContext(muleContext);
  trans.setXslFile(NAME_STYLESHEET);
  trans.initialise();
  final byte[] locallyTransformedBytes=(byte[])trans.doTransform(fileContents,"UTF-8");
  assertEquals(new String(locallyTransformedBytes),getPayloadAsString(result));
}
