{
  MuleMessage message=new DefaultMuleMessage("test",props,muleContext);
  Object result=muleContext.getExpressionManager().evaluate("#[mule:message.headers(foo, baz)]",message);
  assertNotNull(result);
  assertTrue(result instanceof Map);
  assertEquals(2,((Map)result).size());
  assertTrue(((Map)result).values().contains("moo"));
  assertTrue(((Map)result).values().contains("maz"));
  assertFalse(((Map)result).values().contains("mar"));
  result=muleContext.getExpressionManager().evaluate("#[mule:message.headers(fool?)]",message);
  assertNotNull(result);
  assertTrue(result instanceof Map);
  assertEquals(0,((Map)result).size());
  result=muleContext.getExpressionManager().evaluate("#[mule:message.headers(foo?, baz)]",message);
  assertNotNull(result);
  assertTrue(result instanceof Map);
  assertEquals(2,((Map)result).size());
  assertTrue(((Map)result).values().contains("moo"));
  assertTrue(((Map)result).values().contains("maz"));
  assertFalse(((Map)result).values().contains("mar"));
  result=muleContext.getExpressionManager().evaluate("#[mule:message.headers(fool?)]",message);
  assertEquals(0,((Map)result).size());
  result=muleContext.getExpressionManager().evaluate("#[mule:message.headers(foo, fool?)]",message);
  assertTrue(result instanceof Map);
  assertEquals("moo",((Map)result).get("foo"));
  assertEquals(1,((Map)result).size());
  try {
    muleContext.getExpressionManager().evaluate("#[mule:message.headers(foo, fool)]",createMessageWithAttachments());
    fail("Header 'fool' is not on the message and not defined as optional");
  }
 catch (  Exception e) {
  }
}
