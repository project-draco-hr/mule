{
  MuleExpressionEvaluator eval=new MuleExpressionEvaluator();
  eval.setMuleContext(muleContext);
  MuleMessage message=new DefaultMuleMessage("test",props,muleContext);
  Object result=eval.evaluate("message.headers-list(foo, baz)",message);
  assertNotNull(result);
  assertTrue(result instanceof List);
  assertEquals(2,((List)result).size());
  assertTrue(((List)result).contains("moo"));
  assertTrue(((List)result).contains("maz"));
  assertFalse(((List)result).contains("mar"));
  result=eval.evaluate("message.headers(fool?)",message);
  assertNotNull(result);
  assertTrue(result instanceof Map);
  assertEquals(0,((Map)result).size());
  result=eval.evaluate("message.headers-list(foo?, baz)",message);
  assertNotNull(result);
  assertTrue(result instanceof List);
  assertEquals(2,((List)result).size());
  assertTrue(((List)result).contains("moo"));
  assertTrue(((List)result).contains("maz"));
  assertFalse(((List)result).contains("mar"));
  result=eval.evaluate("message.headers(fool?)",message);
  assertEquals(0,((Map)result).size());
  result=eval.evaluate("message.headers-list(foo, fool?)",message);
  assertTrue(result instanceof List);
  assertEquals("moo",((List)result).get(0));
  assertEquals(1,((List)result).size());
  try {
    eval.evaluate("message.headers-list(foo, fool)",createMessageWithAttachments());
    fail("Header 'fool' is not on the message and not defined as optional");
  }
 catch (  Exception e) {
  }
}
