{
  DataType<?> original=message.getDataType();
  String mimeType=transformed.getMimeType() == null || MimeTypes.ANY.equals(transformed.getMimeType()) ? original.getMimeType() : transformed.getMimeType();
  String encoding=transformed.getEncoding() == null ? message.getEncoding() : transformed.getEncoding();
  Class<?> type=payloadTransformedClass != null && transformed.getType() == Object.class && original.isCompatibleWith(DataTypeFactory.create(payloadTransformedClass,mimeType)) ? original.getType() : transformed.getType();
  DataType mergedDataType=DataTypeFactory.create(type,mimeType);
  mergedDataType.setEncoding(encoding);
  return mergedDataType;
}
