{
  DataType<?> original=message.getDataType();
  MediaType mimeType=transformed.getMediaType() == null || MediaType.ANY.matches(transformed.getMediaType()) ? original.getMediaType() : transformed.getMediaType();
  Charset encoding=transformed.getMediaType().getCharset().orElse(message.getDataType().getMediaType().getCharset().orElse(getDefaultEncoding(muleContext)));
  Class<?> type=payloadTransformedClass != null && transformed.getType() == Object.class && original.isCompatibleWith(DataType.builder().type(payloadTransformedClass).mediaType(mimeType).build()) ? original.getType() : payloadTransformedClass != null ? payloadTransformedClass : transformed.getType();
  return DataType.builder().type(type).mediaType(mimeType).charset(encoding).build();
}
