{
  DataType<?> original=message.getDataType();
  String mimeType=transformed.getMimeType() == null || MimeType.ANY.equals(transformed.getMimeType()) ? original.getMimeType() : transformed.getMimeType();
  String encoding=transformed.getEncoding() == null ? message.getEncoding() : transformed.getEncoding();
  Class<?> type=payloadTransformedClass != null && transformed.getType() == Object.class && original.isCompatibleWith(DataType.builder().type(payloadTransformedClass).mimeType(mimeType).build()) ? original.getType() : transformed.getType();
  return DataType.builder().type(type).mimeType(mimeType).encoding(encoding).build();
}
