{
  Object result;
  if (transformer instanceof MessageTransformer) {
    result=((MessageTransformer)transformer).transform(message,event);
  }
 else {
    result=transformer.transform(message);
  }
  if (result instanceof MuleMessage) {
    return (MuleMessage)result;
  }
 else {
    MuleMessage messagePostTransform=(event != null && event.getMessage() != null) ? event.getMessage() : message;
    return MuleMessage.builder(messagePostTransform).payload(result).mediaType(mergeMediaType(messagePostTransform,transformer.getReturnDataType())).build();
  }
}
