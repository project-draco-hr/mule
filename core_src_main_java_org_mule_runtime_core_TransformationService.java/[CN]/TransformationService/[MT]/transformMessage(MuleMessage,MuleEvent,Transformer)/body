{
  Object result;
  if (transformer instanceof MessageTransformer) {
    result=((MessageTransformer)transformer).transform(message,event);
  }
 else {
    result=transformer.transform(message);
  }
  if (result instanceof MuleMessage) {
    if (!result.equals(message)) {
      MuleMessage transformResult=(MuleMessage)result;
      return new DefaultMuleMessage(result,transformResult,muleContext,transformResult.getDataType());
    }
    return (MuleMessage)result;
  }
 else {
    return new DefaultMuleMessage(result,message,muleContext,mergeDataType(message,transformer.getReturnDataType(),result != null ? result.getClass() : null));
  }
}
