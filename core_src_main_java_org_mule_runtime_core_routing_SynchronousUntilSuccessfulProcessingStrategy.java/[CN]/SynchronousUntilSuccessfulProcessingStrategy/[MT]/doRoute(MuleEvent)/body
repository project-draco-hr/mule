{
  Exception lastExecutionException=null;
  MuleEvent retryEvent=copyEventForRetry(event);
  try {
    for (int i=0; i <= getUntilSuccessfulConfiguration().getMaxRetries(); i++) {
      try {
        return processResponseThroughAckResponseExpression(processEvent(retryEvent));
      }
 catch (      Exception e) {
        logger.info("Exception thrown inside until-successful " + e.getMessage());
        if (logger.isDebugEnabled()) {
          logger.debug(e);
        }
        lastExecutionException=e;
        if (i < getUntilSuccessfulConfiguration().getMaxRetries()) {
          Thread.sleep(getUntilSuccessfulConfiguration().getMillisBetweenRetries());
          retryEvent=copyEventForRetry(event);
        }
      }
    }
    throw new RoutingException(retryEvent,getUntilSuccessfulConfiguration().getRouter(),lastExecutionException);
  }
 catch (  MessagingException e) {
    throw e;
  }
catch (  Exception e) {
    throw new RoutingException(retryEvent,getUntilSuccessfulConfiguration().getRouter(),e);
  }
}
