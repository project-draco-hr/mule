{
  ((DefaultMuleContext)muleContext).setPollingController(new PollingController(){
    @Override public boolean isPrimaryPollingInstance(){
      return false;
    }
  }
);
  MuleClient client=muleContext.getClient();
  client.dispatch("vm://source","Hello",null);
  Thread.sleep(10000);
  int numMessages=-1;
  MuleMessage message;
  do {
    numMessages++;
    message=client.request("vm://sink",1);
    if (message != null) {
      assertEquals("Hello",message.getPayload());
    }
  }
 while (message != null);
  assertTrue(numMessages > 0);
}
