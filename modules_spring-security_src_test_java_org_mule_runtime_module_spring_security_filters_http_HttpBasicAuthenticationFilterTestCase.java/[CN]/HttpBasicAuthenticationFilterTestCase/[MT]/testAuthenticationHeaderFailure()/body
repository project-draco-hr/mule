{
  MuleEvent oldEvent=RequestContext.getEvent();
  MuleEvent event=getTestEvent(MuleMessage.builder().payload("a").addInboundProperty(AUTHORIZATION,"Basic a").build());
  RequestContext.setEvent(event);
  HttpBasicAuthenticationFilter filter=new HttpBasicAuthenticationFilter();
  SecurityManager manager=mock(SecurityManager.class);
  filter.setSecurityManager(manager);
  doThrow(new UnauthorisedException(null,(MuleEvent)event)).when(manager).authenticate(anyObject());
  try {
    filter.authenticate(event);
    fail("An UnauthorisedException should be thrown");
  }
 catch (  UnauthorisedException e) {
    assertNotNull(event.getMessage().getOutboundProperty("WWW-Authenticate"));
    assertEquals("Basic realm=",event.getMessage().getOutboundProperty("WWW-Authenticate"));
    verify(manager);
  }
  RequestContext.setEvent(oldEvent);
}
