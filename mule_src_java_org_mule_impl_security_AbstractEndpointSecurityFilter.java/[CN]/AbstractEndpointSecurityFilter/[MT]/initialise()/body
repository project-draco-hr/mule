{
  if (securityManager == null) {
    securityManager=MuleManager.getInstance().getSecurityManager();
  }
  if (securityManager == null) {
    throw new InitialisationException("No security Manager has been set");
  }
  if (endpoint == null) {
    throw new InitialisationException("The endpont is null for this Security filter");
  }
  if (securityProviders != null) {
    UMOSecurityManager localManager=new MuleSecurityManager();
    String sp[]=Utility.split(securityProviders,",");
    for (int i=0; i < sp.length; i++) {
      UMOSecurityProvider provider=securityManager.getProvider(sp[i]);
      if (provider != null) {
        localManager.addProvider(provider);
      }
 else {
        throw new InitialisationException("There is not security provider registered called: " + sp[i]);
      }
    }
    securityManager=localManager;
  }
  if (endpoint.getType().equals(UMOEndpoint.ENDPOINT_TYPE_RECEIVER)) {
    inbound=true;
  }
 else   if (endpoint.getType().equals(UMOEndpoint.ENDPOINT_TYPE_SENDER)) {
    inbound=false;
  }
 else {
    throw new InitialisationException("The Endpoint that this security filter is associated with must have a type of " + UMOEndpoint.ENDPOINT_TYPE_SENDER + " or "+ UMOEndpoint.ENDPOINT_TYPE_RECEIVER+ ". Endpoint type is set to "+ endpoint.getType());
  }
  doInitialise();
}
