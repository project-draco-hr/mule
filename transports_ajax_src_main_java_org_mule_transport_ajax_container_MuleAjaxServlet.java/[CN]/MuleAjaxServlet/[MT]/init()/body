{
  super.init();
  MuleContext muleContext=(MuleContext)getServletContext().getAttribute(MuleProperties.MULE_CONTEXT_PROPERTY);
  if (muleContext == null) {
    throw new ServletException("Attribute " + MuleProperties.MULE_CONTEXT_PROPERTY + " not set on ServletContext");
  }
  String servletConnectorName=getServletConfig().getInitParameter(AJAX_CONNECTOR_NAME_PROPERTY);
  if (servletConnectorName == null) {
    servletConnectorName=(String)getServletContext().getAttribute(AJAX_CONNECTOR_NAME_PROPERTY);
  }
  if (servletConnectorName == null) {
    connector=(AjaxServletConnector)new TransportFactory(muleContext).getConnectorByProtocol(getConnectorProtocol());
    if (connector == null) {
      connector=new AjaxServletConnector(muleContext);
      connector.setName("ajax.servlet." + getServletContext().getServerInfo());
      try {
        muleContext.getRegistry().registerConnector(connector);
      }
 catch (      MuleException e) {
        throw new ServletException("Failed to register the AjaxServletConnector",e);
      }
    }
  }
 else {
    connector=(AjaxServletConnector)muleContext.getRegistry().lookupConnector(servletConnectorName);
    if (connector == null) {
      throw new ServletException(AjaxMessages.noAjaxConnectorWithName(servletConnectorName,AJAX_CONNECTOR_NAME_PROPERTY).toString());
    }
  }
  connector.setBayeux(getBayeux());
  jsonTransformer=new ObjectToJson();
  try {
    connector.getMuleContext().getRegistry().applyProcessorsAndLifecycle(jsonTransformer);
  }
 catch (  MuleException e) {
    throw new ServletException(e);
  }
}
