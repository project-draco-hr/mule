{
  MessagePropertiesTransformer t=new MessagePropertiesTransformer();
  Map add=new HashMap();
  add.put("addedProperty","overwrittenValue");
  t.setAddProperties(add);
  UMOMessage msg=new MuleMessage("message");
  msg.setProperty("addedProperty","originalValue");
  UMOEventContext ctx=getTestEventContext(msg);
  msg=ctx.getMessage();
  MuleMessage transformed=(MuleMessage)t.transform(msg,null,ctx);
  assertSame(msg,transformed);
  assertEquals(msg.getUniqueId(),transformed.getUniqueId());
  assertEquals(msg.getPayload(),transformed.getPayload());
  assertEquals(msg.getPropertyNames(),transformed.getPropertyNames());
  assertEquals("overwrittenValue",transformed.getProperty("addedProperty"));
}
