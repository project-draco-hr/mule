{
  String impl=null;
  Class implClass=null;
  if (implementationReference instanceof String) {
    impl=implementationReference.toString();
    if (impl.startsWith(MuleDescriptor.IMPLEMENTATION_TYPE_LOCAL)) {
      impl=impl.substring(MuleDescriptor.IMPLEMENTATION_TYPE_LOCAL.length());
      Object obj=properties.get(impl);
      if (obj != null) {
        implClass=obj.getClass();
        if (implClass.equals(String.class)) {
          implClass=getImplementationForReference(impl);
        }
      }
 else {
        throw new MuleException("No component implementation found as local reference using: " + impl);
      }
    }
 else {
      implClass=getImplementationForReference(impl);
    }
  }
 else {
    implClass=implementationReference.getClass();
  }
  return implClass;
}
