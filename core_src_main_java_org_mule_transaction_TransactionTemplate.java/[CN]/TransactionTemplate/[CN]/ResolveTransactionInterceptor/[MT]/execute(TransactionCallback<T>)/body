{
  byte action=config.getAction();
  Transaction transactionBeforeTemplate=TransactionCoordination.getInstance().getTransaction();
  if ((action == TransactionConfig.ACTION_NONE || action == TransactionConfig.ACTION_ALWAYS_BEGIN) && transactionBeforeTemplate != null) {
    if (logger.isDebugEnabled()) {
      logger.debug(action + ", " + "current TX: "+ transactionBeforeTemplate);
    }
    resolveTransaction(transactionBeforeTemplate);
  }
  T result=next.execute(callback);
  Transaction currentTransaction=TransactionCoordination.getInstance().getTransaction();
  if (currentTransaction != null && (config.getAction() == TransactionConfig.ACTION_ALWAYS_BEGIN || (config.getAction() == TransactionConfig.ACTION_BEGIN_OR_JOIN && transactionBeforeTemplate == null))) {
    resolveTransaction(currentTransaction);
  }
  return result;
}
