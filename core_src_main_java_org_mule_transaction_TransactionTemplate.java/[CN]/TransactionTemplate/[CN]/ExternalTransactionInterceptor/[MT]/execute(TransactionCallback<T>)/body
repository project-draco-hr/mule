{
  Transaction joinedExternal=null;
  Transaction tx=TransactionCoordination.getInstance().getTransaction();
  try {
    if (tx == null && context != null && config != null && config.isInteractWithExternal()) {
      TransactionFactory tmFactory=config.getFactory();
      if (tmFactory instanceof ExternalTransactionAwareTransactionFactory) {
        ExternalTransactionAwareTransactionFactory externalTransactionFactory=(ExternalTransactionAwareTransactionFactory)tmFactory;
        joinedExternal=tx=externalTransactionFactory.joinExternalTransaction(context);
      }
    }
    return next.execute(callback);
  }
  finally {
    if (joinedExternal != null) {
      TransactionCoordination.getInstance().unbindTransaction(joinedExternal);
    }
  }
}
