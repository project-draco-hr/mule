{
  Connection c=null;
  Session s=null;
  try {
    log.debug("purging topic : " + topic);
    c=getConnection(true,false);
    if (c == null) {
      log.debug("could not create a connection to topic : " + destination);
    }
    c.start();
    s=((TopicConnection)c).createTopicSession(true,Session.SESSION_TRANSACTED);
    log.debug("created topic session");
    Topic dest=s.createTopic(destination);
    log.debug("created topic destination");
    MessageConsumer consumer=null;
    try {
      consumer=s.createDurableSubscriber(dest,topic);
      log.debug("created consumer");
      while (consumer.receiveNoWait() != null) {
        log.debug("Topic " + topic + " isn't empty, draining it");
      }
      log.debug("topic should be empty");
      consumer.close();
      s.unsubscribe(topic);
    }
 catch (    JMSException e) {
      log.debug("could not unsubscribe : " + topic);
    }
  }
  finally {
    if (c != null) {
      c.stop();
      if (s != null) {
        s.close();
      }
      try {
        c.close();
      }
 catch (      JMSException e) {
        log.warn("Failed to close jms connection: " + e.getMessage());
      }
    }
  }
  log.debug("completed draining topic :" + topic);
}
