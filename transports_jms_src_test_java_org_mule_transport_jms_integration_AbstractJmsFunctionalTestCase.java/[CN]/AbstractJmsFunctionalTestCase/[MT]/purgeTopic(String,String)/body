{
  Connection c=null;
  Session s=null;
  try {
    logger.debug("purging topic : " + topic);
    c=(TopicConnection)getConnection(true,false);
    if (c == null) {
      logger.debug("could not create a connection to topic : " + destination);
    }
    c.start();
    s=((TopicConnection)c).createTopicSession(true,Session.SESSION_TRANSACTED);
    logger.debug("created topic session");
    Topic dest=s.createTopic(destination);
    logger.debug("created topic destination");
    TopicPublisher t;
    if (client != null) {
      client.dispose();
    }
    MessageConsumer consumer=null;
    try {
      consumer=s.createDurableSubscriber((Topic)dest,topic);
      logger.debug("created consumer");
      while (consumer.receiveNoWait() != null) {
        logger.debug("Topic " + topic + " isn't empty, draining it");
      }
      logger.debug("topic should be empty");
      consumer.close();
      s.unsubscribe(topic);
    }
 catch (    JMSException e) {
      logger.debug("could not unsubscribe : " + topic);
    }
  }
  finally {
    if (c != null) {
      c.stop();
      if (s != null) {
        s.close();
      }
      c.close();
    }
  }
  logger.debug("completed draining topic :" + topic);
}
