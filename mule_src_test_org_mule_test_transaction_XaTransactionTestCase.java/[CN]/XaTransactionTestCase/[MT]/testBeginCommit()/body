{
  Mock trans=new Mock(Transaction.class);
  XaTransaction xatx=new XaTransaction((Transaction)trans.proxy());
  Mock resource=new Mock(XAResource.class);
  trans.expect("commit");
  trans.expectAndReturn("enlistResource",C.eq((XAResource)resource.proxy()),true);
  trans.expectAndReturn("delistResource",C.args(C.eq((XAResource)resource.proxy()),C.eq(XAResource.TMSUCCESS)),true);
  assertTrue(xatx.enlistResource((XAResource)resource.proxy()));
  xatx.begin();
  assertTrue(xatx.isBegun());
  assertTrue(!xatx.isCommitted());
  xatx.delistResource((XAResource)resource.proxy(),XAResource.TMSUCCESS);
  xatx.commit();
  assertTrue(xatx.isCommitted());
  resource.verify();
  trans.verify();
}
