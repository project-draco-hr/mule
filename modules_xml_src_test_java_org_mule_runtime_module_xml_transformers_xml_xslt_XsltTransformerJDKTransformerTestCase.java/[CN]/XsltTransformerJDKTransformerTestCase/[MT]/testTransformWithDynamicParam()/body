{
  String xml="<node1>" + "<subnode1>sub node 1 original value</subnode1>" + "<subnode2>sub node 2 original value</subnode2>"+ "</node1>";
  String param="sub node 2 cool new value";
  String expectedTransformedxml="<node1>" + "<subnode1>sub node 1 original value</subnode1>" + "<subnode2>" + param + "</subnode2>"+ "</node1>";
  String xsl="<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" version=\"2.0\"" + " xmlns:wsdlsoap=\"http://schemas.xmlsoap.org/wsdl/soap/\"" + " xmlns:wsdl=\"http://schemas.xmlsoap.org/wsdl/\">"+ "<xsl:param name=\"param1\"/>"+ "<xsl:template match=\"@*|node()\">"+ "<xsl:copy><xsl:apply-templates select=\"@*|node()\"/></xsl:copy>"+ "</xsl:template>"+ "<xsl:template match=\"/node1/subnode2/text()\">"+ "<xsl:value-of select=\"$param1\"/>"+ "</xsl:template>"+ "</xsl:stylesheet>";
  XsltTransformer transformer=new XsltTransformer();
  transformer.setMuleContext(muleContext);
  transformer.setReturnDataType(DataTypeFactory.STRING);
  transformer.setMuleContext(muleContext);
  transformer.setXslt(xsl);
  Map<String,Object> params=new HashMap<String,Object>();
  params.put("param1","#[message.outboundProperties.myproperty]");
  transformer.setContextProperties(params);
  transformer.initialise();
  MutableMuleMessage message=new DefaultMuleMessage(xml,muleContext);
  message.setOutboundProperty("myproperty",param);
  String transformerResult=(String)transformer.transform(message);
  transformerResult=transformerResult.substring(transformerResult.indexOf("?>") + 2);
  assertTrue(transformerResult.indexOf(expectedTransformedxml) > -1);
}
