{
  String to=(String)endpoint.getProperty("folder");
  if (to == null) {
    throw new MalformedEndpointException(endpoint.getEndpointURI().toString());
  }
  Chat chat=xmppConnection.createChat(to);
  Message message=null;
  if (timeout == MuleEvent.TIMEOUT_WAIT_FOREVER) {
    message=chat.nextMessage();
  }
 else   if (timeout == MuleEvent.TIMEOUT_DO_NOT_WAIT) {
    message=chat.nextMessage(1);
  }
 else {
    message=chat.nextMessage(timeout);
  }
  if (message != null) {
    return new DefaultMuleMessage(connector.getMessageAdapter(message),connector.getMuleContext());
  }
 else {
    return null;
  }
}
