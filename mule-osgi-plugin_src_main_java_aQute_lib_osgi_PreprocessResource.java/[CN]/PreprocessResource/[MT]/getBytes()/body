{
  ByteArrayOutputStream bout=new ByteArrayOutputStream(2000);
  OutputStreamWriter osw=new OutputStreamWriter(bout);
  PrintWriter pw=new PrintWriter(osw);
  InputStream in=resource.openInputStream();
  try {
    BufferedReader rdr=new BufferedReader(new InputStreamReader(in));
    String line=rdr.readLine();
    while (line != null) {
      line=processor.getReplacer().process(line);
      pw.println(line);
      line=rdr.readLine();
    }
    pw.flush();
    byte[] data=bout.toByteArray();
    return data;
  }
  finally {
    in.close();
  }
}
