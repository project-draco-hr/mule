{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  byte[] buffer=new byte[1024 * 2];
  int len;
  if (message instanceof BytesMessage) {
    BytesMessage bMsg=(BytesMessage)message;
    bMsg.reset();
    while ((len=bMsg.readBytes(buffer)) != -1) {
      baos.write(buffer,0,len);
    }
  }
 else   if (message instanceof StreamMessage) {
    StreamMessage sMsg=(StreamMessage)message;
    sMsg.reset();
    while ((len=sMsg.readBytes(buffer)) != -1) {
      baos.write(buffer,0,len);
    }
  }
 else   if (message instanceof ObjectMessage) {
    ObjectMessage oMsg=(ObjectMessage)message;
    ByteArrayOutputStream bs=new ByteArrayOutputStream();
    ObjectOutputStream os=new ObjectOutputStream(bs);
    os.writeObject(oMsg.getObject());
    os.flush();
    baos.write(bs.toByteArray());
    os.close();
    bs.close();
  }
 else   if (message instanceof TextMessage) {
    TextMessage tMsg=(TextMessage)message;
    baos.write(tMsg.getText().getBytes());
  }
 else {
    throw new JMSException("Cannot get bytes from Map Message");
  }
  baos.flush();
  byte[] bytes=baos.toByteArray();
  baos.close();
  return bytes;
}
