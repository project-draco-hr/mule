{
  Flow flow=(Flow)getFlowConstruct("headerOverride");
  MuleEvent event=getTestEvent(TEST_MESSAGE);
  Map<String,String> params=new HashMap<>();
  params.put("testName1","testValueNew");
  params.put("testName2","testValue2");
  event.getMessage().setInvocationProperty("headers",params);
  flow.process(event);
  final Collection<String> values=headers.getCollection("testName1");
  assertThat(values,Matchers.containsInAnyOrder(Arrays.asList("testValue1","testValueNew").toArray(new String[2])));
  assertThat(getFirstReceivedHeader("testName2"),equalTo("testValue2"));
}
