{
  try {
    UMOMessageAdapter adapter=connector.getMessageAdapter(packet);
    if (logger.isDebugEnabled()) {
      logger.debug("Processing XMPP packet from: " + packet.getFrom());
      logger.debug("UMOMessageAdapter is a: " + adapter.getClass().getName());
    }
    UMOMessage returnMessage=routeMessage(new MuleMessage(adapter),endpoint.isSynchronous());
    if (returnMessage != null && packet instanceof Message) {
      RequestContext.safeRewriteEvent(returnMessage);
      Packet result=(Packet)connector.getDefaultResponseTransformer().transform(returnMessage.getPayload());
      xmppConnection.sendPacket(result);
    }
  }
 catch (  Exception e) {
    handleException(e);
  }
}
