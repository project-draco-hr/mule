{
  MuleMessage.Builder messageBuilder=MuleMessage.builder(event.getMessage()).addOutboundProperty(MULE_ENDPOINT_PROPERTY,endpoint.getEndpointURI().toString());
  if (endpoint.getProperties() != null) {
    for (Iterator<?> iterator=endpoint.getProperties().keySet().iterator(); iterator.hasNext(); ) {
      String prop=(String)iterator.next();
      Serializable value=endpoint.getProperties().get(prop);
      if (!ignoreProperty(event.getMessage(),prop)) {
        messageBuilder.addOutboundProperty(prop,value);
      }
    }
  }
  event.setMessage(messageBuilder.build());
  event=OptimizedRequestContext.unsafeSetEvent(event);
  return event;
}
