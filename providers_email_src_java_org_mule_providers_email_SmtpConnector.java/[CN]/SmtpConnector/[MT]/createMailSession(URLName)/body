{
  if (url == null) {
    throw new IllegalArgumentException("Url argument cannot be null when creating a session");
  }
  Properties props=System.getProperties();
  props.put("mail.smtp.host",url.getHost());
  props.put("mail.smtp.port",String.valueOf(url.getPort()));
  Session session=Session.getDefaultInstance(props,null);
  session.setDebug(logger.isDebugEnabled());
  PasswordAuthentication pw=new PasswordAuthentication(url.getUsername(),url.getPassword());
  session.setPasswordAuthentication(url,pw);
  return session;
}
