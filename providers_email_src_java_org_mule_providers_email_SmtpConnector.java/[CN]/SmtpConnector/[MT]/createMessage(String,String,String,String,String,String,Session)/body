{
  Message msg=new MimeMessage(session);
  try {
    InternetAddress[] toAddrs=null;
    if (!StringUtils.isEmpty(to)) {
      toAddrs=InternetAddress.parse(to,false);
      msg.setRecipients(Message.RecipientType.TO,toAddrs);
    }
 else {
      throw new MuleException(new org.mule.config.i18n.Message(Messages.X_IS_NULL,"toAddress"));
    }
    msg.setSentDate(Calendar.getInstance().getTime());
    if (from == null) {
      throw new IllegalArgumentException("From address must be set");
    }
    msg.setFrom(new InternetAddress(from));
    InternetAddress[] ccAddrs=null;
    if (!StringUtils.isEmpty(cc)) {
      ccAddrs=InternetAddress.parse(cc,false);
      msg.setRecipients(Message.RecipientType.CC,ccAddrs);
    }
    InternetAddress[] bccAddrs=null;
    if (!StringUtils.isEmpty(bcc)) {
      bccAddrs=InternetAddress.parse(bcc,false);
      msg.setRecipients(Message.RecipientType.BCC,bccAddrs);
    }
    if (!StringUtils.isEmpty(subject)) {
      msg.setSubject(subject);
    }
 else {
      msg.setSubject("(no subject)");
    }
    Multipart mp=new MimeMultipart();
    MimeBodyPart mbp=new MimeBodyPart();
    mbp.setText(body);
    mp.addBodyPart(mbp);
    msg.setContent(mp);
    return msg;
  }
 catch (  MuleException e) {
    throw e;
  }
catch (  MessagingException e) {
    throw new MuleException(new org.mule.config.i18n.Message(Messages.FAILED_TO_SET_PROPERTIES_ON_X,"Email message"),e);
  }
}
