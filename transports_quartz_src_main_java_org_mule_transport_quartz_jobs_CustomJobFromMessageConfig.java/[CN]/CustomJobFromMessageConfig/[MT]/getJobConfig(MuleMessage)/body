{
  if (evaluator.equals("custom")) {
    evaluator=customEvaluator;
  }
  final MuleContext muleContext=getMuleContext();
  Object result=muleContext.getExpressionManager().evaluate(expression,evaluator,message,true);
  if (result instanceof Job) {
    CustomJobConfig customJob=new CustomJobConfig();
    customJob.setJob((Job)result);
    customJob.setMuleContext(muleContext);
    return customJob;
  }
 else   if (result instanceof JobConfig) {
    if (result instanceof MuleContextAware) {
      ((MuleContextAware)result).setMuleContext(muleContext);
    }
    return (JobConfig)result;
  }
 else {
    throw new IllegalStateException(CoreMessages.propertyIsNotSupportedType(evaluator + ":" + expression,new Class[]{Job.class,JobConfig.class,Class.class,String.class},result.getClass()).getMessage());
  }
}
