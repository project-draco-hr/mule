{
  setClientId("Client1");
  assertNull(receiveNoWait());
  setClientId("Client2");
  assertNull(receiveNoWait());
  setClientId("Sender");
  sendAndCommit(DEFAULT_INPUT_MESSAGE);
  setClientId("Client1");
  Message output=receiveAndCommit();
  assertPayloadEquals(DEFAULT_INPUT_MESSAGE,output);
  assertNull(receiveNoWait());
  setClientId("Client2");
  receiveAndRollback();
  assertPayloadEquals(DEFAULT_INPUT_MESSAGE,output);
  output=receiveAndCommit();
  assertPayloadEquals(DEFAULT_INPUT_MESSAGE,output);
  assertNull(receiveNoWait());
}
