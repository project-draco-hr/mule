{
  MuleClient client=new MuleClient();
  client.getConfiguration().setDefaultSynchronousEndpoints(true);
  client.getConfiguration().setDefaultRemoteSync(true);
  if (!canSendWithoutReceiver) {
    try {
      client.send(urlString,"Test Client Send message",null);
      fail("There is no receiver for this endpointUri");
    }
 catch (    Exception e) {
      assertTrue(e.getCause() instanceof NoReceiverForEndpointException);
    }
  }
  TestReceiver receiver=new TestReceiver();
  String name="myComponent";
  SedaComponent descriptor=new SedaComponent();
  descriptor.setName(name);
  descriptor.setServiceFactory(new SingletonObjectFactory(receiver));
  managementContext.getRegistry().registerComponent(descriptor,managementContext);
  UMOEndpointBuilder endpointBuilder=new EndpointURIEndpointBuilder(urlString,managementContext);
  endpointBuilder.addTransformer(new ByteArrayToString());
  UMOImmutableEndpoint endpoint=managementContext.getRegistry().lookupEndpointFactory().getInboundEndpoint(endpointBuilder,managementContext);
  descriptor.setInboundRouter(new InboundRouterCollection());
  descriptor.getInboundRouter().addEndpoint(endpoint);
  UMOMessage message=client.send(urlString,"Test Client Send message",null);
  assertNotNull(message);
  assertEquals("Received: Test Client Send message",message.getPayloadAsString());
  client.unregisterComponent(name);
  if (!canSendWithoutReceiver) {
    try {
      message=client.send(urlString,"Test Client Send message",null);
      fail("There is no receiver for this endpointUri");
    }
 catch (    Exception e) {
      assertTrue(e.getCause() instanceof NoReceiverForEndpointException);
    }
  }
}
