{
  MuleClient client=new MuleClient(muleContext);
  if (!canSendWithoutReceiver) {
    MuleMessage result=client.send(endpoint,"Test Client Send message",null);
    assertNotNull(result);
    assertNotNull("There is no receiver for this endpointUri",result.getExceptionPayload());
    Throwable e=result.getExceptionPayload().getException();
    assertTrue(e instanceof DispatchException);
    assertTrue(e.getCause() instanceof NoReceiverForEndpointException);
  }
  Service c=muleContext.getRegistry().lookupService(component);
  c.start();
  MuleMessage message=client.send(endpoint,"Test Client Send message",null);
  assertNotNull(message);
  assertEquals("Received: Test Client Send message",message.getPayloadAsString());
  c.stop();
  if (!canSendWithoutReceiver) {
    MuleMessage result=client.send(endpoint,"Test Client Send message",null);
    assertNotNull(result);
    assertNotNull("There is no receiver for this endpointUri",result.getExceptionPayload());
    Throwable e=result.getExceptionPayload().getException();
    assertTrue(e instanceof DispatchException);
    assertTrue(e.getCause() instanceof NoReceiverForEndpointException);
  }
}
