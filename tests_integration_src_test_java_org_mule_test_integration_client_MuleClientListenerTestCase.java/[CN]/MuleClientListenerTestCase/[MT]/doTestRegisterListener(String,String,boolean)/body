{
  MuleClient client=new MuleClient(muleContext);
  try {
    client.send(endpoint,"Test Client Send message",null);
  }
 catch (  DispatchException e) {
    if (!canSendWithoutReceiver) {
      assertTrue(e.getCause() instanceof NoReceiverForEndpointException);
    }
  }
  Object c=muleContext.getRegistry().lookupObject(component);
  MuleMessage message=client.send(endpoint,"Test Client Send message",null);
  assertNotNull(message);
  assertEquals("Received: Test Client Send message",message.getPayloadAsString());
  ((Stoppable)c).stop();
  try {
    client.send(endpoint,"Test Client Send message",null);
  }
 catch (  DispatchException e) {
    if (!canSendWithoutReceiver) {
      assertTrue(e.getCause() instanceof NoReceiverForEndpointException);
    }
  }
}
