{
  final String payload="payload";
  runFlow("dispatch",getTestEvent(payload));
  MuleMessage response=muleContext.getClient().request("vm://in",5000);
  assertThat(response,is(notNullValue()));
  assertThat(response.getPayloadAsString(),is(payload));
  ArgumentCaptor<MuleEvent> eventArgumentCaptor=ArgumentCaptor.forClass(MuleEvent.class);
  verify(objectSerializer,atLeastOnce()).serialize(eventArgumentCaptor.capture());
  MuleEvent capturedEvent=eventArgumentCaptor.getValue();
  assertThat(capturedEvent,is(notNullValue()));
  assertThat(capturedEvent.getMessage().getPayloadAsString(),is(payload));
  verify(objectSerializer,atLeastOnce()).deserialize(any(byte[].class));
}
