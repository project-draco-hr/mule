{
  final TransactionalQueueManager mgr=createQueueManager();
  mgr.setDefaultQueueConfiguration(new QueueConfiguration(1));
  try {
    mgr.start();
    QueueSession s=mgr.getQueueSession();
    Queue q=s.getQueue("queue1");
    assertEquals(q.size(),0);
    assertTrue(q.offer("String1",0L));
    assertEquals(q.size(),1);
    assertFalse(q.offer("String2",1000));
    assertEquals(q.size(),1);
    new Thread(new Runnable(){
      public void run(){
        try {
          Thread.sleep(500);
          QueueSession s=mgr.getQueueSession();
          Queue q=s.getQueue("queue1");
          assertEquals("String1",q.take());
        }
 catch (        Exception e) {
          e.printStackTrace();
        }
      }
    }
).start();
    assertTrue(q.offer("String2",1000));
    assertEquals(q.size(),1);
  }
  finally {
    mgr.stop(AbstractResourceManager.SHUTDOWN_MODE_NORMAL);
  }
}
