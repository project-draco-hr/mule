{
  if (isPersistent()) {
    TransactionalQueueManager mgr1=createQueueManager();
    QueueSession s1=mgr1.getQueueSession();
    Queue q1=s1.getQueue("queue1");
    mgr1.start();
    assertEquals("Queue size",0,q1.size());
    final int numberOfElements=10;
    for (int i=1; i <= numberOfElements; i++) {
      q1.put("String" + i);
      assertEquals("Queue size",i,q1.size());
    }
    mgr1.stop(AbstractResourceManager.SHUTDOWN_MODE_NORMAL);
    TransactionalQueueManager mgr2=createQueueManager();
    QueueSession s2=mgr2.getQueueSession();
    Queue q2=s2.getQueue("queue1");
    mgr2.start();
    for (int i=1; i <= numberOfElements; i++) {
      Object o=q2.take();
      assertNotNull(o);
      assertEquals("Queue content","String" + i,o);
    }
    assertEquals("Queue size",0,q2.size());
    purgeQueue(q2);
    mgr2.stop(AbstractResourceManager.SHUTDOWN_MODE_NORMAL);
  }
}
