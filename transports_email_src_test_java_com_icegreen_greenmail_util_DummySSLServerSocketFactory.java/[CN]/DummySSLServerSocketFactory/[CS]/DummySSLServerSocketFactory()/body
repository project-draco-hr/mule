{
  try {
    SSLContext sslcontext=SSLContext.getInstance("TLS");
    String defaultAlg=KeyManagerFactory.getDefaultAlgorithm();
    KeyManagerFactory km=KeyManagerFactory.getInstance(defaultAlg);
    ks=KeyStore.getInstance(KeyStore.getDefaultType());
    char[] pass="changeit".toCharArray();
    InputStream is=Thread.currentThread().getContextClassLoader().getResourceAsStream("greenmail.jks");
    try {
      ks.load(is,pass);
    }
 catch (    IOException ex) {
      log.warn("Can not load greenmail keystore from 'greenmail.jks' in classpath. Falling back to hard coded keystore.",ex);
      ks.load(new ByteArrayInputStream(HARD_CODED_KEY_STORE),pass);
    }
 finally {
      is.close();
    }
    km.init(ks,pass);
    KeyManager[] kma=km.getKeyManagers();
    sslcontext.init(kma,new TrustManager[]{new DummyTrustManager()},null);
    factory=sslcontext.getServerSocketFactory();
  }
 catch (  Exception e) {
    log.error("Can not initialize",e);
    System.exit(-1);
  }
}
