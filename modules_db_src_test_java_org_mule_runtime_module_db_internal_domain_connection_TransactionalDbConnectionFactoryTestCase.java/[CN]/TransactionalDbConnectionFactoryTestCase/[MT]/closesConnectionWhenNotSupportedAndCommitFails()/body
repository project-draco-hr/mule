{
  when(dbTransactionManager.getTransaction()).thenReturn(null);
  DbConnection connection=mock(DbConnection.class);
  when(connection.getTransactionalAction()).thenReturn(TransactionalAction.NOT_SUPPORTED);
  doThrow(new SQLException()).when(connection).commit();
  factory=new TransactionalDbConnectionFactory(dbTransactionManager,null,null,null);
  factory.releaseConnection(connection);
  verify(connection,times(1)).commit();
  verify(connection,times(1)).close();
}
