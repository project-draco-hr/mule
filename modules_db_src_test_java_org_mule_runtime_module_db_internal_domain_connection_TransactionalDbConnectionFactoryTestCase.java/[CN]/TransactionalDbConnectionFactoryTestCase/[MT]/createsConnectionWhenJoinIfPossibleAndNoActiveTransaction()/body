{
  Connection expectedConnection=mock(Connection.class);
  when(connectionFactory.create(datasource)).thenReturn(expectedConnection);
  factory=new TransactionalDbConnectionFactory(dbTransactionManager,null,connectionFactory,datasource);
  DbConnection connection=factory.createConnection(TransactionalAction.JOIN_IF_POSSIBLE);
  assertWrappedConnection(connection,expectedConnection);
}
