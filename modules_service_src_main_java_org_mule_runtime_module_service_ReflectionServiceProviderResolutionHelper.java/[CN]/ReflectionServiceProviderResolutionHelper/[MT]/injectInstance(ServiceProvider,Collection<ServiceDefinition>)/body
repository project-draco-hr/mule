{
  for (  Field field : getAllFields(serviceProvider.getClass(),withAnnotation(Inject.class))) {
    Class<?> dependencyType=field.getType();
    final Object dependency=lookupService(resolvedServices,dependencyType);
    if (dependency == null) {
      throw new ServiceResolutionError(format("Cannot find a service to inject into field '%s' of service provider '%s'",field.getName(),serviceProvider.getClass().getName()));
    }
    try {
      field.setAccessible(true);
      field.set(serviceProvider,dependency);
    }
 catch (    Exception e) {
      throw new ServiceResolutionError(format("Could not inject dependency on field %s of type %s",field.getName(),dependencyType.getClass().getName()),e);
    }
  }
}
