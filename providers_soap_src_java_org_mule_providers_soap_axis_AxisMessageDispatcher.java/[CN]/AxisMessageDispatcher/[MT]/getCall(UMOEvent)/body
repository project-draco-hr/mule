{
  UMOEndpointURI endpointUri=event.getEndpoint().getEndpointURI();
  String method=(String)endpointUri.getParams().remove("method");
  if (method == null) {
    method=(String)event.getEndpoint().getProperties().get("method");
    if (method == null) {
      throw new DispatchException(new org.mule.config.i18n.Message("soap",4),event.getMessage(),event.getEndpoint());
    }
  }
  Call call=(Call)getService(event).createCall();
  BeanUtils.populateWithoutFail(call,event.getEndpoint().getProperties(),false);
  call.setTargetEndpointAddress(endpointUri.getAddress());
  call.setSOAPActionURI(endpointUri.getAddress());
  call.setOperationName(method);
  call.setProperty(MuleProperties.MULE_EVENT_PROPERTY,event);
  int timeout=event.getIntProperty(MuleProperties.MULE_EVENT_TIMEOUT_PROPERTY,-1);
  if (timeout >= 0) {
    call.setTimeout(new Integer(timeout));
  }
  if (endpointUri.getUserInfo() != null) {
    call.setUsername(endpointUri.getUsername());
    call.setPassword(endpointUri.getPassword());
  }
  return call;
}
