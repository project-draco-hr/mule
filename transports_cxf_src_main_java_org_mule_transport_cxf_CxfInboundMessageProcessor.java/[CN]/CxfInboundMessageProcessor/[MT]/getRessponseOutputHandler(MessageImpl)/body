{
  OutputHandler outputHandler=new OutputHandler(){
    public void write(    MuleEvent event,    OutputStream out) throws IOException {
      Message outFaultMessage=m.getExchange().getOutFaultMessage();
      Message outMessage=m.getExchange().getOutMessage();
      Message contentMsg=null;
      if (outFaultMessage != null && outFaultMessage.getContent(OutputStream.class) != null) {
        contentMsg=outFaultMessage;
      }
 else       if (outMessage != null) {
        contentMsg=outMessage;
      }
      if (contentMsg == null) {
        return;
      }
      DelegatingOutputStream delegate=contentMsg.getContent(DelegatingOutputStream.class);
      out.write(((ByteArrayOutputStream)delegate.getOutputStream()).toByteArray());
      delegate.setOutputStream(out);
      out.flush();
      contentMsg.getInterceptorChain().resume();
    }
  }
;
  return outputHandler;
}
