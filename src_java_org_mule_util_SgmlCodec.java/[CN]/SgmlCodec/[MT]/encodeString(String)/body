{
  int length=s.length();
  StringBuffer buffer=new StringBuffer(length * 2);
  for (int i=0; i < length; i++) {
    char c=s.charAt(i);
    int j=c;
    if ((j < 0x100) && (encoder[j] != null)) {
      buffer.append(encoder[j]);
      buffer.append(';');
    }
 else     if (j < 0x80) {
      buffer.append(c);
    }
 else {
      buffer.append("&#");
      buffer.append((int)c);
      buffer.append(';');
    }
  }
  return buffer.toString();
}
