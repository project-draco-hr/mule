{
  if (muleEvent == null) {
    return query;
  }
  try {
    QueryTemplate queryTemplate=query.getQueryTemplate();
    String resolvedSqlText=expressionManager.parse(queryTemplate.getSqlText(),muleEvent);
    queryTemplate=queryTemplateParser.parse(resolvedSqlText);
    return new Query(queryTemplate,Collections.<QueryParamValue>emptyList());
  }
 catch (  RuntimeException e) {
    throw new QueryResolutionException("Error parsing query",e);
  }
}
