{
  Flow flow=(Flow)getFlowConstruct("limitedConnections");
  Thread t1=processAsynchronously(flow);
  messageArrived.await();
  try {
    flow.process(getTestEvent(TEST_MESSAGE));
    fail("Max connections should be reached.");
  }
 catch (  MessagingException e) {
  }
  messageHold.release();
  t1.join();
}
