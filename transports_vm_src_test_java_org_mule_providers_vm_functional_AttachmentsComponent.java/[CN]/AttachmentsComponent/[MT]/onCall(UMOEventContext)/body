{
  UMOMessage msg=eventContext.getMessage();
  if (msg.getAttachmentNames().size() == 2) {
    throw new IllegalArgumentException("There shuold be 2 attachments");
  }
  DataHandler dh=msg.getAttachment("test-attachment");
  if (dh == null) {
    throw new IllegalArgumentException("test-attachment is not on the message");
  }
  if (!dh.getContentType().startsWith("text/xml")) {
    throw new IllegalArgumentException("content type is not text/xml");
  }
  if (!"Mmm... attachments!".equals(msg.getPayloadAsString())) {
    throw new IllegalArgumentException("payload is incorrect");
  }
  UMOMessage result=new MuleMessage("here is one for you!");
  FileDataSource ds=new FileDataSource(new File("transports/vm/src/test/resources/test.gif").getAbsoluteFile());
  result.addAttachment("mule",new DataHandler(ds));
  return result;
}
