{
  assertTargetPresent();
  String newName=bestGuessName(targetConfig,oldName,target.getBeanClassName());
  MutablePropertyValues targetProperties=target.getPropertyValues();
  PropertyValue pv=targetProperties.getPropertyValue(newName);
  Object oldValue=null == pv ? null : pv.getValue();
  BeanDefinitionBuilder messageFilter=BeanDefinitionBuilder.genericBeanDefinition(MessageFilter.class);
  messageFilter.addPropertyValue(FILTER,bean.getBeanDefinition());
  if (oldValue == null) {
    oldValue=new ManagedList();
    pv=new PropertyValue(newName,oldValue);
    targetProperties.addPropertyValue(pv);
  }
  if (targetConfig.isCollection(oldName)) {
    List list=retrieveList(oldValue);
    list.add(messageFilter.getBeanDefinition());
  }
 else {
    targetProperties.addPropertyValue(newName,messageFilter.getBeanDefinition());
  }
}
