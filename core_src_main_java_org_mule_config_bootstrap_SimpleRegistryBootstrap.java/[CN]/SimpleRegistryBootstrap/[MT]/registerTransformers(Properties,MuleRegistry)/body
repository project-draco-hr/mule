{
  int i=1;
  String transString=props.getProperty(TRANSFORMER_PREFIX + i);
  String name=null;
  String returnClassString=null;
  boolean optional=false;
  while (transString != null) {
    Class returnClass=null;
    int x=transString.indexOf(",");
    if (x > -1) {
      Properties p=PropertiesUtils.getPropertiesFromString(transString.substring(x + 1),',');
      name=p.getProperty("name",null);
      returnClassString=p.getProperty("returnClass",null);
      optional=p.containsKey("optional");
    }
    final String transClass=(x == -1 ? transString : transString.substring(0,x));
    try {
      if (returnClassString != null) {
        if (returnClassString.equals("byte[]")) {
          returnClass=byte[].class;
        }
 else {
          returnClass=ClassUtils.loadClass(returnClassString,getClass());
        }
      }
      Transformer trans=(Transformer)ClassUtils.instanciateClass(transClass);
      if (!(trans instanceof DiscoverableTransformer)) {
        throw new TransformerException(CoreMessages.transformerNotImplementDiscoverable(trans));
      }
      if (returnClass != null) {
        trans.setReturnClass(returnClass);
      }
      if (name != null) {
        trans.setName(name);
      }
 else {
        name=trans.getName();
        trans.setName("_" + name);
      }
      registry.registerTransformer(trans);
    }
 catch (    InvocationTargetException itex) {
      Throwable cause=ExceptionUtils.getCause(itex);
      if (cause instanceof NoClassDefFoundError && optional) {
        if (logger.isDebugEnabled()) {
          logger.debug("Ignoring optional transformer: " + transClass);
        }
      }
 else {
        throw new Exception(cause);
      }
    }
catch (    NoClassDefFoundError ncdfe) {
      if (optional) {
        if (logger.isDebugEnabled()) {
          logger.debug("Ignoring optional transformer: " + transClass);
        }
      }
 else {
        throw ncdfe;
      }
    }
catch (    ClassNotFoundException cnfe) {
      if (optional) {
        if (logger.isDebugEnabled()) {
          logger.debug("Ignoring optional transformer: " + transClass);
        }
      }
 else {
        throw cnfe;
      }
    }
    props.remove(TRANSFORMER_PREFIX + i++);
    name=null;
    returnClass=null;
    transString=props.getProperty(TRANSFORMER_PREFIX + i);
  }
}
