{
  StringToEmailMessage trans=new StringToEmailMessage();
  UMOEndpoint endpoint=new MuleEndpoint("smtp://a:a@a.com",false);
  final Mock mockDispatcher=new Mock(UMOMessageDispatcher.class);
  mockDispatcher.expectAndReturn("getDelegateSession",Session.getDefaultInstance(new Properties()));
  mockDispatcher.expectAndReturn("getDelegateSession",Session.getDefaultInstance(new Properties()));
  endpoint.setConnector(new SmtpConnector(){
    public UMOMessageDispatcher getDispatcher() throws UMOException {
      return (UMOMessageDispatcher)mockDispatcher.proxy();
    }
  }
);
  trans.setEndpoint(endpoint);
  return trans;
}
