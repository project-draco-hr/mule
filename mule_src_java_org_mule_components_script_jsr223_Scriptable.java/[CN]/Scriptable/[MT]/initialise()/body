{
  if (scriptEngine == null) {
    if (compiledScript == null) {
      if (scriptEngineName != null) {
        scriptEngine=createScriptEngine();
      }
 else       if (scriptFile != null) {
        int i=scriptFile.lastIndexOf(".");
        if (i > -1) {
          setScriptEngineName(scriptFile.substring(i + 1));
          logger.info("Script Engine name not set.  Defaulting to file extension: " + getScriptEngineName());
          scriptEngine=createScriptEngine();
        }
      }
      if (scriptEngine == null) {
        throw new InitialisationException(new Message(Messages.PROPERTIES_X_NOT_SET,"scriptEngine, scriptEngineName, compiledScript"),this);
      }
    }
 else {
      scriptEngine=compiledScript.getEngine();
    }
  }
  if (compiledScript == null) {
    if (script == null) {
      if (scriptText == null && scriptFile == null) {
        throw new InitialisationException(new Message(Messages.PROPERTIES_X_NOT_SET,"scriptText, scriptFile"),this);
      }
 else       if (scriptText != null) {
        script=new StringReader(scriptText);
      }
 else {
        InputStream is=null;
        try {
          is=FileUtils.loadResource(scriptFile,getClass());
          script=new InputStreamReader(is);
        }
 catch (        IOException e) {
          throw new InitialisationException(new Message(Messages.CANT_LOAD_X_FROM_CLASSPATH_FILE,scriptFile),e,this);
        }
      }
    }
    try {
      compiledScript=compileScript(script);
    }
 catch (    ScriptException e) {
      throw new InitialisationException(e,this);
    }
  }
}
