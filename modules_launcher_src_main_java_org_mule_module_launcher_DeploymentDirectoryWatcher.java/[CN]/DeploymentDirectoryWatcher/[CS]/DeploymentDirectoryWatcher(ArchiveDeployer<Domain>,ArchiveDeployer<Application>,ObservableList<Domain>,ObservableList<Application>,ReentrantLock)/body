{
  this.appsDir=applicationArchiveDeployer.getDeploymentDirectory();
  this.domainsDir=domainArchiveDeployer.getDeploymentDirectory();
  this.deploymentLock=deploymentLock;
  this.domainArchiveDeployer=domainArchiveDeployer;
  this.applicationArchiveDeployer=applicationArchiveDeployer;
  this.applications=applications;
  this.domains=domains;
  applications.addPropertyChangeListener(new PropertyChangeListener(){
    public void propertyChange(    PropertyChangeEvent e){
      if (e instanceof ElementAddedEvent || e instanceof ElementRemovedEvent) {
        if (logger.isDebugEnabled()) {
          logger.debug("Deployed applications set has been modified, flushing state.");
        }
        dirty=true;
      }
    }
  }
);
  domains.addPropertyChangeListener(new PropertyChangeListener(){
    public void propertyChange(    PropertyChangeEvent e){
      if (e instanceof ElementAddedEvent || e instanceof ElementRemovedEvent) {
        if (logger.isDebugEnabled()) {
          logger.debug("Deployed applications set has been modified, flushing state.");
        }
        dirty=true;
      }
    }
  }
);
  this.applicationTimestampListener=new ArtifactTimestampListener(applications);
  this.domainTimestampListener=new ArtifactTimestampListener(domains);
}
