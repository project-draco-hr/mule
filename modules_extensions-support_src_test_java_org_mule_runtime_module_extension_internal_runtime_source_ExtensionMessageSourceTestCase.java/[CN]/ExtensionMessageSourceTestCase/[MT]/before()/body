{
  spyInjector(muleContext);
  when(threadingProfile.createWorkManager(anyString(),eq(muleContext.getConfiguration().getShutdownTimeout()))).thenReturn(workManager);
  when(sourceFactory.createSource()).thenReturn(source);
  when(muleMessage.getMuleContext()).thenReturn(muleContext);
  when(sourceModel.getExceptionEnricherFactory()).thenReturn(Optional.empty());
  when(sourceModel.getName()).thenReturn(SOURCE_NAME);
  when(extensionModel.getExceptionEnricherFactory()).thenReturn(Optional.empty());
  mockClassLoaderModelProperty(extensionModel,getClass().getClassLoader());
  initialiseIfNeeded(retryPolicyTemplate,muleContext);
  muleContext.getRegistry().registerObject(OBJECT_EXTENSION_MANAGER,extensionManager);
  when(extensionModel.getModelProperty(SubTypesModelProperty.class)).thenReturn(Optional.empty());
  when(configurationModel.getSourceModel(SOURCE_NAME)).thenReturn(Optional.of(sourceModel));
  when(extensionManager.getConfigurationProvider(CONFIG_NAME)).thenReturn(Optional.of(configurationProvider));
  when(configurationProvider.get(any())).thenReturn(configurationInstance);
  when(configurationProvider.getModel()).thenReturn(configurationModel);
  messageSource=getNewExtensionMessageSourceInstance();
}
