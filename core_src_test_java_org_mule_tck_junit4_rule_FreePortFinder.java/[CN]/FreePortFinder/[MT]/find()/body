{
  for (int port=minPortNumber; port < maxPortNumber; port++) {
    if (selectedPorts.contains(port)) {
      continue;
    }
    if (isPortFree(port)) {
      if (logger.isDebugEnabled()) {
        logger.debug("Found free port: " + port);
      }
      selectedPorts.add(port);
      return port;
    }
  }
  throw new IllegalStateException("Unable to find an available port");
}
