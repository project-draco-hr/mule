{
  if (!(key instanceof String)) {
    throw new IllegalArgumentException("Invalid key type");
  }
  OAuthState state=null;
  if (!this.objectStore.contains(((String)key))) {
    throw new RuntimeException((("There is no access token stored under the key " + ((String)key)) + ". You need to call the <authorize> message processor. The key will be given to you via a flow variable after the OAuth dance is completed. You can extract it using flowVars['tokenId']."));
  }
  state=this.objectStore.retrieve((String)key);
  OAuth2Adapter connector=this.getAdapterClass().getConstructor(OAuth2Manager.class).newInstance(this.oauthManager);
  connector.setConsumerKey(oauthManager.getConsumerKey());
  connector.setConsumerSecret(oauthManager.getConsumerSecret());
  connector.setAccessToken(state.getAccessToken());
  connector.setAuthorizationUrl(state.getAuthorizationUrl());
  connector.setAccessTokenUrl(state.getAccessTokenUrl());
  connector.setRefreshToken(state.getRefreshToken());
  this.setCustomAdapterProperties(connector,state);
  if (connector instanceof Initialisable) {
    ((Initialisable)connector).initialise();
  }
  if (connector instanceof MuleContextAware) {
    ((MuleContextAware)connector).setMuleContext(oauthManager.getMuleContext());
  }
  if (connector instanceof Startable) {
    ((Startable)connector).start();
  }
  connector.postAuth();
  return connector;
}
