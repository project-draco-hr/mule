{
  try {
    Object content=part.getContent();
    if (isMultipart(content)) {
      processMultipartPart(part);
    }
    if (isAttachment(part)) {
      Map<String,LinkedList<String>> headers=new HashMap<>();
      final Enumeration allHeaders=part.getAllHeaders();
      while (allHeaders.hasMoreElements()) {
        Header h=(Header)allHeaders.nextElement();
        headers.put(h.getName(),new LinkedList<>(singletonList(h.getValue())));
      }
      attachmentParts.add(MuleMessage.builder().payload(part.getInputStream()).mediaType(MediaType.parse(part.getContentType())).attributes(new PartAttributes(part.getFileName(),part.getFileName(),part.getSize(),headers)).build());
    }
 else {
      if (isText(content)) {
        body.add((String)content);
      }
      if (content instanceof InputStream && isInline(part) && part.isMimeType(TEXT)) {
        String inline=IOUtils.toString((InputStream)content);
        body.add(inline);
      }
    }
  }
 catch (  MessagingException|IOException e) {
    throw new EmailException(ERROR_PROCESSING_MESSAGE,e);
  }
}
