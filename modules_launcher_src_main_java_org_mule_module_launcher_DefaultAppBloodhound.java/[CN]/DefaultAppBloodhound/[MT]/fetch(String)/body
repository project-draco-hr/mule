{
  final String muleHome=System.getProperty(MuleProperties.MULE_HOME_DIRECTORY_PROPERTY);
  File appDir=new File(String.format("%s/apps/%s",muleHome,appName));
  if (!appDir.exists()) {
    throw new MuleRuntimeException(MessageFactory.createStaticMessage(String.format("Application directory does not exist '%s'",appName)));
  }
  @SuppressWarnings("unchecked") Collection<File> deployFiles=FileUtils.listFiles(appDir,new WildcardFileFilter("mule-deploy.*"),null);
  if (deployFiles.isEmpty()) {
    return new EmptyApplicationDescriptor(appName);
  }
  if (deployFiles.size() > 1) {
    throw new MuleRuntimeException(MessageFactory.createStaticMessage(String.format("More than one mule-deploy descriptors found in application '%s'",appName)));
  }
  final File descriptorFile=deployFiles.iterator().next();
  final String ext=FilenameUtils.getExtension(descriptorFile.getName());
  final DescriptorParser descriptorParser=parserRegistry.get(ext);
  if (descriptorParser == null) {
    throw new MuleRuntimeException(MessageFactory.createStaticMessage(String.format("Unsupported deployment descriptor format for app '%s': %s",appName,ext)));
  }
  ApplicationDescriptor desc=descriptorParser.parse(descriptorFile);
  desc.setAppName(appName);
  return desc;
}
