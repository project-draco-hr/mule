{
  final MuleEvent response=flowRunner("recipientListFlow").withPayload(TEST_MESSAGE).withInboundProperty("urls",new String[]{getUrlForPort(port1),getUrlForPort(port2),getUrlForPort(port3)}).run();
  assertThat(response,notNullValue());
  assertThat(response.getMessage().getPayload(),IsInstanceOf.instanceOf(List.class));
  MuleMessage aggregatedResponse=response.getMessage();
  assertThat(((List<MuleMessage>)aggregatedResponse.getPayload()).size(),is(3));
  final MuleMessage[] messages=(MuleMessage[])((List<MuleMessage>)aggregatedResponse.getPayload()).toArray();
  for (int i=0; i < messages.length; i++) {
    MuleMessage message=messages[i];
    assertThat(message,notNullValue());
    assertThat(getPayloadAsString(message),is("inXFlowResponse".replace("X",String.valueOf(i + 1))));
  }
}
