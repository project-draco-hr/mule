{
  HttpState state=new HttpState();
  if (getProxyUsername() != null) {
    state.setProxyCredentials(new AuthScope(null,-1,null,null),new UsernamePasswordCredentials(getProxyUsername(),getProxyPassword()));
  }
  HttpClient client=new HttpClient();
  client.setState(state);
  client.setHttpConnectionManager(getClientConnectionManager());
  return client;
}
