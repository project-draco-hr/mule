{
  final int newBufferSize=8 * 1024;
  testWithSystemProperty(MuleProperties.MULE_STREAMING_BUFFER_SIZE,Integer.toString(newBufferSize),new TestCallback(){
    @Override public void run() throws Exception {
      InputStream in=new ByteArrayInputStream(new byte[newBufferSize]);
      OutputStream out=mock(OutputStream.class);
      Class clazz=ClassUtils.loadClass(IOUtils.class.getCanonicalName(),new URLClassLoader(((URLClassLoader)Thread.currentThread().getContextClassLoader()).getURLs(),null));
      clazz.getMethod("copyLarge",InputStream.class,OutputStream.class).invoke(clazz.newInstance(),in,out);
      verify(out,times(1)).write(any(byte[].class),Mockito.anyInt(),Mockito.anyInt());
    }
  }
);
}
