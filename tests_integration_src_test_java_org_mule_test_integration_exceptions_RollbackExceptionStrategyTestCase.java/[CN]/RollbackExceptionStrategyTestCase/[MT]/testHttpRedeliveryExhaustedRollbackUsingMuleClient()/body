{
  LocalMuleClient client=muleContext.getClient();
  MuleMessage response=null;
  final HttpRequestOptions httpRequestOptions=newOptions().method(POST.name()).disableStatusCodeValidation().responseTimeout(TIMEOUT).build();
  for (int i=1; i <= EXPECTED_SHORT_DELIVERED_TIMES; i++) {
    response=client.send(String.format("http://localhost:%s",dynamicPort2.getNumber()),new DefaultMuleMessage(MESSAGE,muleContext),httpRequestOptions);
    assertThat(response.<Integer>getInboundProperty(HttpConnector.HTTP_STATUS_PROPERTY),is(500));
  }
  response=client.send(String.format("http://localhost:%s",dynamicPort2.getNumber()),new DefaultMuleMessage(MESSAGE,muleContext),httpRequestOptions);
  assertThat(response.<Integer>getInboundProperty(HttpConnector.HTTP_STATUS_PROPERTY),is(200));
  assertThat(response.getExceptionPayload(),IsNull.<Object>nullValue());
  assertThat(response.getPayloadAsString(),is(MESSAGE_EXPECTED));
}
