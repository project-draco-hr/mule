{
  Connection connection;
  try {
    connection=dataSource.getConnection();
  }
 catch (  SQLException e) {
    throw new ConnectionCreationException("Could not obtain connection from data source",e);
  }
  if (connection == null) {
    throw new ConnectionCreationException("Unable to create connection to the provided dataSource: " + dataSource);
  }
  Map<String,Class<?>> typeMapping=createTypeMapping(customDataTypes);
  if (typeMapping != null && !typeMapping.isEmpty()) {
    try {
      connection.setTypeMap(typeMapping);
    }
 catch (    SQLException e) {
      throw new ConnectionCreationException("Could not set custom data types on connection",e);
    }
  }
  return connection;
}
