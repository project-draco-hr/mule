{
  EndpointURI endpointURI=event.getEndpoint().getEndpointURI();
  Map<String,String> properties=new HashMap<String,String>();
  MuleMessage msg=event.getMessage();
  for (  String name : event.getMessage().getPropertyNames(PropertyScope.INVOCATION)) {
    final String value=msg.getInvocationProperty(name,StringUtils.EMPTY);
    properties.put(name,value);
  }
  for (  String name : event.getMessage().getPropertyNames(PropertyScope.OUTBOUND)) {
    final String value=msg.getStringProperty(name,PropertyScope.OUTBOUND,"");
    properties.put(name,value);
  }
  for (Iterator<?> iterator=msg.getPropertyNames().iterator(); iterator.hasNext(); ) {
    String propertyKey=(String)iterator.next();
    properties.put(propertyKey,msg.getProperty(propertyKey).toString());
  }
  properties.put(MuleProperties.MULE_METHOD_PROPERTY,method.getLocalPart());
  properties.put("methodNamespace",method.getNamespaceURI());
  properties.put("address",endpointURI.getAddress());
  properties.put("scheme",endpointURI.getScheme());
  properties.put("host",endpointURI.getHost());
  properties.put("port",String.valueOf(endpointURI.getPort()));
  properties.put("path",endpointURI.getPath());
  properties.put("hostInfo",endpointURI.getScheme() + "://" + endpointURI.getHost()+ (endpointURI.getPort() > -1 ? ":" + String.valueOf(endpointURI.getPort()) : ""));
  if (event.getFlowConstruct() != null) {
    properties.put("serviceName",event.getFlowConstruct().getName());
  }
  soapAction=soapActionTemplateParser.parse(properties,soapAction);
  if (logger.isDebugEnabled()) {
    logger.debug("SoapAction for this call is: " + soapAction);
  }
  return soapAction;
}
