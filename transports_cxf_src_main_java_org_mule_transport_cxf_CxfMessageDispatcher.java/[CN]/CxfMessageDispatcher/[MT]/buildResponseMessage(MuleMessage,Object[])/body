{
  if (transportResponse == null) {
    return new DefaultMuleMessage(NullPayload.getInstance(),connector.getMuleContext());
  }
  MuleMessage result=null;
  if (response != null && response.length <= 1) {
    if (response.length == 1) {
      result=new DefaultMuleMessage(response[0],transportResponse,connector.getMuleContext());
    }
  }
 else {
    result=new DefaultMuleMessage(response,transportResponse,connector.getMuleContext());
  }
  String statusCode=(String)transportResponse.getProperty(HttpConnector.HTTP_STATUS_PROPERTY);
  if (statusCode == null || Integer.parseInt(statusCode) != HttpConstants.SC_OK) {
    String payload;
    try {
      payload=transportResponse.getPayloadAsString();
    }
 catch (    Exception e) {
      payload="Invalid status code: " + statusCode;
    }
    result.setExceptionPayload(new DefaultExceptionPayload(new HttpException(payload)));
  }
  return result;
}
