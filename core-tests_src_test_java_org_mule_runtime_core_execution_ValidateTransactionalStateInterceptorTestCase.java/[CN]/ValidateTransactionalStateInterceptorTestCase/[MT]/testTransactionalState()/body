{
  boolean shouldThrowException=resultMap.get(hasTransactionInContext).get(transactionConfig);
  Exception thrownException=null;
  Event result=null;
  if (hasTransactionInContext) {
    TransactionCoordination.getInstance().bindTransaction(mockTransaction);
  }
  ValidateTransactionalStateInterceptor<Event> interceptor=new ValidateTransactionalStateInterceptor<Event>(new ExecuteCallbackInterceptor<Event>(),transactionConfig);
  try {
    result=interceptor.execute(new ExecutionCallback<Event>(){
      @Override public Event process() throws Exception {
        return mockMuleEvent;
      }
    }
,new ExecutionContext());
  }
 catch (  IllegalTransactionStateException e) {
    thrownException=e;
  }
  if (shouldThrowException) {
    assertThat(thrownException,IsNull.<Object>notNullValue());
    assertThat(thrownException,IsInstanceOf.instanceOf(IllegalTransactionStateException.class));
  }
 else {
    assertThat(result,Is.is(mockMuleEvent));
  }
}
