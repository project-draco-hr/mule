{
  try {
    muleContext.start();
    fail("Expected Mule to fail to start, due to our RudeMessageProcessor");
  }
 catch (  Exception e) {
    System.err.println("Expected Exception:");
    e.printStackTrace();
  }
  muleContext.dispose();
  new PollingProber(10000,100).check(new Probe(){
    @Override public boolean isSatisfied(){
      boolean threadsStopped=true;
      for (      Thread t : Thread.getAllStackTraces().keySet()) {
        if (t.getName().startsWith("SHUTDOWN_TEST_FLOW") || t.getName().startsWith("MuleServer")) {
          threadsStopped=false;
          break;
        }
      }
      return threadsStopped;
    }
    @Override public String describeFailure(){
      return "mule threads running during dispose";
    }
  }
);
}
