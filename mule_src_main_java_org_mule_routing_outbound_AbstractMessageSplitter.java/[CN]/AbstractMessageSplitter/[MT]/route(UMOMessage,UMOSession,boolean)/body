{
  String correlationId=(String)propertyExtractor.getProperty(MuleProperties.MULE_CORRELATION_ID_PROPERTY,message);
  initialise(message);
  UMOEndpoint endpoint;
  UMOMessage result=null;
  List list=getEndpoints();
  int correlationSequence=1;
  for (Iterator iterator=list.iterator(); iterator.hasNext(); ) {
    endpoint=(UMOEndpoint)iterator.next();
    message=getMessagePart(message,endpoint);
    if (message == null) {
      logger.warn("Message part is null for endpoint: " + endpoint.getEndpointURI().toString());
    }
    while (message != null) {
      try {
        if (enableCorrelation != ENABLE_CORRELATION_NEVER) {
          boolean correlationSet=message.getCorrelationId() != null;
          if (!correlationSet && (enableCorrelation == ENABLE_CORRELATION_IF_NOT_SET)) {
            message.setCorrelationId(correlationId);
          }
          final int groupSize=message.getCorrelationGroupSize();
          message.setCorrelationGroupSize(groupSize);
          message.setCorrelationSequence(correlationSequence++);
        }
        if (synchronous) {
          result=send(session,message,endpoint);
        }
 else {
          dispatch(session,message,endpoint);
        }
      }
 catch (      UMOException e) {
        throw new CouldNotRouteOutboundMessageException(message,endpoint,e);
      }
      if (!multimatch) {
        break;
      }
      message=getMessagePart(message,endpoint);
    }
  }
  return result;
}
