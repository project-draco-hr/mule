{
  MuleClient client=new MuleClient();
  Map props=new HashMap();
  UMOEncryptionStrategy strategy=muleContext.getSecurityManager().getEncryptionStrategy("PBE");
  String header=MuleCredentials.createHeader("Evil","dragon","PBE",strategy);
  props.put(MuleProperties.MULE_USER_PROPERTY,header);
  UMOMessage m=client.send("vm://test","Test",props);
  assertNotNull(m);
  assertTrue(m.getPayload() instanceof String);
  assertFalse(m.getPayloadAsString().equals("Test Received"));
  UMOExceptionPayload exceptionPayload=m.getExceptionPayload();
  assertNotNull(exceptionPayload);
  assertEquals("Authentication failed for principal Evil. Message payload is of type: String",exceptionPayload.getMessage());
}
