{
  Flow flow=new Flow("flow",muleContext);
  LatchedSystemExceptionHandler exceptionListener=new LatchedSystemExceptionHandler();
  muleContext.setExceptionListener(exceptionListener);
  initialiseObject(flow);
  MuleEvent event=getTestEvent(TEST_MESSAGE,flow,MessageExchangePattern.ONE_WAY);
  MessageProcessor next=new MessageProcessor(){
    public MuleEvent process(    MuleEvent event) throws MuleException {
      throw new DefaultMuleException("failure");
    }
  }
;
  messageProcessor.setListener(next);
  messageProcessor.setMuleContext(muleContext);
  messageProcessor.process(event);
  assertTrue(exceptionListener.latch.await(RECEIVE_TIMEOUT,TimeUnit.MILLISECONDS));
}
