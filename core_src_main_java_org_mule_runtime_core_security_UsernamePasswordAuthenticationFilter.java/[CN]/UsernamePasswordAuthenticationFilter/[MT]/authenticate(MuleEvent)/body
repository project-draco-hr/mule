{
  Authentication authentication=getAuthenticationToken(event);
  Authentication authResult;
  try {
    authResult=getSecurityManager().authenticate(authentication);
  }
 catch (  UnauthorisedException e) {
    if (logger.isDebugEnabled()) {
      logger.debug("Authentication request for user: " + username + " failed: "+ e.toString());
    }
    throw new UnauthorisedException(CoreMessages.authFailedForUser(authentication.getPrincipal().toString()),e);
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Authentication success: " + authResult.toString());
  }
  SecurityContext context=getSecurityManager().createSecurityContext(authResult);
  context.setAuthentication(authResult);
  event.getSession().setSecurityContext(context);
  return event;
}
