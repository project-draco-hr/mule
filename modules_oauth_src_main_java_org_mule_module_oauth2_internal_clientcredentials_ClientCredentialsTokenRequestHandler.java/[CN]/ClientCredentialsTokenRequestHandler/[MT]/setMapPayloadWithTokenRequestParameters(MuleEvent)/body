{
  final HashMap<String,String> formData=new HashMap<String,String>();
  formData.put(OAuthConstants.GRANT_TYPE_PARAMETER,OAuthConstants.GRANT_TYPE_CLIENT_CREDENTIALS);
  String clientId=applicationCredentials.getClientId();
  String clientSecret=applicationCredentials.getClientSecret();
  if (encodeClientCredentialsInBody) {
    formData.put(OAuthConstants.CLIENT_ID_PARAMETER,clientId);
    formData.put(OAuthConstants.CLIENT_SECRET_PARAMETER,clientSecret);
  }
 else {
    String encodedCredentials=Base64.encodeBase64String(String.format("%s:%s",clientId,clientSecret).getBytes());
    event.getMessage().setOutboundProperty(HttpHeaders.Names.AUTHORIZATION,"Basic " + encodedCredentials);
  }
  if (scopes != null) {
    formData.put(OAuthConstants.SCOPE_PARAMETER,scopes);
  }
  event.getMessage().setPayload(formData);
}
