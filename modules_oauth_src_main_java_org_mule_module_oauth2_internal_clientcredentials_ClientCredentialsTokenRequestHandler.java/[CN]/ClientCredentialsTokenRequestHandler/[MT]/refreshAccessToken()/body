{
  final DefaultMuleEvent accessTokenEvent=new DefaultMuleEvent(new DefaultMuleMessage(NullPayload.getInstance(),getMuleContext()),MessageExchangePattern.REQUEST_RESPONSE,new Flow("test",getMuleContext()));
  setMapPayloadWithTokenRequestParameters(accessTokenEvent);
  final MuleEvent response=invokeTokenUrl(accessTokenEvent);
  final TokenResponseProcessor tokenResponseProcessor=TokenResponseProcessor.createClientCredentialsrocessor(tokenResponseConfiguration,getMuleContext().getExpressionManager());
  tokenResponseProcessor.process(response);
  final ResourceOwnerOAuthContext defaultUserState=tokenManager.getConfigOAuthContext().getContextForResourceOwner(ResourceOwnerOAuthContext.DEFAULT_RESOURCE_OWNER_ID);
  defaultUserState.setAccessToken(tokenResponseProcessor.getAccessToken());
  defaultUserState.setExpiresIn(tokenResponseProcessor.getExpiresIn());
  for (  NameValuePair parameter : tokenResponseProcessor.getCustomResponseParameters()) {
    defaultUserState.getTokenResponseParameters().put(parameter.getName(),parameter.getValue());
  }
  tokenManager.getConfigOAuthContext().updateResourceOwnerOAuthContext(defaultUserState);
}
