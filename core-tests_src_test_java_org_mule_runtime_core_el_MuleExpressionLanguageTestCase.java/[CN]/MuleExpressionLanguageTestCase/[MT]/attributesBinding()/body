{
  ExpressionLanguage expressionLanguage=spy(MuleExpressionLanguage.class);
  MuleEvent event=getEventWithError(empty());
  Message message=mock(Message.class);
  when(event.getMessage()).thenReturn(message);
  Attributes at=mock(Attributes.class);
  when(message.getAttributes()).thenReturn(at);
  BindingContext context=getBindingContextFromEvaluation(expressionLanguage,event);
  assertThat(context.lookup(ATTRIBUTES).get().getValue(),is(sameInstance(at)));
}
