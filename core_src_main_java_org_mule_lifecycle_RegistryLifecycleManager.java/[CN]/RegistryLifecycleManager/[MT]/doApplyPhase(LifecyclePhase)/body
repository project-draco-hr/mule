{
  if (logger.isDebugEnabled()) {
    logger.debug("Applying lifecycle phase: " + phase.getName());
  }
  if (phase instanceof ContainerManagedLifecyclePhase) {
    phase.applyLifecycle(registry);
    return;
  }
  Set duplicates=new HashSet();
  for (  LifecycleObject lo : phase.getOrderedLifecycleObjects()) {
    Collection<?> targetsObj=registry.lookupObjects(lo.getType());
    List targets=new LinkedList(targetsObj);
    if (targets.size() == 0) {
      continue;
    }
    lo.firePreNotification(muleContext);
    for (Iterator target=targets.iterator(); target.hasNext(); ) {
      Object o=target.next();
      if (duplicates.contains(o)) {
        target.remove();
      }
 else {
        if (logger.isDebugEnabled()) {
          logger.debug("lifecycle phase: " + phase.getName() + " for object: "+ o);
        }
        phase.applyLifecycle(o);
        target.remove();
        duplicates.add(o);
      }
    }
    lo.firePostNotification(muleContext);
  }
}
