{
  UMOMessageAdapter adapter=connector.getMessageAdapter(new ByteArrayInputStream(data));
  UMOMessage message=new MuleMessage(adapter);
  if (logger.isDebugEnabled()) {
    logger.debug((String)message.getProperty(HttpConnector.HTTP_REQUEST_PROPERTY));
  }
  OutputStream os=new ResponseOutputStream(dataOut,socket);
  UMOMessage returnMessage=routeMessage(message,connector.isSynchronous(),os);
  if (returnMessage == null) {
    return new byte[]{};
  }
 else {
    RequestContext.rewriteEvent(returnMessage);
    String responseText=(String)getResponseTransformer().transform(returnMessage.getPayload());
    return responseText.getBytes();
  }
}
