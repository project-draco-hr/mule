{
  Mock session=MuleTestUtils.getMockSession();
  Service testService=getTestService("test",Apple.class);
  assertNotNull(testService);
  InboundRouterCollection messageRouter=new DefaultInboundRouterCollection();
  SimpleEventResequencer router=new SimpleEventResequencer(3);
  messageRouter.addRouter(router);
  messageRouter.setCatchAllStrategy(new LoggingCatchAllStrategy());
  MuleMessage message1=new DefaultMuleMessage("test event A");
  MuleMessage message2=new DefaultMuleMessage("test event B");
  MuleMessage message3=new DefaultMuleMessage("test event C");
  Endpoint endpoint=getTestOutboundEndpoint("Test1Provider");
  MuleEvent event1=new DefaultMuleEvent(message1,endpoint,(MuleSession)session.proxy(),false);
  MuleEvent event2=new DefaultMuleEvent(message2,endpoint,(MuleSession)session.proxy(),false);
  MuleEvent event3=new DefaultMuleEvent(message3,endpoint,(MuleSession)session.proxy(),false);
  assertTrue(router.isMatch(event1));
  assertTrue(router.isMatch(event2));
  assertTrue(router.isMatch(event3));
  assertNull(router.process(event2));
  assertNull(router.process(event3));
  MuleEvent[] results=router.process(event1);
  assertNotNull(results);
  assertEquals(3,results.length);
  assertEquals("test event B",results[0].getMessageAsString());
  assertEquals("test event C",results[1].getMessageAsString());
  assertEquals("test event A",results[2].getMessageAsString());
  router.setComparator(new EventPayloadComparator());
  assertNull(router.process(event2));
  assertNull(router.process(event3));
  results=router.process(event1);
  assertNotNull(results);
  assertEquals(3,results.length);
  assertEquals("test event A",results[0].getMessageAsString());
  assertEquals("test event B",results[1].getMessageAsString());
  assertEquals("test event C",results[2].getMessageAsString());
}
