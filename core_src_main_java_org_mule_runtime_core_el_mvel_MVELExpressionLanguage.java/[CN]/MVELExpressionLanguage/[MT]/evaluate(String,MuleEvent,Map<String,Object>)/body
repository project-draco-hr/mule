{
  if (event == null) {
    return evaluate(expression,vars);
  }
  MVELExpressionLanguageContext context=createExpressionLanguageContext();
  if (vars != null) {
    context.setNextFactory(new CachedMapVariableResolverFactory(vars,new DelegateVariableResolverFactory(staticContext,new EventVariableResolverFactory(parserConfiguration,muleContext,event,new DelegateVariableResolverFactory(globalContext,createVariableVariableResolverFactory(event))))));
  }
 else {
    context.setNextFactory(new DelegateVariableResolverFactory(staticContext,new EventVariableResolverFactory(parserConfiguration,muleContext,event,new DelegateVariableResolverFactory(globalContext,createVariableVariableResolverFactory(event)))));
  }
  return evaluateInternal(expression,context);
}
