{
  if (event == null) {
    return evaluate(expression,vars);
  }
  MVELExpressionLanguageContext context=createExpressionLanguageContext();
  final DelegateVariableResolverFactory innerDelegate=new DelegateVariableResolverFactory(globalContext,createVariableVariableResolverFactory(event));
  final DelegateVariableResolverFactory delegate=new DelegateVariableResolverFactory(staticContext,new EventVariableResolverFactory(parserConfiguration,muleContext,event,flowConstruct,innerDelegate));
  if (vars != null) {
    context.setNextFactory(new CachedMapVariableResolverFactory(vars,delegate));
  }
 else {
    context.setNextFactory(delegate);
  }
  return evaluateInternal(expression,context);
}
