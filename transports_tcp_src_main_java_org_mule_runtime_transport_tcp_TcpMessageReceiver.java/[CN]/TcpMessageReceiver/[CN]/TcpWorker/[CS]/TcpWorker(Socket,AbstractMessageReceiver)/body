{
  super(socket,receiver,((TcpConnector)connector).getTcpProtocol().createResponse(socket));
  this.socket=socket;
  final TcpConnector tcpConnector=((TcpConnector)connector);
  protocol=tcpConnector.getTcpProtocol();
  tcpConnector.configureSocket(TcpConnector.SERVER,socket);
  underlyingIn=new BufferedInputStream(socket.getInputStream());
  dataIn=new TcpInputStream(underlyingIn){
    @Override public void close() throws IOException {
      dataInWorkFinished=true;
      moreMessages=false;
synchronized (notify) {
        notify.notifyAll();
      }
    }
  }
;
  dataOut=new BufferedOutputStream(socket.getOutputStream());
}
