{
  ServiceEndpoint se=me.getEndpoint();
  QName service=me.getService();
  QName interf=me.getInterfaceName();
  if (se != null) {
    se=container.getEndpoints().getEndpoint(se.getServiceName(),se.getEndpointName());
    if (se == null) {
      throw new MessagingException("Could not find activated endpoint");
    }
    se=selectEndpoint(me,new ServiceEndpoint[]{se});
    if (se == null) {
      throw new MessagingException("Component refused exchange");
    }
  }
  if (se == null && service != null) {
    ServiceEndpoint[] endpoints;
    endpoints=container.getEndpoints().getInternalEndpointsForService(service);
    se=selectEndpoint(me,endpoints);
  }
  if (se == null && interf != null) {
    ServiceEndpoint[] endpoints;
    endpoints=container.getEndpoints().getInternalEndpoints(interf);
    se=selectEndpoint(me,endpoints);
  }
  if (se == null) {
    throw new MessagingException("No target specified");
  }
  return se;
}
