{
  try {
    long timeout=((HttpsConnector)getConnector()).getSslHandshakeTimeout();
    boolean handshakeComplete=getHttpServerConnection().getSslSocketHandshakeCompleteLatch().await(timeout,TimeUnit.MILLISECONDS);
    if (!handshakeComplete) {
      throw new MessagingException(HttpMessages.sslHandshakeDidNotComplete(),muleEvent);
    }
  }
 catch (  InterruptedException e) {
    throw new MessagingException(HttpMessages.sslHandshakeDidNotComplete(),muleEvent,e);
  }
  if (getHttpServerConnection().getPeerCertificateChain() != null) {
    muleEvent.getMessage().setOutboundProperty(HttpsConnector.PEER_CERTIFICATES,getHttpServerConnection().getPeerCertificateChain());
  }
  if (getHttpServerConnection().getLocalCertificateChain() != null) {
    muleEvent.getMessage().setOutboundProperty(HttpsConnector.LOCAL_CERTIFICATES,getHttpServerConnection().getLocalCertificateChain());
  }
  super.beforeRouteEvent(muleEvent);
  return muleEvent;
}
