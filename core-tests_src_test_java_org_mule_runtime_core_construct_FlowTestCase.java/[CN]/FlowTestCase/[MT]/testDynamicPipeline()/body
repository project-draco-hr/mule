{
  flow.initialise();
  flow.start();
  Processor appendPre=new StringAppendTransformer("1");
  Processor appendPost2=new StringAppendTransformer("4");
  String pipelineId=flow.dynamicPipeline(null).injectBefore(appendPre,new StringAppendTransformer("2")).injectAfter(new StringAppendTransformer("3"),appendPost2).resetAndUpdate();
  Event response=directInboundMessageSource.process(testEvent());
  assertEquals(TEST_PAYLOAD + "12abcdef34",response.getMessageAsString(muleContext));
  flow.dynamicPipeline(pipelineId).injectBefore(new StringAppendTransformer("2")).injectAfter(new StringAppendTransformer("3")).resetAndUpdate();
  response=directInboundMessageSource.process(testEvent());
  assertEquals(TEST_PAYLOAD + "2abcdef3",response.getMessageAsString(muleContext));
  flow.dynamicPipeline(pipelineId).reset();
  response=directInboundMessageSource.process(testEvent());
  assertEquals(TEST_PAYLOAD + "abcdef",response.getMessageAsString(muleContext));
}
