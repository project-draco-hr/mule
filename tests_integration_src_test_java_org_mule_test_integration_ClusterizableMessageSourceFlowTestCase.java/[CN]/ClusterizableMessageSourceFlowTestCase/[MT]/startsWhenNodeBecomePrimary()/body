{
  TestPollingController pollingController=new TestPollingController();
  ((DefaultMuleContext)muleContext).setPollingController(pollingController);
  muleContext.start();
  Flow test1=(Flow)muleContext.getRegistry().get("test1");
  ClusterizableMessageSourceWrapper messageSource=(ClusterizableMessageSourceWrapper)test1.getMessageSource();
  pollingController.isPrimary=true;
  messageSource.onNotification(new ClusterNodeNotification("primary",ClusterNodeNotification.PRIMARY_CLUSTER_NODE_SELECTED));
  LocalMuleClient client=muleContext.getClient();
  MuleMessage response=client.request("vm://testOut",5000);
  assertEquals("TEST",response.getPayload());
}
