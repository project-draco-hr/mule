{
  TestPollingController pollingController=new TestPollingController();
  ((DefaultMuleContext)muleContext).setPollingController(pollingController);
  muleContext.start();
  Flow test1=(Flow)muleContext.getRegistry().get("test1");
  ClusterizableMessageSourceWrapper messageSource=(ClusterizableMessageSourceWrapper)test1.getMessageSource();
  messageSource.initialise();
  pollingController.isPrimary=true;
  muleContext.fireNotification(new ClusterNodeNotification("primary",ClusterNodeNotification.PRIMARY_CLUSTER_NODE_SELECTED));
  MuleClient client=muleContext.getClient();
  InternalMessage response=client.request("test://testOut",RECEIVE_TIMEOUT).getRight().get();
  assertEquals("TEST",response.getPayload().getValue());
}
