{
  ConfigurationInstance config=getConfigurationInstanceFromRegistry("config" + flowName,getTestEvent(TEST_PAYLOAD));
  ConnectionProviderWrapper providerWrapper=(ConnectionProviderWrapper)config.getConnectionProvider().get();
  HttpRequesterProvider provider=(HttpRequesterProvider)providerWrapper.getDelegate();
  ProxyConfig proxyConfig=provider.getProxyConfig();
  assertThat(proxyConfig.getHost(),is(PROXY_HOST));
  assertThat(proxyConfig.getPort(),is(Integer.valueOf(proxyPort.getValue())));
  if (proxyType == ProxyType.USER_PASS || proxyType == ProxyType.NTLM) {
    assertThat(proxyConfig.getUsername(),is(PROXY_USERNAME));
    assertThat(proxyConfig.getPassword(),is(PROXY_PASSWORD));
    if (proxyType == ProxyType.NTLM) {
      assertThat(proxyConfig,is(instanceOf(NtlmProxyConfig.class)));
      assertThat(((NtlmProxyConfig)proxyConfig).getNtlmDomain(),is(PROXY_NTLM_DOMAIN));
    }
  }
}
