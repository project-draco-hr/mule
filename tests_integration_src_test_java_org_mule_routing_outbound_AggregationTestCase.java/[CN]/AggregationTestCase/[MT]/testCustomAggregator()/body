{
  MuleClient client=muleContext.getClient();
  String payload="Long string that wil be broken uop into multiple messages";
  client.dispatch("vm://in2",payload,null);
  MuleMessage msg=client.request("vm://collectionCreated2",5000);
  assertNotNull(msg);
  assertNotNull(msg.getPayload());
  assertTrue(msg.getPayload() instanceof List);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  for (  Object obj : (List<?>)msg.getPayload()) {
    assertTrue(obj instanceof MuleEvent);
    MuleEvent event=(MuleEvent)obj;
    assertTrue(event.getMessage().getPayload() instanceof byte[]);
    baos.write((byte[])event.getMessage().getPayload());
  }
  String aggregated=baos.toString();
  assertEquals(payload,aggregated);
}
