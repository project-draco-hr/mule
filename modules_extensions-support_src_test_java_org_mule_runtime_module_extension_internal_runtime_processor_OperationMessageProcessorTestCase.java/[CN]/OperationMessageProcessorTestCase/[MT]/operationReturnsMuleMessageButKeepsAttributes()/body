{
  Object payload=new Object();
  DataType dataType=DataType.builder(DataType.OBJECT).charset(getDefaultEncoding(context)).build();
  Serializable oldAttributes=mock(Serializable.class);
  when(operationExecutor.execute(any(OperationContext.class))).thenReturn(new DefaultMuleMessage(payload,dataType));
  when(event.getMessage()).thenReturn(new DefaultMuleMessage("",DataType.OBJECT,oldAttributes));
  ArgumentCaptor<DefaultMuleMessage> captor=ArgumentCaptor.forClass(DefaultMuleMessage.class);
  messageProcessor.process(event);
  verify(event).setMessage(captor.capture());
  MuleMessage message=captor.getValue();
  assertThat(message,is(notNullValue()));
  assertThat(message.getPayload(),is(sameInstance(payload)));
  assertThat(message.getAttributes(),is(sameInstance(oldAttributes)));
  assertThat(message.getDataType(),is(sameInstance(dataType)));
}
