{
  Collection fileKeys=new ArrayList(files.keySet());
  for (Iterator i=fileKeys.iterator(); i.hasNext(); ) {
    File file=(File)i.next();
    long lastModifiedTime=((Long)files.get(file)).longValue();
    long newModifiedTime=file.exists() ? file.lastModified() : -1;
    if (newModifiedTime != lastModifiedTime) {
      files.put(file,new Long(newModifiedTime));
      for (Iterator j=listeners.iterator(); j.hasNext(); ) {
        WeakReference reference=(WeakReference)j.next();
        FileListener listener=(FileListener)reference.get();
        if (listener == null) {
          j.remove();
        }
 else {
          try {
            listener.fileChanged(file);
          }
 catch (          IOException e) {
            if (exceptionListener != null) {
              exceptionListener.exceptionThrown(e);
            }
          }
        }
      }
    }
  }
}
