{
  if (startupProperties != null) {
    ((MuleManager)MuleManager.getInstance()).addProperties(startupProperties);
  }
  manager=(MuleManager)process(configResources);
  if (manager == null) {
    throw new ConfigurationException(new Message(Messages.FAILED_TO_CREATE_MANAGER_INSTANCE_X,"Are you using a correct configuration builder?"));
  }
  try {
    setContainerProperties();
    setTransformers();
    setGlobalEndpoints();
    if (System.getProperty(MuleProperties.MULE_START_AFTER_CONFIG_SYSTEM_PROPERTY,"true").equalsIgnoreCase("true")) {
      manager.start();
    }
  }
 catch (  Exception e) {
    throw new ConfigurationException(new Message(Messages.X_FAILED_TO_INITIALISE,"MuleManager"),e);
  }
  return manager;
}
