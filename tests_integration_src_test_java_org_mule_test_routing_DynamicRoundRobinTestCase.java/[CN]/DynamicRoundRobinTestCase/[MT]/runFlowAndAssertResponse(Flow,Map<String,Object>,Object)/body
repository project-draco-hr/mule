{
  MuleEvent event=getTestEvent(TEST_MESSAGE);
  if (flowVars != null) {
    for (    String key : flowVars.keySet()) {
      event.setFlowVariable(key,flowVars.get(key));
    }
  }
  MuleEvent response=flow.process(event);
  assertThat(response.getMessageAsString(),is(expectedMessage));
  return response;
}
