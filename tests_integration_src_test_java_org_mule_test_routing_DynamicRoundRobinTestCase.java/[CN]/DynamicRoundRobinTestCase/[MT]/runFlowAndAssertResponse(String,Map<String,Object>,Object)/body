{
  FlowRunner runner=flowRunner(flowName).withPayload(TEST_MESSAGE);
  if (flowVars != null) {
    for (    String key : flowVars.keySet()) {
      runner=runner.withFlowVariable(key,flowVars.get(key));
    }
  }
  MuleEvent response=runner.run();
  assertThat(response.getMessageAsString(),is(expectedMessage));
  return response;
}
