{
  fireNotification(ex);
  logException(ex);
  if (isRollback(ex)) {
    logger.debug("Rolling back transaction");
    rollback(ex,rollbackMethod);
  }
 else {
    logger.debug("Committing transaction");
    commit();
  }
  ExceptionPayload exceptionPayload=new DefaultExceptionPayload(ex);
  if (RequestContext.getEvent() != null) {
    RequestContext.setExceptionPayload(exceptionPayload);
  }
  if (ex instanceof ConnectException) {
    handleReconnection((ConnectException)ex);
  }
}
