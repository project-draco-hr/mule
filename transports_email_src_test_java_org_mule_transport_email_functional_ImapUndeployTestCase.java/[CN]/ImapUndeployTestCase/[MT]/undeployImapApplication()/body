{
  final RetrieveMessageReceiver receiver=getReceiver();
  disposeLatch.await();
  Thread t=new Thread(){
    @Override public void run(){
      muleContext.dispose();
    }
  }
;
  t.start();
  new PollingProber(10000,100).check(new Probe(){
    public boolean isSatisfied(){
      return (receiver.isStopping() || receiver.isStopped());
    }
    public String describeFailure(){
      return null;
    }
  }
);
  mailProcessorLatch.countDown();
  assertEquals(1,numberOfProcessedMessages);
  t.join();
}
