{
  MuleMessage msg=getTestMuleMessage("Mmm... attachments!");
  FileDataSource ds=new FileDataSource(new File("transports/vm/src/test/resources/" + getConfigFile()).getAbsoluteFile());
  msg.addOutboundAttachment("test-attachment",new DataHandler(ds));
  MuleClient client=muleContext.getClient();
  MuleMessage reply=client.send("vm-in",msg);
  assertNotNull(reply);
  if (reply.getExceptionPayload() != null) {
    fail(reply.getExceptionPayload().getException().getCause().toString());
  }
  assertEquals(1,reply.getInboundAttachmentNames().size());
  assertNotNull(reply.getInboundAttachment("mule"));
  assertTrue(reply.getInboundAttachment("mule").getContentType().startsWith("image/gif"));
}
