{
  if (connected.get()) {
    return;
  }
  if (connecting.commit(false,true)) {
    connectionStrategy.connect(this);
    logger.info("Connected: " + getConnectionDescription());
    return;
  }
  try {
    doConnect();
    fireNotification(new ConnectionNotification(this,getConnectEventId(),ConnectionNotification.CONNECTION_CONNECTED));
  }
 catch (  Exception e) {
    fireNotification(new ConnectionNotification(this,getConnectEventId(),ConnectionNotification.CONNECTION_FAILED));
    if (e instanceof ConnectException) {
      throw (ConnectException)e;
    }
 else {
      throw new ConnectException(e,this);
    }
  }
  connected.set(true);
  connecting.set(false);
  if (startOnConnect.get()) {
    startConnector();
  }
 else {
    for (Iterator iterator=receivers.values().iterator(); iterator.hasNext(); ) {
      AbstractMessageReceiver amr=(AbstractMessageReceiver)iterator.next();
      if (logger.isDebugEnabled()) {
        logger.debug("Connecting receiver on endpoint: " + amr.getEndpoint().getEndpointURI());
      }
      amr.connect();
    }
  }
}
