{
  checkDisposed();
  UMOMessageDispatcher dispatcher=null;
  endpoint=StringUtils.defaultIfEmpty(endpoint,"ANY");
  if ("ANY".equals(endpoint) && dispatchers.size() > 0) {
    Map.Entry entry;
    for (Iterator iterator=dispatchers.entrySet().iterator(); iterator.hasNext(); ) {
      entry=(Map.Entry)iterator.next();
      if (((UMOMessageDispatcher)entry.getValue()).isDisposed()) {
        dispatchers.remove(entry.getKey());
      }
 else {
        dispatcher=(UMOMessageDispatcher)entry.getValue();
        break;
      }
    }
  }
 else {
    if (dispatchers == null) {
      throw new NullPointerException("Dispatchers are null for connector: " + name);
    }
    dispatcher=(UMOMessageDispatcher)dispatchers.get(endpoint);
    if (dispatcher != null && dispatcher.isDisposed()) {
      dispatchers.values().remove(dispatcher);
      dispatcher=null;
    }
  }
  if (dispatcher == null) {
    dispatcher=createDispatcher();
    dispatchers.put(endpoint,dispatcher);
  }
  return dispatcher;
}
