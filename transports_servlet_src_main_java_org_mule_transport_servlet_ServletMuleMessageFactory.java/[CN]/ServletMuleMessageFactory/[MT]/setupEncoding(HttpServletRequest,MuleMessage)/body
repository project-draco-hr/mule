{
  String contentType=request.getContentType();
  if (contentType != null) {
    int index=contentType.indexOf("charset");
    if (index > -1) {
      int semicolonIndex=contentType.lastIndexOf(";");
      String encoding;
      if (semicolonIndex > index) {
        encoding=contentType.substring(index + 8,semicolonIndex);
      }
 else {
        encoding=contentType.substring(index + 8);
      }
      message.setEncoding(encoding.replaceAll("\"","").trim());
    }
  }
}
