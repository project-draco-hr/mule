{
  String contentType=request.getContentType();
  if (contentType != null) {
    int index=contentType.indexOf("charset");
    if (index > -1) {
      int semicolonIndex=contentType.lastIndexOf(";");
      if (semicolonIndex > index) {
        message.setEncoding(contentType.substring(index + 8,semicolonIndex));
      }
 else {
        message.setEncoding(contentType.substring(index + 8));
      }
    }
  }
}
