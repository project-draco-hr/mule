{
  String message="test";
  MuleClient client=muleContext.getClient();
  Map<String,Object> props=new HashMap<String,Object>(3);
  props.put("recipient1","vm://service1.queue?exchangePattern=request-response");
  props.put("recipient2","vm://service2.queue?exchangePattern=request-response");
  props.put("recipient3","vm://service3.queue?exchangePattern=request-response");
  MuleMessage result=client.send("vm://distributor.queue",message,props);
  assertNotNull(result);
  assertTrue(result.getPayload() instanceof List);
  List<MuleMessage> results=(List<MuleMessage>)result.getPayload();
  assertEquals(3,results.size());
  MuleMessage[] resultsArray=results.toArray(new MuleMessage[3]);
  for (int i=0; i < resultsArray.length; i++) {
    MuleMessage muleMessage=resultsArray[i];
    assertEquals("test " + (i + 1) + " Received",muleMessage.getPayload());
  }
}
