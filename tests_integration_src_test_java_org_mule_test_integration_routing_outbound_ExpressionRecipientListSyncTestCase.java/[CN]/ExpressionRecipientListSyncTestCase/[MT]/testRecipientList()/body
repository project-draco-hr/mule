{
  String message="test";
  MuleClient client=muleContext.getClient();
  Map<String,Object> props=new HashMap<String,Object>(3);
  props.put("recipient1","vm://service1.queue?exchangePattern=request-response");
  props.put("recipient2","vm://service2.queue?exchangePattern=request-response");
  props.put("recipient3","vm://service3.queue?exchangePattern=request-response");
  MuleMessage result=client.send("vm://distributor.queue",message,props);
  assertNotNull(result);
  assertTrue(result instanceof MuleMessageCollection);
  MuleMessageCollection coll=(MuleMessageCollection)result;
  assertEquals(3,coll.size());
  MuleMessage[] results=coll.getMessagesAsArray();
  for (int i=0; i < results.length; i++) {
    MuleMessage muleMessage=results[i];
    assertEquals("test " + (i + 1) + " Received",muleMessage.getPayload());
  }
}
