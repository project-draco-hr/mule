{
  MuleRegistry muleRegistry=Mockito.mock(MuleRegistry.class);
  if (isPersistent) {
    PartitionableObjectStore<?> store=createPersistentPartitionableObjectStore(muleContext);
    Mockito.when(muleRegistry.lookupObject(MuleProperties.OBJECT_STORE_DEFAULT_PERSISTENT_NAME)).thenReturn(store);
  }
 else {
    PartitionableObjectStore<?> store=createTransientPartitionableObjectStore();
    Mockito.when(muleRegistry.lookupObject(MuleProperties.OBJECT_STORE_DEFAULT_IN_MEMORY_NAME)).thenReturn(store);
  }
  Mockito.when(muleContext.getRegistry()).thenReturn(muleRegistry);
}
