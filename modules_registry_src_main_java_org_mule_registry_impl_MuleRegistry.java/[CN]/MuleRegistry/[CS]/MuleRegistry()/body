{
  persistenceManager=new ObjectPersistenceManager();
  registryStore=new InMemoryStore(this);
  metadata=new HashMap();
  registrationFactory=new RegistrationFactory();
  PersistenceNotificationListener listener=new PersistenceNotificationListener(persistenceManager);
  try {
    persistenceManager.initialise();
  }
 catch (  Exception e) {
    logger.info("Unable to initialize PersistenceManager: " + e.toString());
  }
  try {
    registryStore.initialise();
    registryStore.registerPersistenceRequestListener(listener);
  }
 catch (  Exception e) {
    logger.info(e);
  }
  try {
    Registration registration=registrationFactory.getInstance(RegistrationFactory.REF_MULE_COMPONENT);
    registration.setId("0");
    registration.setProperty("sourceObjectClassName",this.getClass().getName());
    registration.setType("Registry");
    registryStore.registerComponent(registration);
  }
 catch (  Exception e) {
    logger.error("Unable to store the registry ComponentReference - no data can be persisted");
  }
}
