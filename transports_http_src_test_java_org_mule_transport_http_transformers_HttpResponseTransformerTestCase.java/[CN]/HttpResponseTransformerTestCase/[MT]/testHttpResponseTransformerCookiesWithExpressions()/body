{
  HttpResponseTransformer httpResponseTransformer=createHttpResponseTransformer();
  List<CookieWrapper> cookies=new ArrayList<CookieWrapper>();
  cookies.add(createCookie(HEADER_NAME,HEADER_VALUE,HEADER_DOMAIN,HEADER_PATH,HEADER_EXPIRY_DATE,HEADER_SECURE,HEADER_VERSION));
  httpResponseTransformer.setCookies(cookies);
  when(mockExpressionManager.isExpression(HEADER_NAME)).thenReturn(true);
  when(mockExpressionManager.evaluate(HEADER_NAME,mockMuleMessage)).thenReturn("userName");
  when(mockExpressionManager.isExpression(HEADER_VALUE)).thenReturn(true);
  when(mockExpressionManager.evaluate(HEADER_VALUE,mockMuleMessage)).thenReturn("John_Galt");
  when(mockExpressionManager.isExpression(HEADER_DOMAIN)).thenReturn(true);
  when(mockExpressionManager.evaluate(HEADER_DOMAIN,mockMuleMessage)).thenReturn("localhost");
  when(mockExpressionManager.isExpression(HEADER_PATH)).thenReturn(true);
  when(mockExpressionManager.evaluate(HEADER_PATH,mockMuleMessage)).thenReturn("/");
  when(mockExpressionManager.isExpression(HEADER_EXPIRY_DATE)).thenReturn(true);
  when(mockExpressionManager.evaluate(HEADER_EXPIRY_DATE,mockMuleMessage)).thenReturn("Thu, 15 Dec 2013 16:00:00 GMT");
  when(mockExpressionManager.isExpression(HEADER_SECURE)).thenReturn(true);
  when(mockExpressionManager.evaluate(HEADER_SECURE,mockMuleMessage)).thenReturn("true");
  when(mockExpressionManager.isExpression(HEADER_VERSION)).thenReturn(true);
  when(mockExpressionManager.evaluate(HEADER_VERSION,mockMuleMessage)).thenReturn("1");
  HttpResponse response=new HttpResponse();
  httpResponseTransformer.setCookies(response,mockMuleMessage);
  Map<String,String> responseCookies=getHeaderCookie(response.getHeaders());
  assertNotNull(responseCookies);
  assertEquals("userName=John_Galt; Version=1; Domain=localhost; Path=/; Secure; Expires=Sun, 15-Dec-2013 16:00:00 GMT",responseCookies.get("userName"));
}
