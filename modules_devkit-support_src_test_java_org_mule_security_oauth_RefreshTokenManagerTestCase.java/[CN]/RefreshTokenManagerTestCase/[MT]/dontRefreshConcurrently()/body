{
  final String ACCESS_TOKEN_ID="accessTokenId";
  final int TIMEOUT=1000;
  final int THREAD_COUNT=10;
  final AtomicInteger exceptionCount=new AtomicInteger(0);
  final OAuth2Adapter adapter=this.getAdapter();
  this.refreshTokenManager.setMinRefreshIntervalInMillis(TIMEOUT);
  final Runnable task=new Runnable(){
    @Override public void run(){
      try {
        refreshTokenManager.refreshToken(adapter,ACCESS_TOKEN_ID);
      }
 catch (      Exception e) {
        exceptionCount.addAndGet(1);
      }
    }
  }
;
  List<Thread> threads=new ArrayList<Thread>(THREAD_COUNT);
  for (int i=0; i < THREAD_COUNT; i++) {
    Thread thread=new Thread(task);
    threads.add(thread);
    thread.start();
  }
  for (  Thread thread : threads) {
    thread.join();
  }
  assertEquals(0,exceptionCount.get());
  verify(adapter,times(1)).refreshAccessToken(ACCESS_TOKEN_ID);
  Thread.sleep(TIMEOUT);
  reset(adapter);
  this.refreshTokenManager.refreshToken(adapter,ACCESS_TOKEN_ID);
  verify(adapter,times(1)).refreshAccessToken(ACCESS_TOKEN_ID);
}
