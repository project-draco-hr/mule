{
  List<MuleCoreExtension> extensions=new LinkedList<>();
  TestServerPluginClassLoaderManagerAwareExtension extension=mock(TestServerPluginClassLoaderManagerAwareExtension.class);
  extensions.add(extension);
  when(coreExtensionDiscoverer.discover()).thenReturn(extensions);
  when(coreExtensionDependencyResolver.resolveDependencies(extensions)).thenReturn(extensions);
  ServerPluginClassLoaderManager serverPluginClassLoaderManager=mock(ServerPluginClassLoaderManager.class);
  coreExtensionManager.setServerPluginClassLoaderManager(serverPluginClassLoaderManager);
  coreExtensionManager.initialise();
  verify(extension).setServerPluginClassLoaderManager(serverPluginClassLoaderManager);
}
