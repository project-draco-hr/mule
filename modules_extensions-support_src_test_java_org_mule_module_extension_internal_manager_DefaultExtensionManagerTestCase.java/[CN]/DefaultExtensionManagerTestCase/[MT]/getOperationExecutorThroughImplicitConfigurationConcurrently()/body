{
  final long timeout=5;
  final TimeUnit timeUnit=TimeUnit.SECONDS;
  final int threadCount=2;
  final Latch testLatch=new Latch();
  final CountDownLatch joinerLatch=new CountDownLatch(threadCount);
  discover();
  when(extension1ConfigurationModel.getCapabilities(ParameterGroupCapability.class)).thenReturn(null);
  when(extensionModel1.getConfigurations()).thenAnswer(new Answer<List<ConfigurationModel>>(){
    @Override public List<ConfigurationModel> answer(    InvocationOnMock invocation) throws Throwable {
      new Thread(){
        @Override public void run(){
          testLatch.release();
          extensionsManager.getConfiguration(extensionModel1,extension1OperationContext);
        }
      }
.start();
      testLatch.await(timeout,timeUnit);
      joinerLatch.countDown();
      return Arrays.asList(extension1ConfigurationModel);
    }
  }
);
  Object configurationInstance=extensionsManager.getConfiguration(extensionModel1,extension1OperationContext);
  assertThat(joinerLatch.await(5,TimeUnit.SECONDS),is(true));
  assertThat(configurationInstance,is(sameInstance(configInstance)));
}
