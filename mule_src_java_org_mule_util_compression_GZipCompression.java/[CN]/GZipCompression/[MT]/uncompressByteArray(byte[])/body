{
  if (!isCompressed(bytes)) {
    return bytes;
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Uncompressing message of size: " + bytes.length);
  }
  if (!isCompressed(bytes)) {
    logger.warn("Data is not of type GZIP compressed." + " The data may not have been compressed in the first place.");
    throw new CompressionException("Not in GZIP format");
  }
  ByteArrayInputStream bais=new ByteArrayInputStream(bytes);
  GZIPInputStream gis=new GZIPInputStream(bais);
  ByteArrayOutputStream baos=new ByteArrayOutputStream(bytes.length * 4);
  IOUtils.copy(gis,baos);
  byte[] uncompressedByteArray=baos.toByteArray();
  if (logger.isDebugEnabled()) {
    logger.debug("Uncompressed message to size: " + uncompressedByteArray.length);
  }
  return uncompressedByteArray;
}
