{
  TestConnector testConnector1=new TestConnector(muleContext);
  testConnector1.setName("testConnector1");
  TestConnector testConnector2=new TestConnector(muleContext);
  testConnector2.setName("testConnector2");
  registerConnector(muleContext.getRegistry(),testConnector1);
  registerConnector(muleContext.getRegistry(),testConnector2);
  String globalEndpointName="concreteEndpoint";
  EndpointBuilder endpointBuilder=new EndpointURIEndpointBuilder("test://address",muleContext);
  endpointBuilder.setConnector(testConnector1);
  muleContext.getRegistry().registerObject(globalEndpointName,endpointBuilder);
  EndpointFactory endpointFactory=new DefaultEndpointFactory();
  endpointFactory.setMuleContext(muleContext);
  EndpointBuilder endpointBuilder1=endpointFactory.getEndpointBuilder(globalEndpointName);
  assertNotSame(endpointBuilder1,endpointBuilder);
  assertTrue(endpointBuilder1.equals(endpointBuilder));
  EndpointBuilder endpointBuilder2=endpointFactory.getEndpointBuilder(globalEndpointName);
  assertNotSame(endpointBuilder2,endpointBuilder);
  assertTrue(endpointBuilder2.equals(endpointBuilder));
  assertNotSame(endpointBuilder1,endpointBuilder2);
  assertTrue(endpointBuilder1.equals(endpointBuilder2));
  assertEquals(endpointBuilder1.hashCode(),endpointBuilder2.hashCode());
  endpointBuilder1.setExchangePattern(MessageExchangePattern.REQUEST_RESPONSE);
  endpointBuilder1.setResponseTimeout(99);
  ImmutableEndpoint ep=endpointFactory.getInboundEndpoint(endpointBuilder1);
  assertEquals(ep.getEndpointURI().getUri().toString(),"test://address");
  assertEquals(MessageExchangePattern.REQUEST_RESPONSE,ep.getExchangePattern());
  assertEquals(99,ep.getResponseTimeout());
  assertNotNull(ep.getConnector());
  assertEquals(testConnector1,ep.getConnector());
  endpointBuilder2.setExchangePattern(MessageExchangePattern.ONE_WAY);
  endpointBuilder2.setResponseTimeout(0);
  endpointBuilder2.setConnector(testConnector2);
  ImmutableEndpoint ep2=endpointFactory.getInboundEndpoint(endpointBuilder2);
  assertEquals(ep2.getEndpointURI().getUri().toString(),"test://address");
  assertEquals(MessageExchangePattern.ONE_WAY,ep2.getExchangePattern());
  assertEquals(0,ep2.getResponseTimeout());
  assertNotNull(ep.getConnector());
  assertEquals(testConnector2,ep2.getConnector());
  ImmutableEndpoint ep3=endpointFactory.getInboundEndpoint(endpointBuilder1);
  assertEquals(ep3.getEndpointURI().getUri().toString(),"test://address");
  assertTrue(ep3.getResponseTimeout() != 0);
  assertEquals(MessageExchangePattern.REQUEST_RESPONSE,ep3.getExchangePattern());
  assertNotNull(ep.getConnector());
  assertEquals(testConnector1,ep3.getConnector());
}
