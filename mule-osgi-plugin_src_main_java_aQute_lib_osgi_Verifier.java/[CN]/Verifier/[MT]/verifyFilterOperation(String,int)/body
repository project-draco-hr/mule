{
  StringBuffer sb=new StringBuffer();
  while ("=><~()".indexOf(expr.charAt(index)) < 0) {
    sb.append(expr.charAt(index++));
  }
  String attr=sb.toString().trim();
  if (attr.length() == 0)   throw new IllegalArgumentException("Filter mismatch: attr at index " + index + " is 0");
  sb=new StringBuffer();
  while ("=><~".indexOf(expr.charAt(index)) >= 0) {
    sb.append(expr.charAt(index++));
  }
  String operator=sb.toString();
  if (!verify(operator,FILTEROP))   throw new IllegalArgumentException("Filter error, illegal operator " + operator + " at index "+ index);
  sb=new StringBuffer();
  while (")".indexOf(expr.charAt(index)) < 0) {
switch (expr.charAt(index)) {
case '\\':
      if (expr.charAt(index + 1) == '*' || expr.charAt(index + 1) == ')')       index++;
 else       throw new IllegalArgumentException("Filter error, illegal use of backslash at index " + index + ". Backslash may only be used before * or (");
  }
  sb.append(expr.charAt(index++));
}
return index;
}
