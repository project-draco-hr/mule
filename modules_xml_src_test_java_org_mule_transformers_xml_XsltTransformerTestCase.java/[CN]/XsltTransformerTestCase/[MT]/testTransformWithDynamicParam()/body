{
  String xml="<node1>" + "<subnode1>sub node 1 original value</subnode1>" + "<subnode2>sub node 2 original value</subnode2>"+ "</node1>";
  String param="sub node 2 cool new value";
  String expectedTransformedxml="<node1>" + "<subnode1>sub node 1 original value</subnode1>" + "<subnode2>" + param + "</subnode2>"+ "</node1>";
  String xsl=someXslText();
  XsltTransformer transformer=new XsltTransformer();
  transformer.setMuleContext(muleContext);
  transformer.setReturnDataType(DataTypeFactory.create(String.class));
  transformer.setMuleContext(muleContext);
  transformer.setXslt(xsl);
  Map params=new HashMap();
  params.put("param1","#[header:myproperty]");
  transformer.setContextProperties(params);
  transformer.initialise();
  MuleMessage message=new DefaultMuleMessage(xml,muleContext);
  message.setOutboundProperty("myproperty",param);
  String transformerResult=(String)transformer.transform(message);
  transformerResult=transformerResult.substring(transformerResult.indexOf("?>") + 2);
  assertTrue(transformerResult.indexOf(expectedTransformedxml) > -1);
}
