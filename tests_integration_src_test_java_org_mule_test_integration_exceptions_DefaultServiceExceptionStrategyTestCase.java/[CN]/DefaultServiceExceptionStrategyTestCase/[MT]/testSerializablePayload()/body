{
  Map<String,String> map=new HashMap<String,String>();
  map.put("key1","value1");
  map.put("key2","value2");
  MuleClient mc=new MuleClient(muleContext);
  mc.dispatch("vm://in1",map,null);
  MuleMessage message=mc.request("vm://out1",FunctionalTestCase.RECEIVE_TIMEOUT);
  assertTrue(message.getPayload() instanceof ExceptionMessage);
  Object payload=((ExceptionMessage)message.getPayload()).getPayload();
  assertTrue("payload shoud be a Map, but is " + payload.getClass().getName(),payload instanceof Map<?,?>);
  Map<?,?> payloadMap=(Map<?,?>)payload;
  assertEquals("value1",payloadMap.get("key1"));
  assertEquals("value2",payloadMap.get("key2"));
}
