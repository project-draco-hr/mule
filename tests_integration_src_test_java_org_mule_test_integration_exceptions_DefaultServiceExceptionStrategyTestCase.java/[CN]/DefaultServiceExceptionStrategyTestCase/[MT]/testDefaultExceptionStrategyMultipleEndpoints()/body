{
  FlowConstruct service=muleContext.getRegistry().lookupFlowConstruct("testService2");
  assertNotNull(service);
  assertNotNull(service.getExceptionListener());
  assertTrue(service.getExceptionListener() instanceof DefaultMessagingExceptionStrategy);
  DefaultMessagingExceptionStrategy exceptionListener=(DefaultMessagingExceptionStrategy)service.getExceptionListener();
  MessageProcessor mp=exceptionListener.getMessageProcessors().iterator().next();
  assertTrue(mp.getClass().getName(),mp instanceof MulticastingRouter);
  assertEquals(2,((MulticastingRouter)mp).getRoutes().size());
  MuleClient client=muleContext.getClient();
  client.dispatch("vm://in2","test",null);
  MuleMessage out2=client.request("vm://out2",RECEIVE_TIMEOUT);
  MuleMessage out3=client.request("vm://out3",RECEIVE_TIMEOUT);
  assertExceptionMessage(out2);
  assertExceptionMessage(out3);
  assertNotSame(out2,out3);
  assertEquals(out2.getPayload(),out3.getPayload());
}
