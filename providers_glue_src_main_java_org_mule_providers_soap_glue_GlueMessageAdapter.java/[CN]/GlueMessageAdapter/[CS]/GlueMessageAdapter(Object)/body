{
  if (message instanceof GlueMessageHolder) {
    GlueMessageHolder holder=(GlueMessageHolder)message;
    this.message=holder.getMessage();
    IteratorAdapter iter=new IteratorAdapter(holder.getService().getContext().getPropertyNames());
    String key;
    while (iter.hasNext()) {
      key=iter.next().toString();
      setProperty(key,holder.getService().getContext().getProperty(key));
    }
  }
 else {
    this.message=message;
  }
  String value=(String)ThreadContext.removeProperty(MuleProperties.MULE_REPLY_TO_PROPERTY);
  if (value != null) {
    setReplyTo(value);
  }
  value=(String)ThreadContext.removeProperty(MuleProperties.MULE_CORRELATION_ID_PROPERTY);
  if (value != null) {
    setCorrelationId(value);
  }
  value=(String)ThreadContext.removeProperty(MuleProperties.MULE_CORRELATION_SEQUENCE_PROPERTY);
  if (value != null && !"-1".equals(value)) {
    setCorrelationSequence(Integer.parseInt(value));
  }
  value=(String)ThreadContext.removeProperty(MuleProperties.MULE_CORRELATION_GROUP_SIZE_PROPERTY);
  if (value != null && !"-1".equals(value)) {
    setCorrelationGroupSize(Integer.parseInt(value));
  }
}
