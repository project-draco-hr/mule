{
  when(outboundEndpoint.getProperty(SftpConnector.PROPERTY_OUTPUT_PATTERN)).thenReturn(null);
  SftpMessageDispatcher sftpMessageDispatcher=new SftpMessageDispatcher(outboundEndpoint);
  sftpMessageDispatcher.doDispatch(muleEvent);
  verify(sftpClient).storeFile(transferFilenameCaptor.capture(),inputStreamCaptor.capture());
  assertEquals("Output filename was not set correctly.",PROPERTY_FILENAME,transferFilenameCaptor.getValue());
  InputStream inputStream=inputStreamCaptor.getValue();
  StringWriter stringWriter=new StringWriter();
  IOUtils.copy(inputStream,stringWriter,"UTF-8");
  assertEquals(payload,stringWriter.toString());
}
