{
  when(sftpConnector.createSftpClient(eq(outboundEndpoint),any(SftpNotifier.class))).thenReturn(sftpClient);
  when(sftpConnector.getFilenameParser()).thenReturn(filenameParser);
  when(filenameParser.getFilename(any(MuleMessage.class),anyString())).thenAnswer(new Answer<String>(){
    @Override public String answer(    InvocationOnMock invocation) throws Throwable {
      Object[] args=invocation.getArguments();
      return (String)args[1];
    }
  }
);
  when(outboundEndpoint.getConnector()).thenReturn(sftpConnector);
  when(outboundEndpoint.getEndpointURI()).thenReturn(endpointUri);
  when(muleEvent.getMessage()).thenReturn(muleMessage);
  when(muleMessage.getPayload()).thenReturn(payload);
  when(muleMessage.findPropertyInAnyScope(SftpConnector.PROPERTY_FILENAME,null)).thenReturn(PROPERTY_FILENAME);
  when(sftpClient.duplicateHandling(anyString(),anyString(),anyString())).thenAnswer(new Answer<String>(){
    @Override public String answer(    InvocationOnMock invocation) throws Throwable {
      Object[] args=invocation.getArguments();
      return (String)args[1];
    }
  }
);
}
