{
  when(sftpConnector.getDuplicateHandling()).thenReturn("append");
  SftpMessageDispatcher sftpMessageDispatcher=new SftpMessageDispatcher(outboundEndpoint);
  sftpMessageDispatcher.doDispatch(muleEvent);
  verify(sftpClient).storeFile(transferFilenameCaptor.capture(),inputStreamCaptor.capture(),writeModeCaptor.capture());
  InputStream inputStream=inputStreamCaptor.getValue();
  StringWriter stringWriter=new StringWriter();
  IOUtils.copy(inputStream,stringWriter,"UTF-8");
  assertEquals(payload,stringWriter.toString());
}
