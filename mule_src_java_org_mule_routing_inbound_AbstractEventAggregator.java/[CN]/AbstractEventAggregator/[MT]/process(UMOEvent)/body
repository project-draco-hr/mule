{
  AtomicBoolean doAggregate=new AtomicBoolean(false);
  EventGroup eg=null;
  if (isMatch(event)) {
    eg=addEvent(event);
    doAggregate.compareAndSet(false,shouldAggregate(eg));
  }
  if (doAggregate.get()) {
synchronized (lock) {
      UMOMessage returnMessage=aggregateEvents(eg);
      removeGroup(eg.getGroupId());
      UMOEndpoint endpoint=new MuleEndpoint(event.getEndpoint());
      endpoint.setTransformer(null);
      endpoint.setName(getClass().getName());
      UMOEvent returnEvent=new MuleEvent(returnMessage,endpoint,event.getComponent(),event);
      return new UMOEvent[]{returnEvent};
    }
  }
  return null;
}
