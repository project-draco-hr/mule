{
  SAXParserFactory factory=SAXParserFactory.newInstance();
  try {
    factory.setFeature("http://xml.org/sax/features/external-general-entities",externalEntities);
    factory.setFeature("http://xml.org/sax/features/external-parameter-entities",externalEntities);
    factory.setFeature("http://apache.org/xml/features/disallow-doctype-decl",!expandEntities);
  }
 catch (  Exception e) {
    logger.warn("Can't configure XML entity expansion for SAXParserFactory, this could introduce XXE and BL vulnerabilities");
  }
  return factory;
}
