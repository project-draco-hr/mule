{
  setPayloadMessageProcessor.setValue(EXPRESSION);
  when(expressionManager.isExpression(EXPRESSION)).thenReturn(true);
  setPayloadMessageProcessor.initialise();
  DefaultTypedValue typedValue=new DefaultTypedValue(PLAIN_TEXT,DataType.STRING);
  when(expressionManager.evaluate(EXPRESSION,testEvent())).thenReturn(typedValue);
  when(expressionManager.evaluate(eq(EXPRESSION),eq(testEvent()),any(Event.Builder.class),eq(null))).thenReturn(typedValue);
  Event response=setPayloadMessageProcessor.process(testEvent());
  assertThat(response.getMessage().getPayload().getValue(),is(PLAIN_TEXT));
}
