{
  this.locks=new HashMap<String,Lock>();
  Mockito.when(this.manager.getDefaultUnauthorizedConnector().getConsumerKey()).thenReturn(consumerKey);
  Mockito.when(this.manager.getDefaultUnauthorizedConnector().getConsumerSecret()).thenReturn(consumerSecret);
  Mockito.when(this.manager.getMuleContext()).thenReturn(this.muleContext);
  Mockito.when(this.muleContext.getLockFactory().createLock(Mockito.anyString())).thenAnswer(new Answer<Lock>(){
    @Override public synchronized Lock answer(    InvocationOnMock invocation) throws Throwable {
      String key=invocation.getArguments()[0].toString();
      Lock lock=locks.get(key);
      if (lock == null) {
        lock=new ReentrantLock();
        locks.put(key,lock);
      }
      return lock;
    }
  }
);
  this.factory=Mockito.spy(new TestClientFactory(this.manager,this.objectStore));
}
