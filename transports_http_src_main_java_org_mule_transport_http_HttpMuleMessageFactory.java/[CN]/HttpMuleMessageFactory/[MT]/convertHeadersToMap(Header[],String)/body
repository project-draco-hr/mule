{
  Map<String,Object> headersMap=new CaseInsensitiveHashMap();
  for (int i=0; i < headersArray.length; i++) {
    final Header header=headersArray[i];
    if (HttpConnector.HTTP_COOKIES_PROPERTY.equals(header.getName()) || HttpConstants.HEADER_COOKIE.equals(header.getName())) {
      putCookieHeaderInMapAsAServer(headersMap,header,uri);
    }
 else     if (HttpConstants.HEADER_COOKIE_SET.equals(header.getName())) {
      putCookieHeaderInMapAsAClient(headersMap,header,uri);
    }
 else {
      if (headersMap.containsKey(header.getName())) {
        if (headersMap.get(header.getName()) instanceof String) {
          headersMap.put(header.getName(),headersMap.get(header.getName()) + "," + header.getValue());
        }
 else {
          headersMap.put(header.getName(),header.getValue());
        }
      }
 else {
        headersMap.put(header.getName(),header.getValue());
      }
    }
  }
  return headersMap;
}
