{
  String method;
  HttpVersion httpVersion;
  String uri;
  String statusCode=null;
  Map<String,Object> headers;
  Header cookieHeader;
  if (transportMessage instanceof HttpRequest) {
    HttpRequest httpRequest=(HttpRequest)transportMessage;
    method=httpRequest.getRequestLine().getMethod();
    httpVersion=httpRequest.getRequestLine().getHttpVersion();
    uri=httpRequest.getRequestLine().getUri();
    headers=convertHeadersToMap(httpRequest.getHeaders());
    cookieHeader=httpRequest.getFirstHeader(HttpConnector.HTTP_COOKIES_PROPERTY);
  }
 else   if (transportMessage instanceof HttpMethod) {
    HttpMethod httpMethod=(HttpMethod)transportMessage;
    method=httpMethod.getName();
    httpVersion=HttpVersion.parse(httpMethod.getStatusLine().getHttpVersion());
    uri=httpMethod.getURI().toString();
    statusCode=String.valueOf(httpMethod.getStatusCode());
    headers=convertHeadersToMap(httpMethod.getResponseHeaders());
    cookieHeader=httpMethod.getResponseHeader(HttpConnector.HTTP_COOKIES_PROPERTY);
  }
 else {
    throw new MessageTypeNotSupportedException(transportMessage,getClass());
  }
  rewriteConnectionAndKeepAliveHeaders(headers);
  headers=processIncomingHeaders(headers,uri,cookieHeader);
  headers.put(HttpConnector.HTTP_METHOD_PROPERTY,method);
  headers.put(HttpConnector.HTTP_REQUEST_PROPERTY,uri);
  headers.put(HttpConnector.HTTP_VERSION_PROPERTY,httpVersion.toString());
  if (enableCookies) {
    headers.put(HttpConnector.HTTP_COOKIE_SPEC_PROPERTY,cookieSpec);
  }
  if (statusCode != null) {
    headers.put(HttpConnector.HTTP_STATUS_PROPERTY,statusCode);
  }
  if (transportMessage instanceof HttpRequest) {
    message.addInboundProperties(headers);
  }
 else {
    message.addProperties(headers);
  }
  initEncoding(message,headers);
}
