{
  MuleClient client=new MuleClient(muleContext);
  Map props=new HashMap();
  EncryptionStrategy strategy=muleContext.getSecurityManager().getEncryptionStrategy("PBE");
  String header=MuleCredentials.createHeader("Marie.Rizzo","anon","PBE",strategy);
  props.put(MuleProperties.MULE_USER_PROPERTY,header);
  MuleMessage m=client.send("vm://test","Test",props);
  assertNotNull(m);
  assertTrue(m.getPayload() instanceof String);
  assertFalse(m.getPayloadAsString().equals("Test Received"));
  ExceptionPayload exceptionPayload=m.getExceptionPayload();
  assertNotNull(exceptionPayload);
  assertEquals("Authentication failed for principal Marie.Rizzo. Message payload is of type: String",exceptionPayload.getMessage());
}
