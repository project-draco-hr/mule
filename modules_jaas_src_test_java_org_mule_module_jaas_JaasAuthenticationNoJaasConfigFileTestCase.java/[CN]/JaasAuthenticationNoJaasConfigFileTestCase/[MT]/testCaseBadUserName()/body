{
  MuleClient client=new MuleClient();
  Map props=new HashMap();
  EncryptionStrategy strategy=muleContext.getSecurityManager().getEncryptionStrategy("PBE");
  String header=MuleCredentials.createHeader("Evil","dragon","PBE",strategy);
  props.put(MuleProperties.MULE_USER_PROPERTY,header);
  MuleMessage m=client.send("vm://test","Test",props);
  assertNotNull(m);
  assertTrue(m.getPayload() instanceof String);
  assertFalse(m.getPayloadAsString().equals("Test Received"));
  assertExceptionPayload(m,"Authentication failed for principal Evil. Message payload is of type: String");
}
