{
  InterceptingMessageProcessorChain finalChain=new InterceptingMessageProcessorChain(null,null,"");
  LinkedList<MessageProcessor> tempList=new LinkedList<MessageProcessor>();
  for (int i=processors.size() - 1; i >= 0; i--) {
    MessageProcessor processor=decorateMessageProcessorForCallbacks(initializeMessageProcessor(processors.get(i)),finalChain);
    if ((processors.get(i)) instanceof InterceptingMessageProcessor) {
      if (i + 1 < processors.size()) {
        if (tempList.isEmpty()) {
          ((InterceptingMessageProcessor)processor).setListener(decorateMessageProcessorForCallbacks(initializeMessageProcessor(processors.get(i + 1)),finalChain));
        }
 else {
          final IteratingCompositeMessageProcessor chain=new IteratingCompositeMessageProcessor(new ArrayList<MessageProcessor>(tempList));
          ((InterceptingMessageProcessor)processor).setListener(chain);
        }
      }
      tempList=new LinkedList<MessageProcessor>(Collections.singletonList(processor));
    }
 else {
      tempList.addFirst(processor);
    }
  }
  final IteratingCompositeMessageProcessor chain=new IteratingCompositeMessageProcessor(new ArrayList<MessageProcessor>(tempList));
  finalChain.setFirstInChain(chain);
  finalChain.setMessageProcessors(processors);
  return finalChain;
}
