{
  MuleClient client=muleContext.getClient();
  String payload="payload";
  Map<String,Object> headers=new HashMap<String,Object>();
  final String customHeader="X-Custom-Header";
  headers.put(customHeader,"value");
  client.dispatch(String.format("http://localhost:%d/in",httpPort.getNumber()),new DefaultMuleMessage(payload,headers,muleContext),newOptions().method(POST.name()).build());
  MuleMessage msg=client.request("vm://out",10000);
  assertNotNull(msg);
  assertEquals(payload,getPayloadAsString(msg));
  assertEquals("value",msg.getInboundProperty(customHeader));
}
