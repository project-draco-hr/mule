{
  MuleClient client=muleContext.getClient();
  String payload="payload";
  Map<String,Object> headers=new HashMap<String,Object>();
  final String customHeader="X-Custom-Header";
  headers.put(customHeader,"value");
  client.dispatch(String.format("http://localhost:%d/in",httpPort.getNumber()),new DefaultMuleMessage(payload,headers,muleContext),newOptions().method(POST.name()).build());
  MuleMessage msg=client.request("test://out",RECEIVE_TIMEOUT);
  assertNotNull(msg);
  assertThat(getPayloadAsString(msg),is(payload));
  assertThat(msg.getInboundProperty(customHeader),is("value"));
}
