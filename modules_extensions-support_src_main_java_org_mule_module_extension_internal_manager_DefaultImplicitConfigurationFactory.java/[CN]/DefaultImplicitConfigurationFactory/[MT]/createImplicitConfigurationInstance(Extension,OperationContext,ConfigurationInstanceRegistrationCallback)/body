{
  Configuration implicitConfiguration=getImplicitConfiguration(extension);
  if (implicitConfiguration == null) {
    throw new IllegalStateException(String.format("Could not find a config for extension '%s' and none can be created automatically. Please define one",extension.getName()));
  }
synchronized (implicitConfiguration) {
    if (!extensionRegistry.getExtensionState(extension).getConfigurationInstanceProviders().isEmpty()) {
      return null;
    }
    final String instanceName=String.format("%s-%s",extension.getName(),implicitConfiguration.getName());
    ConfigurationObjectBuilder configurationObjectBuilder=new ConfigurationObjectBuilder(implicitConfiguration,buildImplicitConfigurationResolverSet(implicitConfiguration));
    Object configurationInstance;
    try {
      configurationInstance=configurationObjectBuilder.build(asOperationContextAdapter(operationContext).getEvent());
    }
 catch (    MuleException e) {
      throw new MuleRuntimeException(e);
    }
    return new ConfigurationInstanceHolder(instanceName,configurationInstance);
  }
}
