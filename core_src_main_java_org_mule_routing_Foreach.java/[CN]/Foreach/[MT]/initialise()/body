{
  if (collectionExpression != null) {
    expressionConfig.setExpression(collectionExpression);
    checkEvaluator(expressionConfig);
    splitter=new ExpressionSplitter(expressionConfig);
    if (expressionConfig.getEvaluator() != null && expressionConfig.getEvaluator().startsWith(XPATH_PREFIX)) {
      xpathCollection=true;
    }
 else     if (expressionConfig.getEvaluator() == null && expressionConfig.getExpression().matches("^xpath\\(.+\\)$")) {
      xpathCollection=true;
    }
  }
 else {
    splitter=new CollectionMapSplitter();
  }
  splitter.setBatchSize(batchSize);
  splitter.setCounterVariableName(counterVariableName);
  splitter.setMuleContext(muleContext);
  messageProcessors.add(0,splitter);
  messageProcessors.add(new MessageFilter(new Filter(){
    @Override public boolean accept(    MuleMessage message){
      return false;
    }
  }
));
  try {
    this.ownedMessageProcessor=new DefaultMessageProcessorChainBuilder().chain(messageProcessors).build();
  }
 catch (  MuleException e) {
    throw new InitialisationException(e,this);
  }
  super.initialise();
}
