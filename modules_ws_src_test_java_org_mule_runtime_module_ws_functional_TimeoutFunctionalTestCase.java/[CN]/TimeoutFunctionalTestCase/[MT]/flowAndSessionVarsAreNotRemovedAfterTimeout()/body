{
  final Latch serverLatch=new Latch();
  getFunctionalTestComponent("server").setEventCallback(new EventCallback(){
    @Override public void eventReceived(    MuleEventContext context,    Object component) throws Exception {
      serverLatch.await();
    }
  }
);
  FlowRunner runner=flowRunner("client").withPayload("<echo/>");
  runner.buildEvent().setTimeout(1);
  runner.run();
  serverLatch.release();
  MuleMessage message=muleContext.getClient().request("test://out",RECEIVE_TIMEOUT);
  assertThat(message.<String>getOutboundProperty("flowVar"),equalTo("testFlowVar"));
  assertThat(message.<String>getOutboundProperty("sessionVar"),equalTo("testSessionVar"));
}
