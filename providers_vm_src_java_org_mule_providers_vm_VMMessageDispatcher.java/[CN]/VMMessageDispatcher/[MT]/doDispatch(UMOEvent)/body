{
  UMOEndpointURI endpointUri=event.getEndpoint().getEndpointURI();
  if (endpointUri == null) {
    throw new DispatchException(new Message(Messages.X_IS_NULL,"Endpoint"),event.getMessage(),event.getEndpoint());
  }
  if (connector.isQueueEvents()) {
    QueueSession session=connector.getQueueSession();
    Queue queue=session.getQueue(endpointUri.getAddress());
    queue.put(event);
  }
 else {
    VMMessageReceiver receiver=connector.getReceiver(event.getEndpoint().getEndpointURI());
    if (receiver == null) {
      logger.warn("No receiver for endpointUri: " + event.getEndpoint().getEndpointURI());
      return;
    }
    if (event.isStreaming()) {
      StreamMessageAdapter sma=(StreamMessageAdapter)event.getMessage().getAdapter();
      sma.setIn(new PipedInputStream());
      PipedOutputStream out=new PipedOutputStream((PipedInputStream)sma.getInput());
      sma.write(event,out);
    }
    receiver.onEvent(event);
  }
  if (logger.isDebugEnabled()) {
    logger.debug("dispatched Event on endpointUri: " + endpointUri);
  }
}
