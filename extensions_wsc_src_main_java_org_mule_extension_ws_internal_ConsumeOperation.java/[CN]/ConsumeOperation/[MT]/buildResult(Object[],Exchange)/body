{
  String response=processOutput(invocationResponse);
  WscAttributes attributes=processAttributes(exchange);
  List<Message> receivedAttachments=(List<Message>)exchange.get(MULE_ATTACHMENTS_KEY);
  Object output;
  if (!receivedAttachments.isEmpty()) {
    ImmutableList<Message> parts=ImmutableList.<Message>builder().add(Message.builder().payload(response).attributes(BODY_ATTRIBUTES).build()).addAll(receivedAttachments).build();
    output=new DefaultMultiPartPayload(parts);
  }
 else {
    output=response;
  }
  return OperationResult.<Object,WscAttributes>builder().output(output).attributes(attributes).build();
}
