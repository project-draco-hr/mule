{
  validateEncoding();
  if (!initialised.get()) {
    initialising.set(true);
    startDate=System.currentTimeMillis();
    if (workManager == null) {
      ThreadingProfile tp=config.getDefaultThreadingProfile();
      logger.debug("Creating default work manager using default threading profile: " + tp);
      workManager=new MuleWorkManager(tp,"UMOManager");
      workManager.start();
    }
    notificationManager=new ServerNotificationManager(workManager);
    notificationManager.registerEventType(ManagerNotification.class,ManagerNotificationListener.class);
    notificationManager.registerEventType(ModelNotification.class,ModelNotificationListener.class);
    notificationManager.registerEventType(ComponentNotification.class,ComponentNotificationListener.class);
    notificationManager.registerEventType(SecurityNotification.class,SecurityNotificationListener.class);
    notificationManager.registerEventType(ManagementNotification.class,ManagementNotificationListener.class);
    notificationManager.registerEventType(AdminNotification.class,AdminNotificationListener.class);
    notificationManager.registerEventType(CustomNotification.class,CustomNotificationListener.class);
    notificationManager.registerEventType(ConnectionNotification.class,ConnectionNotificationListener.class);
    if (config.isEnableMessageEvents()) {
      notificationManager.registerEventType(MessageNotification.class,MessageNotificationListener.class);
    }
    fireSystemEvent(new ManagerNotification(this,ManagerNotification.MANAGER_INITIALISNG));
    if (id == null) {
      logger.warn("No unique id has been set on this manager");
    }
    try {
      if (securityManager != null) {
        securityManager.initialise();
      }
      if (queueManager == null) {
        try {
          TransactionalQueueManager queueMgr=new TransactionalQueueManager();
          QueuePersistenceStrategy ps=new CachingPersistenceStrategy(getConfiguration().getPersistenceStrategy());
          queueMgr.setPersistenceStrategy(ps);
          queueManager=queueMgr;
        }
 catch (        Exception e) {
          throw new InitialisationException(new Message(Messages.INITIALISATION_FAILURE_X,"QueueManager"),e);
        }
      }
      initialiseConnectors();
      initialiseEndpoints();
      initialiseAgents();
      if (model != null)       model.initialise();
    }
  finally {
      initialised.set(true);
      initialising.set(false);
      fireSystemEvent(new ManagerNotification(this,ManagerNotification.MANAGER_INITIALISED));
    }
  }
}
