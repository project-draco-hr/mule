{
  try {
    MessageFactory mf=MessageFactory.getInstance("OpenPGP");
    ByteArrayInputStream in=new ByteArrayInputStream(data);
    Collection msgs=mf.generateMessages(in);
    Message msg=(Message)msgs.iterator().next();
    if (msg instanceof EncryptedMessage) {
      msg=((EncryptedMessage)msg).decrypt(keyManager.getSecretKeyBundle(),keyManager.getSecretPassphrase().toCharArray());
      return new PGPArmouredMessage(msg).getEncoded();
    }
  }
 catch (  Exception e) {
    throw new CryptoFailureException(this,e);
  }
  return data;
}
