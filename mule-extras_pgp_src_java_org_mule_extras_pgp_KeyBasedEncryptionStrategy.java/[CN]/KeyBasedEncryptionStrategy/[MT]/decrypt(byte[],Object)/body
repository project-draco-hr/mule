{
  try {
    MessageFactory mf=MessageFactory.getInstance("OpenPGP");
    ByteArrayInputStream in=new ByteArrayInputStream(data);
    Collection msgs=mf.generateMessages(in);
    Message msg=(Message)msgs.iterator().next();
    if (msg instanceof EncryptedMessage) {
      msg=((EncryptedMessage)msg).decrypt(secretKeyBundle,secretPassphrase.toCharArray());
      return msg.getEncoded();
    }
  }
 catch (  Exception e) {
    throw new CryptoFailureException(this,e);
  }
  return data;
}
