{
  TestClassLoader appClassLoader=new TestClassLoader();
  when(applicationClassLoaderFactory.create(null,appDescriptor).getClassLoader()).thenReturn(appClassLoader);
  final List<ArtifactClassLoader> artifactClassLoaders=new LinkedList<>();
  TestClassLoader pluginClassLoader=new TestClassLoader();
  ArtifactClassLoader artifactClassLoader=mock(ArtifactClassLoader.class);
  when(artifactClassLoader.getClassLoader()).thenReturn(pluginClassLoader);
  artifactClassLoaders.add(artifactClassLoader);
  when(serverPluginClassLoaderManager.getPluginClassLoaders()).thenReturn(artifactClassLoaders);
  ClassLoader createdClassLoader=pluginAwareClassLoaderFactory.create(null,appDescriptor).getClassLoader();
  createdClassLoader.getResource("foo");
  assertThat(appClassLoader.loadedResource,equalTo(true));
  assertThat(pluginClassLoader.loadedResource,equalTo(true));
}
