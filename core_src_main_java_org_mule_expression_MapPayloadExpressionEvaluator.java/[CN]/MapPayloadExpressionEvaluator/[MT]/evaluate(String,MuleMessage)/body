{
  Object payload=message.getPayload();
  if (!(payload instanceof Map)) {
    return null;
  }
  if (expression.indexOf(DELIM) > -1) {
    String[] strings=StringUtils.splitAndTrim(expression,DELIM);
    Map<String,Object> result=new HashMap<String,Object>(strings.length);
    for (    String s : strings) {
      Object val=getValue(s,(Map)payload);
      if (val != null) {
        if (s.endsWith(OPTIONAL_ARGUMENT)) {
          s=s.substring(0,s.length() - OPTIONAL_ARGUMENT.length());
        }
        result.put(s,val);
      }
    }
    return result;
  }
 else {
    return getValue(expression,(Map)payload);
  }
}
