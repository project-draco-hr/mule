{
  fireNotification(ex);
  doLogException(ex);
  if (isRollback(ex)) {
    logger.debug("Rolling back transaction");
    rollback(ex,rollbackMethod);
  }
 else {
    logger.debug("Committing transaction");
    commit();
  }
  ExceptionPayload exceptionPayload=new DefaultExceptionPayload(ex);
  Error error=builder(ex).build();
  if (getCurrentEvent() != null) {
    MuleEvent currentEvent=getCurrentEvent();
    currentEvent.setMessage(MuleMessage.builder(currentEvent.getMessage()).exceptionPayload(exceptionPayload).build());
    currentEvent.setError(error);
    setCurrentEvent(currentEvent);
  }
  if (ex instanceof ConnectException) {
    ((ConnectException)ex).handleReconnection();
  }
}
