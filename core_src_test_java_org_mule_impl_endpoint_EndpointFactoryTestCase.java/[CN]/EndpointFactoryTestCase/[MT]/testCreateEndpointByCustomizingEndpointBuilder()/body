{
  Registry r=muleContext.getRegistry();
  TestConnector testConnector1=new TestConnector();
  testConnector1.setName("testConnector1");
  TestConnector testConnector2=new TestConnector();
  testConnector2.setName("testConnector2");
  r.registerConnector(testConnector1);
  r.registerConnector(testConnector2);
  String globalEndpointName="concreteEndpoint";
  UMOEndpointBuilder endpointBuilder=new EndpointURIEndpointBuilder("test://address",muleContext);
  endpointBuilder.setConnector(testConnector1);
  r.registerObject(globalEndpointName,endpointBuilder);
  UMOEndpointFactory endpointFactory=new EndpointFactory();
  endpointFactory.setMuleContext(muleContext);
  try {
    UMOEndpointBuilder endpointBuilder1=endpointFactory.getEndpointBuilder(globalEndpointName);
    assertNotSame(endpointBuilder1,endpointBuilder);
    assertTrue(endpointBuilder1.equals(endpointBuilder));
    UMOEndpointBuilder endpointBuilder2=endpointFactory.getEndpointBuilder(globalEndpointName);
    assertNotSame(endpointBuilder2,endpointBuilder);
    assertTrue(endpointBuilder2.equals(endpointBuilder));
    assertNotSame(endpointBuilder1,endpointBuilder2);
    assertTrue(endpointBuilder1.equals(endpointBuilder2));
    assertEquals(endpointBuilder1.hashCode(),endpointBuilder2.hashCode());
    endpointBuilder1.setSynchronous(true);
    endpointBuilder1.setRemoteSyncTimeout(99);
    UMOImmutableEndpoint ep=endpointFactory.getInboundEndpoint(endpointBuilder1);
    assertEquals(ep.getEndpointURI().getUri().toString(),"test://address");
    assertTrue(ep.isSynchronous());
    assertEquals(99,ep.getRemoteSyncTimeout());
    assertNotNull(ep.getConnector());
    assertEquals(testConnector1,ep.getConnector());
    endpointBuilder2.setSynchronous(false);
    endpointBuilder2.setRemoteSyncTimeout(0);
    endpointBuilder2.setConnector(testConnector2);
    UMOImmutableEndpoint ep2=endpointFactory.getInboundEndpoint(endpointBuilder2);
    assertEquals(ep2.getEndpointURI().getUri().toString(),"test://address");
    assertFalse(ep2.isSynchronous());
    assertEquals(0,ep2.getRemoteSyncTimeout());
    assertNotNull(ep.getConnector());
    assertEquals(testConnector2,ep2.getConnector());
    UMOImmutableEndpoint ep3=endpointFactory.getInboundEndpoint(endpointBuilder1);
    assertEquals(ep3.getEndpointURI().getUri().toString(),"test://address");
    assertTrue(ep3.getRemoteSyncTimeout() != 0);
    assertTrue(ep3.isSynchronous());
    assertNotNull(ep.getConnector());
    assertEquals(testConnector1,ep3.getConnector());
  }
 catch (  Exception e) {
    fail("Unexpected exception: " + e.getMessage());
  }
}
