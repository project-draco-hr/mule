{
  XmlConfigurationMuleArtifactFactory factory=lookupArtifact();
  MuleArtifact artifact=null;
  try {
    artifact=factory.getArtifact(document.getDocumentElement(),callback);
    assertNotNull(artifact);
    assertTrue(artifact.hasCapability(Testable.class));
    assertTrue(artifact.getCapability(Testable.class) instanceof Testable);
    if (expectedResult != null) {
      Testable artifactCapability=artifact.getCapability(Testable.class);
      assertEquals(expectedResult,artifactCapability.test().getStatus());
    }
  }
  finally {
    if (artifact != null) {
      factory.returnArtifact(artifact);
    }
  }
}
