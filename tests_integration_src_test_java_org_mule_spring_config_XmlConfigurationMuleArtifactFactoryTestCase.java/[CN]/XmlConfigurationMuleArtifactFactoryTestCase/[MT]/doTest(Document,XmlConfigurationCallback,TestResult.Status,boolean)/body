{
  XmlConfigurationMuleArtifactFactory factory=lookupArtifact();
  MuleArtifact artifact=null;
  try {
    artifact=factory.getArtifact(document.getDocumentElement(),callback);
    Assert.assertNotNull(artifact);
    Assert.assertTrue(artifact.hasCapability(Testable.class));
    Assert.assertTrue(artifact.getCapability(Testable.class) instanceof Testable);
    if (canConnect) {
      Testable t=artifact.getCapability(Testable.class);
      Assert.assertEquals(expectedResult,t.test().getStatus());
    }
  }
  finally {
    if (artifact != null) {
      factory.returnArtifact(artifact);
    }
  }
}
