{
  if (username == null && password == null) {
    return super.doCreateConnection();
  }
 else {
    ConnectionFactory cf=getTargetConnectionFactory();
    if (Boolean.FALSE.equals(getPubSubMode()) && cf instanceof QueueConnectionFactory) {
      return ((QueueConnectionFactory)cf).createQueueConnection(username,password);
    }
 else     if (Boolean.TRUE.equals(getPubSubMode()) && cf instanceof TopicConnectionFactory) {
      return ((TopicConnectionFactory)cf).createTopicConnection(username,password);
    }
 else {
      return getTargetConnectionFactory().createConnection(username,password);
    }
  }
}
