{
  if (event.getSession().getSecurityContext() == null) {
    if (isAuthenticate()) {
      throw new UnauthorisedException(event.getSession().getSecurityContext(),event.getEndpoint(),this);
    }
 else {
      return;
    }
  }
  UMOAuthentication auth=event.getSession().getSecurityContext().getAuthentication();
  if (isAuthenticate()) {
    auth=getSecurityManager().authenticate(auth);
    if (logger.isDebugEnabled()) {
      logger.debug("Authentication success: " + auth.toString());
    }
  }
  String token=auth.getCredentials().toString();
  String header=new String(strategy.encrypt(token.getBytes()));
  event.setProperty(MuleProperties.MULE_USER_PROPERTY,header);
}
