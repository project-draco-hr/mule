{
  Transformer result=exactTransformerCache.get(criteria.getInputTypes()[0].getName() + criteria.getOutputType().getName());
  if (result != null) {
    return result;
  }
  List trans=muleContext.getRegistry().lookupTransformers(criteria.getInputTypes()[0],criteria.getOutputType());
  result=getNearestTransformerMatch(trans,criteria.getInputTypes()[0],criteria.getOutputType());
  Transformer secondPass=null;
  if (result == null) {
    if (criteria.getOutputType().equals(String.class)) {
      secondPass=objectToString;
    }
 else     if (criteria.getOutputType().equals(byte[].class)) {
      secondPass=objectToByteArray;
    }
 else {
      return null;
    }
    trans=muleContext.getRegistry().lookupTransformers(criteria.getInputTypes()[0],Object.class);
    result=getNearestTransformerMatch(trans,criteria.getInputTypes()[0],criteria.getOutputType());
    if (result != null) {
      result=new TransformerChain(new Transformer[]{result,secondPass});
    }
  }
  if (result != null) {
    exactTransformerCache.put(criteria.getInputTypes()[0].getName() + criteria.getOutputType().getName(),result);
  }
  return result;
}
