{
  final String domainOriginal="TEST_DOMAIN_1";
  final MuleDescriptor descriptor=new MuleDescriptor("TEST_SERVICE");
  descriptor.setServiceFactory(new SingletonObjectFactory(new Object()));
  getDefaultModel(managementContext).registerComponent(descriptor);
  managementContext.start();
  final ComponentService service=new ComponentService("TEST_SERVICE");
  final ObjectName name=ObjectName.getInstance(domainOriginal + ":type=TEST_SERVICE");
  mBeanServer.registerMBean(service,name);
  Set mbeans=mBeanServer.queryMBeans(ObjectName.getInstance(domainOriginal + ":*"),null);
  assertEquals("Unexpected number of components registered in the domain.",4,mbeans.size());
  mBeanServer.unregisterMBean(name);
  mbeans=mBeanServer.queryMBeans(ObjectName.getInstance(domainOriginal + ":*"),null);
  assertEquals("There should be no MBeans left in the domain",0,mbeans.size());
}
