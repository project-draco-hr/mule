{
  if (!headers.get("foo").equals("fooValue")) {
    throw new IllegalArgumentException("Header foo was not set to the correct value 'fooValue'");
  }
  List<Node> nodes=XMLUtils.select("/person/emailAddresses/emailAddress",doc);
  List<EmailAddress> addrs=new ArrayList<EmailAddress>(nodes.size());
  for (  Node node : nodes) {
    addrs.add(context.createUnmarshaller().unmarshal(node,EmailAddress.class).getValue());
  }
  return addrs;
}
