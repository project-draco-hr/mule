{
  if (endpoints == null || endpoints.size() == 0) {
    throw new RoutePathNotFoundException(CoreMessages.noEndpointsForRouter(),message,null);
  }
  if (enableCorrelation != ENABLE_CORRELATION_NEVER) {
    boolean correlationSet=message.getCorrelationId() != null;
    if (correlationSet && (enableCorrelation == ENABLE_CORRELATION_IF_NOT_SET)) {
      logger.debug("CorrelationId is already set, not setting Correlation group size");
    }
 else {
      message.setCorrelationGroupSize(endpoints.size());
    }
  }
  List results=new ArrayList(endpoints.size());
  try {
    OutboundEndpoint endpoint;
    for (int i=0; i < endpoints.size(); i++) {
      endpoint=(OutboundEndpoint)endpoints.get(i);
      if (endpoint.isSynchronous()) {
        results.add(send(session,new DefaultMuleMessage(message.getPayload(),message),endpoint));
      }
 else {
        dispatch(session,message,endpoint);
      }
    }
  }
 catch (  MuleException e) {
    throw new CouldNotRouteOutboundMessageException(message,(ImmutableEndpoint)endpoints.get(0),e);
  }
  return resultsHandler.aggregateResults(results,message);
}
