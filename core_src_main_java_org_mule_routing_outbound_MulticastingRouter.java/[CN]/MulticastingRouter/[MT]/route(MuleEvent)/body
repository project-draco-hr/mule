{
  MuleMessage message=event.getMessage();
  if (routes == null || routes.size() == 0) {
    throw new RoutePathNotFoundException(CoreMessages.noEndpointsForRouter(),event,null);
  }
  if (enableCorrelation != CorrelationMode.NEVER) {
    boolean correlationSet=message.getCorrelationId() != null;
    if (correlationSet && (enableCorrelation == CorrelationMode.IF_NOT_SET)) {
      logger.debug("CorrelationId is already set, not setting Correlation group size");
    }
 else {
      message.setCorrelationGroupSize(routes.size());
    }
  }
  List<MuleEvent> results=new ArrayList<MuleEvent>(routes.size());
  try {
    for (int i=0; i < routes.size(); i++) {
      MessageProcessor mp=routes.get(i);
      OutboundEndpoint endpoint=mp instanceof OutboundEndpoint ? (OutboundEndpoint)mp : null;
      if (endpoint == null || endpoint.getFilter() == null || (endpoint.getFilter() != null && endpoint.getFilter().accept(message))) {
        if (((DefaultMuleMessage)message).isConsumable()) {
          throw new MessagingException(CoreMessages.cannotCopyStreamPayload(message.getPayload().getClass().getName()),event);
        }
        MuleMessage clonedMessage=new DefaultMuleMessage(message.getPayload(),message,muleContext);
        MuleEvent result=sendRequest(event,clonedMessage,mp,true);
        if (result != null) {
          results.add(result);
        }
      }
    }
  }
 catch (  MuleException e) {
    throw new CouldNotRouteOutboundMessageException(event,routes.get(0),e);
  }
  return resultsHandler.aggregateResults(results,event,muleContext);
}
