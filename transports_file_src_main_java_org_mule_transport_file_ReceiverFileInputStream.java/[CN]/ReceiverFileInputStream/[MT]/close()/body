{
  super.close();
  if (!isStreamProcessingError()) {
    if (moveToOnClose != null) {
      if (currentFile.exists()) {
        if (!FileUtils.moveFileWithCopyFallback(currentFile,moveToOnClose)) {
          logger.warn(String.format("Failed to move file from %s to %s\n",currentFile.getPath(),moveToOnClose.getPath()));
        }
      }
 else       if (logger.isDebugEnabled()) {
        logger.debug(String.format("Failed to move file from %s to %s. The file does not exist.\n",currentFile.getPath(),moveToOnClose.getPath()));
      }
    }
 else     if (deleteOnClose) {
      if (currentFile.exists()) {
        if (!currentFile.delete()) {
          throw new IOException(new DefaultMuleException(FileMessages.failedToDeleteFile(currentFile)));
        }
      }
 else       if (logger.isDebugEnabled()) {
        logger.debug(String.format("Failed to delete file %s. The file does not exist.\n",currentFile.getPath()));
      }
    }
  }
  if (closeListener != null) {
    closeListener.fileClose(currentFile);
  }
}
