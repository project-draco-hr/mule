{
  if (!alreadyClosed.getAndSet(true)) {
    super.close();
    if (!isStreamProcessingError()) {
      if (moveToOnClose != null) {
        if (!FileUtils.moveFileWithCopyFallback(currentFile,moveToOnClose)) {
          logger.warn(String.format("Failed to move file from %s to %s\n",currentFile.getPath(),moveToOnClose.getPath()));
        }
      }
 else       if (deleteOnClose) {
        if (!currentFile.delete()) {
          try {
            throw new DefaultMuleException(FileMessages.failedToDeleteFile(currentFile));
          }
 catch (          DefaultMuleException e) {
            IOException e2=new IOException();
            e2.initCause(e);
            throw e2;
          }
        }
      }
    }
    if (closeListener != null) {
      closeListener.fileClose(currentFile);
    }
  }
}
