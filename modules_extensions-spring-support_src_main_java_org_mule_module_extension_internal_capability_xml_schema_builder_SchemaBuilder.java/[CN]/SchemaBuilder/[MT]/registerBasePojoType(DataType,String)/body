{
  final TopLevelComplexType complexType=new TopLevelComplexType();
  registeredComplexTypesHolders.put(type,new ComplexTypeHolder(complexType,type));
  complexType.setName(type.getName());
  complexType.setAnnotation(createDocAnnotation(description));
  ComplexContent complexContent=new ComplexContent();
  complexType.setComplexContent(complexContent);
  final ExtensionType extension=new ExtensionType();
  extension.setBase(MULE_ABSTRACT_EXTENSION_TYPE);
  complexContent.setExtension(extension);
  for (  Field field : getExposedFields(type.getRawType())) {
    if (isIgnored(field)) {
      continue;
    }
    final String name=getAlias(field);
    final DataType fieldType=getFieldDataType(field);
    final boolean required=isRequired(field);
    final Object defaultValue=getDefaultValue(field);
    final ExpressionSupport expressionSupport=getExpressionSupport(field);
    fieldType.getQualifier().accept(new AbstractDataQualifierVisitor(){
      @Override public void onList(){
        final ExplicitGroup all=getOrCreateSequenceGroup(extension);
        generateCollectionElement(all,name,EMPTY,fieldType,required);
      }
      @Override public void onMap(){
        final ExplicitGroup all=getOrCreateSequenceGroup(extension);
        generateMapElement(all,name,EMPTY,fieldType,required);
      }
      @Override public void onPojo(){
        if (TlsContextFactory.class.isAssignableFrom(fieldType.getRawType())) {
          final ExplicitGroup all=getOrCreateSequenceGroup(extension);
          addTlsSupport(extension,all);
          return;
        }
        if (shouldGeneratePojoChildElements(fieldType.getRawType())) {
          if (ExpressionSupport.REQUIRED != expressionSupport) {
            final ExplicitGroup all=getOrCreateSequenceGroup(extension);
            registerComplexTypeChildElement(all,name,EMPTY,fieldType,false);
          }
 else {
            defaultOperation();
            registerPojoType(fieldType,EMPTY);
          }
        }
      }
      @Override protected void defaultOperation(){
        Attribute attribute=createAttribute(name,EMPTY,fieldType,defaultValue,required,expressionSupport);
        extension.getAttributeOrAttributeGroup().add(attribute);
      }
    }
);
  }
  schema.getSimpleTypeOrComplexTypeOrGroup().add(complexType);
  return complexType;
}
