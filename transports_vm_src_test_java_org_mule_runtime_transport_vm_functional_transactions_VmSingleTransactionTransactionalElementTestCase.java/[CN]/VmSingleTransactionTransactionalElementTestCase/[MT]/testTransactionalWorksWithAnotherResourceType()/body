{
  Flow flow=(Flow)getFlowConstruct("transactionalWorksWithAnotherResourceType");
  MuleEvent event=getTestEvent("message",flow);
  try {
    flow.process(event);
    fail("DispatchException should be thrown");
  }
 catch (  DispatchException e) {
    assertThat(e.getCause() instanceof TransactionException,Is.is(true));
  }
  MuleMessage message1=muleContext.getClient().request("vm://out1?connector=vmConnector1",1000);
  MuleMessage message2=muleContext.getClient().request("vm://out2?connector=vmConnector1",1000);
  assertThat(message1,nullValue());
  assertThat(message2,nullValue());
}
