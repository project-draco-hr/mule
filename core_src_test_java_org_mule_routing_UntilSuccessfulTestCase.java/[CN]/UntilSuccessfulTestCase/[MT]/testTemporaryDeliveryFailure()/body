{
  targetMessageProcessor.setNumberOfFailuresToSimulate(untilSuccessful.getMaxProcessingAttempts() - 1);
  untilSuccessful.initialise();
  untilSuccessful.start();
  final MuleEvent testEvent=getTestEvent("ERROR");
  assertNull(untilSuccessful.process(testEvent));
  assertEquals(1,objectStore.allKeys().size());
  ponderUntilEventProcessed(testEvent);
  assertEquals(targetMessageProcessor.getEventCount(),untilSuccessful.getMaxProcessingAttempts());
}
