{
  URLName url=urlFromEndpoint(endpoint);
  Properties global=System.getProperties();
  Properties local=new Properties();
  Session session;
synchronized (global) {
    extendPropertiesForSession(global,local,url);
    session=Session.getInstance(local,getAuthenticator());
  }
  if (logger.isDebugEnabled()) {
    local.setProperty("mail.debug","true");
    dumpProperties("Session local properties",local,true);
    dumpProperties("System global properties",global,true);
    logger.debug("Creating mail session: host = " + url.getHost() + ", port = "+ url.getPort()+ ", user = "+ url.getUsername()+ ", pass = "+ url.getPassword());
  }
  return new SessionDetails(session,url);
}
