{
  MuleClient client=muleContext.getClient();
  Map<String,Object> properties=new HashMap<String,Object>();
  properties.put(HttpConnector.HTTP_REQUEST_PROPERTY,"/resource/operation");
  properties.put(HttpConnector.HTTP_CONTEXT_PATH_PROPERTY,"");
  properties.put(HttpConnector.HTTP_METHOD_PROPERTY,"GET");
  client.dispatch("vm://in",null,properties);
  MuleMessage response=client.request("vm://out",RECEIVE_TIMEOUT);
  TestResource testResource=muleContext.getRegistry().get("testResourceBean");
  assertThat(testResource.isCalled(),is(true));
  assertThat(testResource.getTestStreamingOutput().isCalled(),is(false));
  response.getPayloadAsBytes();
  assertThat(testResource.getTestStreamingOutput().isCalled(),is(true));
}
