{
  if (message == null) {
    servletResponse.setStatus(HttpServletResponse.SC_NO_CONTENT);
    if (feedback) {
      servletResponse.setStatus(HttpServletResponse.SC_OK);
      servletResponse.getWriter().write("Action was processed successfully. There was no result");
    }
  }
 else {
    HttpResponse httpResponse;
    if (message.getPayload() instanceof HttpResponse) {
      httpResponse=(HttpResponse)message.getPayload();
    }
 else {
      httpResponse=(HttpResponse)responseTransformer.transform(message);
    }
    Header contentTypeHeader=httpResponse.getFirstHeader(HttpConstants.HEADER_CONTENT_TYPE);
    String contentType=null;
    if (contentTypeHeader != null && contentTypeHeader.getValue() != null) {
      logger.debug("Using Content-Type from message header = " + contentTypeHeader.getValue());
      contentType=contentTypeHeader.getValue();
    }
 else {
      contentType=defaultContentType;
    }
    servletResponse.setContentType(contentType);
    servletResponse=setHttpHeadersOnServletResponse(httpResponse,servletResponse);
    if (!servletResponse.isCommitted()) {
      servletResponse.setStatus(httpResponse.getStatusCode());
    }
    if (httpResponse.hasBody()) {
      OutputHandler outputHandler=httpResponse.getBody();
      outputHandler.write(RequestContext.getEvent(),servletResponse.getOutputStream());
    }
  }
  servletResponse.flushBuffer();
}
