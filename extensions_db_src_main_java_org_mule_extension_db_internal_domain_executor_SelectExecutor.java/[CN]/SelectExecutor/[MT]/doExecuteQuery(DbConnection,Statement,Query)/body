{
  ResultSet resultSet;
  try {
    if (statement instanceof PreparedStatement) {
      resultSet=((PreparedStatement)statement).executeQuery();
    }
 else {
      resultSet=statement.executeQuery(query.getQueryTemplate().getSqlText());
    }
    return resultHandler.processResultSet(connection,resultSet);
  }
  finally {
    if (!resultHandler.requiresMultipleOpenedResults()) {
      statement.close();
    }
  }
}
