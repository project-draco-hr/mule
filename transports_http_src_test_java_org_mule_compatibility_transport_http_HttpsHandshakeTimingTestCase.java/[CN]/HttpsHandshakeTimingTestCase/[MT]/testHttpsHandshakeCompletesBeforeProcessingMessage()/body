{
  MockHttpsMessageReceiver messageReceiver=setupMockHttpsMessageReceiver();
  MockSslSocket socket=new MockSslSocket();
  socket.setInputStream(new ByteArrayInputStream("GET /path/to/file/index.html HTTP/1.0\n\n\n".getBytes()));
  HttpServerConnection serverConnection=new HttpServerConnection(socket,UTF_8,(HttpConnector)messageReceiver.getConnector());
  HttpMessageProcessTemplate messageContext=messageReceiver.createMessageProcessTemplate(serverConnection);
  invokeHandshakeCompleted(serverConnection,socket);
  InternalMessage message=InternalMessage.builder().payload(TEST_MESSAGE).build();
  messageContext.acquireMessage();
  serverConnection.readRequest();
  Event muleEvent=messageContext.beforeRouteEvent(getTestEvent(message));
  assertNotNull(muleEvent.getMessage().getOutboundProperty(HttpsConnector.LOCAL_CERTIFICATES));
  assertNotNull(muleEvent.getMessage().getOutboundProperty(HttpsConnector.PEER_CERTIFICATES));
}
