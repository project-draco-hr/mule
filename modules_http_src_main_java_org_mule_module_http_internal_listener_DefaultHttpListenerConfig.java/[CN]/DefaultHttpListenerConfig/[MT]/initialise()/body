{
  if (initialised) {
    return;
  }
  basePath=HttpParser.sanitizePathWithStartSlash(this.basePath);
  try {
    connectionManager=muleContext.getRegistry().lookupObject(HttpListenerConnectionManager.class);
  }
 catch (  RegistrationException e) {
    throw new InitialisationException(e,this);
  }
  if (workerThreadingProfile == null) {
    workerThreadingProfile=new MutableThreadingProfile(ThreadingProfile.DEFAULT_THREADING_PROFILE);
    workerThreadingProfile.setMaxThreadsActive(DEFAULT_MAX_THREADS);
  }
  if (port == null) {
    port=protocol.getDefaultPort();
  }
  if (protocol.equals(HTTP) && tlsContext != null) {
    throw new InitialisationException(CoreMessages.createStaticMessage("TlsContext cannot be configured with protocol HTTP. " + "If you defined a tls:context element in your listener-config then you must set protocol=\"HTTPS\""),this);
  }
  if (protocol.equals(HTTPS) && tlsContext == null) {
    throw new InitialisationException(CoreMessages.createStaticMessage("Configured protocol is HTTPS but there's no TlsContext configured"),this);
  }
  if (tlsContext != null && !tlsContext.isKeyStoreConfigured()) {
    throw new InitialisationException(CoreMessages.createStaticMessage("KeyStore must be configured for server side SSL"),this);
  }
  verifyConnectionsParameters();
  ServerAddress serverAddress;
  try {
    serverAddress=createServerAddress();
  }
 catch (  UnknownHostException e) {
    throw new InitialisationException(CoreMessages.createStaticMessage("Cannot resolve host %s",host),e,this);
  }
  if (tlsContext == null) {
    server=connectionManager.createServer(serverAddress,createWorkManagerSource(),usePersistentConnections,connectionIdleTimeout);
  }
 else {
    server=connectionManager.createSslServer(serverAddress,createWorkManagerSource(),tlsContext,usePersistentConnections,connectionIdleTimeout);
  }
  initialised=true;
}
