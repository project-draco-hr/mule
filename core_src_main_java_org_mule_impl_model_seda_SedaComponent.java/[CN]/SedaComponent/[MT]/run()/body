{
  MuleEvent event=null;
  MuleProxy proxy=null;
  QueueSession queueSession=getManagementContext().getQueueManager().getQueueSession();
  while (!stopped.get()) {
    try {
      paused.whenFalse(null);
      if (stopping.get()) {
        if (queueSession == null || queueSession.getQueue(descriptorQueueName).size() == 0) {
          stopping.set(false);
          break;
        }
      }
      event=(MuleEvent)dequeue();
      if (event != null) {
        if (stats.isEnabled()) {
          stats.decQueuedEvent();
        }
        if (logger.isDebugEnabled()) {
          logger.debug("Component: " + descriptor.getName() + " dequeued event on: "+ event.getEndpoint().getEndpointURI());
        }
        proxy=getProxy();
        proxy.start();
        proxy.onEvent(queueSession,event);
        workManager.scheduleWork(proxy,WorkManager.INDEFINITE,null,this);
      }
    }
 catch (    Exception e) {
      if (isStopped() || isStopping()) {
        break;
      }
      if (proxy != null && proxyPool != null) {
        try {
          proxyPool.returnObject(proxy);
        }
 catch (        Exception e2) {
          logger.info("Failed to return proxy to pool",e2);
        }
      }
      if (e instanceof InterruptedException) {
        stopping.set(false);
        break;
      }
 else       if (e instanceof NoSuchElementException) {
        handleException(new ComponentException(CoreMessages.proxyPoolTimedOut(),(event == null ? null : event.getMessage()),this,e));
      }
 else       if (e instanceof UMOException) {
        handleException(e);
      }
 else       if (e instanceof WorkException) {
        handleException(new ComponentException(CoreMessages.eventProcessingFailedFor(descriptor.getName()),(event == null ? null : event.getMessage()),this,e));
      }
 else {
        handleException(new ComponentException(CoreMessages.failedToGetPooledObject(),(event == null ? null : event.getMessage()),this,e));
      }
    }
 finally {
      stopping.set(false);
      if (proxy != null && componentPerRequest) {
        proxy.dispose();
      }
    }
  }
}
