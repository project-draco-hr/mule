{
  Flow flow=getTestFlow("test",Apple.class);
  MuleSession session=getTestSession(flow,muleContext);
  OutboundEndpoint endpoint=getTestOutboundEndpoint("Test1Endpoint","test://endpoint?exchangePattern=request-response");
  ListMessageSplitter router=new ListMessageSplitter();
  router.setFilter(null);
  router.addRoute(endpoint);
  router.setMuleContext(muleContext);
  List<String> payload=new ArrayList<String>();
  payload.add("one");
  payload.add("two");
  payload.add("three");
  payload.add("four");
  MuleMessage message=new DefaultMuleMessage(payload,muleContext);
  MuleEvent result=router.route(new OutboundRoutingTestEvent(message,session,muleContext));
  assertNotNull(result);
  MuleMessage resultMessage=result.getMessage();
  assertNotNull(resultMessage);
  assertTrue(resultMessage instanceof MuleMessageCollection);
  assertEquals("There should be 4 results for 4 split messages.",4,((MuleMessageCollection)resultMessage).size());
}
