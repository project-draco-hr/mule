{
  Service testService=getTestService("test",Apple.class);
  MuleSession session=getTestSession(testService,muleContext);
  OutboundEndpoint endpoint=getTestOutboundEndpoint("Test1Endpoint","test://endpoint?exchange-pattern=request-response");
  ListMessageSplitter router=new ListMessageSplitter();
  router.setFilter(null);
  router.addEndpoint(endpoint);
  router.setMuleContext(muleContext);
  List payload=new ArrayList();
  payload.add("one");
  payload.add("two");
  payload.add("three");
  payload.add("four");
  MuleMessage message=new DefaultMuleMessage(payload,muleContext);
  MuleEvent result=router.route(new OutboundRoutingTestEvent(message,session));
  assertNotNull(result);
  MuleMessage resultMessage=result.getMessage();
  assertNotNull(resultMessage);
  assertTrue(resultMessage instanceof MuleMessageCollection);
  assertEquals("There should be 4 results for 4 split messages.",4,((MuleMessageCollection)resultMessage).size());
}
