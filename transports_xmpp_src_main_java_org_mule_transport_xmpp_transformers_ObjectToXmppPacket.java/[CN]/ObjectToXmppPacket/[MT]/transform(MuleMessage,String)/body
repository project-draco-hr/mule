{
  Object src=muleMessage.getPayload();
  if (src instanceof Message) {
    return src;
  }
  Message result=new Message();
  if (muleMessage.getExceptionPayload() != null) {
    result.setError(new XMPPError(XMPPError.Condition.service_unavailable,muleMessage.getExceptionPayload().getMessage()));
  }
  for (  String propertyName : muleMessage.getPropertyNames()) {
    if (propertyName.equals(XmppConnector.XMPP_THREAD)) {
      result.setThread((String)muleMessage.getProperty(propertyName));
    }
 else     if (propertyName.equals(XmppConnector.XMPP_SUBJECT)) {
      result.setSubject((String)muleMessage.getProperty(propertyName));
    }
 else     if (propertyName.equals(XmppConnector.XMPP_FROM)) {
      result.setFrom((String)muleMessage.getProperty(propertyName));
    }
 else     if (propertyName.equals(XmppConnector.XMPP_TO)) {
      result.setTo((String)muleMessage.getProperty(propertyName));
    }
 else {
      result.setProperty(propertyName,muleMessage.getProperty(propertyName));
    }
  }
  result.setBody((String)src);
  return result;
}
