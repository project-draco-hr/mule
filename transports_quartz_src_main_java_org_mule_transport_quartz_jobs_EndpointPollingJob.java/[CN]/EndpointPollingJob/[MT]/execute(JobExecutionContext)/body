{
  JobDataMap jobDataMap=jobExecutionContext.getJobDetail().getJobDataMap();
  String receiverKey=(String)jobDataMap.get(QuartzMessageReceiver.QUARTZ_RECEIVER_PROPERTY);
  if (receiverKey == null) {
    throw new JobExecutionException(QuartzMessages.receiverNotInJobDataMap().getMessage());
  }
  String connectorName=(String)jobDataMap.get(QuartzMessageReceiver.QUARTZ_CONNECTOR_PROPERTY);
  if (connectorName == null) {
    throw new JobExecutionException(QuartzMessages.connectorNotInJobDataMap().getMessage());
  }
  AbstractConnector connector=(AbstractConnector)RegistryContext.getRegistry().lookupConnector(connectorName);
  if (connector == null) {
    throw new JobExecutionException(QuartzMessages.noConnectorFound(connectorName).getMessage());
  }
  AbstractMessageReceiver receiver=(AbstractMessageReceiver)connector.lookupReceiver(receiverKey);
  if (receiver == null) {
    throw new JobExecutionException(QuartzMessages.noReceiverInConnector(receiverKey,connectorName).getMessage());
  }
  EndpointPollingJobConfig jobConfig=(EndpointPollingJobConfig)jobDataMap.get(QuartzConnector.PROPERTY_JOB_CONFIG);
  if (jobConfig == null) {
    throw new JobExecutionException(QuartzMessages.missingJobDetail(QuartzConnector.PROPERTY_JOB_CONFIG).getMessage());
  }
  try {
    MuleClient client=new MuleClient();
    logger.debug("Attempting to receive event on: " + jobConfig.getEndpointRef());
    MuleMessage result=client.request(jobConfig.getEndpointRef(),jobConfig.getTimeout());
    if (result != null) {
      if (logger.isDebugEnabled()) {
        logger.debug("Received event on: " + jobConfig.getEndpointRef());
      }
      result=(MuleMessage)((ThreadSafeAccess)result).newThreadCopy();
      result.addProperties(jobDataMap,PropertyScope.INVOCATION);
      receiver.routeMessage(result);
    }
  }
 catch (  MuleException e) {
    throw new JobExecutionException(e);
  }
}
