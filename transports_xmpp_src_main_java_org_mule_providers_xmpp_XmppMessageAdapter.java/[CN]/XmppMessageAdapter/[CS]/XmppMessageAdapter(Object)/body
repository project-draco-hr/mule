{
  if (message instanceof Packet) {
    this.message=(Packet)message;
    for (Iterator iter=this.message.getPropertyNames(); iter.hasNext(); ) {
      String name=(String)iter.next();
      this.setProperty(name,this.message.getProperty(name));
    }
    if (this.message instanceof Message) {
      this.setProperty("subject",StringUtils.defaultIfEmpty(((Message)this.message).getSubject(),DEFAULT_SUBJECT));
      this.setProperty("thread",StringUtils.defaultIfEmpty(((Message)this.message).getThread(),DEFAULT_THREAD));
    }
  }
 else {
    throw new MessageTypeNotSupportedException(message,getClass());
  }
}
