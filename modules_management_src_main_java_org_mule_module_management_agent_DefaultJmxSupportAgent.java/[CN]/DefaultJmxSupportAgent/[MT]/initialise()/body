{
  try {
    Agent agent=createRmiAgent();
    final MuleRegistry registry=muleContext.getRegistry();
    if (!isAgentRegistered(agent)) {
      registry.registerAgent(agent);
    }
    agent=createJmxAgent();
    if (registry.lookupObject(JmxApplicationAgent.class) == null) {
      registry.registerAgent(agent);
    }
    if (loadLog4jAgent) {
      agent=createLog4jAgent();
      if (!isAgentRegistered(agent)) {
        registry.registerAgent(agent);
      }
    }
    agent=createJmxNotificationAgent();
    if (!isAgentRegistered(agent)) {
      registry.registerAgent(agent);
    }
    if (loadJdmkAgent) {
      agent=createJdmkAgent();
      if (!isAgentRegistered(agent)) {
        registry.registerAgent(agent);
      }
    }
    if (loadMx4jAgent) {
      agent=createMx4jAgent();
      if (!isAgentRegistered(agent)) {
        registry.registerAgent(agent);
      }
    }
    if (loadProfilerAgent) {
      agent=createProfilerAgent();
      if (!isAgentRegistered(agent)) {
        registry.registerAgent(agent);
      }
    }
    registry.unregisterAgent(name);
  }
 catch (  MuleException e) {
    throw new InitialisationException(e,this);
  }
}
