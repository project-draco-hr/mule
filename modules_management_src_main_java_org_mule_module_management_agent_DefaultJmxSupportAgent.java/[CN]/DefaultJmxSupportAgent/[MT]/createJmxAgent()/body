{
  JmxAgent agent=new JmxAgent();
  String remotingUri=null;
  if (StringUtils.isBlank(host) && StringUtils.isBlank(port)) {
    remotingUri=JmxAgent.DEFAULT_REMOTING_URI;
  }
 else   if (StringUtils.isNotBlank(host)) {
    Map props=agent.getConnectorServerProperties();
    Map mergedProps=new HashMap(props.size() + 1);
    mergedProps.putAll(props);
    RMIClientSocketFactory factory=new FixedHostRmiClientSocketFactory(host);
    mergedProps.put(RMIConnectorServer.RMI_CLIENT_SOCKET_FACTORY_ATTRIBUTE,factory);
    agent.setConnectorServerProperties(mergedProps);
  }
  if (StringUtils.isBlank(remotingUri)) {
    remotingUri=MessageFormat.format("service:jmx:rmi:///jndi/rmi://{0}:{1}/server",StringUtils.defaultString(host,DEFAULT_HOST),StringUtils.defaultString(port,DEFAULT_PORT));
  }
  if (credentials != null && !credentials.isEmpty()) {
    agent.setCredentials(credentials);
  }
  agent.setConnectorServerUrl(remotingUri);
  return agent;
}
