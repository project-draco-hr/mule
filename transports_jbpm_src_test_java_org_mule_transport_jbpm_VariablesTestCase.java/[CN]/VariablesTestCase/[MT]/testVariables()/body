{
  ProcessConnector connector=(ProcessConnector)muleContext.getRegistry().lookupConnector("bpmConnector");
  BPMS bpms=connector.getBpms();
  assertNotNull(bpms);
  MuleClient client=new MuleClient(muleContext);
  try {
    Map<String,Object> props=new HashMap<String,Object>();
    props.put("foo","bar");
    MuleMessage response=client.send("bpm://variables","data",props);
    String processId=(String)bpms.getId(response.getPayload());
    assertNotNull(processId);
    response=client.request("vm://queueA",3000);
    assertNotNull(response);
    assertEquals("bar",response.getInboundProperty("foo"));
    assertEquals(0.75,response.getInboundProperty("fraction"));
    props=new HashMap<String,Object>();
    props.put("straw","berry");
    props.put("time",new Date());
    response=client.send("bpm://variables/" + processId,"data",props);
    response=client.request("vm://queueB",3000);
    assertNotNull(response);
    assertEquals("bar",response.getInboundProperty("foo"));
    assertEquals(0.75,response.getInboundProperty("fraction"));
    assertEquals("berry",response.getInboundProperty("straw"));
    final Object o=response.getInboundProperty("time");
    assertTrue(o instanceof Date);
  }
  finally {
    client.dispose();
  }
}
