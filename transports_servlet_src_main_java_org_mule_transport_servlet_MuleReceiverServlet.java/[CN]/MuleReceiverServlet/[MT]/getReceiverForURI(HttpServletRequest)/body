{
  String uri=getReceiverName(httpServletRequest);
  if (uri == null) {
    throw new EndpointException(HttpMessages.unableToGetEndpointUri(httpServletRequest.getRequestURI()));
  }
  MessageReceiver receiver=(MessageReceiver)getReceivers().get(uri);
  if (receiver == null) {
    receiver=(AbstractMessageReceiver)getReceivers().get(uri);
    if (receiver == null) {
      receiver=HttpMessageReceiver.findReceiverByStem(connector.getReceivers(),uri);
    }
    if (receiver == null) {
      throw new NoReceiverForEndpointException("No receiver found for endpointUri: " + uri);
    }
  }
  InboundEndpoint endpoint=receiver.getEndpoint();
  if (!(endpoint instanceof DynamicURIInboundEndpoint)) {
    endpoint=new DynamicURIInboundEndpoint(receiver.getEndpoint());
    receiver.setEndpoint(endpoint);
  }
  EndpointURI epURI=new MuleEndpointURI(getRequestUrl(httpServletRequest));
  try {
    epURI.initialise();
    epURI.getParams().setProperty("servlet.endpoint","true");
    ((DynamicURIInboundEndpoint)endpoint).setEndpointURI(epURI);
  }
 catch (  InitialisationException e) {
    throw new EndpointException(e);
  }
  return receiver;
}
