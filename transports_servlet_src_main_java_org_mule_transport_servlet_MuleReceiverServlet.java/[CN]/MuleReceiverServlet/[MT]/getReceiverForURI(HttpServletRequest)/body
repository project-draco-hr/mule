{
  String uri=getReceiverName(httpServletRequest);
  if (uri == null) {
    throw new EndpointException(HttpMessages.unableToGetEndpointUri(httpServletRequest.getRequestURI()));
  }
  MessageReceiver receiver=getReceivers().get(uri);
  if (receiver == null) {
    receiver=HttpMessageReceiver.findReceiverByStem(connector.getReceivers(),uri);
  }
  if (receiver == null) {
    for (    Object key : getReceivers().keySet()) {
      if (new WildcardFilter(key.toString()).accept(uri)) {
        receiver=connector.getReceivers().get(key);
      }
    }
    if (receiver == null) {
      throw new NoReceiverForEndpointException(uri);
    }
  }
  InboundEndpoint endpoint=receiver.getEndpoint();
  if (!(endpoint instanceof DynamicURIInboundEndpoint)) {
    endpoint=new DynamicURIInboundEndpoint(receiver.getEndpoint());
    receiver.setEndpoint(endpoint);
  }
  EndpointURI epURI=new MuleEndpointURI(getRequestUrl(httpServletRequest),muleContext);
  try {
    epURI.initialise();
    epURI.getParams().setProperty("servlet.endpoint","true");
    ((DynamicURIInboundEndpoint)endpoint).setEndpointURI(epURI);
  }
 catch (  InitialisationException e) {
    throw new EndpointException(e);
  }
  return receiver;
}
