{
  boolean stopProcessing=!descriptor.getOutboundRouter().hasEndpoints();
  UMOMessage returnMessage=null;
  if (descriptor.getResponseRouter() != null) {
    if (event.isSynchronous() && !stopProcessing) {
      descriptor.getOutboundRouter().route(message,event.getSession(),false);
    }
    logger.debug("Waiting for response router message");
    message=descriptor.getResponseRouter().getResponse(message);
  }
  UMOEvent event=RequestContext.getEvent();
  if (event.isStopFurtherProcessing()) {
    logger.debug("Event stop further processing has been set, no outbound routing will be performed.");
  }
  if (message != null && !event.isStopFurtherProcessing()) {
    Map context=RequestContext.clearProperties();
    if (context != null) {
      message.addProperties(context);
    }
    returnMessage=descriptor.getOutboundRouter().route(message,event.getSession(),event.isSynchronous());
  }
 else {
    returnMessage=message;
  }
  if (message != null && replyTo != null) {
    String requestor=(String)message.getProperty(MuleProperties.MULE_REPLY_TO_REQUESTOR_PROPERTY);
    if (replyToHandler != null) {
      if ((requestor != null && !requestor.equals(descriptor.getName())) || requestor == null) {
        replyToHandler.processReplyTo(event,message,replyTo);
      }
    }
  }
  return returnMessage;
}
