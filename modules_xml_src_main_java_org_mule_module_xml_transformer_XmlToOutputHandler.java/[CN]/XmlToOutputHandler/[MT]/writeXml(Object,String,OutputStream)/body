{
  try {
    if (src instanceof XMLStreamReader) {
      XMLStreamReader reader=(XMLStreamReader)src;
      XMLStreamWriter writer=getXMLOutputFactory().createXMLStreamWriter(out);
      try {
        writer.writeStartDocument();
        XMLUtils.copy(reader,writer);
        writer.writeEndDocument();
      }
  finally {
        writer.close();
        reader.close();
      }
    }
 else     if (src instanceof DelayedResult) {
      DelayedResult result=(DelayedResult)src;
      StreamResult streamResult=new StreamResult(out);
      result.write(streamResult);
    }
 else {
      writeToStream(src,encoding,out);
    }
  }
 catch (  Exception e) {
    IOException ioe=new IOException(e.toString());
    ioe.initCause(e);
    throw ioe;
  }
}
