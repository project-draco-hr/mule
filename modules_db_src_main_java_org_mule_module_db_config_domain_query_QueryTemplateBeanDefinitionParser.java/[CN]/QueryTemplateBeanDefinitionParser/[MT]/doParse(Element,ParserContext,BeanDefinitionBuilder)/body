{
  builder.setScope(isSingleton() ? BeanDefinition.SCOPE_SINGLETON : BeanDefinition.SCOPE_PROTOTYPE);
  ParserContext nestedCtx=new ParserContext(context.getReaderContext(),context.getDelegate(),builder.getBeanDefinition());
  Element sqlElem=DomUtils.getChildElementByTagName(element,PARAMETERIZED_QUERY);
  if (sqlElem != null) {
    parseParameterizedQuery(element,builder,nestedCtx,sqlElem);
  }
 else {
    sqlElem=DomUtils.getChildElementByTagName(element,DYNAMIC_QUERY);
    if (sqlElem != null) {
      parseDynamicQuery(element,builder,sqlElem);
    }
 else {
      sqlElem=DomUtils.getChildElementByTagName(element,TEMPLATE_QUERY_REF);
      if (sqlElem != null) {
        parseQueryTemplateRef(element,builder,nestedCtx,sqlElem);
      }
 else {
        throw new IllegalArgumentException("Template must contain one of the following elements: " + Arrays.toString(QUERY_DEFINITION_ELEMENTS));
      }
    }
  }
}
