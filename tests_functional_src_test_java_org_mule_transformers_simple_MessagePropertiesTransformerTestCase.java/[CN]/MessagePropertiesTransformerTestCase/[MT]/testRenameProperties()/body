{
  MessagePropertiesTransformer t=new MessagePropertiesTransformer();
  Map<String,String> add=new HashMap<String,String>();
  add.put("Foo","Baz");
  t.setRenameProperties(add);
  t.setScope(PropertyScope.INVOCATION);
  t.setMuleContext(muleContext);
  DefaultMuleMessage msg=new DefaultMuleMessage("message",muleContext);
  msg.setInvocationProperty("Foo","Bar");
  DefaultMuleMessage transformed=(DefaultMuleMessage)t.transform(msg);
  assertSame(msg,transformed);
  assertEquals(msg.getUniqueId(),transformed.getUniqueId());
  assertEquals(msg.getPayload(),transformed.getPayload());
  compareProperties(msg,transformed);
  assertEquals("Bar",transformed.getInvocationProperty("Baz"));
}
