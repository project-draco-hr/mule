{
  MessagePropertiesTransformer t=new MessagePropertiesTransformer();
  t.setDeleteProperties(Collections.singletonList("badProperty"));
  t.setMuleContext(muleContext);
  DefaultMuleMessage msg=new DefaultMuleMessage("message",muleContext);
  msg.setOutboundProperty("badProperty","badValue");
  assertEquals("badValue",msg.<Object>getOutboundProperty("badProperty"));
  DefaultMuleMessage transformed=(DefaultMuleMessage)t.transform(msg,null);
  assertSame(msg,transformed);
  assertEquals(msg.getUniqueId(),transformed.getUniqueId());
  assertEquals(msg.getPayload(),transformed.getPayload());
  compareProperties(msg,transformed);
  assertFalse(transformed.getPropertyNames(PropertyScope.INVOCATION).contains("badValue"));
  assertFalse(transformed.getPropertyNames(PropertyScope.INBOUND).contains("badValue"));
  assertFalse(transformed.getPropertyNames(PropertyScope.OUTBOUND).contains("badValue"));
  assertFalse(transformed.getPropertyNames(PropertyScope.SESSION).contains("badValue"));
}
