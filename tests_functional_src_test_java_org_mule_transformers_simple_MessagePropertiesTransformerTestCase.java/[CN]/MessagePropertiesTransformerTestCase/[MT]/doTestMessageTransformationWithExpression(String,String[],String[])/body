{
  MessagePropertiesTransformer t=createTransformerWithExpression(expression);
  DefaultMuleMessage msg=new DefaultMuleMessage("message",(Map)null,muleContext);
  addPropertiesToMessage(validProperties,msg);
  addPropertiesToMessage(invalidProperties,msg);
  DefaultMuleMessage transformed=(DefaultMuleMessage)t.transform(msg,null);
  assertSame(msg,transformed);
  assertEquals(msg.getUniqueId(),transformed.getUniqueId());
  assertEquals(msg.getPayload(),transformed.getPayload());
  assertEquals(msg.getPropertyNames(),transformed.getPropertyNames());
  assertNotNull(transformed.getPropertyNames());
  assertMessageContainsExpectedProperties(validProperties,invalidProperties,transformed);
}
