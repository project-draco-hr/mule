{
  FunctionalTestComponent testComponent=getFunctionalTestComponent("testService");
  assertNotNull(testComponent);
  EventCallback callback=new EventCallback(){
    @Override public void eventReceived(    final MuleEventContext context,    final Object component) throws Exception {
      MuleMessage msg=context.getMessage();
      assertEquals("BAR",msg.getInboundProperty("FOO"));
    }
  }
;
  testComponent.setEventCallback(callback);
  MuleClient client=muleContext.getClient();
  Map<String,Object> props=new HashMap<String,Object>();
  props.put("operation","greetMe");
  props.put("FOO","BAR");
  MuleMessage result;
  if (config == HEADER_CONF_HTTPN_XML) {
    result=((Flow)getFlowConstruct("clientFlow")).process(getTestEvent(new DefaultMuleMessage("Dan",props,muleContext))).getMessage();
  }
 else {
    result=client.send("clientEndpoint","Dan",props);
  }
  assertEquals("Hello Dan Received",result.getPayload());
  GreeterImpl impl=getGreeter();
  assertEquals(1,impl.getInvocationCount());
}
