{
  if (!initialised.get()) {
    String inbox=null;
    if (connector.getProtocol().equals("imap") && endpoint.getParams().get("folder") != null) {
      inbox=(String)endpoint.getParams().get("folder");
    }
 else {
      inbox=Pop3Connector.MAILBOX;
    }
    URLName url=new URLName(endpoint.getScheme(),endpoint.getHost(),endpoint.getPort(),inbox,endpoint.getUsername(),endpoint.getPassword());
    session=MailUtils.createMailSession(url,connector);
    session.setDebug(logger.isDebugEnabled());
    Store store=session.getStore(url);
    store.connect();
    folder=store.getFolder(inbox);
    if (!folder.isOpen()) {
      try {
        folder.open(Folder.READ_WRITE);
      }
 catch (      MessagingException e) {
        logger.warn("Failed to open folder: " + folder.getFullName(),e);
      }
    }
  }
}
