{
  SecurityContext securityContext=event.getSession().getSecurityContext();
  if (securityContext == null) {
    if (isAuthenticate()) {
      throw new UnauthorisedException(event,securityContext,this);
    }
 else {
      return;
    }
  }
  Authentication auth=securityContext.getAuthentication();
  if (isAuthenticate()) {
    auth=getSecurityManager().authenticate(auth);
    if (logger.isDebugEnabled()) {
      logger.debug("Authentication success: " + auth.toString());
    }
  }
  StringBuffer header=new StringBuffer(128);
  header.append("Basic ");
  String token=auth.getCredentials().toString();
  header.append(new String(Base64.encodeBase64(token.getBytes())));
  event.getMessage().setOutboundProperty(HttpConstants.HEADER_AUTHORIZATION,header.toString());
}
