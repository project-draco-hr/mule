{
  final Event response=flowRunner("recipientListFlow").withPayload(TEST_MESSAGE).withInboundProperty("urls",new String[]{getUrlForPort(port1),getUrlForPort(port2),getUrlForPort(port3)}).run();
  assertThat(response,notNullValue());
  assertThat(response.getMessage().getPayload().getValue(),IsInstanceOf.instanceOf(List.class));
  InternalMessage aggregatedResponse=response.getMessage();
  assertThat(((List<InternalMessage>)aggregatedResponse.getPayload().getValue()).size(),is(3));
  final InternalMessage[] messages=(InternalMessage[])((List<InternalMessage>)aggregatedResponse.getPayload().getValue()).toArray();
  for (int i=0; i < messages.length; i++) {
    InternalMessage message=messages[i];
    assertThat(message,notNullValue());
    assertThat(getPayloadAsString(message),is("inXFlowResponse".replace("X",String.valueOf(i + 1))));
  }
}
