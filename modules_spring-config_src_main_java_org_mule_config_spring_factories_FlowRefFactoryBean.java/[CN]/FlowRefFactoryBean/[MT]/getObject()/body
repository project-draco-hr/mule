{
  final MessageProcessor processor=((MessageProcessor)applicationContext.getBean(refName));
  if (processor instanceof FlowConstruct) {
    return new MessageProcessor(){
      public MuleEvent process(      MuleEvent event) throws MuleException {
        try {
          return processor.process(event);
        }
 catch (        MessagingException e) {
          if (e.getEvent().getMessage().getExceptionPayload() != null) {
            throw e;
          }
          return e.getEvent();
        }
      }
    }
;
  }
 else {
    return processor;
  }
}
