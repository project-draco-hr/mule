{
  final MessageProcessor referencedFlow=((MessageProcessor)applicationContext.getBean(name));
  if (referencedFlow == null) {
    throw new MuleRuntimeException(CoreMessages.objectIsNull(name));
  }
  if (referencedFlow instanceof FlowConstruct) {
    return new FlowRefMessageProcessor(){
      @Override public MuleEvent process(      MuleEvent event) throws MuleException {
        return referencedFlow.process(event);
      }
    }
;
  }
 else {
    return referencedFlow;
  }
}
