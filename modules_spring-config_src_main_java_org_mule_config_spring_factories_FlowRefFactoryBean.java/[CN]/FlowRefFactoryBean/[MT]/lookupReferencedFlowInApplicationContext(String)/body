{
  final MessageProcessor referencedFlow=((MessageProcessor)applicationContext.getBean(name));
  if (referencedFlow == null) {
    throw new MuleRuntimeException(CoreMessages.objectIsNull(name));
  }
  if (referencedFlow instanceof FlowConstruct) {
    return new MessageProcessor(){
      @Override public MuleEvent process(      MuleEvent event) throws MuleException {
        MuleEvent newEvent=DefaultMuleEvent.copy(event);
        newEvent.clearFlowVariables();
        MuleEvent resultEvent=referencedFlow.process(newEvent);
        if (resultEvent != null && !resultEvent.equals(VoidMuleEvent.getInstance())) {
          resultEvent.clearFlowVariables();
          DefaultMuleEvent.copyVariables((DefaultMuleEvent)event,(DefaultMuleEvent)resultEvent);
          OptimizedRequestContext.criticalSetEvent(resultEvent);
        }
        return resultEvent;
      }
    }
;
  }
 else {
    return referencedFlow;
  }
}
