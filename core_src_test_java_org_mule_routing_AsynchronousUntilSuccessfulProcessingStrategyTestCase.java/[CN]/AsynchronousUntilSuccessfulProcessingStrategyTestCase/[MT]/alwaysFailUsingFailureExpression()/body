{
  when(mockUntilSuccessfulConfiguration.getDlqMP()).thenReturn(null);
  when(mockUntilSuccessfulConfiguration.getFailureExpressionFilter()).thenReturn(mockAlwaysTrueFailureExpressionFilter);
  executeUntilSuccessfulFailingRoute(new FailCallback(){
    @Override public void doFail(){
      throw new RuntimeException(EXPECTED_FAILURE_MSG);
    }
  }
);
  waitUntilRouteIsExecuted();
  waitUntilExceptionIsHandled();
  verify(mockEvent.getFlowConstruct().getExceptionListener(),times(1)).handleException(argThat(new ArgumentMatcher<Exception>(){
    @Override public boolean matches(    Object item){
      return item instanceof RetryPolicyExhaustedException && EXPECTED_FAILURE_MSG.equals(((RetryPolicyExhaustedException)item).getCause().getMessage());
    }
  }
),eq(mockEvent));
  verify(mockDLQ,never()).process(any(MuleEvent.class));
}
