{
  if (message == null) {
    response.setStatus(HttpServletResponse.SC_NO_CONTENT);
    if (feedback) {
      response.setStatus(HttpServletResponse.SC_OK);
      response.getWriter().write("Action was processed successfully. There was no result");
    }
  }
 else {
    String contentType=(String)message.getProperty("contentType");
    if (contentType == null)     contentType=defaultContentType;
    if (!contentType.startsWith("text")) {
      response.setContentType(contentType);
      response.getOutputStream().write(message.getPayloadAsBytes());
    }
 else {
      response.setContentType(contentType);
      response.getWriter().write(message.getPayloadAsString());
    }
    response.setStatus(HttpServletResponse.SC_OK);
  }
}
