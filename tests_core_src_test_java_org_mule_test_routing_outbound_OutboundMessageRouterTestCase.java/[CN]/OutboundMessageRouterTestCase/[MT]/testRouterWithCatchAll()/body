{
  final int[] count1=new int[]{0};
  final int[] count2=new int[]{0};
  final int[] catchAllCount=new int[]{0};
  OutboundMessageRouter messageRouter=new OutboundMessageRouter();
  FilteringOutboundRouter filterRouter1=new FilteringOutboundRouter(){
    public UMOMessage route(    UMOMessage message,    UMOSession session,    boolean synchronous) throws RoutingException {
      count1[0]++;
      return message;
    }
  }
;
  FilteringOutboundRouter filterRouter2=new FilteringOutboundRouter(){
    public UMOMessage route(    UMOMessage message,    UMOSession session,    boolean synchronous) throws RoutingException {
      count2[0]++;
      return message;
    }
  }
;
  filterRouter1.setFilter(new PayloadTypeFilter(Exception.class));
  filterRouter2.setFilter(new PayloadTypeFilter(StringBuffer.class));
  messageRouter.addRouter(filterRouter1);
  messageRouter.addRouter(filterRouter2);
  LoggingCatchAllStrategy strategy=new LoggingCatchAllStrategy(){
    public UMOMessage catchMessage(    UMOMessage message,    UMOSession session,    boolean synchronous) throws RoutingException {
      catchAllCount[0]++;
      return null;
    }
  }
;
  messageRouter.setCatchAllStrategy(strategy);
  UMOSession session=getTestSession(getTestComponent(getTestDescriptor("test","test")));
  messageRouter.route(new MuleMessage("hello"),session,true);
  assertEquals(1,catchAllCount[0]);
  assertEquals(0,count1[0]);
  assertEquals(0,count2[0]);
  messageRouter.route(new MuleMessage(new StringBuffer()),session,true);
  assertEquals(1,catchAllCount[0]);
  assertEquals(0,count1[0]);
  assertEquals(1,count2[0]);
  messageRouter.route(new MuleMessage(new Exception()),session,true);
  assertEquals(1,catchAllCount[0]);
  assertEquals(1,count1[0]);
  assertEquals(1,count2[0]);
}
