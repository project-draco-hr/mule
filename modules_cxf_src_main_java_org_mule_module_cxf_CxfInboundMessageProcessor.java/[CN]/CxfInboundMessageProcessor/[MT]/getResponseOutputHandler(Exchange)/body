{
  OutputHandler outputHandler=new OutputHandler(){
    @Override public void write(    MuleEvent event,    OutputStream out) throws IOException {
      Message outFaultMessage=exchange.getOutFaultMessage();
      Message outMessage=exchange.getOutMessage();
      Message contentMsg=null;
      if (outFaultMessage != null && outFaultMessage.getContent(OutputStream.class) != null) {
        contentMsg=outFaultMessage;
      }
 else       if (outMessage != null) {
        contentMsg=outMessage;
      }
      if (contentMsg == null) {
        return;
      }
      DelegatingOutputStream delegate=contentMsg.getContent(DelegatingOutputStream.class);
      if (delegate.getOutputStream() instanceof ByteArrayOutputStream) {
        out.write(((ByteArrayOutputStream)delegate.getOutputStream()).toByteArray());
      }
      delegate.setOutputStream(out);
      out.flush();
      contentMsg.getInterceptorChain().resume();
    }
  }
;
  return outputHandler;
}
