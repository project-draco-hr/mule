{
  Service service=muleContext.getRegistry().lookupService("PausedTestPersistentQueueService");
  int numMessage=500;
  for (int i=0; i < numMessage; i++) {
    service.dispatchEvent(getTestEvent("test",service,getTestInboundEndpoint("test://test")));
  }
  muleContext.stop();
  Thread.sleep(200);
  assertEquals(0,getTestQueueSession().getQueue("out").size());
  assertQueues(numMessage,"PausedTestPersistentQueueService");
  muleContext.start();
  Thread.sleep(200);
  muleContext.stop();
  Thread.sleep(200);
  assertTrue(getTestQueueSession().getQueue("out").size() > 1);
  assertQueues(numMessage,"PausedTestPersistentQueueService");
  service.resume();
  Thread.sleep(100);
  assertTrue(getTestQueueSession().getQueue("out").size() > 0);
  assertQueues(numMessage,"PausedTestPersistentQueueService");
  muleContext.start();
  Thread.sleep(3000);
  muleContext.stop();
  assertQueues(numMessage,"PausedTestPersistentQueueService");
}
