{
  Flow flow=(Flow)muleContext.getRegistry().lookupFlowConstruct("TestPersistentQueueService");
  populateSedaQueue(flow,NUM_MESSAGES);
  muleContext.dispose();
  assertNoLostMessages(NUM_MESSAGES,flow);
  recreateAndStartMuleContext();
  Thread.sleep(WAIT_TIME_MILLIS);
  muleContext.dispose();
  assertNoLostMessages(NUM_MESSAGES,flow);
  recreateAndStartMuleContext();
  Thread.sleep(WAIT_TIME_MILLIS * 10);
  muleContext.dispose();
  assertNoLostMessages(NUM_MESSAGES,flow);
  assertSedaQueueEmpty(flow);
}
