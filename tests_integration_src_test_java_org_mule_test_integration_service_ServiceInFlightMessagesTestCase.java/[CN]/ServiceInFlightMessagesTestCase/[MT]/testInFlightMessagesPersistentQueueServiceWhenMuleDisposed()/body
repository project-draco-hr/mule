{
  Service service=muleContext.getRegistry().lookupService("TestPersistentQueueService");
  populateSedaQueue(service,NUM_MESSAGES);
  muleContext.dispose();
  assertNoLostMessages(NUM_MESSAGES,service);
  recreateAndStartMuleContext();
  Thread.sleep(WAIT_TIME_MILLIS);
  muleContext.dispose();
  assertNoLostMessages(NUM_MESSAGES,service);
  recreateAndStartMuleContext();
  Thread.sleep(WAIT_TIME_MILLIS * 10);
  muleContext.dispose();
  assertNoLostMessages(NUM_MESSAGES,service);
  assertSedaQueueEmpty(service);
}
