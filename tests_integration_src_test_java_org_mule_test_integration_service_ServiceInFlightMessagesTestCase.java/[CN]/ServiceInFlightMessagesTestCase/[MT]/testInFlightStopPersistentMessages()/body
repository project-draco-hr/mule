{
  Service service=muleContext.getRegistry().lookupService("TestPersistentQueueService");
  populateSedaQueue(service,NUM_MESSAGES);
  Thread.sleep(WAIT_TIME_MILLIS);
  muleContext.stop();
  Thread.sleep(WAIT_TIME_MILLIS);
  assertNoLostMessages(NUM_MESSAGES,service);
  assertSedaQueueNotEmpty(service);
  muleContext.start();
  Thread.sleep(WAIT_TIME_MILLIS);
  muleContext.stop();
  assertNoLostMessages(NUM_MESSAGES,service);
  muleContext.start();
  Thread.sleep(WAIT_TIME_MILLIS * 8);
  muleContext.stop();
  assertNoLostMessages(NUM_MESSAGES,service);
  assertSedaQueueEmpty(service);
}
