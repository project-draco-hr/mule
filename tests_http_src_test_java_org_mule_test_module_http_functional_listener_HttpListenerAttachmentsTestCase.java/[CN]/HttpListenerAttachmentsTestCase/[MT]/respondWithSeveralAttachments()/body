{
  MuleMessage response=muleContext.getClient().send(getUrl(filePath.getValue()),getTestMuleMessage()).getRight();
  assertThat(response.getPayload(),instanceOf(MultiPartPayload.class));
  assertThat(((MultiPartPayload)response.getPayload()).getParts(),hasSize(2));
  org.mule.runtime.api.message.MuleMessage attachment1=((MultiPartPayload)response.getPayload()).getPart(FILE_BODY_FIELD_NAME);
  assertThat(attachment1.getAttributes(),instanceOf(PartAttributes.class));
  assertThat(((PartAttributes)attachment1.getAttributes()).getName(),is(FILE_BODY_FIELD_NAME));
  assertThat(((PartAttributes)attachment1.getAttributes()).getFileName(),is(FILE_BODY_FIELD_FILENAME));
  assertThat(attachment1.getDataType().getMediaType(),is(MediaType.BINARY));
  assertThat(IOUtils.toString((InputStream)attachment1.getPayload()),is(FILE_BODY_FIELD_VALUE));
  org.mule.runtime.api.message.MuleMessage attachment2=((MultiPartPayload)response.getPayload()).getPart(TEXT_BODY_FIELD_NAME);
  assertThat(IOUtils.toString((InputStream)attachment2.getPayload()),is(TEXT_BODY_FIELD_VALUE));
  assertThat(attachment2.getDataType().getMediaType().toRfcString(),is(TEXT_PLAIN.toString()));
}
