{
  final String catalog="test";
  ResultSet procedureColumns=new StoredProcedureColumnTypesBuilder().with(TestDbTypeMetadata.INTEGER_DB_TYPE_METADATA).build();
  DatabaseMetaData databaseMetaData=new DatabaseMetaDataBuilder().returningStoredProcedureColumns(catalog,"testStoredProcedure",procedureColumns).build();
  final String sqlText="call testStoredProcedure(?)";
  DbConnection connection=new DbConnectionBuilder().onCalatog(catalog).with(databaseMetaData).build();
  QueryTemplate queryTemplate=new QueryTemplate(sqlText,QueryType.STORE_PROCEDURE_CALL,Collections.<org.mule.runtime.module.db.internal.domain.param.QueryParam>singletonList(new DefaultInputQueryParam(1,UnknownDbType.getInstance(),"7",TYPE_COLUMN)));
  DbTypeManager dbTypeManager=new DbTypeManagerBuilder().on(connection).managing(JdbcTypes.INTEGER_DB_TYPE).build();
  StoredProcedureParamTypeResolver paramTypeResolver=new StoredProcedureParamTypeResolver(dbTypeManager);
  Map<Integer,DbType> parameterTypes=paramTypeResolver.getParameterTypes(connection,queryTemplate);
  assertThat(parameterTypes.size(),equalTo(1));
  assertThat(parameterTypes.get(1),equalTo(JdbcTypes.INTEGER_DB_TYPE));
}
