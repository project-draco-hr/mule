{
  SourceDescriptor source=declaration.withMessageSource(getSourceName(sourceType));
  List<Class<?>> sourceGenerics=getSuperClassGenerics(sourceType,Source.class);
  if (sourceGenerics.size() != 2) {
    throw new IllegalModelDefinitionException(String.format("Message source class '%s' was expected to have 2 generic types " + "(one for the Payload type and another for the Attributes type) but %d were found",sourceType.getName(),sourceGenerics.size()));
  }
  source.sourceCreatedBy(new DefaultSourceFactory(sourceType)).whichReturns(DataType.of(sourceGenerics.get(0))).withAttributesOfType(DataType.of(sourceGenerics.get(1))).withModelProperty(ImplementingTypeModelProperty.KEY,new ImplementingTypeModelProperty(sourceType));
  declareAnnotatedParameters(sourceType,source,source.with());
}
