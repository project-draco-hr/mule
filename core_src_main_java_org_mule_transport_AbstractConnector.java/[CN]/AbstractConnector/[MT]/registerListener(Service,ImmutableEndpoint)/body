{
  if (endpoint == null) {
    throw new IllegalArgumentException("The endpoint cannot be null when registering a listener");
  }
  if (service == null) {
    throw new IllegalArgumentException("The service cannot be null when registering a listener");
  }
  EndpointURI endpointUri=endpoint.getEndpointURI();
  if (endpointUri == null) {
    throw new ConnectorException(CoreMessages.endpointIsNullForListener(),this);
  }
  logger.info("Registering listener: " + service.getName() + " on endpointUri: "+ endpointUri.toString());
  MessageReceiver receiver=this.getReceiver(service,endpoint);
  if (receiver != null) {
    throw new ConnectorException(CoreMessages.listenerAlreadyRegistered(endpointUri),this);
  }
 else {
    receiver=this.createReceiver(service,endpoint);
    Object receiverKey=getReceiverKey(service,endpoint);
    receiver.setReceiverKey(receiverKey.toString());
    receiver.initialise();
    receivers.put(receiverKey,receiver);
  }
  return receiver;
}
