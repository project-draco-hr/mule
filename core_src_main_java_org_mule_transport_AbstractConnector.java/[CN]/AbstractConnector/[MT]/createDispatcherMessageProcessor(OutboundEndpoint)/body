{
  if (endpoint.getExchangePattern().hasResponse() || !getDispatcherThreadingProfile().isDoThreading()) {
    return new DispatcherMessageProcessor(endpoint);
  }
 else {
    DefaultMessageProcessorChainBuilder builder=new DefaultMessageProcessorChainBuilder();
    builder.setName("dispatcher processor chain for '" + endpoint.getAddress() + "'");
    OptionalAsyncInterceptingMessageProcessor async=new OptionalAsyncInterceptingMessageProcessor(new WorkManagerSource(){
      @Override public WorkManager getWorkManager() throws MuleException {
        return getDispatcherWorkManager();
      }
    }
);
    ((EndpointAware)async).setEndpoint(endpoint);
    builder.chain(async);
    builder.chain(new DispatcherMessageProcessor(endpoint));
    return builder.build();
  }
}
