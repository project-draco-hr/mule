{
  if (endpoint.getExchangePattern().hasResponse() || !getDispatcherThreadingProfile().isDoThreading()) {
    return new DispatcherMessageProcessor();
  }
 else {
    DefaultMessageProcessorChainBuilder builder=new DefaultMessageProcessorChainBuilder();
    builder.setName("dispatcher processor chain for '" + endpoint.getAddress() + "'");
    builder.chain(new OptionalAsyncInterceptingMessageProcessor(new WorkManagerSource(){
      public WorkManager getWorkManager() throws MuleException {
        return getDispatcherWorkManager();
      }
    }
));
    builder.chain(new DispatcherMessageProcessor());
    return builder.build();
  }
}
