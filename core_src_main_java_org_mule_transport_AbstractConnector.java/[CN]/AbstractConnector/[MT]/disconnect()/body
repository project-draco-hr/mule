{
  startOnConnect=isStarted();
  this.fireNotification(new ConnectionNotification(this,getConnectEventId(),ConnectionNotification.CONNECTION_DISCONNECTED));
  connected.set(false);
  try {
    if (receivers != null) {
      for (Iterator iterator=receivers.values().iterator(); iterator.hasNext(); ) {
        MessageReceiver receiver=(MessageReceiver)iterator.next();
        if (logger.isDebugEnabled()) {
          logger.debug("Disonnecting receiver on endpoint: " + receiver.getEndpoint().getEndpointURI());
        }
        receiver.disconnect();
      }
    }
    this.doDisconnect();
  }
  finally {
    if (receivers != null) {
      for (Iterator iterator=receivers.values().iterator(); iterator.hasNext(); ) {
        MessageReceiver receiver=(MessageReceiver)iterator.next();
        if (logger.isDebugEnabled()) {
          logger.debug("Stopping receiver on endpoint: " + receiver.getEndpoint().getEndpointURI());
        }
        receiver.stop();
      }
    }
    this.stop();
  }
  logger.info("Disconnected: " + this.getConnectionDescription());
}
