{
  final String invalidSchemaLocation="non-existent.xsd";
  Mock session=MuleTestUtils.getMockSession();
  session.matchAndReturn("getFlowConstruct",getTestService());
  XmlMessageSplitter splitter=new XmlMessageSplitter();
  splitter.setValidateSchema(true);
  splitter.setExternalSchemaLocation(invalidSchemaLocation);
  splitter.setMuleContext(muleContext);
  String payload=IOUtils.getResourceAsString("purchase-order.xml",getClass());
  MuleMessage message=new DefaultMuleMessage(payload,muleContext);
  assertTrue(splitter.isMatch(message));
  try {
    splitter.route(message,(MuleSession)session.proxy());
    fail("Should have thrown an exception, because XSD is not found.");
  }
 catch (  IllegalArgumentException iaex) {
    assertTrue("Wrong exception?",iaex.getMessage().indexOf("Couldn't find schema at " + invalidSchemaLocation) != -1);
  }
  session.verify();
}
