{
  final String invalidSchemaLocation="non-existent.xsd";
  Mock session=MuleTestUtils.getMockSession();
  ImmutableEndpoint endpoint1=getTestOutboundEndpoint("Test1Endpoint","test://endpointUri.1");
  RoundRobinXmlSplitter splitter=new RoundRobinXmlSplitter();
  splitter.setValidateSchema(true);
  splitter.setExternalSchemaLocation(invalidSchemaLocation);
  String payload=IOUtils.getResourceAsString("purchase-order.xml",getClass());
  MuleMessage message=new DefaultMuleMessage(payload);
  assertTrue(splitter.isMatch(message));
  try {
    splitter.route(message,(MuleSession)session.proxy(),false);
    fail("Should have thrown an exception, because XSD is not found.");
  }
 catch (  IllegalArgumentException iaex) {
    assertTrue("Wrong exception?",iaex.getMessage().indexOf("Couldn't find schema at " + invalidSchemaLocation) != -1);
  }
  session.verify();
}
