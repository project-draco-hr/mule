{
  HttpRequestMessageAdapter messageAdapter=(HttpRequestMessageAdapter)message.getAdapter();
  String payloadParam=messageAdapter.getStringProperty(AbstractReceiverServlet.PAYLOAD_PARAMETER_NAME,AbstractReceiverServlet.DEFAULT_PAYLOAD_PARAMETER_NAME);
  String payload=messageAdapter.getStringProperty(payloadParam,null);
  if (payload == null) {
    if (messageAdapter.getContentType() == null || messageAdapter.getContentType().startsWith("text/")) {
      try {
        InputStream is=(InputStream)message.getPayload();
        BufferedReader reader;
        if (messageAdapter.getCharacterEncoding() != null) {
          reader=new BufferedReader(new InputStreamReader(is,messageAdapter.getCharacterEncoding()));
        }
 else {
          reader=new BufferedReader(new InputStreamReader(is));
        }
        StringBuffer buffer=new StringBuffer(8192);
        String line=reader.readLine();
        while (line != null) {
          buffer.append(line);
          line=reader.readLine();
          if (line != null)           buffer.append(SystemUtils.LINE_SEPARATOR);
        }
        payload=buffer.toString();
      }
 catch (      IOException e) {
        throw new TransformerException(this,e);
      }
    }
 else     if (messageAdapter.getContentType().equals("application/x-www-form-urlencoded")) {
      InputStream is=(InputStream)message.getPayload();
      Properties props=new Properties();
      try {
        props.load(is);
      }
 catch (      IOException e) {
        throw new TransformerException(this,e);
      }
 finally {
        try {
          is.close();
        }
 catch (        IOException e2) {
          throw new TransformerException(this,e2);
        }
      }
      return props.get(payloadParam);
    }
  }
  return payload;
}
