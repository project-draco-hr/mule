{
  String payloadParam=message.getStringProperty(AbstractReceiverServlet.PAYLOAD_PARAMETER_NAME,AbstractReceiverServlet.DEFAULT_PAYLOAD_PARAMETER_NAME);
  String payload=message.getStringProperty(payloadParam,null);
  if (payload == null) {
    String contentType=message.getStringProperty(ServletConnector.CONTENT_TYPE_PROPERTY_KEY,null);
    if ((contentType == null) || contentType.startsWith("text/")) {
      try {
        InputStream is=(InputStream)message.getPayload();
        String characterEncoding=message.getStringProperty(ServletConnector.CHARACTER_ENCODING_PROPERTY_KEY,null);
        BufferedReader reader;
        if (characterEncoding != null) {
          reader=new BufferedReader(new InputStreamReader(is,characterEncoding));
        }
 else {
          reader=new BufferedReader(new InputStreamReader(is));
        }
        StringBuffer buffer=new StringBuffer(8192);
        String line=reader.readLine();
        while (line != null) {
          buffer.append(line);
          line=reader.readLine();
          if (line != null)           buffer.append(SystemUtils.LINE_SEPARATOR);
        }
        payload=buffer.toString();
      }
 catch (      IOException e) {
        throw new TransformerException(this,e);
      }
    }
 else     if (contentType.equals("application/x-www-form-urlencoded")) {
      InputStream is=(InputStream)message.getPayload();
      Properties props=new Properties();
      try {
        props.load(is);
      }
 catch (      IOException e) {
        throw new TransformerException(this,e);
      }
 finally {
        try {
          is.close();
        }
 catch (        IOException e2) {
          throw new TransformerException(this,e2);
        }
      }
      return props.get(payloadParam);
    }
  }
  return payload;
}
