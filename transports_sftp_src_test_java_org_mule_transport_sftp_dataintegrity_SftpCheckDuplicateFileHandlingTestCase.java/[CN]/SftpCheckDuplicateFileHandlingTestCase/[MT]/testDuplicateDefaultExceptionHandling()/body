{
  MuleClient muleClient=new MuleClient(muleContext);
  SftpClient sftpClient=getSftpClient(muleClient,OUTBOUND_ENDPOINT_NAME2);
  try {
    dispatchAndWaitForDelivery(new DispatchParameters(INBOUND_ENDPOINT_NAME2,OUTBOUND_ENDPOINT_NAME2));
    verifyInAndOutFiles(muleClient,INBOUND_ENDPOINT_NAME2,OUTBOUND_ENDPOINT_NAME2,false,true);
    Exception exception=dispatchAndWaitForException(new DispatchParameters(INBOUND_ENDPOINT_NAME2,OUTBOUND_ENDPOINT_NAME2),"sftp","serviceDuplicateHandlingThrowException");
    assertNotNull(exception);
    assertTrue(exception instanceof DispatchException);
    assertTrue(exception.getCause() instanceof IOException);
    assertEquals("Failure",exception.getCause().getMessage());
    verifyInAndOutFiles(muleClient,INBOUND_ENDPOINT_NAME2,OUTBOUND_ENDPOINT_NAME2,true,true);
  }
  finally {
    sftpClient.disconnect();
  }
}
