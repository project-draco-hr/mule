{
  final TestSedaComponent testSedaComponent=(TestSedaComponent)muleContext.getRegistry().lookupComponent("testComponent");
  FunctionalTestComponent testComponent=(FunctionalTestComponent)testSedaComponent.getOrCreateService();
  assertNotNull(testComponent);
  final AtomicBoolean callbackMade=new AtomicBoolean(false);
  EventCallback callback=new EventCallback(){
    public void eventReceived(    final MuleEventContext context,    final Object component) throws Exception {
      MuleMessage msg=context.getMessage();
      assertTrue(callbackMade.compareAndSet(false,true));
      assertNotNull(msg.getProperty(HttpsConnector.LOCAL_CERTIFICATES));
    }
  }
;
  testComponent.setEventCallback(callback);
  MuleClient client=new MuleClient();
  Map props=new HashMap();
  props.put(HttpConstants.HEADER_CONTENT_TYPE,"text/plain;charset=UTF-8");
  MuleMessage result=client.send("clientEndpoint",TEST_MESSAGE,props);
  assertNotNull(result);
  assertEquals(TEST_MESSAGE + " Received",result.getPayloadAsString());
  assertTrue("Callback never fired",callbackMade.get());
}
