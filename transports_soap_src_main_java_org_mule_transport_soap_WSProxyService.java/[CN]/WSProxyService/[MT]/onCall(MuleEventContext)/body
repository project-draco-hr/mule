{
  if (wsdlEndpoint == null && lazyInit) {
    initialise();
  }
  MuleMessage message=eventContext.getMessage();
  String httpRequest=((String)message.getProperty(HTTP_REQUEST)).toLowerCase();
  if ((httpRequest.indexOf(WSDL_PARAM_1) != -1) || (httpRequest.indexOf(WSDL_PARAM_2) != -1)) {
    logger.debug("Retrieving WSDL from web service");
    String wsdlString;
    if (this.useFile) {
      eventContext.setStopFurtherProcessing(true);
      return wsdlFileContents;
    }
    MuleContext muleContext=MuleServer.getMuleContext();
    InboundEndpoint webServiceEndpoint=muleContext.getRegistry().lookupEndpointFactory().getInboundEndpoint(this.wsdlEndpoint);
    MuleMessage replyWSDL=eventContext.requestEvent(webServiceEndpoint,eventContext.getTimeout());
    wsdlString=replyWSDL.getPayloadAsString();
    wsdlString=wsdlString.replaceAll(this.urlWebservice,eventContext.getEndpointURI().getAddress());
    DefaultMuleMessage modifiedWsdl=new DefaultMuleMessage(wsdlString,message);
    logger.debug("WSDL retrieved successfully");
    eventContext.setStopFurtherProcessing(true);
    return modifiedWsdl;
  }
 else {
    logger.debug("Forwarding SOAP message");
    return eventContext.getMessage();
  }
}
