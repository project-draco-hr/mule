{
  final ArrayList<Part> httpParts=new ArrayList<>(parts.size());
  for (  String partName : parts.keySet()) {
    final DataHandler dataHandlerPart=parts.get(partName);
    if (dataHandlerPart.getDataSource() instanceof HttpPartDataSource) {
      httpParts.add(((HttpPartDataSource)dataHandlerPart.getDataSource()).getPart());
    }
 else {
      byte[] data=IOUtils.toByteArray(dataHandlerPart.getInputStream());
      httpParts.add(new HttpPart(partName,data,dataHandlerPart.getContentType(),data.length));
    }
  }
  return httpParts;
}
