{
  this.port=port;
  this.state=new InOutState();
  System.getProperties().put(FTP_STATE_KEY + port,state);
  Properties properties=new Properties();
  properties.setProperty("config.listeners.default.port",Integer.toString(port));
  properties.setProperty("config.file-system-manager.class",FileManager.class.getName());
  properties.setProperty("config.file-system-manager.stateFromSystemProperties",FTP_STATE_KEY + port);
  properties.setProperty("config.connection-manager.default-idle-time","1");
  properties.setProperty("config.connection-manager.max-login","1000");
  properties.setProperty("config.connection-manager.max-anonymous-login","1000");
  properties.setProperty("config.user-manager.class",InMemoryUserManager.class.getName());
  properties.setProperty("config.ip-restrictor.class",InMemoryIpRestrictor.class.getName());
  Configuration config=new PropertiesConfiguration(properties);
  FtpServerContext context=new ConfigurableFtpServerContext(config);
  server=new FtpServer(context);
  server.start();
}
