{
  MuleEvent event=(MuleEvent)events.iterator().next();
  if (!(event.getService() instanceof Service)) {
    throw new UnsupportedOperationException("CollectionResponseWithCallbackCorrelator is only supported with Service");
  }
  if (callback != null) {
    event.getMessage().setProperty(MuleProperties.MULE_METHOD_PROPERTY,callback,PropertyScope.INVOCATION);
    try {
      return ((Service)event.getService()).getComponent().process(event).getMessage();
    }
 catch (    MuleException e) {
      throw new RoutingException(AnnotationsMessages.failedToInvokeReplyMethod(callback),event.getMessage(),event.getEndpoint());
    }
  }
 else {
    return event.getMessage();
  }
}
