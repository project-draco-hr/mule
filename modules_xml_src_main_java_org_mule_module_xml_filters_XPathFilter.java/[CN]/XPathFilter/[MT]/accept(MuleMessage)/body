{
  Object payload=message.getPayload();
  if (payload == null) {
    logger.warn("Applying StandardXPathFilter to null object.");
    return false;
  }
  if (pattern == null) {
    logger.warn("Expression for StandardXPathFilter is not set.");
    return false;
  }
  if (expectedValue == null) {
    if (pattern.endsWith("= null") || pattern.endsWith("=null")) {
      expectedValue="null";
      pattern=pattern.substring(0,pattern.lastIndexOf("="));
    }
 else {
      if (logger.isInfoEnabled()) {
        logger.info("Expected value for StandardXPathFilter is not set, using 'true' by default");
      }
      expectedValue=Boolean.TRUE.toString();
    }
  }
  Node node;
  try {
    node=toDOMNode(payload);
  }
 catch (  Exception e) {
    logger.warn("StandardXPathFilter filter rejected message because of an error while parsing XML: " + e.getMessage(),e);
    return false;
  }
  message.setPayload(node);
  return accept(node);
}
