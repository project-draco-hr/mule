{
  flattening=true;
  try {
    Properties flattened=new Properties();
    for (Enumeration<?> e=properties.propertyNames(); e.hasMoreElements(); ) {
      String key=(String)e.nextElement();
      if (!key.startsWith("_"))       flattened.put(key,process(properties.getProperty(key)));
    }
    return flattened;
  }
  finally {
    flattening=false;
  }
}
