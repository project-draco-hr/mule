{
  incomingState="bad state";
  exception=true;
  parameters.clear();
  parameters.put("state",incomingState);
  final String accessTokenUrl="accessTokenUrl";
  final String redirectUri="redirectUri";
  final String accessTokenId="accessTokenId";
  processor.setRedirectUri(redirectUri);
  OAuth2Adapter adapter=mock(OAuth2Adapter.class);
  when(manager.createAdapter(verifier)).thenReturn(adapter);
  when(manager.getDefaultUnauthorizedConnector().getName()).thenReturn(accessTokenId);
  when(adapter.getAccessTokenUrl()).thenReturn(accessTokenUrl);
  assertSame(event,processor.process(event));
}
