{
  final String accessTokenUrl="accessTokenUrl";
  final String redirectUri="redirectUri";
  final String accessTokenId="accessTokenId";
  processor.setRedirectUri(redirectUri);
  processor.setAccessTokenUrl(accessTokenUrl);
  OAuth2Adapter adapter=mock(OAuth2Adapter.class);
  when(manager.createAdapter(restoredEvent,verifier)).thenReturn(adapter);
  when(manager.getDefaultUnauthorizedConnector().getName()).thenReturn(accessTokenId);
  assertSame(restoredEvent,processor.process(event));
  verify(adapter).fetchAccessToken(redirectUri);
  verify(manager.getAccessTokenPoolFactory()).passivateObject(accessTokenId,adapter);
  verify(restoredEvent.getMessage()).setInvocationProperty(OAuthProperties.ACCESS_TOKEN_ID,accessTokenId);
}
