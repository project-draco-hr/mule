{
  Service service=getTestService();
  service.setInboundRouter(new DefaultInboundRouterCollection());
  InboundEndpoint endpoint=getTestInboundEndpoint("in","test://in");
  service.getInboundRouter().addEndpoint(endpoint);
  connector=(TestConnector)endpoint.getConnector();
  assertEquals(0,connector.receivers.size());
  connector.start();
  assertEquals(0,connector.receivers.size());
  service.start();
  assertEquals(1,connector.receivers.size());
  assertTrue(((AbstractMessageReceiver)connector.receivers.get("in")).isConnected());
  assertTrue(((AbstractMessageReceiver)connector.receivers.get("in")).isStarted());
  connector.stop();
  assertEquals(1,connector.receivers.size());
  assertFalse(((AbstractMessageReceiver)connector.receivers.get("in")).isConnected());
  assertFalse(((AbstractMessageReceiver)connector.receivers.get("in")).isStarted());
  connector.start();
  assertEquals(1,connector.receivers.size());
  assertTrue(((AbstractMessageReceiver)connector.receivers.get("in")).isConnected());
  assertTrue(((AbstractMessageReceiver)connector.receivers.get("in")).isStarted());
  service.stop();
  assertEquals(0,connector.receivers.size());
  connector.stop();
  assertEquals(0,connector.receivers.size());
}
