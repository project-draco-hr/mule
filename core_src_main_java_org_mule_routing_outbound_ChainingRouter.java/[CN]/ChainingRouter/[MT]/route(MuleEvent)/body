{
  MuleEvent resultToReturn=event;
  if (routes == null || routes.size() == 0) {
    throw new RoutePathNotFoundException(CoreMessages.noEndpointsForRouter(),event,null);
  }
  final int endpointsCount=routes.size();
  if (logger.isDebugEnabled()) {
    logger.debug("About to chain " + endpointsCount + " targets.");
  }
  MessageProcessor endpoint=null;
  try {
    MuleMessage intermediaryResult=event.getMessage();
    for (int i=0; i < endpointsCount; i++) {
      endpoint=getRoute(i,resultToReturn);
      boolean lastEndpointInChain=(i == endpointsCount - 1);
      if (logger.isDebugEnabled()) {
        logger.debug("Sending Chained message '" + i + "': "+ (intermediaryResult == null ? "null" : intermediaryResult.toString()));
      }
      if (!lastEndpointInChain) {
        MuleEvent endpointResult=sendRequest(resultToReturn,intermediaryResult,endpoint,true);
        resultToReturn=endpointResult != null && VoidMuleEvent.getInstance().equals(endpointResult) ? endpointResult : resultToReturn;
        MuleMessage localResult=endpointResult == null || VoidMuleEvent.getInstance().equals(endpointResult) ? null : endpointResult.getMessage();
        if (localResult != null && localResult.getPayload() != NullPayload.getInstance() && intermediaryResult != null) {
          processIntermediaryResult(localResult,intermediaryResult);
        }
        intermediaryResult=localResult;
        if (logger.isDebugEnabled()) {
          logger.debug("Received Chain result '" + i + "': "+ (intermediaryResult != null ? intermediaryResult.toString() : "null"));
        }
        if (intermediaryResult == null || intermediaryResult.getPayload() == NullPayload.getInstance()) {
          resultToReturn=intermediaryResult == null ? null : new DefaultMuleEvent(intermediaryResult,resultToReturn);
          logger.warn("Chaining router cannot process any further targets. " + "There was no result returned from endpoint invocation: " + endpoint);
          break;
        }
      }
 else {
        resultToReturn=sendRequest(resultToReturn,intermediaryResult,endpoint,true);
        if (logger.isDebugEnabled()) {
          MuleMessage resultMessage=resultToReturn == null ? null : resultToReturn.getMessage();
          logger.debug("Received final Chain result '" + i + "': "+ (resultMessage == null ? "null" : resultMessage.toString()));
        }
      }
    }
  }
 catch (  MuleException e) {
    throw new CouldNotRouteOutboundMessageException(resultToReturn,endpoint,e);
  }
  return resultToReturn;
}
