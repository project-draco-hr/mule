{
  FtpFileAttributes attributes=getExistingFile(filePath);
  if (attributes.isDirectory()) {
    throw cannotReadDirectoryException(Paths.get(attributes.getPath()));
  }
  try {
    attributes=new ClassicFtpFileAttributes(resolvePath(filePath),client.listFiles(filePath)[0]);
  }
 catch (  Exception e) {
    throw exception("Found exception while trying to read path " + filePath,e);
  }
  Path path=Paths.get(attributes.getPath());
  PathLock pathLock;
  if (lock) {
    pathLock=fileSystem.lock(path);
  }
 else {
    fileSystem.verifyNotLocked(path);
    pathLock=new NullPathLock();
  }
  try {
    return new DefaultMuleMessage(ClassicFtpInputStream.newInstance(config,attributes,pathLock),fileSystem.getFileMessageDataType(message.getDataType(),attributes),attributes).asNewMessage();
  }
 catch (  ConnectionException e) {
    throw exception("Could not obtain connection to fetch file " + path,e);
  }
}
