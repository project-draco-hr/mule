{
  if (previousEvent != null) {
    UMOMessage msg=previousEvent.getMessage();
synchronized (msg) {
      for (Iterator iterator=msg.getPropertyNames().iterator(); iterator.hasNext(); ) {
        String prop=(String)iterator.next();
        Object value=msg.getProperty(prop);
        if (!ignoreProperty(prop,value)) {
          message.setProperty(prop,value);
        }
        if (logger.isDebugEnabled()) {
          Object currentValue=message.getProperty(prop);
          if (!value.equals(currentValue)) {
            logger.warn("Property on the current message " + prop + "="+ currentValue+ " overrides property on the previous event: "+ prop+ "="+ value);
          }
        }
      }
    }
  }
  if (endpoint != null && endpoint.getProperties() != null) {
    for (Iterator iterator=endpoint.getProperties().keySet().iterator(); iterator.hasNext(); ) {
      String prop=(String)iterator.next();
      Object value=endpoint.getProperties().get(prop);
      if (!ignoreProperty(prop,value)) {
        message.setProperty(prop,value);
      }
      if (logger.isDebugEnabled()) {
        Object currentValue=message.getProperty(prop);
        if (!value.equals(currentValue)) {
          logger.warn("Property on the current message " + prop + "="+ currentValue+ " overrides property on the endpoint: "+ prop+ "="+ value);
        }
      }
    }
  }
  setCredentials();
}
