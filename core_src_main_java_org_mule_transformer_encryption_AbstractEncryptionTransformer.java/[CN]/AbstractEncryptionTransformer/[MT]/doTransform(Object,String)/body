{
  byte[] buf;
  if (src instanceof String) {
    buf=src.toString().getBytes();
  }
 else   if (src instanceof InputStream) {
    InputStream input=(InputStream)src;
    try {
      buf=IOUtils.toByteArray(input);
    }
  finally {
      IOUtils.closeQuietly(input);
    }
  }
 else {
    buf=(byte[])src;
  }
  try {
    byte[] result=getTransformedBytes(buf);
    if (getReturnDataType().equals(DataTypeFactory.STRING)) {
      if (outputEncoding != null) {
        try {
          return new String(result,outputEncoding);
        }
 catch (        UnsupportedEncodingException ex) {
          return new String(result);
        }
      }
 else {
        return new String(result);
      }
    }
 else {
      return result;
    }
  }
 catch (  CryptoFailureException e) {
    throw new TransformerException(this,e);
  }
}
