{
  validate();
  dataSourceConfig.setUrl(getEffectiveUrl());
  dataSourceFactory=createDataSourceFactory();
  if (dataSourceConfig.isDynamic()) {
    DataSourceFactory dataSourceFactory=new DataSourceFactory(name);
    dataSourceFactory.setMuleContext(muleContext);
    return new DynamicDbConfigResolver(name,dbConfigFactory,dataSourceFactory,dataSourceConfig);
  }
 else {
    DataSource instanceDataSource;
    if (dataSource == null) {
      instanceDataSource=dataSourceFactory.create(dataSourceConfig);
    }
 else {
      instanceDataSource=dataSourceFactory.decorateDataSource(dataSource,dataSourceConfig.getPoolingProfile(),muleContext);
    }
    DbConfig dbConfig=dbConfigFactory.create(name,getAnnotations(),instanceDataSource);
    dbConfig.setAnnotations(getAnnotations());
    return new StaticDbConfigResolver(dbConfig);
  }
}
