{
  ((Jbpm)bpms).deployProcess("message-process.xml");
  UMOMessage response;
  Object process;
  BPMS bpms=connector.getBpms();
  MuleClient client=new MuleClient();
  try {
    response=client.send("bpm://message","data",null);
    process=response.getPayload();
    long processId=NumberUtils.toLong(bpms.getId(process));
    assertFalse(processId == -1);
    assertEquals("sendMessage",bpms.getState(process));
    response=client.send("bpm://message/" + processId,"data",null);
    process=response.getPayload();
    assertTrue(bpms.hasEnded(process));
  }
  finally {
    client.dispose();
  }
}
