{
  int timeout=event.getMessage().getIntProperty(MuleProperties.MULE_EVENT_TIMEOUT_PROPERTY,-1);
  if (timeout >= 0) {
    event.setTimeout(timeout);
  }
  if (event.getEndpoint() instanceof OutboundEndpoint) {
    try {
      if (logger.isDebugEnabled()) {
        logger.debug("sending event: " + event);
      }
      Connector connector=event.getEndpoint().getConnector();
      if (connector instanceof AbstractConnector) {
        ((AbstractConnector)connector).getSessionHandler().storeSessionInfoToMessage(this,event.getMessage());
      }
 else {
        logger.warn("A session handler could not be obtained, using default.");
        new MuleSessionHandler().storeSessionInfoToMessage(new DefaultMuleSession(this,muleContext),event.getMessage());
      }
      MuleMessage response=((OutboundEndpoint)event.getEndpoint()).send(event);
      return OptimizedRequestContext.unsafeRewriteEvent(response);
    }
 catch (    MuleException e) {
      throw e;
    }
catch (    Exception e) {
      throw new DispatchException(event.getMessage(),event.getEndpoint(),e);
    }
  }
 else   if (service != null) {
    if (logger.isDebugEnabled()) {
      logger.debug("sending event to service: " + service.getName() + " event is: "+ event);
    }
    return service.sendEvent(event);
  }
 else {
    throw new DispatchException(CoreMessages.noComponentForEndpoint(),event.getMessage(),event.getEndpoint());
  }
}
