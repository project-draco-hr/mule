{
  MuleMessageFactory factory=createMuleMessageFactory();
  File moveTo=tempFolder.newFile("moveTo.tmp");
  moveTo.deleteOnExit();
  InputStreamCloseListener closeListener=mock(InputStreamCloseListener.class);
  ReceiverFileInputStream stream=new ReceiverFileInputStream(tempFile,false,moveTo,closeListener);
  MuleMessage message=factory.create(stream,encoding,muleContext);
  assertNotNull(message);
  stream.close();
  stream.close();
  verify(closeListener,times(1)).fileClose(tempFile);
  verify(closeListener,times(0)).fileClose(moveTo);
}
