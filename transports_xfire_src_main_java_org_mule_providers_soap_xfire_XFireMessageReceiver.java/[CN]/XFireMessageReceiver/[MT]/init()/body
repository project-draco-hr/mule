{
  try {
    Map props=new HashMap(component.getDescriptor().getProperties());
    props.putAll(endpoint.getProperties());
    String namespace=(String)component.getDescriptor().getProperties().get(SoapConstants.SOAP_NAMESPACE_PROPERTY);
    if (namespace == null) {
      namespace=MapUtils.getString(props,"namespace",XFireConnector.DEFAULT_MULE_NAMESPACE_URI);
    }
    if (props.size() == 0) {
      props=null;
    }
 else {
      rewriteProperty(props,"portType");
      rewriteProperty(props,"style");
      rewriteProperty(props,"use");
      rewriteProperty(props,"createDefaultBindings");
      rewriteProperty(props,"soap12Transports");
      rewriteProperty(props,"soap11Transports");
      rewriteProperty(props,"scope");
      rewriteProperty(props,"schemas");
    }
    serviceInterfaces=(List)component.getDescriptor().getProperties().get("serviceInterfaces");
    Class exposedInterface;
    if (serviceInterfaces == null)     exposedInterface=component.getDescriptor().getImplementationClass();
 else {
      String className=(String)serviceInterfaces.get(0);
      exposedInterface=Class.forName(className);
      logger.info(className + " class was used to expose your service");
      if (serviceInterfaces.size() > 1) {
        logger.info("Only the first class was used to expose your method");
      }
    }
    String wsdlUrl=(String)component.getDescriptor().getProperties().get(SoapConstants.WSDL_URL_PROPERTY);
    if (StringUtils.isBlank(wsdlUrl)) {
      service=connector.getServiceFactory().create(exposedInterface,component.getDescriptor().getName(),namespace,props);
    }
 else {
      service=connector.getServiceFactory().create(exposedInterface,new QName(namespace,component.getDescriptor().getName()),new URL(wsdlUrl),props);
    }
    boolean sync=endpoint.isSynchronous();
    if (endpoint.getEndpointURI().getScheme().startsWith("http") || endpoint.getEndpointURI().getScheme().startsWith("servlet")) {
      sync=true;
    }
    service.setInvoker(new MuleInvoker(this,sync));
  }
 catch (  UMOException e) {
    throw new InitialisationException(e,this);
  }
catch (  ClassNotFoundException e) {
    throw new InitialisationException(e,this);
  }
catch (  MalformedURLException e) {
    throw new InitialisationException(e,this);
  }
}
