{
  MuleClient muleClient=new MuleClient(muleContext);
  SftpClient sftpClient=getSftpClient(muleClient,OUTBOUND_ENDPOINT_NAME);
  try {
    remoteChmod(muleClient,sftpClient,OUTBOUND_ENDPOINT_NAME,00500);
    Exception exception=dispatchAndWaitForException(new DispatchParameters(INBOUND_ENDPOINT_NAME,OUTBOUND_ENDPOINT_NAME),"sftp","service");
    assertNotNull(exception);
    assertTrue("expected DispatchException, but got : " + exception.getClass().toString(),exception instanceof DispatchException);
    assertTrue("expected IOException, but got : " + exception.getCause().getClass().toString(),exception.getCause() instanceof IOException);
    assertEquals("Could not create the directory 'uploading', caused by: Permission denied",exception.getCause().getMessage());
    verifyInAndOutFiles(muleClient,INBOUND_ENDPOINT_NAME,OUTBOUND_ENDPOINT_NAME,true,false);
  }
  finally {
    sftpClient.disconnect();
  }
}
