{
  UMOEvent event=null;
  boolean one=false;
  boolean two=false;
  CreditProfileTO creditProfileTO=null;
  try {
    for (Iterator iterator=events.getEvents().iterator(); iterator.hasNext(); ) {
      event=(UMOEvent)iterator.next();
      creditProfileTO=(CreditProfileTO)event.getTransformedMessage();
      if (creditProfileTO.getCreditScore() >= CreditProfileTO.CREDIT_LIMIT) {
        one=true;
      }
      if (creditProfileTO.getCreditAuthorisedStatus() == CreditProfileTO.CREDIT_AUTHORISED) {
        two=true;
      }
    }
  }
 catch (  TransformerException e) {
    throw new RoutingException(Message.createStaticMessage("Failed to validate payment service"),new MuleMessage(events,(Map)null),null,e);
  }
  if (one && two) {
    creditProfileTO.setValid(true);
  }
  return new MuleMessage(creditProfileTO,event.getProperties());
}
