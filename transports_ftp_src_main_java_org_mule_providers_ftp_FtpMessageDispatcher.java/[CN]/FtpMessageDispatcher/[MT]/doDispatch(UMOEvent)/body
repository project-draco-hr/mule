{
  FTPClient client=null;
  UMOEndpointURI uri=event.getEndpoint().getEndpointURI();
  try {
    Object data=event.getTransformedMessage();
    byte[] dataBytes;
    if (data instanceof byte[]) {
      dataBytes=(byte[])data;
    }
 else {
      dataBytes=data.toString().getBytes();
    }
    FtpOutputStreamWrapper out=(FtpOutputStreamWrapper)getOutputStream(event.getEndpoint(),event.getMessage());
    client=out.getFtpClient();
    IOUtils.write(dataBytes,out);
    out.close();
  }
  finally {
    connector.releaseFtp(uri,client);
  }
}
