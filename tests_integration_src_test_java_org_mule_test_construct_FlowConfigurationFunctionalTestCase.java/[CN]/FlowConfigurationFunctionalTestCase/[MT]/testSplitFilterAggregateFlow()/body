{
  final Apple apple=new Apple();
  final Banana banana=new Banana();
  final Orange orange=new Orange();
  final FruitBowl fruitBowl=new FruitBowl(apple,banana);
  fruitBowl.addFruit(orange);
  muleContext.getClient().send("vm://split-filter-aggregate-in",new DefaultMuleMessage(fruitBowl,muleContext));
  final MuleMessage result=muleContext.getClient().request("vm://split-filter-aggregate-out",RECEIVE_TIMEOUT);
  assertNotNull(result);
  assertTrue(result instanceof MuleMessageCollection);
  final MuleMessageCollection coll=(MuleMessageCollection)result;
  assertEquals(1,coll.size());
  final List<?> results=(List<?>)coll.getPayload();
  assertTrue(results.contains(apple));
  assertFalse(results.contains(banana));
  assertFalse(results.contains(orange));
}
