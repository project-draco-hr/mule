{
  muleContext.getClient().send("vm://wiretap-in",new DefaultMuleMessage(TEST_MESSAGE,muleContext));
  final MuleMessage result=muleContext.getClient().request("vm://wiretap-out",RECEIVE_TIMEOUT);
  final MuleMessage tapResult=muleContext.getClient().request("vm://wiretap-tap",RECEIVE_TIMEOUT);
  assertNotNull(result);
  assertNotNull(tapResult);
  assertNotSame(result,tapResult);
  assertEquals(TEST_MESSAGE + "inout",getPayloadAsString(result));
  assertEquals(TEST_MESSAGE + "intap",getPayloadAsString(tapResult));
}
