{
  File[] files=dir.listFiles();
  for (int i=0; i < files.length; i++) {
    if (files[i].isDirectory()) {
      restoreFiles(files[i],msgs);
    }
 else     if (files[i].getName().endsWith(EXTENSION)) {
      FileInputStream fis=null;
      try {
        fis=new FileInputStream(files[i]);
        ObjectInputStream ois=null;
        try {
          ois=new ObjectInputStream(fis);
          Object object=ois.readObject();
          String name=files[i].getCanonicalPath();
          name=name.substring(storeDir.getCanonicalPath().length() + 1,name.length() - EXTENSION.length());
          objects.put(name,object);
          msgs.add(name);
          logger.debug("File entry: " + name);
        }
  finally {
          if (ois != null) {
            ois.close();
          }
        }
      }
  finally {
        if (fis != null) {
          fis.close();
        }
      }
    }
  }
}
