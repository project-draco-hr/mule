{
  UMOEndpoint endpoint=getEndpoint(t);
  if (endpoint != null) {
    try {
      logger.error("Message being processed is: " + (message == null ? "null" : message.toString()));
      UMOEventContext ctx=RequestContext.getEventContext();
      ExceptionMessage msg=null;
      if (failedEndpoint != null) {
        msg=new ExceptionMessage(getErrorMessagePayload(message),failedEndpoint,t,ctx);
      }
 else {
        msg=new ExceptionMessage(getErrorMessagePayload(message),t,ctx);
      }
      ctx.sendEvent(new MuleMessage(msg,ctx.getMessage()),endpoint);
      if (logger.isDebugEnabled()) {
        logger.debug("routed Exception message via " + endpoint);
      }
    }
 catch (    UMOException e) {
      logFatal(message,e);
    }
  }
 else {
    markTransactionForRollback();
  }
}
