{
  if (credential == null || credential.getUsernametoken() == null) {
    throw new WSSecurityException(WSSecurityException.FAILURE,"noCredential");
  }
  DefaultMuleAuthentication auth=new DefaultMuleAuthentication(new MuleCredentials(credential.getUsernametoken().getName(),credential.getUsernametoken().getPassword().toCharArray()));
  try {
    Authentication authentication=securityManager.authenticate(auth);
    SecurityContext secContext=null;
    try {
      secContext=securityManager.createSecurityContext(authentication);
      secContext.setAuthentication(authentication);
    }
 catch (    UnknownAuthenticationTypeException e) {
      logger.warn("Could not create security context after having successfully authenticated.",e);
    }
    RequestContext.getEvent().getSession().setSecurityContext(secContext);
  }
 catch (  org.mule.runtime.core.api.security.SecurityException e) {
    throw new WSSecurityException(WSSecurityException.FAILED_AUTHENTICATION,null,null,e);
  }
catch (  SecurityProviderNotFoundException e) {
    throw new WSSecurityException(WSSecurityException.FAILED_AUTHENTICATION,null,null,e);
  }
  return credential;
}
