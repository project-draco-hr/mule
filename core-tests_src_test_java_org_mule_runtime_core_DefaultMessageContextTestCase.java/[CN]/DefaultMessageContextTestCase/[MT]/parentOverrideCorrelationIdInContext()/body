{
  final MuleMessage messageParent=MuleMessage.builder().payload(TEST_PAYLOAD).build();
  final MuleMessage message=MuleMessage.builder().payload(TEST_PAYLOAD).build();
  final MuleEvent eventParent=MuleEvent.builder(executionContextWithCorrelation).message(messageParent).flow(flow).build();
  ((DefaultFlowCallStack)eventParent.getFlowCallStack()).push(new FlowStackElement(flow.getName(),"/0"));
  final MuleEvent event=MuleEvent.builder(executionContextWithCorrelation).message(message).flow(flow).build();
  ((DefaultMuleEvent)event).setLegacyCorrelationId(CORRELATION_ID);
  ((DefaultMuleEvent)event).setParent(eventParent);
  assertThat(event.getCorrelationId(),is(CORRELATION_ID));
}
