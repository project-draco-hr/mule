{
  try {
    wrapper=new ClientWrapper(){
      @Override public void initialize() throws Exception, IOException {
        String wsdlUrl=endpoint.getEndpointURI().getAddress();
        String serviceName=endpoint.getEndpointURI().getAddress();
        if (endpoint.getProperty("wsdlUrl") != null && StringUtils.isNotBlank(endpoint.getProperty("wsdlUrl").toString())) {
          wsdlUrl=(String)endpoint.getProperty("wsdlUrl");
        }
        if (serviceName.indexOf("?") > -1) {
          serviceName=serviceName.substring(0,serviceName.lastIndexOf('?'));
        }
        try {
          DynamicClientFactory cf=DynamicClientFactory.newInstance(bus);
          this.client=cf.createClient(wsdlUrl,new QName(serviceName));
        }
 catch (        Exception ex) {
          disconnect();
          throw ex;
        }
      }
    }
;
    wrapper.setBus(connector.getCxfBus());
    wrapper.setEndpoint(endpoint);
    wrapper.initialize();
  }
 catch (  Exception ex) {
    disconnect();
    throw ex;
  }
}
