{
  FunctionalTestComponent ftc=getFunctionalTestComponent("polled");
  assertNotNull(ftc);
  ftc.setEventCallback(new EventCallback(){
    @Override public void eventReceived(    MuleEventContext context,    Object component) throws Exception {
      assertEquals("The Accept header should be set on the incoming message","application/xml",context.getMessage().<String>getInboundProperty("Accept"));
    }
  }
);
  MuleClient client=muleContext.getClient();
  MuleMessage result=client.request("vm://toclient",RECEIVE_TIMEOUT);
  assertNotNull(result.getPayload());
  assertEquals("foo",result.getPayloadAsString());
}
