{
  if (url == null) {
    throw new IllegalArgumentException("Url argument cannot be null when creating a session");
  }
  Properties props=System.getProperties();
  props.put("mail.smtp.host",url.getHost());
  props.put("mail.smtp.port",String.valueOf(url.getPort()));
  Session session;
  if (url.getPassword() != null) {
    props.put("mail.smtp.auth","true");
    Authenticator auth=new SMTPAuthenticator(url.getUsername(),url.getPassword());
    session=Session.getInstance(props,auth);
  }
 else {
    session=Session.getDefaultInstance(props,null);
  }
  return session;
}
