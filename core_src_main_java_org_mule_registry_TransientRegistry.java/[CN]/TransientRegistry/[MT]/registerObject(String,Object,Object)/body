{
  logger.debug("registering object");
  if (isInitialised() || isInitialising()) {
    logger.debug("applying processors");
    value=applyProcessors(value);
  }
  Map objectMap=getObjectTypeMap(metadata);
  if (objectMap != null) {
    if (objectMap.containsKey(key)) {
      logger.warn("TransientRegistry already contains an object named '" + key + "'.  The previous object will be overwritten.");
    }
    objectMap.put(key,value);
    try {
      MuleContext mc=MuleServer.getMuleContext();
      logger.debug("context: " + mc);
      if (mc != null) {
        logger.debug("applying lifecycle");
        mc.applyLifecycle(value);
      }
 else {
        throw new RegistrationException("Unable to register object (\"" + key + ":"+ ClassUtils.getSimpleName(value.getClass())+ "\") because MuleContext has not yet been created.");
      }
    }
 catch (    MuleException e) {
      throw new RegistrationException(e);
    }
  }
 else {
    throw new RegistrationException("No object map exists for type " + metadata);
  }
}
