{
  try {
    final Continuation continuation=ContinuationSupport.getContinuation(request,mutex);
synchronized (mutex) {
      MessageReceiver receiver=getReceiverForURI(request);
      MuleMessage requestMessage=new DefaultMuleMessage(new HttpRequestMessageAdapter(request),muleContext);
      requestMessage.setProperty(HttpConnector.HTTP_METHOD_PROPERTY,request.getMethod());
      requestMessage.removeProperty(MuleProperties.MULE_REMOTE_SYNC_PROPERTY);
      requestMessage.setReplyTo(continuation);
      setupRequestMessage(request,requestMessage,receiver);
      routeMessage(receiver,requestMessage,request);
      continuation.suspend(10000);
    }
    writeResponse(response,(MuleMessage)continuation.getObject());
  }
 catch (  Exception e) {
    throw new ServletException(e);
  }
}
