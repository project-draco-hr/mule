{
  if (protocolEndpoints.get(uri) != null) {
    return protocolEndpoints.get(uri);
  }
  MuleRegistry registry=connector.getMuleContext().getRegistry();
  OutboundEndpoint protocolEndpoint;
  if (muleEndpoint == null) {
    protocolEndpoint=registry.lookupEndpointFactory().getOutboundEndpoint(uri);
  }
 else {
    EndpointURIEndpointBuilder builder=new EndpointURIEndpointBuilder(uri,connector.getMuleContext());
    String connectorName=(String)muleEndpoint.getProperty("protocolConnector");
    if (connectorName != null) {
      builder.setConnector(registry.lookupConnector(connectorName));
    }
    builder.setResponseTimeout(muleEndpoint.getResponseTimeout());
    protocolEndpoint=registry.lookupEndpointFactory().getOutboundEndpoint(builder);
  }
  protocolEndpoints.put(uri,protocolEndpoint);
  return protocolEndpoint;
}
