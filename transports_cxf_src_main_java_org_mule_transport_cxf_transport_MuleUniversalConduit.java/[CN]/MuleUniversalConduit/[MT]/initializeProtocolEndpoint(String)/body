{
  if (protocolEndpoints.get(uri) != null) {
    return protocolEndpoints.get(uri);
  }
  MuleRegistry registry=connector.getMuleContext().getRegistry();
  OutboundEndpoint protocolEndpoint;
  EndpointURIEndpointBuilder builder=new EndpointURIEndpointBuilder(uri,connector.getMuleContext());
  builder.setExchangePattern(MessageExchangePattern.request_response);
  if (muleEndpoint == null) {
    protocolEndpoint=registry.lookupEndpointFactory().getOutboundEndpoint(uri);
  }
 else {
    String connectorName=(String)muleEndpoint.getProperty("protocolConnector");
    if (connectorName != null) {
      builder.setConnector(registry.lookupConnector(connectorName));
    }
    builder.setResponseTimeout(muleEndpoint.getResponseTimeout());
  }
  protocolEndpoint=registry.lookupEndpointFactory().getOutboundEndpoint(builder);
  protocolEndpoints.put(uri,protocolEndpoint);
  return protocolEndpoint;
}
