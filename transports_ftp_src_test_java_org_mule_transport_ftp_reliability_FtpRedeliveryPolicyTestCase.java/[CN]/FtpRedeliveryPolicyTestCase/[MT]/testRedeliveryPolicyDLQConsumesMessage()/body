{
  ExceptionListener exceptionListener=new ExceptionListener(muleContext).setNumberOfExecutionsRequired(MAX_REDELIVERY_ATTEMPTS + 1);
  createFileOnFtpServer(FILE_TXT);
  exceptionListener.waitUntilAllNotificationsAreReceived();
  MuleMessage message=muleContext.getClient().request("vm://error-queue",RECEIVE_TIMEOUT);
  assertThat(message,is(notNullValue()));
  assertThat(message.getPayloadAsString(),is(TEST_MESSAGE));
  assertThat(fileExists(FILE_TXT),is(false));
}
