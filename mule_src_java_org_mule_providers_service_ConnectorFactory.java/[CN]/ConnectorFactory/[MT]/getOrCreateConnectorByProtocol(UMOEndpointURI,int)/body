{
  UMOConnector connector=getConnectorByProtocol(uri.getSchemeMetaInfo());
  if (ConnectorFactory.ALWAYS_CREATE_CONNECTOR == create || (connector == null && create == ConnectorFactory.GET_OR_CREATE_CONNECTOR)) {
    connector=ConnectorFactory.createConnector(uri);
    try {
      BeanUtils.populate(connector,uri.getParams());
      MuleManager.getInstance().registerConnector(connector);
    }
 catch (    Exception e) {
      throw new ConnectorFactoryException(new Message(Messages.FAILED_TO_SET_PROPERTIES_ON_X,"Connector"),e);
    }
  }
 else   if (create == ConnectorFactory.NEVER_CREATE_CONNECTOR && connector == null) {
    logger.warn("There is no connector for protocol: " + uri.getScheme() + " and 'createConnector' is set to NEVER.  Returning null");
  }
  return connector;
}
