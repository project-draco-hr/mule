{
  final MuleMessage message=event.getMessage();
  try {
    final Builder builder=MuleMessage.builder(message);
    final DefaultMultiPartPayload multiPartPayload=(DefaultMultiPartPayload)message.getPayload();
    if (multiPartPayload.hasBodyPart()) {
      builder.payload(multiPartPayload.getBodyPart().getPayload());
    }
 else {
      builder.nullPayload();
    }
    for (    org.mule.runtime.api.message.MuleMessage muleMessage : multiPartPayload.getNonBodyParts()) {
      final PartAttributes attributes=(PartAttributes)muleMessage.getAttributes();
      builder.addOutboundAttachment(attributes.getName(),toDataHandler(attributes.getName(),muleMessage.getPayload(),muleMessage.getDataType().getMediaType()));
    }
    event.setMessage(builder.build());
  }
 catch (  Exception e) {
    throw new TransformerException(this,e);
  }
  return event.getMessage();
}
