{
  ProcessingStrategy configProcessingStrategy=mock(ProcessingStrategy.class);
  ProcessingStrategyFactory configProcessingStrategyFactory=mock(ProcessingStrategyFactory.class);
  when(configProcessingStrategyFactory.create()).thenReturn(configProcessingStrategy);
  when(configuration.getDefaultProcessingStrategyFactory()).thenReturn(configProcessingStrategyFactory);
  ProcessingStrategy processingStrategy=mock(ProcessingStrategy.class);
  ProcessingStrategyFactory processingStrategyFactory=mock(ProcessingStrategyFactory.class);
  when(processingStrategyFactory.create()).thenReturn(processingStrategy);
  createFlow();
  flow.setProcessingStrategyFactory(processingStrategyFactory);
  flow.initialise();
  assertThat(flow.getProcessingStrategy(),is(sameInstance(processingStrategy)));
}
