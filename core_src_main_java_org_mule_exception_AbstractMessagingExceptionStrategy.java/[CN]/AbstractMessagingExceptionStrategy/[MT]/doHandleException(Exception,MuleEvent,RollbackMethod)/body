{
  if (isRollback(ex)) {
    rollback(rollbackMethod);
  }
 else {
    FlowConstructStatistics statistics=event.getFlowConstruct().getStatistics();
    if (statistics != null && statistics.isEnabled()) {
      statistics.incExecutionError();
    }
    routeException(event,ex);
    closeStream(event.getMessage());
    commit();
    if (stopMessageProcessing) {
      stopFlow(event.getFlowConstruct());
    }
  }
}
