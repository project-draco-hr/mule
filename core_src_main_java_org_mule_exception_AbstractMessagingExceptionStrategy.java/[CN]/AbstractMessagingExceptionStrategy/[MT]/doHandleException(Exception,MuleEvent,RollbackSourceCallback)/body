{
  FlowConstructStatistics statistics=event.getFlowConstruct().getStatistics();
  if (statistics != null && statistics.isEnabled()) {
    statistics.incExecutionError();
  }
  if (isRollback(ex)) {
    logger.debug("Rolling back transaction");
    rollback(rollbackMethod);
    if (ex instanceof MessagingException) {
      ((MessagingException)ex).setCauseRollback(true);
    }
    logger.debug("Routing exception message");
    routeException(event,ex);
  }
 else {
    logger.debug("Routing exception message");
    routeException(event,ex);
    logger.debug("Committing transaction");
    commit();
  }
  closeStream(event.getMessage());
  resumeSuspendedTransactionIfAny();
  if (stopMessageProcessing) {
    stopFlow(event.getFlowConstruct());
  }
}
