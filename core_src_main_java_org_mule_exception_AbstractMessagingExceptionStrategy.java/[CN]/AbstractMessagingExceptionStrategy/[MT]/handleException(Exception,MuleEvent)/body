{
  if (enableNotifications) {
    fireNotification(new ExceptionNotification(e));
  }
  logException(e);
  doHandleException(e,event);
  handleTransaction(e);
  closeStream(event.getMessage());
  event.getMessage().setPayload(NullPayload.getInstance());
  ExceptionPayload exceptionPayload=new DefaultExceptionPayload(e);
  event.getMessage().setExceptionPayload(exceptionPayload);
  if (RequestContext.getEvent() != null) {
    RequestContext.setExceptionPayload(exceptionPayload);
  }
  return event;
}
