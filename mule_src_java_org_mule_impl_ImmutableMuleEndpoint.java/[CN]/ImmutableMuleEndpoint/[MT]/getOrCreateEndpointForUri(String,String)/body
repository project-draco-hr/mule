{
  UMOEndpoint endpoint=getEndpointFromUri(uriIdentifier);
  if (endpoint == null) {
    endpoint=createEndpointFromUri(new MuleEndpointURI(uriIdentifier),type);
  }
 else {
    if (endpoint.getType().equals(UMOEndpoint.ENDPOINT_TYPE_SENDER_AND_RECEIVER)) {
      endpoint.setType(type);
    }
 else     if (!endpoint.getType().equals(type)) {
      throw new IllegalArgumentException("Endpoint matching: " + uriIdentifier + " is not of type: "+ type+ ". It is of type: "+ endpoint.getType());
    }
  }
  return endpoint;
}
