{
  ExpressionManager expressionManager=event.getMuleContext().getExpressionManager();
  MuleEvent enricherEvent=DefaultMuleEvent.copy(event);
  if (event.isAllowNonBlocking() && event.getReplyToHandler() != null) {
    enricherEvent=new DefaultMuleEvent(event.getMessage(),event,true);
  }
  OptimizedRequestContext.unsafeSetEvent(enricherEvent);
  MuleEvent enrichmentEvent=enrichmentProcessor.process(enricherEvent);
  OptimizedRequestContext.unsafeSetEvent(event);
  if (enrichmentEvent != null && !VoidMuleEvent.getInstance().equals(enrichmentEvent)) {
    for (    EnrichExpressionPair pair : enrichExpressionPairs) {
      enrich(event.getMessage(),enrichmentEvent.getMessage(),pair.getSource(),pair.getTarget(),expressionManager);
    }
  }
  if (muleContext != null && muleContext.getConfiguration().isEnricherPropagatesSessionVariableChanges()) {
    event=new DefaultMuleEvent(event.getMessage(),event,enrichmentEvent.getSession());
  }
  OptimizedRequestContext.unsafeSetEvent(event);
  return event;
}
