{
  final String myName="Walt";
  final MuleEvent event=getTestEvent(myName);
  String returnedName=runFlow("dynamic",event).getMessage().getPayloadAsString();
  HeisenbergExtension config=muleContext.getRegistry().lookupObject(HeisenbergExtension.class);
  assertThat(returnedName,is(myName));
  assertThat(config.getPersonalInfo().getName(),is(myName));
  PollingProber prober=new PollingProber(5000,100);
  prober.check(new JUnitProbe(){
    @Override protected boolean test() throws Exception {
      assertThat(config.getStop(),is(1));
      assertThat(config.getDispose(),is(1));
      return true;
    }
    @Override public String describeFailure(){
      return "config was not stopped or disposed";
    }
  }
);
}
