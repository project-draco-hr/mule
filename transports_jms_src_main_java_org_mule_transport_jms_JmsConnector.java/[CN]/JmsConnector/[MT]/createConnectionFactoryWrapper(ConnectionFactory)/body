{
  ConnectionFactory wrappedConnectionFactory=connectionFactory;
  if (connectionFactory instanceof BitronixConnectionFactoryWrapper || connectionFactory instanceof ConnectionFactoryWrapper) {
    return connectionFactory;
  }
  try {
    if (connectionFactory instanceof XAConnectionFactory && muleContext.getTransactionManager() instanceof TransactionManagerWrapper) {
      logger.info(String.format("No pool defined for XAConnectionFactory in connector %s. A default pool will be created. " + "To customize define a bti:xa-connection-factory-pool element in your config and assign it to " + "the connector.",getName()));
      BitronixConnectionFactoryPoolBuilder builder=new BitronixConnectionFactoryPoolBuilder();
      builder.setConnectionFactory((XAConnectionFactory)connectionFactory);
      builder.setName(getName());
      wrappedConnectionFactory=builder.build(muleContext);
    }
 else {
      if (connectionFactory instanceof XAConnectionFactory && muleContext.getTransactionManager() != null) {
        wrappedConnectionFactory=new ConnectionFactoryWrapper(connectionFactory,sameRMOverrideValue);
      }
    }
    return wrappedConnectionFactory;
  }
 catch (  Exception e) {
    throw new InitialisationException(e,this);
  }
}
