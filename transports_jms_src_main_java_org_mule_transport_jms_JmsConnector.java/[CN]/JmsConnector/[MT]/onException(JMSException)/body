{
  final JmsConnector jmsConnector=JmsConnector.this;
  Map receivers=jmsConnector.getReceivers();
  boolean isMultiConsumerReceiver=false;
  if (!receivers.isEmpty()) {
    Map.Entry entry=(Map.Entry)receivers.entrySet().iterator().next();
    if (entry.getValue() instanceof MultiConsumerJmsMessageReceiver) {
      isMultiConsumerReceiver=true;
    }
  }
  int expectedReceiverCount=isMultiConsumerReceiver ? 1 : (jmsConnector.getReceivers().size() * jmsConnector.getNumberOfConcurrentTransactedReceivers());
  if (logger.isDebugEnabled()) {
    logger.debug("About to recycle myself due to remote JMS connection shutdown but need " + "to wait for all active receivers to report connection loss. Receiver count: " + (receiverReportedExceptionCount.get() + 1) + '/'+ expectedReceiverCount);
  }
  if (receiverReportedExceptionCount.incrementAndGet() >= expectedReceiverCount) {
    receiverReportedExceptionCount.set(0);
    handleException(new ConnectException(jmsException,this));
  }
}
