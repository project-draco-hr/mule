{
  latch=new CountDownLatch(1);
  muleContext.registerListener(new RoutingNotificationListener(){
    public void onNotification(    ServerNotification notification){
      if (notification.getAction() == RoutingNotification.MISSED_ASYNC_REPLY) {
        latch.countDown();
        assertEquals("test Received Late!",((MuleMessage)((RoutingNotification)notification).getSource()).getPayload());
      }
    }
  }
);
  String message="test";
  MuleClient client=new MuleClient();
  MuleMessage result=client.send("vm://distributor.queue",message,null);
  assertNotNull(result);
  assertTrue(result instanceof MuleMessageCollection);
  MuleMessageCollection mc=(MuleMessageCollection)result;
  assertEquals(2,mc.size());
  for (int i=0; i < mc.getMessagesAsArray().length; i++) {
    MuleMessage msg=mc.getMessagesAsArray()[i];
    assertEquals("test Received",msg.getPayload());
  }
  assertTrue(latch.await(3000,TimeUnit.MILLISECONDS));
}
