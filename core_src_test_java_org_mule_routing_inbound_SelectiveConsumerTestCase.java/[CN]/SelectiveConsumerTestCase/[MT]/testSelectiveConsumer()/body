{
  Mock session=MuleTestUtils.getMockSession();
  Service testService=getTestService("test",Apple.class);
  InboundRouterCollection messageRouter=createObject(DefaultInboundRouterCollection.class);
  SelectiveConsumer router=createObject(SelectiveConsumer.class);
  messageRouter.addRouter(router);
  messageRouter.setCatchAllStrategy(new LoggingCatchAllStrategy());
  PayloadTypeFilter filter=new PayloadTypeFilter(String.class);
  router.setFilter(filter);
  assertEquals(filter,router.getFilter());
  MuleMessage message=new DefaultMuleMessage("test event",muleContext);
  ImmutableEndpoint endpoint=getTestInboundEndpoint(MessageExchangePattern.ONE_WAY);
  MuleEvent event=new DefaultMuleEvent(message,endpoint,(MuleSession)session.proxy());
  assertTrue(router.isMatch(event));
  session.expect("dispatchEvent",C.eq(event));
  session.expectAndReturn("getService",testService);
  messageRouter.process(event);
  session.verify();
  endpoint=getTestInboundEndpoint(MessageExchangePattern.REQUEST_RESPONSE);
  event=new DefaultMuleEvent(message,endpoint,(MuleSession)session.proxy());
  session.expectAndReturn("sendEvent",C.eq(event),message);
  session.expectAndReturn("getService",testService);
  MuleMessage result=messageRouter.process(event).getMessage();
  assertNotNull(result);
  assertEquals(message,result);
  session.verify();
  session.expectAndReturn("getService",testService);
  session.expectAndReturn("toString","");
  message=new DefaultMuleMessage(new Exception(),muleContext);
  endpoint=getTestInboundEndpoint(MessageExchangePattern.ONE_WAY);
  event=new DefaultMuleEvent(message,endpoint,(MuleSession)session.proxy());
  assertTrue(!router.isMatch(event));
  messageRouter.process(event);
  session.verify();
}
