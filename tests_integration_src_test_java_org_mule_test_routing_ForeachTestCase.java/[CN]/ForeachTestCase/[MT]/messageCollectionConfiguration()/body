{
  List<MuleMessage> list=new ArrayList<>();
  for (int i=0; i < 10; i++) {
    MutableMuleMessage msg=new DefaultMuleMessage("message-" + i,muleContext);
    msg.setOutboundProperty("out","out" + (i + 1));
    list.add(msg);
  }
  MuleMessage msgCollection=new DefaultMuleMessage(list,muleContext);
  MuleMessage result=flowRunner("message-collection-config").withPayload(msgCollection).run().getMessage();
  assertThat(result.getOutboundProperty("totalMessages"),is(10));
  assertThat(result.getPayload(),is(msgCollection.getPayload()));
  FlowAssert.verify("message-collection-config");
}
