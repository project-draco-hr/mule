{
  final Collection<String> names=new ArrayList<String>();
  names.add("residente");
  names.add("visitante");
  Map<String,Object> props=new HashMap<String,Object>();
  props.put("names",names);
  MuleMessage message=new DefaultMuleMessage("message payload",props,muleContext);
  MuleMessage result=client.send("vm://input-3",message);
  assertTrue(result.getPayload() instanceof String);
  assertEquals(names.size(),((Collection<?>)message.getOutboundProperty("names")).size());
  MuleMessage out=client.request("vm://out",getTestTimeoutSecs());
  assertTrue(out.getPayload() instanceof String);
  assertEquals("residente",out.getPayload());
  out=client.request("vm://out",getTestTimeoutSecs());
  assertTrue(out.getPayload() instanceof String);
  assertEquals("visitante",out.getPayload());
}
