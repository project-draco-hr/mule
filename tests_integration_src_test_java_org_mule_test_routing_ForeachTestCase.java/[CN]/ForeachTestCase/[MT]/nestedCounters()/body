{
  final List<List<String>> payload=createNestedPayload();
  MuleMessage parent=new DefaultMuleMessage(payload,muleContext);
  MuleMessage result=client.send("vm://input-16",parent);
  assertTrue(result.getPayload() instanceof Collection);
  Collection<?> resultPayload=(Collection<?>)result.getPayload();
  assertEquals(3,resultPayload.size());
  assertSame(payload,resultPayload);
  MuleMessage out;
  for (int i=0; i < payload.size(); i++) {
    for (int j=0; j < payload.get(i).size(); j++) {
      out=client.request("vm://out",getTestTimeoutSecs());
      assertEquals("The nested counters are not consistent.",(Object)out.getInboundProperty("j"),j + 1);
    }
    out=client.request("vm://out",getTestTimeoutSecs());
    assertThat("The nested counters are not consistent",out.getInboundProperty("i"),is(i + 1));
  }
}
