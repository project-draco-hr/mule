{
  final Latch latch=new Latch();
  final AtomicReference<Object> data=new AtomicReference<Object>();
  client.addListener(new MessageListener(){
    @Override public void deliver(    Client fromClient,    Client toClient,    Message message){
      if (message.getData() != null) {
        data.set((message.getData()));
        latch.release();
      }
    }
  }
);
  client.subscribe("/response");
  client.publish("/request",TEST_JSON_MESSAGE,null);
  latch.await(DEFAULT_TEST_TIMEOUT_SECS,TimeUnit.SECONDS);
  assertNotNull(data.get());
  assertEquals("{\"value1\":\"foo\",\"value2\":\"bar\"}",data.get());
}
