{
  MuleClient client=muleContext.getClient();
  int id=Integer.valueOf(DateUtils.formatTimeStamp(Calendar.getInstance().getTime(),"hhmmss"));
  String valueExpression=DateUtils.formatTimeStamp(Calendar.getInstance().getTime(),"ssmmhh");
  MuleMessage message=new DefaultMuleMessage("hi",muleContext);
  message.setProperty("originalId",id,PropertyScope.OUTBOUND);
  message.setProperty("valueId",valueExpression,PropertyScope.OUTBOUND);
  client.dispatch("vm://in",message);
  MuleMessage requestMessage=client.request("vm://forProcessing",FunctionalTestCase.RECEIVE_TIMEOUT);
  assertNotNull(requestMessage);
  message=new DefaultMuleMessage("hi",muleContext);
  message.setProperty("originalId",id,PropertyScope.OUTBOUND);
  message.setProperty("valueId",valueExpression,PropertyScope.OUTBOUND);
  client.send("vm://in",message);
  requestMessage=client.request("vm://duplicated",FunctionalTestCase.RECEIVE_TIMEOUT);
  assertNotNull(requestMessage);
}
