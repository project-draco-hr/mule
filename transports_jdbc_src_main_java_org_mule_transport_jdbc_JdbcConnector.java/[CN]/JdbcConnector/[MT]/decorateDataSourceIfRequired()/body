{
  if (dataSource instanceof XADataSource) {
    if (muleContext.getTransactionManager() instanceof TransactionManagerWrapper) {
      BitronixJdbcXaDataSourceProvider.xaDatasourceHolder=(XADataSource)dataSource;
      PoolingDataSource poolingDataSource=new PoolingDataSource();
      poolingDataSource.setClassName(BitronixJdbcXaDataSourceProvider.class.getCanonicalName());
      poolingDataSource.setMaxPoolSize(100);
      poolingDataSource.setAcquireIncrement(1);
      poolingDataSource.setAllowLocalTransactions(true);
      poolingDataSource.setAutomaticEnlistingEnabled(false);
      poolingDataSource.setUniqueName(muleContext.getConfiguration().getId() + "-" + getName());
      poolingDataSource.init();
      this.dataSource=new BitronixXaDataSourceWrapper(poolingDataSource);
    }
 else {
      this.dataSource=new DataSourceWrapper((XADataSource)dataSource);
    }
  }
}
