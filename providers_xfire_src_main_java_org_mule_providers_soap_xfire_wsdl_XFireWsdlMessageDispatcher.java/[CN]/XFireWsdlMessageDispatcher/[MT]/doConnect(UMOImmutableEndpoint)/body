{
  try {
    XFire xfire=connector.getXfire();
    String wsdlUrl=endpoint.getEndpointURI().getAddress();
    String serviceName=wsdlUrl.substring(0,wsdlUrl.lastIndexOf('?'));
    Service service=xfire.getServiceRegistry().getService(new QName(serviceName));
    if (service == null) {
      service=new Client(new URL(wsdlUrl)).getService();
      service.setName(new QName(serviceName));
      xfire.getServiceRegistry().register(service);
    }
    clientPool=new StackObjectPool(new XFireWsdlClientPoolFactory(endpoint,service,xfire));
    clientPool.addObject();
  }
 catch (  Exception ex) {
    disconnect();
    throw ex;
  }
}
