{
  try {
    clientPool=new StackObjectPool(new BasePoolableObjectFactory(){
      public Object makeObject() throws Exception {
        XFire xfire=connector.getXfire();
        String wsdlUrl=endpoint.getEndpointURI().getAddress();
        String serviceName=wsdlUrl.substring(0,wsdlUrl.lastIndexOf('?'));
        Service service=xfire.getServiceRegistry().getService(new QName(serviceName));
        Client client;
        if (service != null) {
          client=new Client(new MuleUniversalTransport(),service,wsdlUrl);
        }
 else {
          client=new Client(new URL(wsdlUrl));
          client.getService().setName(new QName(serviceName));
          xfire.getServiceRegistry().register(client.getService());
        }
        client.setXFire(xfire);
        client.setEndpointUri(endpoint.getEndpointURI().toString());
        return client;
      }
    }
);
    clientPool.addObject();
    clientPool.addObject();
  }
 catch (  Exception ex) {
    disconnect();
    throw ex;
  }
}
