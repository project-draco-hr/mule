{
  TestClassLoader appClassLoader=new TestClassLoader();
  when(applicationClassLoaderFactory.create(appDescriptor).getClassLoader()).thenReturn(appClassLoader);
  TestClassLoader pluginClassLoader=new TestClassLoader();
  List<ClassLoader> pluginClassLoaders=new LinkedList<ClassLoader>();
  pluginClassLoaders.add(pluginClassLoader);
  when(pluginClassLoaderManager.getPluginClassLoaders()).thenReturn(pluginClassLoaders);
  ClassLoader createdClassLoader=pluginAwareClassLoaderFactory.create(appDescriptor).getClassLoader();
  createdClassLoader.getResource("foo");
  assertThat(appClassLoader.loadedResource,equalTo(true));
  assertThat(pluginClassLoader.loadedResource,equalTo(true));
}
