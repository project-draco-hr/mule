{
  final MuleMessage attachmentPart1=toMuleMessagePart("spi-props",getResourceAsUrl("test-spi.properties",getClass()),MediaType.TEXT);
  final MuleMessage attachmentPart2=toMuleMessagePart("dummy",getResourceAsUrl("dummy.xml",getClass()),null);
  MuleMessage message=MuleMessage.builder().payload(new DefaultMultiPartPayload(MuleMessage.builder().payload(TEST_PAYLOAD).attributes(BODY_ATTRIBUTES).build(),attachmentPart1,attachmentPart2)).build();
  assertThat(((MultiPartPayload)message.getPayload()).getParts(),hasSize(3));
  assertThat(((MultiPartPayload)message.getPayload()).getPart("dummy").getDataType().getMediaType(),is(MediaType.APPLICATION_XML));
}
