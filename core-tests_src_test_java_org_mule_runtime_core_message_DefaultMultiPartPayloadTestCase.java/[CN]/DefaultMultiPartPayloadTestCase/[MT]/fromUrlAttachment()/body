{
  final InternalMessage attachmentPart=toMuleMessagePart("spi-props",getResourceAsUrl("test-spi.properties",getClass()),MediaType.TEXT);
  InternalMessage message=InternalMessage.builder().payload(new DefaultMultiPartPayload(InternalMessage.builder().payload(TEST_PAYLOAD).attributes(BODY_ATTRIBUTES).build(),attachmentPart)).build();
  assertThat(((MultiPartPayload)message.getPayload().getValue()).getParts(),hasSize(2));
  assertThat(((MultiPartPayload)message.getPayload().getValue()).getPartNames(),hasItem("spi-props"));
  assertThat(((MultiPartPayload)message.getPayload().getValue()).getPart("spi-props"),sameInstance(attachmentPart));
  assertThat(((MultiPartPayload)message.getPayload().getValue()).getPart("spi-props").getPayload().getDataType().getMediaType(),is(MediaType.TEXT));
}
