{
  List<Element> elementList=null;
  try {
    elementList=DOMUtils.findAllElementsByTagNameNS(doc.getDocumentElement(),"http://www.w3.org/2001/XMLSchema","import");
    for (    Element el : elementList) {
      String sl=el.getAttribute("schemaLocation");
      if (smp.containsKey(URLDecoder.decode(sl,"utf-8"))) {
        el.setAttribute("schemaLocation",base + "?xsd=" + sl.replace(" ","%20"));
      }
    }
    elementList=DOMUtils.findAllElementsByTagNameNS(doc.getDocumentElement(),"http://www.w3.org/2001/XMLSchema","include");
    for (    Element el : elementList) {
      String sl=el.getAttribute("schemaLocation");
      if (smp.containsKey(URLDecoder.decode(sl,"utf-8"))) {
        el.setAttribute("schemaLocation",base + "?xsd=" + sl.replace(" ","%20"));
      }
    }
    elementList=DOMUtils.findAllElementsByTagNameNS(doc.getDocumentElement(),"http://www.w3.org/2001/XMLSchema","redefine");
    for (    Element el : elementList) {
      String sl=el.getAttribute("schemaLocation");
      if (smp.containsKey(URLDecoder.decode(sl,"utf-8"))) {
        el.setAttribute("schemaLocation",base + "?xsd=" + sl.replace(" ","%20"));
      }
    }
    elementList=DOMUtils.findAllElementsByTagNameNS(doc.getDocumentElement(),"http://schemas.xmlsoap.org/wsdl/","import");
    for (    Element el : elementList) {
      String sl=el.getAttribute("location");
      if (mp.containsKey(URLDecoder.decode(sl,"utf-8"))) {
        el.setAttribute("location",base + "?wsdl=" + sl.replace(" ","%20"));
      }
    }
  }
 catch (  UnsupportedEncodingException e) {
    throw new WSDLQueryException(new org.apache.cxf.common.i18n.Message("COULD_NOT_PROVIDE_WSDL",LOG,base),e);
  }
  Boolean rewriteSoapAddress=ei.getProperty("autoRewriteSoapAddress",Boolean.class);
  if (rewriteSoapAddress != null && rewriteSoapAddress.booleanValue()) {
    List<Element> serviceList=DOMUtils.findAllElementsByTagNameNS(doc.getDocumentElement(),"http://schemas.xmlsoap.org/wsdl/","service");
    for (    Element serviceEl : serviceList) {
      String serviceName=serviceEl.getAttribute("name");
      if (serviceName.equals(ei.getService().getName().getLocalPart())) {
        elementList=DOMUtils.findAllElementsByTagNameNS(doc.getDocumentElement(),"http://schemas.xmlsoap.org/wsdl/","port");
        for (        Element el : elementList) {
          String name=el.getAttribute("name");
          if (name.equals(ei.getName().getLocalPart())) {
            Element soapAddress=DOMUtils.findAllElementsByTagNameNS(el,"http://schemas.xmlsoap.org/wsdl/soap/","address").iterator().next();
            soapAddress.setAttribute("location",base);
          }
        }
      }
    }
  }
  try {
    doc.setXmlStandalone(true);
  }
 catch (  Exception ex) {
  }
}
