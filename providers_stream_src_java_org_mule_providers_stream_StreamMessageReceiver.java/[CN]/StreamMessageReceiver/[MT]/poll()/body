{
  try {
    byte[] buf=new byte[getBufferSize()];
    int len=inputStream.read(buf);
    if (len == -1) {
      return;
    }
    StringBuffer message=new StringBuffer(new String(buf,0,len));
    if (message.charAt(message.length()) == (char)Character.LINE_SEPARATOR) {
      message.setLength(message.length() - 1);
    }
    UMOMessage umoMessage=new MuleMessage(connector.getMessageAdapter(message.toString()));
    routeMessage(umoMessage,endpoint.isSynchronous());
    ((StreamConnector)endpoint.getConnector()).reinitialise();
  }
 catch (  Exception e) {
    handleException(e);
  }
}
