{
  if (result instanceof MuleEvent) {
    event=(MuleEvent)result;
  }
 else   if (result instanceof MuleMessage) {
    event.setMessage((MuleMessage)result);
  }
 else {
    event.getMessage().setPayload(result);
  }
  ContentMetadata contentMetadata=operationContext.getVariable(CONTENT_METADATA);
  if (contentMetadata != null) {
    final ContentType contentType=contentMetadata.getOutputContentType();
    final MuleMessage message=event.getMessage();
    final Object payload=message.getPayload();
    final DataType<?> dataType=DataTypeFactory.createWithEncoding(payload.getClass(),contentType.getEncoding().name());
    dataType.setMimeType(contentType.getMimeType());
    message.setPayload(message.getPayload(),dataType);
  }
  return event;
}
