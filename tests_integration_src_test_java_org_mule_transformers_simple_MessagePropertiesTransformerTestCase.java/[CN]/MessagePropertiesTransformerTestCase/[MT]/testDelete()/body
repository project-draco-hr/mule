{
  MessagePropertiesTransformer t=new MessagePropertiesTransformer();
  t.setDeleteProperties("badProperty");
  t.setMuleContext(muleContext);
  DefaultMuleMessage msg=new DefaultMuleMessage("message",muleContext);
  msg.setOutboundProperty("badProperty","badValue");
  assertEquals("badValue",msg.<Object>getOutboundProperty("badProperty"));
  DefaultMuleMessage transformed=(DefaultMuleMessage)t.transform(msg,(String)null);
  assertSame(msg,transformed);
  assertEquals(msg.getUniqueId(),transformed.getUniqueId());
  assertEquals(msg.getPayload(),transformed.getPayload());
  compareProperties(msg,transformed);
  assertFalse(transformed.getInvocationPropertyNames().contains("badValue"));
  assertFalse(transformed.getInboundPropertyNames().contains("badValue"));
  assertFalse(transformed.getOutboundPropertyNames().contains("badValue"));
  assertFalse(transformed.getPropertyNames(SESSION).contains("badValue"));
}
