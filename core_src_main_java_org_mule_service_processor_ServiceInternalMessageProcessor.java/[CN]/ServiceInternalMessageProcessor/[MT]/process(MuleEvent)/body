{
  MuleEvent resultEvent=null;
  try {
    Object replyTo=event.getMessage().getReplyTo();
    ReplyToHandler replyToHandler=getReplyToHandler(event.getMessage(),event.getEndpoint());
    event.getMessage().setReplyTo(null);
    resultEvent=service.getComponent().process(event);
    resultEvent=processNext(resultEvent);
    if (resultEvent != null) {
      String replyToStop=resultEvent.getMessage().getInvocationProperty(MuleProperties.MULE_REPLY_TO_STOP_PROPERTY);
      if (!event.getEndpoint().getExchangePattern().hasResponse() || !BooleanUtils.toBoolean(replyToStop)) {
        processReplyTo(event,resultEvent,replyToHandler,replyTo);
      }
    }
    return resultEvent;
  }
 catch (  Exception e) {
    event.getSession().setValid(false);
    if (e instanceof MuleException) {
      throw (MuleException)e;
    }
 else {
      throw new MessagingException(event,e);
    }
  }
}
