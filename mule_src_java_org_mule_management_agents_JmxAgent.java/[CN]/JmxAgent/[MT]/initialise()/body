{
  if (initialized) {
    return;
  }
  if (!locateServer && !createServer) {
    throw new InitialisationException(new Message(Messages.JMX_CREATE_OR_LOCATE_SHOULD_BE_SET),this);
  }
  if (mBeanServer == null && locateServer) {
    List l=MBeanServerFactory.findMBeanServer(null);
    if (l != null && l.size() > 0) {
      mBeanServer=(MBeanServer)l.get(0);
    }
  }
  if (mBeanServer == null && createServer) {
    mBeanServer=MBeanServerFactory.createMBeanServer();
    serverCreated=true;
  }
  if (mBeanServer == null) {
    throw new InitialisationException(new Message(Messages.JMX_CANT_LOCATE_CREATE_SERVER),this);
  }
  if (connectorServerUrl != null) {
    try {
      JMXServiceURL url=new JMXServiceURL(connectorServerUrl);
      connectorServer=JMXConnectorServerFactory.newJMXConnectorServer(url,null,mBeanServer);
    }
 catch (    Exception e) {
      throw new InitialisationException(new Message(Messages.FAILED_TO_CREATE_X,"Jmx Connector"),e,this);
    }
  }
  MuleManager.getInstance().registerListener(new ModelEventListener(){
    public void onEvent(    UMOServerEvent event){
      if (event.getAction() == ModelEvent.MODEL_STARTED) {
        try {
          registerStatisticsService();
          registerMuleService();
          registerModelService();
          registerComponentServices();
          registerEndpointServices();
          registerConnectorServices();
        }
 catch (        Exception e) {
          throw new MuleRuntimeException(new Message(Messages.X_FAILED_TO_INITIALISE,"MBeans"),e);
        }
      }
    }
  }
);
  initialized=true;
}
