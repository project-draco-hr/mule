{
  Object data=event.getTransformedMessage();
  UMOMessage message=new MuleMessage(data,event.getMessage());
  byte[] buf;
  if (data instanceof byte[]) {
    buf=(byte[])data;
  }
 else {
    buf=data.toString().getBytes(event.getEncoding());
  }
  FileOutputStream fos=(FileOutputStream)connector.getOutputStream(event.getEndpoint(),message);
  if (event.getMessage().getStringProperty(FileConnector.PROPERTY_FILENAME,null) == null) {
    event.getMessage().setStringProperty(FileConnector.PROPERTY_FILENAME,message.getStringProperty(FileConnector.PROPERTY_FILENAME,""));
  }
  try {
    fos.write(buf);
  }
  finally {
    fos.close();
  }
}
