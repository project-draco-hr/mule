{
  File[] files;
  File file=FileUtils.newFile(dir);
  File result=null;
  try {
    if (file.exists()) {
      if (file.isFile()) {
        result=file;
      }
 else       if (file.isDirectory()) {
        if (filter != null) {
          files=file.listFiles(filter);
        }
 else {
          files=file.listFiles();
        }
        if (files.length > 0) {
          result=files[0];
        }
      }
    }
    return result;
  }
 catch (  Exception e) {
    throw new MuleException(FileMessages.errorWhileListingFiles(),e);
  }
}
