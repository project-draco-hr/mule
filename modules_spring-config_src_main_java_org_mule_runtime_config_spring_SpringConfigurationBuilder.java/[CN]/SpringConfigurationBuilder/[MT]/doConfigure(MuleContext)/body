{
  Registry registry;
  if (parentContext != null) {
    if (appContext instanceof ConfigurableApplicationContext) {
      registry=new SpringRegistry((ConfigurableApplicationContext)appContext,parentContext,muleContext);
    }
 else {
      throw new ConfigurationException(I18nMessageFactory.createStaticMessage("Cannot set a parent context if the ApplicationContext does not implement ConfigurableApplicationContext"));
    }
  }
 else {
    registry=new SpringRegistry(appContext,muleContext);
  }
  muleContext.addRegistry(registry);
  if (muleContext.getLifecycleManager().isPhaseComplete(Initialisable.PHASE_NAME)) {
    registry.initialise();
  }
}
