{
  when(mockDeploymentService.findDomain(DOMAIN_NAME)).thenReturn(mockDomain);
  when(mockDomainDeployer.deployPackagedArtifact(DOMAIN_ZIP_PATH)).thenReturn(mockDomain);
  when(mockDeploymentService.findDomainApplications(DOMAIN_NAME)).thenReturn(Arrays.asList(new Application[]{mockApplication1,mockApplication2}));
  DomainArchiveDeployer domainArchiveDeployer=new DomainArchiveDeployer(mockDomainDeployer,mockApplicationDeployer,mockDeploymentService);
  domainArchiveDeployer.undeployArtifact(DOMAIN_NAME);
  verify(mockApplicationDeployer,times(1)).undeployArtifact(MOCK_APPLICATION_1_NAME);
  verify(mockApplicationDeployer,times(1)).undeployArtifact(MOCK_APPLICATION_2_NAME);
  verify(mockDomainDeployer,times(1)).undeployArtifact(DOMAIN_NAME);
}
