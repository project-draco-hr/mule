{
  if (collectionExpression != null) {
    expressionConfig.setExpression(collectionExpression);
    splitter=new ExpressionSplitter(expressionConfig);
    if (isXPathExpression(expressionConfig.getExpression())) {
      xpathCollection=true;
    }
  }
 else {
    splitter=new CollectionMapSplitter();
  }
  splitter.setBatchSize(batchSize);
  splitter.setCounterVariableName(counterVariableName);
  splitter.setMuleContext(muleContext);
  messageProcessors.add(0,splitter);
  filter=new MessageFilter(new Filter(){
    @Override public boolean accept(    MuleMessage message){
      return false;
    }
  }
);
  messageProcessors.add(filter);
  messageProcessorInitialized=true;
  try {
    this.ownedMessageProcessor=new DefaultMessageProcessorChainBuilder().chain(messageProcessors).build();
  }
 catch (  MuleException e) {
    throw new InitialisationException(e,this);
  }
  super.initialise();
}
