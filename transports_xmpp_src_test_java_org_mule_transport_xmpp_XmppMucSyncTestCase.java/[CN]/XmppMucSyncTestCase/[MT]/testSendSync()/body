{
  MuleClient client=new MuleClient(muleContext);
  MuleMessage reply=client.send("vm://in",testMessage,null);
  assertNotNull(reply);
  assertEquals(NullPayload.getInstance(),reply.getPayload());
  Packet packet=jabberClient.receive(RECEIVE_TIMEOUT);
  boolean inputSeen=false;
  packet=jabberClient.receive(SHORT_RETRIEVE_TIMEOUT);
  while (packet != null) {
    String payload=((Message)packet).getBody();
    if (payload.equals(testMessage)) {
      inputSeen=true;
      break;
    }
    packet=jabberClient.receive(SHORT_RETRIEVE_TIMEOUT);
  }
  assertTrue(inputSeen);
}
