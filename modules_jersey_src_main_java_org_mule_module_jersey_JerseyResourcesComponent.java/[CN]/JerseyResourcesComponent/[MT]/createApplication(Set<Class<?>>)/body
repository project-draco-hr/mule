{
  if (!properties.containsKey(ServerProperties.PROCESSING_RESPONSE_ERRORS_ENABLED)) {
    properties.put(ServerProperties.PROCESSING_RESPONSE_ERRORS_ENABLED,true);
  }
  resourceConfig=new ResourceConfig();
  initializeResources(resourceConfig);
  for (  String pkg : packages) {
    resourceConfig.packages(pkg);
  }
  resourceConfig.addProperties(properties).registerClasses(resources).register(Jackson1Feature.class);
  if (!resourceConfig.isRegistered(ResponseErrorMapper.class)) {
    resourceConfig.register(new FallbackErrorMapper());
  }
  return new ApplicationHandler(resourceConfig);
}
