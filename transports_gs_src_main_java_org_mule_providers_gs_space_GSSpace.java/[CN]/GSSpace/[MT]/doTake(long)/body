{
  try {
    if (snapshot == null) {
      snapshot=space.snapshot(entryTemplate);
    }
    Object retValue=null;
    while (retValue == null) {
      retValue=queue.poll();
      if (retValue != null) {
        continue;
      }
      Entry[] entries=space.takeMultiple(snapshot,getTransaction(),Integer.MAX_VALUE);
      if (entries != null && entries.length > 0) {
        for (int i=0; i < entries.length; i++) {
          queue.put(entries[i]);
        }
        continue;
      }
      Object entry=space.take(snapshot,getTransaction(),5000);
      if (entry != null) {
        queue.put(entry);
      }
    }
    return retValue;
  }
 catch (  Exception e) {
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e1) {
      e1.printStackTrace();
    }
    throw new GSSpaceException(e);
  }
}
