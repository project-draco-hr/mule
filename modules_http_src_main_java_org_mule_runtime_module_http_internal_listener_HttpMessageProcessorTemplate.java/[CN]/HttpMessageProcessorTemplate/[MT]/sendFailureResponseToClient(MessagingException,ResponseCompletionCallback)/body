{
  String exceptionStatusCode=ExceptionHelper.getTransportErrorMapping(HTTP.getScheme(),messagingException.getClass(),sourceMuleEvent.getMuleContext());
  Integer statusCodeFromException=exceptionStatusCode != null ? Integer.valueOf(exceptionStatusCode) : INTERNAL_SERVER_ERROR_STATUS_CODE;
  final org.mule.runtime.module.http.internal.domain.response.HttpResponseBuilder failureResponseBuilder=new org.mule.runtime.module.http.internal.domain.response.HttpResponseBuilder().setStatusCode(statusCodeFromException).setReasonPhrase(messagingException.getMessage());
  addThrottlingHeaders(failureResponseBuilder);
  MuleEvent event=messagingException.getEvent();
  event.setMessage(MuleMessage.builder(event.getMessage()).payload(messagingException.getMessage()).build());
  final HttpResponse response=errorResponseBuilder.build(failureResponseBuilder,event);
  responseReadyCallback.responseReady(response,getResponseFailureCallback(responseCompletationCallback,messagingException.getEvent()));
}
