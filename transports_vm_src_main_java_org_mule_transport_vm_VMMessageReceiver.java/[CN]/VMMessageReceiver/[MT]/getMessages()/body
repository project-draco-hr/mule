{
  QueueSession qs=connector.getQueueSession();
  Queue queue=qs.getQueue(endpoint.getEndpointURI().getAddress());
  List messages=new LinkedList();
  int maxThreads=connector.getReceiverThreadingProfile().getMaxThreadsActive();
  int batchSize=Math.max(1,Math.min(queue.size(),((maxThreads / 2) - 1)));
  MuleMessage message=(MuleMessage)queue.poll(connector.getQueueTimeout());
  if (message != null) {
    messages.add(message);
    for (int i=0; i < batchSize && message != null; i++) {
      message=(MuleMessage)queue.poll(0);
      if (message != null) {
        messages.add(message);
      }
    }
  }
  return messages;
}
