{
  QueueSession qs=connector.getQueueSession();
  Queue queue=qs.getQueue(endpoint.getEndpointURI().getAddress());
  List<MuleMessage> messages=new LinkedList<MuleMessage>();
  int maxThreads=connector.getReceiverThreadingProfile().getMaxThreadsActive();
  int batchSize=Math.max(1,Math.min(queue.size(),((maxThreads / 2) - 1)));
  MuleEvent message=(MuleEvent)queue.poll(connector.getQueueTimeout());
  if (message != null) {
    messages.add(message.getMessage());
    for (int i=0; i < batchSize && message != null; i++) {
      message=(MuleEvent)queue.poll(0);
      if (message != null) {
        messages.add(message.getMessage());
      }
    }
  }
  return messages;
}
