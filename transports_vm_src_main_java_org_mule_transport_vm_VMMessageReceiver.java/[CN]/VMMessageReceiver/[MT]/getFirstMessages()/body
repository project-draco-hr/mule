{
  QueueSession qs=connector.getTransactionalResource(endpoint);
  Queue queue=qs.getQueue(endpoint.getEndpointURI().getAddress());
  List<MuleMessage> messages=new LinkedList<MuleMessage>();
  int batchSize=getBatchSize(queue.size());
  MuleEvent message=(MuleEvent)queue.poll(connector.getQueueTimeout());
  if (message != null) {
    messages.add(new DefaultMuleMessage(message.getMessage().getPayload(),message.getMessage(),endpoint.getMuleContext()));
    for (int i=0; i < batchSize && message != null; i++) {
      message=(MuleEvent)queue.poll(0);
      if (message != null) {
        messages.add(new DefaultMuleMessage(message.getMessage(),endpoint.getMuleContext()));
      }
    }
  }
  return messages;
}
