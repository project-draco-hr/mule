{
  Map<String,DataHandler> attachments=new HashMap<String,DataHandler>(3);
  for (  String name : message.getOutboundAttachmentNames()) {
    attachments.put(name,message.getOutboundAttachment(name));
  }
  Map<String,Object> properties=new HashMap<String,Object>(3);
  for (  String name : message.getOutboundPropertyNames()) {
    properties.put(name,message.getOutboundProperty(name));
  }
  DefaultMuleMessage newMessage=new DefaultMuleMessage(message.getPayload(),message,connector.getMuleContext());
  newMessage.clearProperties(PropertyScope.INBOUND);
  newMessage.clearProperties(PropertyScope.INVOCATION);
  newMessage.clearProperties(PropertyScope.OUTBOUND);
  for (  String s : properties.keySet()) {
    newMessage.setInboundProperty(s,properties.get(s));
  }
  for (  String s : newMessage.getOutboundAttachmentNames()) {
    newMessage.removeAttachment(s);
  }
  for (  String s : attachments.keySet()) {
    newMessage.addInboundAttachment(s,attachments.get(s));
  }
  newMessage.setCorrelationId(message.getCorrelationId());
  newMessage.setCorrelationGroupSize(message.getCorrelationGroupSize());
  newMessage.setCorrelationSequence(message.getCorrelationSequence());
  newMessage.setReplyTo(message.getReplyTo());
  newMessage.setEncoding(message.getEncoding());
  return newMessage;
}
