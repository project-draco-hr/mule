{
  try {
    if (getDoCompression()) {
      byte[] buffer;
      if (src instanceof String) {
        buffer=((String)src).getBytes();
      }
 else {
        buffer=Utility.objectToByteArray(src);
      }
      byte[] cmp=CompressionHelper.compressByteArray(buffer);
      if (logger.isDebugEnabled())       logger.debug("Compressed message in transformation");
      return cmp;
    }
 else {
      return Utility.objectToByteArray(src);
    }
  }
 catch (  IOException e) {
    throw new TransformerException("Failed to compress message",e);
  }
}
