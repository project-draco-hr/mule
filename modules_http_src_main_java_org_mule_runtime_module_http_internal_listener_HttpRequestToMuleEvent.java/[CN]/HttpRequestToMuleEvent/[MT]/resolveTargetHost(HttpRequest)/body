{
  String hostHeaderValue=request.getHeaderValue("host");
  if (HTTP_1_0.equals(request.getProtocol()) || HTTP_0_9.equals(request.getProtocol())) {
    return hostHeaderValue == null ? ALL_INTERFACES_IP : hostHeaderValue;
  }
 else {
    if (hostHeaderValue == null) {
      throw new IllegalArgumentException("Missing 'host' header");
    }
 else {
      return hostHeaderValue;
    }
  }
}
