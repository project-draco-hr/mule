{
  final HttpRequest request=requestContext.getRequest();
  final Collection<String> headerNames=request.getHeaderNames();
  Map<String,Serializable> inboundProperties=new HashMap<>();
  Map<String,Serializable> outboundProperties=new HashMap<>();
  for (  String headerName : headerNames) {
    final Collection<String> values=request.getHeaderValues(headerName);
    if (values.size() == 1) {
      inboundProperties.put(headerName,values.iterator().next());
    }
 else {
      inboundProperties.put(headerName,new ArrayList<>(values));
    }
  }
  new HttpMessagePropertiesResolver().setMethod(request.getMethod()).setProtocol(request.getProtocol().asString()).setUri(request.getUri()).setListenerPath(listenerPath).setRemoteHostAddress(resolveRemoteHostAddress(requestContext)).setScheme(requestContext.getScheme()).setClientCertificate(requestContext.getClientConnection().getClientCertificate()).addPropertiesTo(inboundProperties);
  final Map<String,DataHandler> inboundAttachments=new HashMap<>();
  Object payload=NullPayload.getInstance();
  final DataType dataType=buildContentTypeDataType(request.getHeaderValueIgnoreCase(CONTENT_TYPE),getDefaultEncoding(muleContext));
  DataTypeBuilder dataTypeBuilder=DataType.builder(dataType);
  if (parseRequest) {
    final HttpEntity entity=request.getEntity();
    if (entity != null && !(entity instanceof EmptyHttpEntity)) {
      if (entity instanceof MultipartHttpEntity) {
        inboundAttachments.putAll(createDataHandlerFrom(((MultipartHttpEntity)entity).getParts()));
      }
 else {
        if (dataType.getMediaType() != null) {
          if (dataType.getMediaType().matches(HttpHeaders.Values.APPLICATION_X_WWW_FORM_URLENCODED)) {
            try {
              payload=decodeUrlEncodedBody(IOUtils.toString(((InputStreamHttpEntity)entity).getInputStream()),dataType.getMediaType().getCharset().get());
              dataTypeBuilder.type(ParameterMap.class);
            }
 catch (            IllegalArgumentException e) {
              throw new HttpRequestParsingException("Cannot decode x-www-form-urlencoded payload",e);
            }
          }
 else           if (entity instanceof InputStreamHttpEntity) {
            payload=((InputStreamHttpEntity)entity).getInputStream();
            dataTypeBuilder.type(InputStream.class);
          }
        }
 else         if (entity instanceof InputStreamHttpEntity) {
          payload=((InputStreamHttpEntity)entity).getInputStream();
          dataTypeBuilder.type(InputStream.class);
        }
      }
    }
  }
 else {
    final InputStreamHttpEntity inputStreamEntity=request.getInputStreamEntity();
    if (inputStreamEntity != null) {
      payload=inputStreamEntity.getInputStream();
      dataTypeBuilder.type(InputStream.class);
    }
  }
  final DefaultMuleMessage defaultMuleMessage=new DefaultMuleMessage(payload,inboundProperties,outboundProperties,inboundAttachments,dataTypeBuilder.build());
  return new DefaultMuleEvent(defaultMuleMessage,resolveUri(requestContext),REQUEST_RESPONSE,flowConstruct,new DefaultMuleSession());
}
