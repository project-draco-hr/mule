{
  String serviceFinderClass=null;
  if (overrides != null) {
    serviceFinderClass=(String)props.remove(MuleProperties.SERVICE_FINDER);
  }
  ServiceDescriptor sd;
  if (type.equals(PROVIDER_SERVICE_TYPE)) {
    sd=new DefaultTransportServiceDescriptor(name,props);
    props=SpiUtils.findServiceDescriptor(EXCEPTION_SERVICE_TYPE,name + "-exception-mappings");
    ((TransportServiceDescriptor)sd).setExceptionMappings(props);
  }
 else   if (type.equals(MODEL_SERVICE_TYPE)) {
    sd=new DefaultModelServiceDescriptor(name,props);
  }
 else {
    throw new ServiceException(Message.createStaticMessage("Unrecognized service type: " + type));
  }
  sd.setOverrides(overrides);
  if (StringUtils.isNotBlank(serviceFinderClass)) {
    ServiceFinder finder;
    try {
      finder=(ServiceFinder)ClassUtils.instanciateClass(serviceFinderClass,ClassUtils.NO_ARGS);
    }
 catch (    Exception e) {
      throw new ServiceException(new Message(Messages.CANT_INSTANCIATE_FINDER_X,serviceFinderClass),e);
    }
    String realService=finder.findService(name,sd,props);
    if (realService != null) {
      return MuleManager.getInstance().lookupServiceDescriptor(ServiceDescriptorFactory.PROVIDER_SERVICE_TYPE,realService,overrides);
    }
 else {
      throw new ServiceException(Message.createStaticMessage("ServiceFinder unable to locate the real service."));
    }
  }
  return sd;
}
