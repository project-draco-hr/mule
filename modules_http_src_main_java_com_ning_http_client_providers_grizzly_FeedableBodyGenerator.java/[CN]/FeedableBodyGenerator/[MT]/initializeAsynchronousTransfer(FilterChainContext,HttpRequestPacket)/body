{
  if (asyncTransferInitiated) {
    throw new IllegalStateException("Async transfer has already been initiated.");
  }
  if (feeder == null) {
    throw new IllegalStateException("No feeder available to perform the transfer.");
  }
  assert(context != null);
  assert(requestPacket != null);
  this.requestPacket=requestPacket;
  this.contentBuilder=HttpContent.builder(requestPacket);
  final Connection c=context.getConnection();
  origMaxPendingBytes=c.getMaxAsyncWriteQueueSize();
  if (configuredMaxPendingBytes != DEFAULT) {
    c.setMaxAsyncWriteQueueSize(configuredMaxPendingBytes);
  }
  this.context=context;
  asyncTransferInitiated=true;
  if (requestPacket.isSecure() && (getSSLEngine(context.getConnection()) == null)) {
    flushOnSSLHandshakeComplete();
  }
 else {
    feederFlush(context.getConnection());
  }
}
