{
  if (channel.isClosed()) {
    throw new MessagingException("Channel is closed");
  }
  MessageExchange me;
  if (IN_ONLY_PATTERN.equals(pattern)) {
    me=new InOnlyImpl();
  }
 else   if (IN_OPTIONAL_OUT_PATTERN.equals(pattern)) {
    me=new InOptionalOutImpl();
  }
 else   if (IN_OUT_PATTERN.equals(pattern)) {
    me=new InOutImpl();
  }
 else   if (ROBUST_IN_ONLY_PATTERN.equals(pattern)) {
    me=new RobustInOnlyImpl();
  }
 else {
    throw new MessagingException("Unsupported pattern");
  }
  init(me);
  return me;
}
