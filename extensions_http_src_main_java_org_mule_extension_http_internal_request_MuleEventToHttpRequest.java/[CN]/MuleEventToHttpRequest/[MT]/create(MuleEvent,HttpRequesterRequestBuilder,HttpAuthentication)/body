{
  HttpRequestBuilder builder=new HttpRequestBuilder();
  builder.setUri(this.uri);
  builder.setMethod(this.method);
  builder.setHeaders(toParameterMap(requestBuilder.getHeaders()));
  builder.setQueryParams(toParameterMap(requestBuilder.getQueryParams()));
  if (!builder.getHeaders().containsKey(MuleProperties.CONTENT_TYPE_PROPERTY)) {
    DataType<?> dataType=event.getMessage().getDataType();
    if (!MimeTypes.ANY.equals(dataType.getMimeType())) {
      builder.addHeader(MuleProperties.CONTENT_TYPE_PROPERTY,DataTypeUtils.getContentType(dataType));
    }
  }
  if (config.isEnableCookies()) {
    try {
      Map<String,List<String>> headers=config.getCookieManager().get(URI.create(uri),Collections.<String,List<String>>emptyMap());
      List<String> cookies=headers.get(COOKIE);
      if (cookies != null) {
        for (        String cookie : cookies) {
          builder.addHeader(COOKIE,cookie);
        }
      }
    }
 catch (    IOException e) {
      logger.warn("Error reading cookies for URI " + uri,e);
    }
  }
  builder.setEntity(createRequestEntity(builder,event,this.method,requestBuilder.getParts()));
  if (authentication != null) {
    authentication.authenticate(event,builder);
  }
  return builder.build();
}
