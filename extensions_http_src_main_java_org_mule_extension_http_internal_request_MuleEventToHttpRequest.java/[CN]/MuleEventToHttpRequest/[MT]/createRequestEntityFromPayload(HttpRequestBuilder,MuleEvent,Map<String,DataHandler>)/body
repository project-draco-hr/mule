{
  Object payload=muleEvent.getMessage().getPayload();
  if (!parts.isEmpty()) {
    try {
      return new MultipartHttpEntity(HttpPartDataSource.createFrom(parts));
    }
 catch (    IOException e) {
      throw new MessagingException(muleEvent,e);
    }
  }
  if (doStreaming(requestBuilder,muleEvent)) {
    if (payload instanceof InputStream) {
      return new InputStreamHttpEntity((InputStream)payload);
    }
 else {
      try {
        return new InputStreamHttpEntity(new ByteArrayInputStream(muleEvent.getMessageAsBytes()));
      }
 catch (      Exception e) {
        throw new MessagingException(muleEvent,e);
      }
    }
  }
 else {
    String contentType=requestBuilder.getHeaders().get(CONTENT_TYPE);
    if (contentType == null || contentType.equals(APPLICATION_X_WWW_FORM_URLENCODED.toString())) {
      if (muleEvent.getMessage().getPayload() instanceof Map) {
        String body=HttpParser.encodeString(muleEvent.getMessage().getDataType().getMediaType().getCharset().get(),(Map)payload);
        requestBuilder.addHeader(CONTENT_TYPE,APPLICATION_X_WWW_FORM_URLENCODED.toString());
        return new ByteArrayHttpEntity(body.getBytes());
      }
    }
    try {
      return new ByteArrayHttpEntity(muleEvent.getMessageAsBytes());
    }
 catch (    Exception e) {
      throw new MessagingException(muleEvent,e);
    }
  }
}
