{
  org.mule.runtime.api.metadata.MediaType endpointMimeType=endpoint.getMimeType();
  if (endpointMimeType != null) {
    MuleMessage message=event.getMessage();
    String contentType=message.getInboundProperty(CONTENT_TYPE_PROPERTY);
    if (contentType == null) {
      contentType=message.getOutboundProperty(CONTENT_TYPE_PROPERTY);
    }
    if (contentType == null) {
      event.setMessage(MuleMessage.builder(event.getMessage()).addInboundProperty(CONTENT_TYPE_PROPERTY,endpointMimeType.toRfcString()).build());
    }
 else {
      String messageMimeType=DataType.builder().mediaType(contentType).build().getMediaType().toRfcString();
      if (!messageMimeType.equals(endpointMimeType.toRfcString())) {
        throw new MessagingException(CoreMessages.unexpectedMIMEType(messageMimeType,endpointMimeType.toRfcString()),event,this);
      }
    }
  }
  return event;
}
