{
  MediaType endpointMimeType=endpoint.getMimeType();
  if (endpointMimeType != null) {
    MuleMessage message=event.getMessage();
    final DataType dataType=message.getDataType();
    if (DataType.OBJECT.getMediaType().matches(dataType.getMediaType())) {
      event.setMessage(MuleMessage.builder(event.getMessage()).mediaType(endpointMimeType).build());
    }
 else {
      if (!dataType.getMediaType().matches(endpointMimeType)) {
        throw new MessagingException(CoreMessages.unexpectedMIMEType(dataType.getMediaType().toRfcString(),endpointMimeType.toRfcString()),event,this);
      }
    }
  }
  return event;
}
