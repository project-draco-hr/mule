{
  if (event.getEndpoint().canSend()) {
    try {
      if (logger.isDebugEnabled()) {
        logger.debug("dispatching event: " + event);
      }
      UMOConnector connector=event.getEndpoint().getConnector();
      if (connector instanceof AbstractConnector) {
        ((AbstractConnector)connector).getSessionHandler().storeSessionInfoToMessage(this,event.getMessage());
      }
 else {
        logger.warn("A session handler could not be obtained, using  default");
        new MuleSessionHandler().storeSessionInfoToMessage(this,event.getMessage());
      }
      event.getEndpoint().dispatch(event);
    }
 catch (    Exception e) {
      throw new DispatchException(event.getMessage(),event.getEndpoint(),e);
    }
  }
 else   if (component != null) {
    if (logger.isDebugEnabled()) {
      logger.debug("dispatching event to component: " + component.getDescriptor().getName() + ", event is: "+ event);
    }
    component.dispatchEvent(event);
    UMOMessage response=OptimizedRequestContext.criticalWriteResponse(event.getMessage());
    processResponse(response);
  }
 else {
    throw new DispatchException(CoreMessages.noComponentForEndpoint(),event.getMessage(),event.getEndpoint());
  }
}
