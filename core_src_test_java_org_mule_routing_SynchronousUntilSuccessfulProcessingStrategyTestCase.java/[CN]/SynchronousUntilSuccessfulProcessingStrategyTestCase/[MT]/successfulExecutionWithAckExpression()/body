{
  String ackExpression="some-expression";
  String expressionEvalutaionResult="new payload";
  when(mockUntilSuccessfulConfiguration.getAckExpression()).thenReturn(ackExpression);
  when(mockUntilSuccessfulConfiguration.getMuleContext().getExpressionManager().evaluate(ackExpression,mockEvent)).thenReturn(expressionEvalutaionResult);
  SynchronousUntilSuccessfulProcessingStrategy processingStrategy=createProcessingStrategy();
  when(mockRoute.process(mockEvent)).thenReturn(mockEvent);
  assertThat(processingStrategy.route(mockEvent),is(mockEvent));
  verify(mockRoute,times(1)).process(mockEvent);
  verify(mockUntilSuccessfulConfiguration.getMuleContext().getExpressionManager(),times(1)).evaluate(ackExpression,mockEvent);
  verify(mockEvent.getMessage(),times(1)).setPayload(expressionEvalutaionResult);
}
