{
  String newDirAbs=endpoint.getEndpointURI().getPath() + "/" + newDir;
  String currDir=currentDirectory;
  if (logger.isDebugEnabled()) {
    logger.debug("CHANGE DIR FROM " + currentDirectory + " TO "+ newDirAbs);
  }
synchronized (lock) {
    try {
      changeWorkingDirectory(newDirAbs);
    }
 catch (    IOException e) {
      logger.info("Got an exception when trying to change the working directory to the new dir. " + "Will try to create the directory " + newDirAbs);
      changeWorkingDirectory(endpoint.getEndpointURI().getPath());
      mkdir(newDir);
      changeWorkingDirectory(newDirAbs);
    }
 finally {
      changeWorkingDirectory(currDir);
      if (logger.isDebugEnabled()) {
        logger.debug("DIR IS NOW BACK TO " + currentDirectory);
      }
    }
  }
}
