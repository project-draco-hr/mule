{
  int fileIdx=1;
  String filename;
  String fileType;
  int fileTypeIdx=path.lastIndexOf('.');
  if (fileTypeIdx == -1) {
    filename=path;
    fileType="";
  }
 else {
    fileType=path.substring(fileTypeIdx);
    filename=path.substring(0,fileTypeIdx);
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Create a unique name for: " + path + " ("+ dir+ " - "+ filename+ " - "+ fileType+ ")");
  }
  String uniqueFilename=filename;
  String[] existingFiles=listFiles(getAbsolutePath(dir));
  while (existsFile(existingFiles,uniqueFilename,fileType)) {
    uniqueFilename=filename + '_' + fileIdx++;
  }
  uniqueFilename=uniqueFilename + fileType;
  if (!path.equals(uniqueFilename) && logger.isInfoEnabled()) {
    logger.info("A file with the original filename (" + dir + "/"+ path+ ") already exists, new name: "+ uniqueFilename);
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Unique name returned: " + uniqueFilename);
  }
  return uniqueFilename;
}
