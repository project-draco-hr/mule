{
  try {
    @SuppressWarnings("unchecked") Vector<String> vv=channelSftp.ls(path);
    if (vv != null) {
      List<String> ret=new ArrayList<String>();
      for (int i=0; i < vv.size(); i++) {
        Object obj=vv.elementAt(i);
        if (obj instanceof com.jcraft.jsch.ChannelSftp.LsEntry) {
          LsEntry entry=(LsEntry)obj;
          if (includeFiles && !entry.getAttrs().isDir()) {
            ret.add(entry.getFilename());
          }
          if (includeDirectories && entry.getAttrs().isDir()) {
            if (!entry.getFilename().equals(".") && !entry.getFilename().equals("..")) {
              ret.add(entry.getFilename());
            }
          }
        }
      }
      return ret.toArray(new String[ret.size()]);
    }
  }
 catch (  SftpException e) {
    throw new IOException(e.getMessage());
  }
  return null;
}
