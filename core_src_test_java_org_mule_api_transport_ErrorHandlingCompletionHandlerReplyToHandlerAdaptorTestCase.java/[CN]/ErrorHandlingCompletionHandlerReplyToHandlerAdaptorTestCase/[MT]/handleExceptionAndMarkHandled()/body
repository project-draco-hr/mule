{
  SensingNullCompletionHandler completionHandler=new SensingNullCompletionHandler();
  ErrorHandlingCompletionHandlerReplyToHandlerAdaptor replyToHandler=new ErrorHandlingCompletionHandlerReplyToHandlerAdaptor(completionHandler,messagingExceptionHandler);
  MessagingException messagingException=new MessagingException(sourceEvent,new RuntimeException());
  when(messagingExceptionHandler.handleException(messagingException,sourceEvent)).thenAnswer(new Answer<MuleEvent>(){
    @Override public MuleEvent answer(    InvocationOnMock invocation) throws Throwable {
      ((MessagingException)invocation.getArguments()[0]).setHandled(true);
      return handledEvent;
    }
  }
);
  replyToHandler.processExceptionReplyTo(sourceEvent,messagingException,null);
  verify(messagingExceptionHandler,Mockito.times(1)).handleException(messagingException,sourceEvent);
  assertThat(completionHandler.exception,nullValue());
  assertThat(completionHandler.event,equalTo(handledEvent));
}
