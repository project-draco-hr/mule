{
  SensingNullCompletionHandler completionHandler=new SensingNullCompletionHandler();
  ErrorHandlingCompletionHandlerReplyToHandlerAdaptor replyToHandler=new ErrorHandlingCompletionHandlerReplyToHandlerAdaptor(completionHandler,messagingExceptionHandler);
  MessagingException messagingException=new MessagingException(sourceEvent,new RuntimeException());
  when(messagingExceptionHandler.handleException(messagingException,sourceEvent)).thenAnswer(new Answer<MuleEvent>(){
    @Override public MuleEvent answer(    InvocationOnMock invocation) throws Throwable {
      return handledEvent;
    }
  }
);
  replyToHandler.processExceptionReplyTo(sourceEvent,messagingException,null);
  verify(messagingExceptionHandler,Mockito.times(1)).handleException(messagingException,sourceEvent);
  assertThat(completionHandler.exception,CoreMatchers.<Exception>equalTo(messagingException));
  assertThat(((MessagingException)completionHandler.exception).getEvent(),equalTo(handledEvent));
  assertThat(completionHandler.event,nullValue());
}
