{
  Event event;
  MuleSession session=connector.getSessionHandler().retrieveSessionInfoFromMessage(message,flowConstruct.getMuleContext());
  if (session == null) {
    session=new DefaultMuleSession();
  }
  final Object replyToFromMessage=getReplyToDestination(message);
  final EventContext executionContext=create(flowConstruct,getEndpoint().getAddress(),message.getCorrelationId());
  final Builder builder=Event.builder(executionContext).message(message).flow(flowConstruct).session(session);
  if (replyToFromMessage != null) {
    builder.replyToHandler(replyToHandler).replyToDestination(replyToFromMessage);
  }
  configureMuleEventBuilder(builder);
  if (message.getCorrelationId() != null) {
    builder.correlationId(message.getCorrelationId());
  }
  builder.groupCorrelation(message.getCorrelation());
  Event newEvent=builder.build();
  newEvent=populateFieldsFromInboundEndpoint(newEvent,getEndpoint());
  event=newEvent;
  setCurrentEvent(event);
  if (session.getSecurityContext() != null && session.getSecurityContext().getAuthentication() != null) {
    session.getSecurityContext().getAuthentication().setEvent(event);
  }
  return event;
}
