{
  SaveCertificateCallback callback=(SaveCertificateCallback)muleContext.getRegistry().lookupObject("certificates");
  MuleClient client=new MuleClient();
  for (int i=0; i < n; ++i) {
    callback.clear();
    String msg=TEST_MESSAGE + n;
    MuleMessage result=client.send("in",msg,null);
    assertTrue(callback.isCalled());
    assertNotNull("Null certificates",callback.getCertificates());
    assertEquals(FunctionalTestComponent.received(msg),result.getPayloadAsString());
  }
}
