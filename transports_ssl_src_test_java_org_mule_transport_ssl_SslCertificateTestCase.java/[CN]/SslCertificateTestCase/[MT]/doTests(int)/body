{
  SaveCertificateCallback callback=(SaveCertificateCallback)muleContext.getRegistry().lookupObject("certificates");
  callback.clear();
  MuleClient client=new MuleClient();
  for (int i=0; i < n; ++i) {
    MuleMessage result=client.send("in",TEST_MESSAGE,null);
    assertEquals(FunctionalTestComponent.received(TEST_MESSAGE),result.getPayloadAsString());
  }
  List certificates=callback.getCertificates();
  assertEquals(n,certificates.size());
  for (Iterator certs=certificates.iterator(); certs.hasNext(); ) {
    assertNotNull("Null certificate",certs.next());
  }
}
