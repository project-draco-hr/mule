{
  final ServiceProviderResolutionHelper providerResolutionHelper=mock(ServiceProviderResolutionHelper.class,RETURNS_DEEP_STUBS);
  when(providerResolutionHelper.findServiceDependencies(fooServiceProvider)).thenReturn(singletonList(BarService.class));
  final ReflectionServiceResolver dependencyResolver=new ReflectionServiceResolver(providerResolutionHelper);
  final List<Service> services=dependencyResolver.resolveServices(serviceProviders);
  assertThat(services.size(),equalTo(2));
  assertThat(services.get(0),is(barService));
  assertThat(services.get(1),is(fooService));
  verify(providerResolutionHelper).injectInstance(same(fooServiceProvider),anyCollection());
}
