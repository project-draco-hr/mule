{
  MuleMessage message=mock(MuleMessage.class);
  MuleMessage transformedMessage=mock(MuleMessage.class);
  when(transformedMessage.getPayload()).thenReturn(payload);
  TransformationService transformationService=mock(TransformationService.class);
  when(muleContext.getTransformationService()).thenReturn(transformationService);
  when(transformationService.transform(any(MuleMessage.class),any(DataType.class))).thenReturn(transformedMessage);
  context.addFinalVariable("message",new MessageContext(message,muleContext));
}
