{
  ExpressionManager expressionManager=event.getMuleContext().getExpressionManager();
  if (expressionManager.isExpression(value) && expressionManager.isValidExpression(value)) {
    Object evaluated=expressionManager.evaluate(value,event);
    if (!(evaluated instanceof Serializable)) {
      throw new IllegalArgumentException("Expression " + value + " resolves to an object that is not serializable. It can't be used as watermark.");
    }
    return (Serializable)evaluated;
  }
  return value;
}
