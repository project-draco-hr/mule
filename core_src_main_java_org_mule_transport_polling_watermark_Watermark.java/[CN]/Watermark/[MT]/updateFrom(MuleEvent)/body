{
  String resolvedVariable=resolveVariable(event);
  Object watermarkValue=StringUtils.isEmpty(updateExpression) ? event.getFlowVariable(resolvedVariable) : evaluate(updateExpression,event);
  if (watermarkValue == null) {
    logger.warn(CoreMessages.nullWatermark());
  }
 else   if (watermarkValue instanceof Serializable) {
synchronized (objectStore) {
      if (objectStore.contains(resolvedVariable)) {
        objectStore.remove(resolvedVariable);
      }
      if (watermarkValue != null) {
        objectStore.store(resolvedVariable,(Serializable)watermarkValue);
      }
    }
  }
 else {
    logger.error(CoreMessages.notSerializableWatermark());
  }
}
