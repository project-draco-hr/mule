{
  TransactionManager transactionManager=(TransactionManager)registryBroker.lookupObject(MuleProperties.OBJECT_TRANSACTION_MANAGER);
  if (transactionManager == null) {
    Collection temp=registryBroker.lookupObjects(TransactionManagerFactory.class);
    if (temp.size() > 0) {
      try {
        transactionManager=(((TransactionManagerFactory)temp.iterator().next()).create());
      }
 catch (      Exception e) {
        throw new MuleRuntimeException(CoreMessages.failedToCreate("transaction manager"),e);
      }
    }
 else {
      temp=registryBroker.lookupObjects(TransactionManager.class);
      if (temp.size() > 0) {
        transactionManager=(((TransactionManager)temp.iterator().next()));
      }
    }
  }
  return transactionManager;
}
