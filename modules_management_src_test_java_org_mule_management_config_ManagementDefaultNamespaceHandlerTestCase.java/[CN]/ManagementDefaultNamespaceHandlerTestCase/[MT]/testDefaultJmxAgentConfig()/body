{
  Agent agent=muleContext.getRegistry().lookupAgent("jmx-agent");
  assertNotNull(agent);
  assertEquals(JmxAgent.class,agent.getClass());
  JmxAgent jmxAgent=(JmxAgent)agent;
  assertEquals(true,jmxAgent.isCreateServer());
  assertEquals(true,jmxAgent.isLocateServer());
  assertEquals(true,jmxAgent.isEnableStatistics());
  MBeanServer mBeanServer=jmxAgent.getMBeanServer();
  String domainName=jmxAgent.getJmxSupportFactory().getJmxSupport().getDomainName(muleContext);
  Collection beans=mBeanServer.queryMBeans(ObjectName.getInstance(domainName + ":*"),null);
  String message=domainName + ": " + beans.toString();
  assertEquals(message,6,beans.size());
  agent=muleContext.getRegistry().lookupAgent("jmx-log4j");
  assertNotNull(agent);
  assertEquals(Log4jAgent.class,agent.getClass());
  agent=muleContext.getRegistry().lookupAgent(JmxServerNotificationAgent.DEFAULT_AGENT_NAME);
  assertNotNull(agent);
  assertEquals(JmxServerNotificationAgent.class,agent.getClass());
  agent=muleContext.getRegistry().lookupAgent("jmx-default-config");
  muleContext.dispose();
  assertEquals(0,mBeanServer.queryMBeans(ObjectName.getInstance(domainName + ":*"),null).size());
}
