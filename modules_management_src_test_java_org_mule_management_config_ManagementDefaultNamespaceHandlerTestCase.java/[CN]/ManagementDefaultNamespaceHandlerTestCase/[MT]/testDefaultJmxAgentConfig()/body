{
  UMOAgent agent=muleContext.getRegistry().lookupAgent("JMX Agent");
  assertNotNull(agent);
  assertEquals(JmxAgent.class,agent.getClass());
  JmxAgent jmxAgent=(JmxAgent)agent;
  assertEquals(true,jmxAgent.isCreateServer());
  assertEquals(true,jmxAgent.isLocateServer());
  assertEquals(true,jmxAgent.isEnableStatistics());
  MBeanServer mBeanServer=jmxAgent.getMBeanServer();
  String domainName=jmxAgent.getJmxSupportFactory().getJmxSupport().getDomainName(muleContext);
  assertEquals(6,mBeanServer.queryMBeans(ObjectName.getInstance(domainName + ":*"),null).size());
  agent=muleContext.getRegistry().lookupAgent("Log4j JMX Agent");
  assertNotNull(agent);
  assertEquals(Log4jAgent.class,agent.getClass());
  agent=muleContext.getRegistry().lookupAgent(JmxServerNotificationAgent.DEFAULT_AGENT_NAME);
  assertNotNull(agent);
  assertEquals(JmxServerNotificationAgent.class,agent.getClass());
  agent=muleContext.getRegistry().lookupAgent("Default Jmx Agent Support");
  assertNull(agent);
  muleContext.dispose();
  assertEquals(0,mBeanServer.queryMBeans(ObjectName.getInstance(domainName + ":*"),null).size());
}
