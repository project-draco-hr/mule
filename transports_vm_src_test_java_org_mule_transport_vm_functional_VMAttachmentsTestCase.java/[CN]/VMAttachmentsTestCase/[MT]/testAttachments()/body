{
  DefaultMuleMessage msg=new DefaultMuleMessage("Mmm... attachments!");
  FileDataSource ds=new FileDataSource(new File("transports/vm/src/test/resources/" + getConfigResources()).getAbsoluteFile());
  msg.addAttachment("test-attachment",new DataHandler(ds));
  MuleClient client=new MuleClient();
  MuleMessage reply=client.send("vm-in",msg);
  assertNotNull(reply);
  if (reply.getExceptionPayload() != null) {
    fail(reply.getExceptionPayload().getException().getCause().toString());
  }
  assertEquals(1,reply.getAttachmentNames().size());
  assertNotNull(reply.getAttachment("mule"));
  assertTrue(reply.getAttachment("mule").getContentType().startsWith("image/gif"));
}
