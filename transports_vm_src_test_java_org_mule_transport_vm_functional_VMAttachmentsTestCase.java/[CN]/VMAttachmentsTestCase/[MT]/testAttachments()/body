{
  DefaultMuleMessage msg=new DefaultMuleMessage("Mmm... attachments!",muleContext);
  FileDataSource ds=new FileDataSource(new File("transports/vm/src/test/resources/" + getConfigResources()).getAbsoluteFile());
  msg.addOutboundAttachment("test-attachment",new DataHandler(ds));
  MuleClient client=new MuleClient(muleContext);
  MuleMessage reply=client.send("vm-in",msg);
  assertNotNull(reply);
  if (reply.getExceptionPayload() != null) {
    fail(reply.getExceptionPayload().getException().getCause().toString());
  }
  assertEquals(1,reply.getInboundAttachmentNames().size());
  assertNotNull(reply.getInboundAttachment("mule"));
  assertTrue(reply.getInboundAttachment("mule").getContentType().startsWith("image/gif"));
}
