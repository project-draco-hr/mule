{
  DefaultMuleMessage m=new DefaultMuleMessage("Mmm... attachments!");
  FileDataSource ds=new FileDataSource(new File("transports/vm/src/test/resources/" + getConfigResources()).getAbsoluteFile());
  m.addAttachment("test-attachment",new DataHandler(ds));
  MuleClient client=new MuleClient();
  MuleMessage msg=client.send("vm-in",m);
  assertNotNull(msg);
  if (msg.getExceptionPayload() != null) {
    fail(msg.getExceptionPayload().getException().getCause().toString());
  }
  assertEquals(1,msg.getAttachmentNames().size());
  assertNotNull(msg.getAttachment("mule"));
  assertTrue(msg.getAttachment("mule").getContentType().startsWith("image/gif"));
}
