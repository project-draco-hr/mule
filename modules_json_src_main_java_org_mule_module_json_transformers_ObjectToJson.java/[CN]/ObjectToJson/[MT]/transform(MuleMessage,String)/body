{
  Object src=message.getPayload();
  if (message.getExceptionPayload() != null && this.isHandleException()) {
    if (logger.isDebugEnabled()) {
      logger.debug("Found exception with null payload");
    }
    src=this.getException(message.getExceptionPayload().getException());
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Converting payload " + src + " to "+ String.class);
  }
  String returnValue;
  Class et=getJsonConfig().getEnclosedType();
  try {
    if (et == null) {
      getJsonConfig().setEnclosedType(src.getClass());
    }
    returnValue=JsonUtils.convertJavaObjectToJson(src,getJsonConfig());
  }
  finally {
    if (et == null) {
      getJsonConfig().setEnclosedType(null);
    }
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Successfully converted to value: " + returnValue);
  }
  return returnValue;
}
