{
  Object src=message.getPayload();
  if (src instanceof String && isJsonFilter.accept(src)) {
    return src;
  }
  if (message.getExceptionPayload() != null && this.isHandleException()) {
    if (logger.isDebugEnabled()) {
      logger.debug("Found exception with null payload");
    }
    src=this.getException(message.getExceptionPayload().getException());
  }
  StringWriter writer=new StringWriter();
  try {
    getMapper().writeValue(writer,src);
  }
 catch (  IOException e) {
    throw new TransformerException(this,e);
  }
  if (returnType.getType().equals(byte[].class)) {
    try {
      return writer.toString().getBytes(outputEncoding);
    }
 catch (    UnsupportedEncodingException uee) {
      throw new TransformerException(this,uee);
    }
  }
 else {
    return writer.toString();
  }
}
