{
  Object src=message.getPayload();
  if (src instanceof String) {
    if (isJsonFilter.accept(src)) {
      return src;
    }
 else {
      throw new TransformerException(JsonMessages.messageStringIsNotJson(),this);
    }
  }
  if (message.getExceptionPayload() != null && this.isHandleException()) {
    if (logger.isDebugEnabled()) {
      logger.debug("Found exception with null payload");
    }
    src=this.getException(message.getExceptionPayload().getException());
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  try {
    getMapper().writeValue(baos,src);
  }
 catch (  IOException e) {
    throw new TransformerException(this,e);
  }
  if (returnType.equals(byte[].class)) {
    return baos.toByteArray();
  }
 else {
    return baos.toString();
  }
}
