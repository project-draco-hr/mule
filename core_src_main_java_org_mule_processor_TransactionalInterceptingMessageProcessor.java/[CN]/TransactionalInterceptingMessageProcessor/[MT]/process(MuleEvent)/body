{
  if (next == null) {
    return event;
  }
 else {
    TransactionTemplate<MuleEvent> tt=new TransactionTemplate<MuleEvent>(transactionConfig,event.getMuleContext());
    TransactionCallback<MuleEvent> cb=new TransactionCallback<MuleEvent>(){
      public MuleEvent doInTransaction() throws Exception {
        return next.process(event);
      }
    }
;
    try {
      return tt.execute(cb);
    }
 catch (    MessagingException e) {
      throw e;
    }
catch (    Exception e) {
      throw new MessagingException(CoreMessages.errorInvokingMessageProcessorWithinTransaction(next,transactionConfig),event,e);
    }
  }
}
