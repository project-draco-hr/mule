{
  final CountDownLatch exceptionLatch=new CountDownLatch(1);
  send(scenarioCommit);
  TestExceptionStrategy exceptionStrategy=(TestExceptionStrategy)muleContext.getRegistry().lookupService(serviceName).getExceptionListener();
  exceptionStrategy.setExceptionCallback(new ExceptionCallback(){
    public void onException(    Throwable t){
      assertTrue(t.getCause().getCause() instanceof org.mule.transaction.IllegalTransactionStateException);
      assertEquals(1,exceptionLatch.getCount());
      exceptionLatch.countDown();
    }
  }
);
  assertTrue(exceptionLatch.await(10,TimeUnit.SECONDS));
  receive(scenarioNotReceive);
}
