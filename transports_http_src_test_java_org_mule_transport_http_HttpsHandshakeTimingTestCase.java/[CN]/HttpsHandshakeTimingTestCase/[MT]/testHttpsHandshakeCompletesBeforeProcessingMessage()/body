{
  MockHttpsMessageReceiver messageReceiver=setupMockHttpsMessageReceiver();
  MockSslSocket socket=new MockSslSocket();
  socket.setInputStream(new ByteArrayInputStream("GET /path/to/file/index.html HTTP/1.0\n\n\n".getBytes()));
  HttpServerConnection serverConnection=new HttpServerConnection(socket,"utf-8",(HttpConnector)messageReceiver.getConnector());
  HttpMessageProcessTemplate messageContext=messageReceiver.createMessageContext(serverConnection);
  invokeHandshakeCompleted(serverConnection,socket);
  MuleMessage message=new DefaultMuleMessage(TEST_MESSAGE,muleContext);
  messageContext.acquireMessage();
  serverConnection.readRequest();
  MuleEvent muleEvent=messageContext.beforeRouteEvent(getTestEvent(message));
  assertNotNull(muleEvent.getMessage().<Object>getOutboundProperty(HttpsConnector.LOCAL_CERTIFICATES));
  assertNotNull(muleEvent.getMessage().<Object>getOutboundProperty(HttpsConnector.PEER_CERTIFICATES));
}
