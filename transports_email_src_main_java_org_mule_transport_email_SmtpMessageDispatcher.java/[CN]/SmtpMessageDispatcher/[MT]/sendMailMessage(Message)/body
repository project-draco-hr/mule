{
  message.setSentDate(Calendar.getInstance().getTime());
  if (!transport.isConnected()) {
    EndpointURI uri=endpoint.getEndpointURI();
    if (logger.isInfoEnabled()) {
      logger.info("Connection closed by remote server. Reconnecting.");
    }
    transport.connect(uri.getHost(),uri.getPort(),uri.getUser(),uri.getPassword());
  }
  transport.sendMessage(message,message.getAllRecipients());
  if (logger.isDebugEnabled()) {
    StringBuffer msg=new StringBuffer();
    msg.append("Email message sent with subject'").append(message.getSubject()).append("' sent- ");
    msg.append(", From: ").append(MailUtils.mailAddressesToString(message.getFrom())).append(" ");
    msg.append(", To: ").append(MailUtils.mailAddressesToString(message.getRecipients(Message.RecipientType.TO))).append(" ");
    msg.append(", Cc: ").append(MailUtils.mailAddressesToString(message.getRecipients(Message.RecipientType.CC))).append(" ");
    msg.append(", Bcc: ").append(MailUtils.mailAddressesToString(message.getRecipients(Message.RecipientType.BCC))).append(" ");
    msg.append(", ReplyTo: ").append(MailUtils.mailAddressesToString(message.getReplyTo()));
    logger.debug(msg.toString());
  }
}
