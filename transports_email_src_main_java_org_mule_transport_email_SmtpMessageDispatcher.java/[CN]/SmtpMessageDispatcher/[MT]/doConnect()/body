{
  if (transport == null) {
    try {
      transport=castConnector().getSessionDetails(endpoint).newTransport();
      EndpointURI uri=endpoint.getEndpointURI();
      String encoding=endpoint.getEncoding();
      String user=(uri.getUser() != null ? URLDecoder.decode(uri.getUser(),encoding) : null);
      String pass=(uri.getPassword() != null ? URLDecoder.decode(uri.getPassword(),encoding) : null);
      transport.connect(uri.getHost(),uri.getPort(),user,pass);
    }
 catch (    Exception e) {
      throw new EndpointException(MessageFactory.createStaticMessage("Unable to connect to mail transport."),e);
    }
  }
}
