{
  if (transport == null) {
    try {
      transport=castConnector().getSessionDetails(endpoint).newTransport();
      EndpointURI uri=endpoint.getEndpointURI();
      String user=(uri.getUser() != null ? URLDecoder.decode(uri.getUser()) : null);
      String pass=(uri.getPassword() != null ? URLDecoder.decode(uri.getPassword()) : null);
      transport.connect(uri.getHost(),uri.getPort(),user,pass);
    }
 catch (    Exception e) {
      throw new EndpointException(org.mule.config.i18n.MessageFactory.createStaticMessage("Unable to connect to mail transport."),e);
    }
  }
}
