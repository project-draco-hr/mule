{
  try {
    Object payload=message.getPayload();
    if (!(payload instanceof Node || payload instanceof org.dom4j.Node)) {
      payload=message.getPayload(DataTypeFactory.create(Document.class));
    }
    List<?> result;
    XPath xpath=getXPath(expression,payload);
synchronized (xpath) {
      result=xpath.selectNodes(payload);
    }
    result=extractResultsFromNodes(result);
    if (result.size() == 1) {
      return result.get(0);
    }
 else     if (result.size() == 0) {
      return null;
    }
 else {
      return result;
    }
  }
 catch (  Exception e) {
    throw new MuleRuntimeException(XmlMessages.failedToProcessXPath(expression),e);
  }
}
