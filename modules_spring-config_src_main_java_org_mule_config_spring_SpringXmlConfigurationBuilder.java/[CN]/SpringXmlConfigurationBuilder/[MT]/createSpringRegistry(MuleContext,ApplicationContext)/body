{
  if (parentContext != null) {
    if (applicationContext instanceof ConfigurableApplicationContext) {
      registry=new SpringRegistry((ConfigurableApplicationContext)applicationContext,parentContext,muleContext);
    }
 else {
      throw new ConfigurationException(MessageFactory.createStaticMessage("Cannot set a parent context if the ApplicationContext does not implement ConfigurableApplicationContext"));
    }
  }
 else {
    registry=new SpringRegistry(applicationContext,muleContext);
  }
  muleContext.addRegistry(registry);
  registry.initialise();
}
