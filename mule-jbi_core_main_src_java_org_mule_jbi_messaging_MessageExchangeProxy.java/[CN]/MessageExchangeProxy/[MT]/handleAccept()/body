{
  ExchangeStatus status=getStatus();
  if (status == ExchangeStatus.ACTIVE) {
    this.state=this.states[this.state][STATES_NEXT_MSG];
  }
 else   if (status == ExchangeStatus.ERROR) {
    this.state=this.states[this.state][STATES_NEXT_ERROR];
  }
 else   if (status == ExchangeStatus.DONE) {
    this.state=this.states[this.state][STATES_NEXT_DONE];
  }
 else {
    throw new IllegalStateException("unknown status");
  }
  if (this.state < 0 || this.state >= this.states.length) {
    throw new IllegalStateException("next state is illegal");
  }
}
