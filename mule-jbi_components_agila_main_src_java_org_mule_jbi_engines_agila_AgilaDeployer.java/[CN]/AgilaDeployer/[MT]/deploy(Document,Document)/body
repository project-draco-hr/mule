{
  try {
    log.debug("begin transaction");
    TransactionManager.beginTransaction();
    Element processElement=processDoc.getRootElement();
    log.debug("<process>");
    AgilaProcess tp=deployProcessElement(processElement);
    Document defDoc=definitionDoc;
    deployDefinitions(defDoc,tp);
    deployVariables(processElement.element("variables"),tp);
    deployCorrelationSets(processElement.element("correlationSets"),tp);
    deployActivity(processElement,tp);
    log.debug("</process> ");
    saveProcess(processDoc,definitionDoc,tp.getNamespace() + tp.getName());
    log.debug("commit transaction");
    TransactionManager.commitTransaction();
  }
 catch (  Throwable e) {
    try {
      TransactionManager.rollbackTransaction();
    }
 catch (    TransactionException e1) {
      throw new DeploymentException("Could not rollback transaction.",e);
    }
    throw new DeploymentException(e);
  }
}
