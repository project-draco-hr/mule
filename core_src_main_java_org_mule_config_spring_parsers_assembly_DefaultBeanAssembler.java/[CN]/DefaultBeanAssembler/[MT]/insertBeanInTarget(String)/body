{
  logger.debug("insert " + bean.getBeanDefinition().getBeanClassName() + " -> "+ target.getBeanClassName());
  assertTargetPresent();
  String beanClass=bean.getBeanDefinition().getBeanClassName();
  PropertyValues sourceProperties=bean.getRawBeanDefinition().getPropertyValues();
  String newName=bestGuessName(targetConfig,oldName,target.getBeanClassName());
  MutablePropertyValues targetProperties=target.getPropertyValues();
  PropertyValue pv=targetProperties.getPropertyValue(newName);
  Object oldValue=null == pv ? null : pv.getValue();
  if (newName.equals("map")) {
    System.out.println("oops");
  }
  if (!targetConfig.isIgnored(oldName)) {
    if (targetConfig.isCollection(oldName) || beanClass.equals(ChildListEntryDefinitionParser.ListEntry.class.getName())) {
      if (null == oldValue) {
        if (beanClass.equals(ChildMapEntryDefinitionParser.KeyValuePair.class.getName()) || beanClass.equals(MapFactoryBean.class.getName())) {
          BeanDefinitionBuilder combiner=BeanDefinitionBuilder.rootBeanDefinition(MapCombiner.class);
          targetProperties.addPropertyValue(newName,combiner.getBeanDefinition());
          MutablePropertyValues combinerProperties=combiner.getBeanDefinition().getPropertyValues();
          oldValue=new ManagedList();
          pv=new PropertyValue(MapCombiner.LIST,oldValue);
          combinerProperties.addPropertyValue(pv);
        }
 else {
          oldValue=new ManagedList();
          pv=new PropertyValue(newName,oldValue);
          targetProperties.addPropertyValue(pv);
        }
      }
      List list;
      if (oldValue instanceof List) {
        list=(List)oldValue;
      }
 else       if (oldValue instanceof BeanDefinition && ((BeanDefinition)oldValue).getBeanClassName().equals(MapCombiner.class.getName())) {
        list=(List)((BeanDefinition)oldValue).getPropertyValues().getPropertyValue(MapCombiner.LIST).getValue();
      }
 else {
        throw new ClassCastException("Collection not of expected type: " + oldValue);
      }
      if (ChildMapEntryDefinitionParser.KeyValuePair.class.getName().equals(beanClass)) {
        if (list.isEmpty()) {
          list.add(new ManagedMap());
        }
        Object obfuscatedMap=list.get(list.size() - 1);
        Map map;
        if (obfuscatedMap instanceof ManagedMap) {
          map=(ManagedMap)obfuscatedMap;
        }
 else         if (obfuscatedMap instanceof BeanDefinition && ((BeanDefinition)obfuscatedMap).getBeanClassName().equals(MapFactoryBean.class.getName())) {
          map=(Map)((BeanDefinition)obfuscatedMap).getPropertyValues().getPropertyValue("sourceMap").getValue();
        }
 else {
          throw new ClassCastException("Map not of expected type: " + obfuscatedMap);
        }
        map.put(sourceProperties.getPropertyValue(ChildMapEntryDefinitionParser.KEY).getValue(),sourceProperties.getPropertyValue(ChildMapEntryDefinitionParser.VALUE).getValue());
      }
 else       if (beanClass.equals(ChildListEntryDefinitionParser.ListEntry.class.getName())) {
        list.add(sourceProperties.getPropertyValue(ChildListEntryDefinitionParser.VALUE).getValue());
      }
 else {
        list.add(bean.getBeanDefinition());
      }
    }
 else {
      if (ChildMapEntryDefinitionParser.KeyValuePair.class.getName().equals(beanClass)) {
        if (null == pv || null == oldValue) {
          pv=new PropertyValue(newName,new ManagedMap());
          targetProperties.addPropertyValue(pv);
        }
        Object obfuscatedMap=pv.getValue();
        Map map;
        if (obfuscatedMap instanceof ManagedMap) {
          map=(ManagedMap)obfuscatedMap;
        }
 else         if (obfuscatedMap instanceof BeanDefinition && ((BeanDefinition)obfuscatedMap).getBeanClassName().equals(MapFactoryBean.class.getName())) {
          map=(Map)((BeanDefinition)obfuscatedMap).getPropertyValues().getPropertyValue("sourceMap").getValue();
        }
 else {
          throw new ClassCastException("Map not of expected type: " + obfuscatedMap);
        }
        map.put(sourceProperties.getPropertyValue(ChildMapEntryDefinitionParser.KEY).getValue(),sourceProperties.getPropertyValue(ChildMapEntryDefinitionParser.VALUE).getValue());
      }
 else {
        targetProperties.addPropertyValue(newName,bean.getBeanDefinition());
      }
    }
  }
}
