{
  Flow flow=(Flow)getFlowConstruct("persistent");
  flow.process(getTestEvent(TEST_MESSAGE));
  ensureConnectionIsOpen();
  new PollingProber().check(new JUnitProbe(){
    @Override public boolean test() throws Exception {
      return isConnectionClosed();
    }
    @Override public String describeFailure(){
      return "Connection should be closed.";
    }
  }
);
}
