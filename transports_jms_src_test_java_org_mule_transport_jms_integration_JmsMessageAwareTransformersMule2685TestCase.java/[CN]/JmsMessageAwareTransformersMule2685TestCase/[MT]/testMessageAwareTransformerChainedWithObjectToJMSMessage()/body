{
  RequestContext.setEvent(getTestEvent("test"));
  MuleMessage message=getTestMuleMessage("This is a test TextMessage");
  SetTestRecipientsTransformer trans=new SetTestRecipientsTransformer();
  MuleMessage result1=(MuleMessage)trans.transform(message);
  assertEquals("vm://recipient1, vm://recipient1, vm://recipient3",result1.getOutboundProperty("recipients"));
  AbstractJmsTransformer trans2=new SessionEnabledObjectToJMSMessage(session);
  Message result2=(Message)trans2.transform(result1);
  assertTrue("Transformed object should be a TextMessage",result2 instanceof TextMessage);
  assertEquals("This is a test TextMessage",((TextMessage)result2).getText());
  assertEquals("vm://recipient1, vm://recipient1, vm://recipient3",result2.getStringProperty("recipients"));
}
