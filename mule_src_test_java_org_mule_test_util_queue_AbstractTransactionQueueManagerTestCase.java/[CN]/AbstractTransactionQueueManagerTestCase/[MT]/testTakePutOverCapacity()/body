{
  final TransactionalQueueManager mgr=createQueueManager();
  mgr.start();
  mgr.setDefaultQueueConfiguration(new QueueConfiguration(2));
  final Latch latch=new Latch();
  Thread t=new Thread(){
    public void run(){
      try {
        latch.await();
        Thread.sleep(200);
        QueueSession s=mgr.getQueueSession();
        Queue q=s.getQueue("queue1");
        Object o=q.take();
        assertEquals("String1",o);
      }
 catch (      Exception e) {
      }
    }
  }
;
  t.start();
  QueueSession s=mgr.getQueueSession();
  Queue q=s.getQueue("queue1");
  assertEquals(0,q.size());
  q.put("String1");
  q.put("String2");
  latch.countDown();
  long t0=System.currentTimeMillis();
  q.put("String3");
  long t1=System.currentTimeMillis();
  t.join();
  assertEquals(2,q.size());
  assertTrue(t1 - t0 > 100);
  mgr.stop(AbstractResourceManager.SHUTDOWN_MODE_NORMAL);
}
