{
  t=sanitize(t);
  StackTraceElement[] trace=t.getStackTrace();
  int newStackDepth=Math.min(trace.length,depth);
  StackTraceElement[] newTrace=new StackTraceElement[newStackDepth];
  System.arraycopy(trace,0,newTrace,0,newStackDepth);
  t.setStackTrace(newTrace);
  return t;
}
