{
  ErrorType errorType;
  Throwable causeException=exception instanceof WrapperErrorMessageAwareException ? ((WrapperErrorMessageAwareException)exception).getRootCause() : exception;
  if (AnnotatedObject.class.isAssignableFrom(messageProcessor.getClass())) {
    ComponentIdentifier componentIdentifier=(ComponentIdentifier)((AnnotatedObject)messageProcessor).getAnnotation(ComponentIdentifier.ANNOTATION_NAME);
    errorType=errorTypeLocator.lookupComponentErrorType(componentIdentifier,causeException);
  }
 else {
    errorType=errorTypeLocator.lookupErrorType(causeException);
  }
  return errorType;
}
