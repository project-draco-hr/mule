{
  Path path=resolvePath(filePath);
  assureParentFolderExists(path,createParentDirectory);
  final OpenOption[] openOptions=getOpenOptions(mode);
  PathLock pathLock=lock ? fileSystem.lock(path,openOptions) : new NullPathLock();
  try (OutputStream out=getOutputStream(path,openOptions,mode)){
    new FileContentWrapper(content,event,muleContext).accept(new FileWriterVisitor(out,event,muleContext));
  }
 catch (  Exception e) {
    throw exception(format("Exception was found writing to file '%s'",path),e);
  }
 finally {
    pathLock.release();
  }
}
