{
  HttpURLConnection connection=(HttpURLConnection)pollUrl.openConnection();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  int len=0;
  int bytesWritten=0;
  int contentLength=connection.getContentLength();
  boolean contentLengthNotSet=false;
  if (contentLength < 0) {
    contentLength=defaultBufferSize;
    contentLengthNotSet=true;
  }
  byte[] buffer=new byte[contentLength];
  InputStream is=connection.getInputStream();
  while (bytesWritten != contentLength) {
    len=is.read(buffer);
    if (len != -1) {
      baos.write(buffer,0,len);
      bytesWritten+=len;
    }
 else {
      if (contentLengthNotSet) {
        contentLength=bytesWritten;
      }
    }
  }
  buffer=baos.toByteArray();
  baos.close();
  UMOMessageAdapter adapter=connector.getMessageAdapter(new Object[]{buffer,connection.getHeaderFields()});
  connection.disconnect();
  UMOMessage message=new MuleMessage(adapter);
  routeMessage(message,endpoint.isSynchronous());
}
