{
  Map<Integer,DbType> paramTypes=new HashMap<Integer,DbType>();
  DatabaseMetaData dbMetaData=connection.getMetaData();
  String storedProcedureName=getStoredProcedureName(dbMetaData,queryTemplate.getSqlText());
  ResultSet procedureColumns=dbMetaData.getProcedureColumns(connection.getCatalog(),null,storedProcedureName,"%");
  int position=1;
  while (procedureColumns.next()) {
    int typeId=procedureColumns.getInt(6);
    String typeName=procedureColumns.getString(7);
    if (logger.isDebugEnabled()) {
      String name=procedureColumns.getString(4);
      logger.debug(String.format("Resolved parameter type: Store procedure: %s Name: %s Index: %s Type ID: %s Type Name: %s",storedProcedureName,name,position,typeId,typeName));
    }
    DbType dbType;
    try {
      dbType=dbTypeManager.get(typeId,typeName);
    }
 catch (    UnknownDbTypeException e) {
      dbType=new ResolvedDbType(typeId,typeName);
    }
    paramTypes.put(position,dbType);
    position++;
  }
  return paramTypes;
}
