{
  ConnectionFactory connectionFactory;
  SimpleConnectionFactory simpleConnectionFactory=new SimpleConnectionFactory();
  if (retryPolicyTemplate == null) {
    connectionFactory=simpleConnectionFactory;
  }
 else {
    connectionFactory=new RetryConnectionFactory(retryPolicyTemplate,new AnnotatedConnectionFactory(name,simpleConnectionFactory,annotations));
  }
  DbTypeManager dbTypeManager=doCreateTypeManager();
  DbConnectionFactory dbConnectionFactory=new TransactionalDbConnectionFactory(new TransactionCoordinationDbTransactionManager(),dbTypeManager,connectionFactory,dataSource);
  return doCreateDbConfig(dataSource,dbTypeManager,dbConnectionFactory,name);
}
