{
  ConnectionFactory connectionFactory;
  if (retryPolicyTemplate == null) {
    connectionFactory=new SimpleConnectionFactory();
  }
 else {
    connectionFactory=new RetryConnectionFactory(retryPolicyTemplate,new SimpleConnectionFactory());
  }
  DbTypeManager dbTypeManager=doCreateTypeManager();
  DbConnectionFactory dbConnectionFactory=new TransactionalDbConnectionFactory(new TransactionCoordinationDbTransactionManager(),dbTypeManager,connectionFactory,dataSource);
  return doCreateDbConfig(dataSource,dbTypeManager,dbConnectionFactory,name);
}
