{
  SaveCertificatesCallback callback=setupEventCallback();
  MuleClient client=muleContext.getClient();
  for (int i=0; i < numberOfMessages; ++i) {
    String msg=TEST_MESSAGE + i;
    MuleMessage result=client.send("in",msg,null);
    assertEquals(msg + " Received",result.getPayloadAsString());
  }
  Iterator<Certificate[]> certificates=callback.getCertificates().iterator();
  for (int i=0; i < numberOfMessages; ++i) {
    assertTrue("No cert at " + i,certificates.hasNext());
    assertNotNull("Null cert at " + i,certificates.next());
  }
}
