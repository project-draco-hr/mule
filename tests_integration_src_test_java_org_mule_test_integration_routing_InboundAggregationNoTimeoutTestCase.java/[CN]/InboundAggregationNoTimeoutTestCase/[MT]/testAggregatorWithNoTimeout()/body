{
  MuleMessage message=new DefaultMuleMessage("test",muleContext);
  MuleClient client=new MuleClient(muleContext);
  client.dispatch("vm://distributor.queue",message);
  MuleMessage result=client.request("vm://results",10000);
  assertNotNull(result);
  assertTrue(result instanceof MuleMessageCollection);
  MuleMessageCollection mc=(MuleMessageCollection)result;
  assertEquals(3,mc.size());
  for (int i=0; i < mc.getMessagesAsArray().length; i++) {
    MuleMessage msg=mc.getMessagesAsArray()[i];
    assertEquals("test Received",msg.getPayload());
    assertEquals(message.getMessageRootId(),msg.getMessageRootId());
  }
  assertEquals(message.getMessageRootId(),result.getMessageRootId());
}
