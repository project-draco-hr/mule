{
  logger=LogFactory.getLog(getClass());
  if (null != template) {
    if (template instanceof AbstractMessageAdapter) {
      properties=((AbstractMessageAdapter)template).getPropertiesContext();
    }
 else {
      properties=((AbstractMessageAdapter)((DefaultMuleMessage)template).getAdapter()).getPropertiesContext();
    }
    Iterator attachmentNames=template.getAttachmentNames().iterator();
    while (attachmentNames.hasNext()) {
      String key=(String)attachmentNames.next();
      try {
        addAttachment(key,template.getAttachment(key));
      }
 catch (      Exception e) {
        throw new MuleRuntimeException(CoreMessages.failedToReadPayload(),e);
      }
    }
    encoding=template.getEncoding();
    exceptionPayload=template.getExceptionPayload();
    try {
      id=template.getUniqueId();
    }
 catch (    UniqueIdNotSupportedException e) {
    }
  }
}
