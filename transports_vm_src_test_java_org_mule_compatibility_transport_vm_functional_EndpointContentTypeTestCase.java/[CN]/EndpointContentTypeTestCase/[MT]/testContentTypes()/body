{
  MuleMessage response;
  Map<String,Object> messageProperties=new HashMap<String,Object>();
  messageProperties.put("content-type","text/xml");
  MuleClient client=muleContext.getClient();
  MuleMessage result=client.send("vm://in1?connector=vm-in1","<OK/>",messageProperties);
  assertNotNull(result.getExceptionPayload());
  assertTrue(result.getExceptionPayload().getException() instanceof MessagingException);
  messageProperties.put("content-type","text/plain");
  EchoComponent.setExpectedContentType("text/plain");
  response=client.send("vm://in1?connector=vm-in1","OK",messageProperties);
  assertNotNull(response);
  assertEquals("OK",response.getPayload());
  messageProperties.remove("content-type");
  EchoComponent.setExpectedContentType("text/plain");
  response=client.send("vm://in1?connector=vm-in1","OK",messageProperties);
  assertNotNull(response);
  assertEquals("OK",response.getPayload());
  messageProperties.put("content-type","text/plain");
  EchoComponent.setExpectedContentType("text/xml");
  response=client.send("vm://in2?connector=vm-in2","OK",messageProperties);
  assertNotNull(response);
  assertEquals("OK",response.getPayload());
}
