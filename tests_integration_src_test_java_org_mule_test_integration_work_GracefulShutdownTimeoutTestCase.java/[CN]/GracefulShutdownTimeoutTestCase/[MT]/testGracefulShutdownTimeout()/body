{
  final Latch latch=new Latch();
  FlowConstruct service=muleContext.getRegistry().lookupFlowConstruct("TestService");
  FunctionalTestComponent testComponent=(FunctionalTestComponent)getComponent(service);
  testComponent.setEventCallback(new EventCallback(){
    @Override public void eventReceived(    MuleEventContext context,    Object component) throws Exception {
      Thread.sleep(5500);
      latch.countDown();
    }
  }
);
  ((Flow)service).process(getTestEvent("test"));
  Thread.sleep(200);
  ((Flow)service).dispose();
  assertTrue(latch.await(1000,TimeUnit.MILLISECONDS));
}
