{
  if (event == null) {
    return null;
  }
  if (event.isAllowNonBlocking() && event.getReplyToHandler() != null) {
    final ReplyToHandler originalReplyToHandler=event.getReplyToHandler();
    event=MuleEvent.builder(event).replyToHandler(new NonBlockingReplyToHandler(){
      @Override public MuleEvent processReplyTo(      MuleEvent event,      MuleMessage returnMessage,      Object replyTo) throws MuleException {
        return originalReplyToHandler.processReplyTo(processResponse(event),null,null);
      }
      @Override public void processExceptionReplyTo(      MessagingException exception,      Object replyTo){
        originalReplyToHandler.processExceptionReplyTo(exception,replyTo);
      }
    }
).build();
  }
  MuleEvent result=processNext(processRequest(event));
  if (!(result instanceof NonBlockingVoidMuleEvent)) {
    return processResponse(result);
  }
 else {
    return result;
  }
}
