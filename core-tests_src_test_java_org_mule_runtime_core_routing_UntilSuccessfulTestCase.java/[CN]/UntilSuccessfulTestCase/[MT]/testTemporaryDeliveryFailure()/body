{
  targetMessageProcessor.setNumberOfFailuresToSimulate(untilSuccessful.getMaxRetries());
  untilSuccessful.setMuleContext(muleContext);
  untilSuccessful.initialise();
  untilSuccessful.start();
  final Event testEvent=eventBuilder().message(InternalMessage.of("ERROR")).build();
  assertSame(testEvent,untilSuccessful.process(testEvent));
  ponderUntilEventProcessed(testEvent);
  assertEquals(targetMessageProcessor.getEventCount(),untilSuccessful.getMaxRetries() + 1);
}
