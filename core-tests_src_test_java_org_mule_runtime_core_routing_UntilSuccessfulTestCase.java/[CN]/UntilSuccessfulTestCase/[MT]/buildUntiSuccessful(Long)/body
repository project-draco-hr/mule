{
  UntilSuccessful untilSuccessful=new UntilSuccessful();
  untilSuccessful.setMuleContext(muleContext);
  untilSuccessful.setMessagingExceptionHandler(muleContext.getDefaultExceptionStrategy());
  untilSuccessful.setFlowConstruct(getTestFlow());
  untilSuccessful.setMaxRetries(2);
  if (millisBetweenRetries != null) {
    untilSuccessful.setMillisBetweenRetries(millisBetweenRetries);
  }
  objectStore=new SimpleMemoryObjectStore<MuleEvent>();
  untilSuccessful.setObjectStore(objectStore);
  targetMessageProcessor=new ConfigurableMessageProcessor();
  untilSuccessful.addRoute(targetMessageProcessor);
  return untilSuccessful;
}
