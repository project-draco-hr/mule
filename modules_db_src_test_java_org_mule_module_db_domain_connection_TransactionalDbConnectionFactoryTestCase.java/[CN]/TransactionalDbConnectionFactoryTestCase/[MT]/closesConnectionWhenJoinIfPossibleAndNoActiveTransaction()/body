{
  when(dbTransactionManager.getTransaction()).thenReturn(null);
  DbConnection connection=mock(DbConnection.class);
  when(connection.getTransactionalAction()).thenReturn(TransactionalAction.JOIN_IF_POSSIBLE);
  factory=new TransactionalDbConnectionFactory(null,dbTransactionManager);
  factory.releaseConnection(connection);
  verify(connection,times(1)).commit();
  verify(connection,times(1)).close();
}
