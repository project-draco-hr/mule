{
  changeWorkingDirectory(sourcePath);
  FTPFile[] files;
  try {
    files=client.listFiles();
  }
 catch (  IOException e) {
    throw exception(format("Could not list contents of directory '%s' while trying to copy it to ",sourcePath,target),e);
  }
  for (  FTPFile file : files) {
    if (isVirtualDirectory(file.getName())) {
      continue;
    }
    FileAttributes fileAttributes=new FtpFileAttributes(sourcePath.resolve(file.getName()),file);
    if (fileAttributes.isDirectory()) {
      Path targetPath=target.resolve(fileAttributes.getName());
      copyDirectory(Paths.get(fileAttributes.getPath()),targetPath,overwrite,writerConnection,event);
    }
 else {
      copyFile(fileAttributes,target.resolve(fileAttributes.getName()),overwrite,writerConnection,event);
    }
  }
}
