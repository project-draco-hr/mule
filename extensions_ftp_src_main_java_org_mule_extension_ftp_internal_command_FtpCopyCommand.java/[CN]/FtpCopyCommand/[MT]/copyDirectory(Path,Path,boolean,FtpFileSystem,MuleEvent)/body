{
  changeWorkingDirectory(sourcePath);
  FTPFile[] files;
  try {
    files=client.listFiles();
  }
 catch (  IOException e) {
    throw exception(format("Could not list contents of directory '%s' while trying to copy it to ",sourcePath,target),e);
  }
  for (  FTPFile file : files) {
    if (isVirtualDirectory(file.getName())) {
      continue;
    }
    FilePayload filePayload=new FtpFilePayload(sourcePath.resolve(file.getName()),file,config);
    if (filePayload.isDirectory()) {
      Path targetPath=target.resolve(filePayload.getName());
      copyDirectory(Paths.get(filePayload.getPath()),targetPath,overwrite,writerConnection,event);
    }
 else {
      copyFile(filePayload,target.resolve(filePayload.getName()),overwrite,writerConnection,event);
    }
  }
}
