{
  FilePayload targetFile=getFile(target.toString());
  if (targetFile != null) {
    if (overwrite) {
      fileSystem.delete(targetFile.getPath());
    }
 else {
      throw exception(String.format("Cannot copy file '%s' to path '%s' because it already exists",source.getPath(),target));
    }
  }
  try (InputStream inputStream=client.retrieveFileStream(source.getPath())){
    if (inputStream == null) {
      throw exception(String.format("Could not read file '%s' while trying to copy it to remote path '%s'",source.getPath(),target));
    }
    writeCopy(target.toString(),inputStream,overwrite,writerConnection,event);
  }
 catch (  Exception e) {
    throw exception(String.format("Found exception while trying to copy file '%s' to remote path '%s'",source.getPath(),target),e);
  }
 finally {
    fileSystem.awaitCommandCompletion();
  }
}
