{
  Flow flow=(Flow)getFlowConstruct("limitedConnections");
  Thread t1=processAsynchronously(flow);
  messageArrived.await();
  MessagingException e=flowRunner("limitedConnections").runExpectingException();
  assertThat(e,instanceOf(MessagingException.class));
  assertThat(e.getCause(),instanceOf(IOException.class));
  messageHold.release();
  t1.join();
}
