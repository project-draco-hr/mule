{
  JobConfig jobConfig=(JobConfig)endpoint.getProperty(QuartzConnector.PROPERTY_JOB_CONFIG);
  if (jobConfig == null) {
    throw new IllegalArgumentException(CoreMessages.objectIsNull(QuartzConnector.PROPERTY_JOB_CONFIG).getMessage());
  }
  JobDetail jobDetail=new JobDetail();
  jobDetail.setName(endpoint.getEndpointURI().getAddress() + "-" + event.getId());
  JobDataMap jobDataMap=new JobDataMap();
  jobDataMap.put(QuartzConnector.PROPERTY_JOB_DYNAMIC,Boolean.TRUE);
  MuleMessage msg=event.getMessage();
  for (  String key : msg.getInvocationPropertyNames()) {
    jobDataMap.put(key,msg.getInvocationProperty(key));
  }
  for (  String key : msg.getOutboundPropertyNames()) {
    jobDataMap.put(key,msg.getOutboundProperty(key));
  }
  if (jobConfig instanceof ScheduledDispatchJobConfig) {
    ScheduledDispatchJobConfig scheduledDispatchJobConfig=(ScheduledDispatchJobConfig)jobConfig;
    String endpointRef=event.getMuleContext().getExpressionManager().parse(scheduledDispatchJobConfig.getEndpointRef(),event);
    jobDataMap.put("endpointRef",endpointRef);
  }
  jobDetail.setJobDataMap(jobDataMap);
  Job job=null;
  Object payload=event.getMessage().getPayload();
  if (jobConfig instanceof CustomJobConfig) {
    job=((CustomJobConfig)jobConfig).getJob();
  }
 else   if (jobConfig instanceof CustomJobFromMessageConfig) {
    job=((CustomJobFromMessageConfig)jobConfig).getJob(msg);
    jobConfig=((CustomJobFromMessageConfig)jobConfig).getJobConfig(msg);
  }
  jobDataMap.put(QuartzConnector.PROPERTY_JOB_CONFIG,jobConfig);
  jobDetail.setJobClass(jobConfig.getJobClass());
  if (job != null) {
    jobDataMap.put(QuartzConnector.PROPERTY_JOB_OBJECT,job);
    jobDetail.setJobClass(CustomJob.class);
  }
  jobDataMap.put(QuartzConnector.PROPERTY_PAYLOAD,payload);
  Trigger trigger;
  String cronExpression=jobDataMap.getString(QuartzConnector.PROPERTY_CRON_EXPRESSION);
  String repeatInterval=jobDataMap.getString(QuartzConnector.PROPERTY_REPEAT_INTERVAL);
  String repeatCount=jobDataMap.getString(QuartzConnector.PROPERTY_REPEAT_COUNT);
  String startDelay=jobDataMap.getString(QuartzConnector.PROPERTY_START_DELAY);
  String groupName=jobConfig.getGroupName();
  String jobGroupName=jobConfig.getJobGroupName();
  if (groupName == null) {
    groupName=QuartzConnector.DEFAULT_GROUP_NAME;
  }
  if (jobGroupName == null) {
    jobGroupName=groupName;
  }
  jobDetail.setGroup(groupName);
  if (cronExpression != null) {
    CronTrigger ctrigger=new CronTrigger();
    ctrigger.setCronExpression(cronExpression);
    trigger=ctrigger;
  }
 else   if (repeatInterval != null) {
    SimpleTrigger strigger=new SimpleTrigger();
    strigger.setRepeatInterval(Long.parseLong(repeatInterval));
    if (repeatCount != null) {
      strigger.setRepeatCount(Integer.parseInt(repeatCount));
    }
 else {
      strigger.setRepeatCount(-1);
    }
    trigger=strigger;
  }
 else {
    throw new IllegalArgumentException(QuartzMessages.cronExpressionOrIntervalMustBeSet().getMessage());
  }
  trigger.setName(endpoint.getEndpointURI().toString() + "-" + event.getId());
  trigger.setGroup(groupName);
  trigger.setJobName(jobDetail.getName());
  trigger.setJobGroup(jobGroupName);
  Scheduler scheduler=((QuartzConnector)this.getConnector()).getQuartzScheduler();
  long start=System.currentTimeMillis();
  if (startDelay != null) {
    start+=Long.parseLong(startDelay);
  }
  trigger.setStartTime(new Date(start));
  scheduler.scheduleJob(jobDetail,trigger);
}
