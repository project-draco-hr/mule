{
  OutputHandler payload=new OutputHandler(){
    public void write(    MuleEvent event,    OutputStream out) throws IOException {
      if (context.hasEntity()) {
        context.writeTo(out);
        out.flush();
      }
    }
  }
;
  DefaultMuleMessage response=new DefaultMuleMessage(payload,muleContext);
  response.setIntProperty(HttpConnector.HTTP_STATUS_PROPERTY,context.getStatus());
  long cl=context.getContentLength();
  String cc=context.getCacheControl();
  if (cl > -1) {
    response.setProperty("Content-Length",Long.toString(cl));
  }
  if (cc != null && cc.length() > 0) {
    response.setProperty("Cache-Control",cc);
  }
  MimeType ct=context.getContentType();
  if (ct != null) {
    response.setProperty(HttpConstants.HEADER_CONTENT_TYPE,ct.toString());
  }
  String[] names=context.getHeaderNames();
  for (  String name : names) {
    Object[] headers=context.getHeaders(name);
    for (    Object value : headers) {
      if (value instanceof Date) {
        throw new RuntimeException();
      }
 else {
        response.setProperty(name,value.toString());
      }
    }
  }
  return response;
}
