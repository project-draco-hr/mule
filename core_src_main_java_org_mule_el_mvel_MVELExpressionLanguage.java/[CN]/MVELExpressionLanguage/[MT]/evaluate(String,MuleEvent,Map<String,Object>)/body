{
  MVELExpressionLanguageContext factory=createExpressionLanguageContext();
  if (vars != null) {
    factory.appendFactory(new CachedMapVariableResolverFactory(vars));
  }
  factory.appendFactory(createEventVariableResolverFactory(event));
  factory.appendFactory(createGlobalVariableResolverFactory(factory));
  if (autoResolveVariables) {
    factory.localFactory.appendFactory(createVariableVariableResolverFactory(event));
  }
  factory.addPrivateVariable(MVELExpressionLanguageContext.MULE_MESSAGE_INTERNAL_VARIABLE,event.getMessage());
  return (T)evaluateInternal(expression,factory);
}
