{
  MVELExpressionLanguageContext context=createExpressionLanguageContext(vars);
  context.addChildContext(staticContext);
  VariableResolverFactory messageResolverFactory=new MessageVariableResolverFactory(message);
  context.addChildContext(messageResolverFactory);
  if (useGlobalConfiguration) {
    if (autoResolveVariables) {
      context.addChildContext(createGlobalVariableResolverFactory(staticContext,messageResolverFactory,createVariableVariableResolverFactory(message)));
    }
 else {
      context.addChildContext(createGlobalVariableResolverFactory(staticContext,messageResolverFactory));
    }
  }
 else   if (autoResolveVariables) {
    context.addChildContext(createVariableVariableResolverFactory(message));
  }
  return evaluateInternal(expression,context);
}
