{
  CompositeVariableResolverFactory factory=new CompositeVariableResolverFactory(parserContext,muleContext,appVariableResolverFactory);
  factory.addVariableResolverFactory(new MessageVariableResolverFactory(parserContext,muleContext,message));
  factory.addVariableResolverFactory(new VariableVariableResolverFactory(parserContext,muleContext,message));
  factory.addVariableResolverFactory(new RegistryVariableResolverFactory(parserContext,muleContext));
  if (vars != null) {
    factory.addVariableResolverFactory(new CachedMapVariableResolverFactory(vars));
  }
  return (T)evaluateInternal(expression,factory);
}
