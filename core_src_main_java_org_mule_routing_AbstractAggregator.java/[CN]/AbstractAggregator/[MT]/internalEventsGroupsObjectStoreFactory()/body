{
  return new Factory(){
    @Override public Object create(){
      try {
        ObjectStore objectStore;
        if (persistentStores) {
          objectStore=muleContext.getRegistry().lookupObject(DefaultObjectStoreFactoryBean.class).createDefaultPersistentObjectStore();
        }
 else {
          objectStore=muleContext.getRegistry().lookupObject(DefaultObjectStoreFactoryBean.class).createDefaultInMemoryObjectStore();
        }
        if (objectStore instanceof MuleContextAware) {
          ((MuleContextAware)objectStore).setMuleContext(muleContext);
        }
        return objectStore;
      }
 catch (      RegistrationException e) {
        throw new MuleRuntimeException(e);
      }
    }
  }
;
}
