{
  MuleClient client=muleContext.getClient();
  Apple apple=new Apple();
  client.dispatch("vm://distributor.queue",apple,null);
  List<Apple> results=new ArrayList<>(3);
  MuleMessage result=client.request("vm://collector.queue",RECEIVE_TIMEOUT);
  assertNotNull(result);
  results.add((Apple)result.getPayload());
  result=client.request("vm://collector.queue",RECEIVE_TIMEOUT);
  assertNotNull(result);
  results.add((Apple)result.getPayload());
  result=client.request("vm://collector.queue",RECEIVE_TIMEOUT);
  assertNotNull(result);
  results.add((Apple)result.getPayload());
  assertThat(results.size(),equalTo(3));
  FlowAssert.verify();
}
