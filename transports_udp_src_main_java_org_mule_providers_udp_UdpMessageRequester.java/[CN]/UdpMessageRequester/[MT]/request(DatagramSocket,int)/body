{
  int origTimeout=socket.getSoTimeout();
  try {
    DatagramPacket packet=new DatagramPacket(new byte[connector.getReceiveBufferSize()],connector.getReceiveBufferSize());
    if (timeout > 0 && timeout != socket.getSoTimeout()) {
      socket.setSoTimeout(timeout);
    }
    socket.receive(packet);
    return packet;
  }
  finally {
    if (socket.getSoTimeout() != origTimeout) {
      socket.setSoTimeout(origTimeout);
    }
  }
}
