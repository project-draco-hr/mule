{
  ScheduledThreadPoolExecutor scheduledThreadPoolExecutor=new ScheduledThreadPoolExecutor(Math.min(tp.getMaxThreadsIdle(),tp.getMaxThreadsActive()));
  scheduledThreadPoolExecutor.setContinueExistingPeriodicTasksAfterShutdownPolicy(false);
  scheduledThreadPoolExecutor.setExecuteExistingDelayedTasksAfterShutdownPolicy(true);
  scheduledThreadPoolExecutor.setKeepAliveTime(tp.getThreadTTL(),TimeUnit.MILLISECONDS);
  scheduledThreadPoolExecutor.setCorePoolSize(tp.getMaxThreadsIdle());
  scheduledThreadPoolExecutor.setMaximumPoolSize(tp.getMaxThreadsActive());
  return scheduledThreadPoolExecutor;
}
