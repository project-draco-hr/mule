{
  testService.getOutboundRouter().setMatchAll(false);
  testService.getOutboundRouter().addRouter(new TestDoesNotRequireNewMessageOutboundRouter(false));
  testService.getOutboundRouter().addRouter(new TestRequiresNewMessageOutboundRouter(true));
  testService.getOutboundRouter().addRouter(new TestDoesNotRequireNewMessageOutboundRouter(false));
  testService.getOutboundRouter().addRouter(new TestRequiresNewMessageOutboundRouter(true));
  testService.getOutboundRouter().addRouter(new TestDoesNotRequireNewMessageOutboundRouter(false));
  testService.start();
  TestDoesNotRequireNewMessageOutboundRouter.latch=new CountDownLatch(3);
  TestRequiresNewMessageOutboundRouter.latch=new CountDownLatch(2);
  testService.sendEvent(testEvent);
  assertTrue(TestDoesNotRequireNewMessageOutboundRouter.latch.await(LATCH_AWAIT_TIMEOUT_MS,TimeUnit.MILLISECONDS));
  assertTrue(TestDoesNotRequireNewMessageOutboundRouter.latch.await(LATCH_AWAIT_TIMEOUT_MS,TimeUnit.MILLISECONDS));
}
