{
  DefaultLocalMuleClient client=new DefaultLocalMuleClient(muleContext);
  HashMap<String,Object> props=new HashMap<String,Object>();
  props.put("username","ross");
  props.put("pass","ross");
  MuleMessage result=client.send("vm://test","hi",props);
  assertNull(result.getExceptionPayload());
  props.put("pass","badpass");
  MuleMessage resultMessage=client.send("vm://test","hi",props);
  assertNotNull(resultMessage);
  assertNotNull(resultMessage.getExceptionPayload());
  assertEquals(BadCredentialsException.class,resultMessage.getExceptionPayload().getRootException().getClass());
}
