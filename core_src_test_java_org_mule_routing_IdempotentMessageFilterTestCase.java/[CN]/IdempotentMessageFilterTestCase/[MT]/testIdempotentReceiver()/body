{
  InboundEndpoint endpoint1=getTestInboundEndpoint("Test1Provider","test://Test1Provider?exchangePattern=one-way");
  Mock session=MuleTestUtils.getMockSession();
  Service service=getTestService();
  session.matchAndReturn("getFlowConstruct",service);
  IdempotentMessageFilter ir=new IdempotentMessageFilter();
  ir.setIdExpression("#[header:id]");
  ir.setFlowConstruct(service);
  ir.setThrowOnUnaccepted(false);
  MuleMessage okMessage=new DefaultMuleMessage("OK",muleContext);
  okMessage.setOutboundProperty("id","1");
  MuleEvent event=new DefaultMuleEvent(okMessage,endpoint1,(MuleSession)session.proxy());
  event=ir.process(event);
  assertNotNull(event);
  okMessage=new DefaultMuleMessage("OK",muleContext);
  okMessage.setOutboundProperty("id","1");
  event=new DefaultMuleEvent(okMessage,endpoint1,(MuleSession)session.proxy());
  event=ir.process(event);
  assertNull(event);
}
