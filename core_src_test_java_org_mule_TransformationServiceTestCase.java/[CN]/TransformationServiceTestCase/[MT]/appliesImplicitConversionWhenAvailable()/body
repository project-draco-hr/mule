{
  Transformer transformer=new MockTransformerBuilder().from(DataTypeFactory.BYTE_ARRAY).to(DataTypeFactory.STRING).returning("bar").build();
  Transformer converter=new MockConverterBuilder().from(DataTypeFactory.STRING).to(DataTypeFactory.BYTE_ARRAY).returning("bar".getBytes()).build();
  when(conversionResolver.resolve(Mockito.any(DataType.class),Mockito.anyList())).thenReturn(converter);
  DefaultMuleMessage message=new DefaultMuleMessage("TEST",muleContext);
  transformationService.applyTransformers(message,null,transformer);
  assertEquals("bar",message.getPayload());
  verifyTransformerExecuted(transformer);
  verifyTransformerExecuted(converter);
}
