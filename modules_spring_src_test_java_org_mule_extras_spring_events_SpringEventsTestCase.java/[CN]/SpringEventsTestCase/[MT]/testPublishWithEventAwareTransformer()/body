{
  CountDownLatch latch=new CountDownLatch(1);
  DummyTrans trans=new DummyTrans();
  trans.setLatch(latch);
  MuleManager.getRegistry().registerTransformer(trans);
  MuleApplicationEvent event=new MuleApplicationEvent("Event from a spring bean","vm://testBean2?transformers=dummyTrans");
  TestSubscriptionEventBean bean2=(TestSubscriptionEventBean)context.getBean("testSubscribingEventBean2");
  assertNotNull(bean2);
  EventCallback callback=new EventCallback(){
    public void eventReceived(    UMOEventContext context,    Object o) throws Exception {
      eventCount++;
      if (eventCount == 1) {
synchronized (lock) {
          lock.notifyAll();
        }
      }
    }
  }
;
  bean2.setEventCallback(callback);
  for (int i=0; i < 1; i++) {
    context.publishEvent(event);
  }
synchronized (lock) {
    lock.wait(2000);
  }
  assertTrue(latch.await(3000,TimeUnit.MILLISECONDS));
  assertEquals(1,eventCount);
}
