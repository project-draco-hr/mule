{
  MuleClient client=muleContext.getClient();
  MuleMessage result=client.send("inboundEndpoint","some data",null);
  assertNotNull(result);
  assertEquals(NullPayload.getInstance(),result.getPayload());
  assertNull(result.getExceptionPayload());
  DefaultMuleMessage msg=new DefaultMuleMessage("some data",muleContext);
  msg.setOutboundProperty("foo","bar");
  result=client.send("inboundEndpoint",msg);
  assertNotNull(result);
  assertEquals("got it!",result.getPayloadAsString());
  if (ConfigVariant.SERVICE.equals(variant)) {
    Service async=muleContext.getRegistry().lookupService("In-Out_Out-Only-Async-Service");
    Service external=muleContext.getRegistry().lookupService("ExternalApp");
    assertEquals(2,async.getStatistics().getProcessedEvents());
    assertEquals(1,external.getStatistics().getProcessedEvents());
  }
 else {
    FlowConstruct async=muleContext.getRegistry().lookupFlowConstruct("In-Out_Out-Only-Async-Service");
    FlowConstruct external=muleContext.getRegistry().lookupFlowConstruct("ExternalApp");
    assertEquals(2,async.getStatistics().getProcessedEvents());
    assertEquals(1,external.getStatistics().getProcessedEvents());
  }
}
