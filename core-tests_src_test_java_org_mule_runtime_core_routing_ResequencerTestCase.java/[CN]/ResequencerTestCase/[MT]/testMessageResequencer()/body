{
  MuleSession session=getTestSession(null,muleContext);
  Flow flow=getTestFlow("test",Apple.class);
  assertNotNull(flow);
  TestEventResequencer router=new TestEventResequencer(3);
  router.setMuleContext(muleContext);
  router.setFlowConstruct(flow);
  router.initialise();
  MuleMessage message1=MuleMessage.builder().payload("test event A").build();
  MuleMessage message2=MuleMessage.builder().payload("test event B").build();
  MuleMessage message3=MuleMessage.builder().payload("test event C").build();
  final String correlationId=message1.getUniqueId();
  message1=MuleMessage.builder(message1).correlationId(correlationId).build();
  message2=MuleMessage.builder(message2).correlationId(correlationId).build();
  message3=MuleMessage.builder(message1).correlationId(correlationId).build();
  MuleEvent event1=new DefaultMuleEvent(message1,getTestFlow(),session);
  MuleEvent event2=new DefaultMuleEvent(message2,getTestFlow(),session);
  MuleEvent event3=new DefaultMuleEvent(message3,getTestFlow(),session);
  assertNull(router.process(event2));
  assertNull(router.process(event3));
  MuleEvent resultEvent=router.process(event1);
  assertNotNull(resultEvent);
  MuleMessage resultMessage=resultEvent.getMessage();
  assertNotNull(resultMessage);
  assertTrue(getPayloadAsString(resultMessage).equals("test event A") || getPayloadAsString(resultMessage).equals("test event B") || getPayloadAsString(resultMessage).equals("test event C"));
}
