{
  RuntimeConfigurationModel implicitConfigurationModel=(RuntimeConfigurationModel)getFirstImplicit(extensionModel.getConfigurationModels());
  if (implicitConfigurationModel == null) {
    throw new IllegalStateException(String.format("Could not find a config for extension '%s' and none can be created automatically. Please define one",extensionModel.getName()));
  }
  final String providerName=String.format("%s-%s",extensionModel.getName(),implicitConfigurationModel.getName());
  final ResolverSet resolverSet=buildImplicitResolverSet(implicitConfigurationModel,muleContext.getExpressionManager());
  try {
    ConfigurationInstance<C> configurationInstance=new ConfigurationInstanceFactory<C>(implicitConfigurationModel,resolverSet).createConfiguration(providerName,event,muleContext);
    String configName=configurationInstance.getName();
    RuntimeConfigurationModel configurationModel=configurationInstance.getModel();
    if (resolverSet.isDynamic()) {
      return new DynamicConfigurationProvider<>(configName,configurationModel,resolverSet,new ImplicitConnectionProviderValueResolver(configName,configurationModel,muleContext),ImmutableExpirationPolicy.getDefault(new TimeSupplier()));
    }
    return new StaticConfigurationProvider<>(configName,configurationModel,configurationInstance);
  }
 catch (  MuleException e) {
    throw new MuleRuntimeException(e);
  }
}
