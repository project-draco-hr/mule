{
  File muleHome=null;
  String muleHomeVar=System.getProperty("mule.home");
  if (muleHomeVar != null && !muleHomeVar.trim().equals("") && !muleHomeVar.equals("%MULE_HOME%")) {
    muleHome=new File(muleHomeVar).getCanonicalFile();
  }
  if (muleHome == null || !muleHome.exists() || !muleHome.isDirectory()) {
    throw new IllegalArgumentException("Either MULE_HOME is not set or does not contain a valid directory.");
  }
  return muleHome;
}
