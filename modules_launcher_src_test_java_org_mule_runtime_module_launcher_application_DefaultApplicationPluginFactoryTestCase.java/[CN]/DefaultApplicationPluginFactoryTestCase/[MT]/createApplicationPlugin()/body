{
  ApplicationPluginDescriptor descriptor=mock(ApplicationPluginDescriptor.class);
  when(descriptor.getName()).thenReturn("aPlugin");
  URL[] urls=new URL[]{getClass().getClassLoader().getResource("lib/bar-1.0.jar")};
  when(descriptor.getRuntimeLibs()).thenReturn(urls);
  when(descriptor.getRuntimeClassesDir()).thenReturn(getClass().getClassLoader().getResource("org/foo/"));
  ArtifactClassLoader parentClassLoader=new MuleArtifactClassLoader("mule",new URL[0],getClass().getClassLoader(),new MuleClassLoaderLookupPolicy(emptyMap(),emptySet()));
  ApplicationPlugin appPlugin=new DefaultApplicationPluginFactory(new ApplicationPluginClassLoaderFactory()).create(descriptor,parentClassLoader);
  assertThat(Class.forName("org.bar.BarUtils",true,appPlugin.getArtifactClassLoader().getClassLoader()),is(notNullValue()));
  assertThat(appPlugin.getArtifactName(),is("aPlugin"));
  assertThat(appPlugin.getDescriptor(),is(descriptor));
}
