{
  MuleClient muleClient=new MuleClient(muleContext);
  muleClient.send("vm://in",TEST_MESSAGE,null);
  MuleMessage message=muleClient.request("vm://out",5000);
  assertNotNull(message);
  TestCxfMessageDispatcherFactory factory=getTestCxfMessageDispatcherFactory();
  assertFalse(factory.getCreatedDispatchers().isEmpty());
  boolean dispatcherChecked=false;
  for (  CxfMessageDispatcherWrapper dispatcher : factory.getCreatedDispatchers()) {
    final ClientWrapper clientWrapper=dispatcher.getClientWrapper();
    if (clientWrapper != null) {
      Client client=clientWrapper.getClient();
      final Map<String,Object> requestContext=client.getRequestContext();
      assertTrue("Request context should be empty",requestContext.isEmpty());
      final Map<String,Object> responseContext=client.getResponseContext();
      assertTrue("Response context should be empty",responseContext.isEmpty());
      dispatcherChecked=true;
    }
  }
  assertTrue("CxfMessageDispatcher was not checked",dispatcherChecked);
}
