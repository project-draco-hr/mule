{
  Runtime.getRuntime().addShutdownHook(new ShutdownThread());
  Class cfgBuilderClass=ClassUtils.loadClass(getConfigBuilderClassName(),MuleServer.class);
  ConfigurationBuilder cfgBuilder=(ConfigurationBuilder)cfgBuilderClass.newInstance();
  if (!cfgBuilder.isConfigured()) {
    if (configurationResources == null) {
      logger.warn("A configuration file was not set, using default: " + DEFAULT_CONFIGURATION);
      configurationResources=DEFAULT_CONFIGURATION;
    }
    Properties startupProperties=PropertiesUtils.loadProperties(getStartupPropertiesFile(),getClass());
    DefaultMuleContextFactory muleContextFactory=new DefaultMuleContextFactory();
    muleContextFactory.createMuleContext(configurationResources,startupProperties);
  }
}
