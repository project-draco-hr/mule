{
  Path path=resolveExistingPath(config,filePath);
  if (Files.isDirectory(path)) {
    throw cannotReadDirectoryException(path);
  }
  PathLock pathLock;
  if (lock) {
    pathLock=fileSystem.lock(path);
  }
 else {
    fileSystem.verifyNotLocked(path);
    pathLock=new NullPathLock();
  }
  FileAttributes fileAttributes=new LocalFileAttributes(path);
  return new DefaultMuleMessage(new FileInputStream(path,pathLock),fileSystem.getFileMessageDataType(message.getDataType(),fileAttributes),fileAttributes).asNewMessage();
}
