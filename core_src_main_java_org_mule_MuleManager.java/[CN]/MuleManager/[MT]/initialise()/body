{
  registerListener(new RegistryNotificationListener(registry));
  validateEncoding();
  validateOSEncoding();
  if (!initialised.get()) {
    initialising.set(true);
    startDate=System.currentTimeMillis();
    if (workManager == null) {
      ThreadingProfile tp=config.getDefaultThreadingProfile();
      logger.debug("Creating default work manager using default threading profile: " + tp);
      workManager=new MuleWorkManager(tp,"UMOManager");
      workManager.start();
    }
    notificationManager.start(workManager);
    fireSystemEvent(new ManagerNotification(id,null,null,ManagerNotification.MANAGER_INITIALISNG));
    if (id == null) {
      logger.warn("No unique id has been set on this manager");
    }
    try {
      if (securityManager != null) {
        securityManager.initialise();
      }
      if (queueManager == null) {
        try {
          TransactionalQueueManager queueMgr=new TransactionalQueueManager();
          QueuePersistenceStrategy ps=new CachingPersistenceStrategy(new MemoryPersistenceStrategy());
          queueMgr.setPersistenceStrategy(ps);
          queueManager=queueMgr;
        }
 catch (        Exception e) {
          throw new InitialisationException(new Message(Messages.INITIALISATION_FAILURE_X,"QueueManager"),e);
        }
      }
    }
  finally {
      initialised.set(true);
      initialising.set(false);
      fireSystemEvent(new ManagerNotification(id,null,null,ManagerNotification.MANAGER_INITIALISED));
    }
  }
}
