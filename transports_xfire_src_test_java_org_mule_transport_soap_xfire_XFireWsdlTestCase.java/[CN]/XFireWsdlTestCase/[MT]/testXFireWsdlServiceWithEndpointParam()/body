{
  EndpointBuilder endpointBuilder=new EndpointURIEndpointBuilder(TEST_URL_NOWSDL,muleContext);
  endpointBuilder.setProperty("wsdlUrl",TEST_URL_WSDL);
  ImmutableEndpoint endpoint=muleContext.getRegistry().lookupEndpointFactory().getOutboundEndpoint(endpointBuilder);
  MuleMessage message=new DefaultMuleMessage("test1");
  MuleSession session=new DefaultMuleSession(message,((AbstractConnector)endpoint.getConnector()).getSessionHandler(),muleContext);
  DefaultMuleEvent event=new DefaultMuleEvent(message,endpoint,session,true);
  MuleMessage reply=session.sendEvent(event);
  assertNotNull(reply);
  String response=reply.getPayloadAsString();
  assertNotNull(response);
  XMLAssert.assertXpathEvaluatesTo("test1","//*[namespace-uri()='http://applications.external.tck.mule.org' and local-name()='key']",response);
}
