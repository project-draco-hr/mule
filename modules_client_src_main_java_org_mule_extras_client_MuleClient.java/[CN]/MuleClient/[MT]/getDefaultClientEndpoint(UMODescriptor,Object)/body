{
  UMOEndpoint endpoint=(UMOEndpoint)descriptor.getInboundRouter().getEndpoints().get(0);
  if (endpoint != null) {
    if (endpoint.getTransformers() != null) {
      if (TransformerUtils.isSourceTypeSupportedByFirst(endpoint.getTransformers(),payload.getClass())) {
        return endpoint;
      }
 else {
        endpoint=new MuleEndpoint(endpoint);
        endpoint.setTransformers(new LinkedList());
        return endpoint;
      }
    }
 else {
      return endpoint;
    }
  }
 else {
    UMOConnector connector=null;
    UMOEndpointURI defaultEndpointUri=new MuleEndpointURI("vm://mule.client");
    connector=TransportFactory.createConnector(defaultEndpointUri,managementContext);
    managementContext.getRegistry().registerConnector(connector);
    connector.start();
    endpoint=new MuleEndpoint("muleClientProvider",defaultEndpointUri,connector,TransformerUtils.UNDEFINED,UMOEndpoint.ENDPOINT_TYPE_RECEIVER,0,null,null);
  }
  managementContext.getRegistry().registerEndpoint(endpoint);
  return endpoint;
}
