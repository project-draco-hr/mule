{
  Registry registry;
  if (parentContext != null) {
    if (appContext instanceof ConfigurableApplicationContext) {
      registry=new SpringRegistry((ConfigurableApplicationContext)appContext,parentContext,muleContext);
    }
 else {
      throw new ConfigurationException(MessageFactory.createStaticMessage("Cannot set a parent context if the ApplicationContext does not implement ConfigurableApplicationContext"));
    }
  }
 else {
    registry=new SpringRegistry(appContext,muleContext);
  }
  muleContext.addRegistry(registry);
  registry.initialise();
}
