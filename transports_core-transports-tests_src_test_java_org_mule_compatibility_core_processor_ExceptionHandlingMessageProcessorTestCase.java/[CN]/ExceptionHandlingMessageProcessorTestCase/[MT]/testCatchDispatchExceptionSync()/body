{
  OutboundEndpoint endpoint=createTestOutboundEndpoint(null,null);
  InterceptingMessageProcessor mp=new ExceptionHandlingMessageProcessor();
  mp.setListener(new ExceptionThrowingMessageProcessor());
  MuleEvent event=createTestOutboundEvent(exceptionListener);
  MuleEvent resultEvent=mp.process(event);
  assertNotNull(resultEvent);
  assertNotNull("exception expected",resultEvent.getError());
  assertTrue(resultEvent.getError().get().getException() instanceof IllegalStateException);
  assertEquals(null,resultEvent.getMessage().getPayload());
  assertNotNull(exceptionListener.sensedException);
}
