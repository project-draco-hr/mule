{
  URL wsdl=getClass().getResource("/wsdl/mtom_xop.wsdl");
  assertNotNull(wsdl);
  CxfConfiguration clientConfig=new CxfConfiguration();
  clientConfig.setMuleContext(muleContext);
  clientConfig.initialise();
  BusFactory.setThreadDefaultBus(clientConfig.getCxfBus());
  TestMtomService svc=new TestMtomService(wsdl);
  TestMtom port=svc.getTestMtomPort();
  BindingProvider bp=((BindingProvider)port);
  bp.getRequestContext().put(BindingProvider.ENDPOINT_ADDRESS_PROPERTY,"http://localhost:" + dynamicPort.getNumber() + "/services/mtom");
  ((SOAPBinding)bp.getBinding()).setMTOMEnabled(true);
  File file=new File("src/test/resources/mtom-conf-service.xml");
  DataHandler dh=new DataHandler(new FileDataSource(file));
  Holder<String> name=new Holder<String>("test");
  Holder<DataHandler> info=new Holder<DataHandler>(dh);
  port.testXop(name,info);
  assertEquals("return detail + test",name.value);
  assertNotNull(info.value);
  InputStream input=info.value.getInputStream();
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  IOUtils.copy(input,bos);
  input.close();
}
