{
  MuleClient client=muleContext.getClient();
  InternalMessage muleMessage=InternalMessage.builder().payload(TEST_MESSAGE).mediaType(MediaType.parse(MediaType.TEXT + "; charset=" + UTF_16.name())).build();
  client.dispatch("vm://testInput",muleMessage);
  InternalMessage response=client.request("vm://testOutput",120000).getRight().get();
  assertThat(response.getPayload().getDataType().getMediaType().getPrimaryType(),equalTo(MediaType.TEXT.getPrimaryType()));
  assertThat(response.getPayload().getDataType().getMediaType().getSubType(),equalTo(MediaType.TEXT.getSubType()));
  assertThat(response.getPayload().getDataType().getMediaType().getCharset().get(),equalTo(UTF_16));
}
