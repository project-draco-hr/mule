{
  AxisProperties.setProperty("axis.doAutoTypes",String.valueOf(connector.isDoAutoTypes()));
  MuleDescriptor descriptor=(MuleDescriptor)component.getDescriptor();
  String style=(String)descriptor.getProperties().get("style");
  String use=(String)descriptor.getProperties().get("use");
  String doc=(String)descriptor.getProperties().get("documentation");
  UMOEndpointURI uri=endpoint.getEndpointURI();
  String serviceName=component.getDescriptor().getName();
  SOAPService existing=this.connector.getAxisServer().getService(serviceName);
  if (existing != null) {
    service=existing;
    logger.debug("Using existing service for " + serviceName);
  }
 else {
    if (style != null && style.equalsIgnoreCase("message")) {
      logger.debug("Creating Message Provider");
      service=new SOAPService(new MuleMsgProvider(connector));
    }
 else {
      logger.debug("Creating RPC Provider");
      service=new SOAPService(new MuleRPCProvider(connector));
    }
    service.setEngine(connector.getAxisServer());
  }
  String servicePath=uri.getPath();
  service.setOption(serviceName,this);
  service.setOption(AxisConnector.SERVICE_PROPERTY_SERVCE_PATH,servicePath);
  service.setOption(AxisConnector.SERVICE_PROPERTY_COMPONENT_NAME,serviceName);
  service.setName(serviceName);
  Map options=(Map)descriptor.getProperties().get("axisOptions");
  if (options == null) {
    options=new HashMap(2);
  }
  if (options.get("wsdlServiceElement") == null) {
    options.put("wsdlServiceElement",serviceName);
  }
  Map.Entry entry;
  for (Iterator iterator=options.entrySet().iterator(); iterator.hasNext(); ) {
    entry=(Map.Entry)iterator.next();
    service.setOption(entry.getKey().toString(),entry.getValue());
    logger.debug("Adding Axis option: " + entry);
  }
  Class[] interfaces=ServiceProxy.getInterfacesForComponent(component);
  if (interfaces.length == 0) {
    throw new InitialisationException(new Message(Messages.X_MUST_IMPLEMENT_AN_INTERFACE,serviceName),component);
  }
  String methodNames="*";
  Map methods=(Map)endpoint.getProperties().get("soapMethods");
  if (methods == null) {
    methods=(Map)descriptor.getProperties().get("soapMethods");
  }
  if (methods != null) {
    Iterator i=methods.keySet().iterator();
    StringBuffer buf=new StringBuffer(64);
    while (i.hasNext()) {
      String name=(String)i.next();
      Object m=methods.get(name);
      SoapMethod method=null;
      if (m instanceof List) {
        method=new SoapMethod(name,(List)m);
      }
 else {
        method=new SoapMethod(name,(String)m);
      }
      List namedParameters=method.getNamedParameters();
      ParameterDesc[] parameters=new ParameterDesc[namedParameters.size()];
      for (int j=0; j < namedParameters.size(); j++) {
        NamedParameter parameter=(NamedParameter)namedParameters.get(j);
        byte mode=ParameterDesc.INOUT;
        if (parameter.getMode().equals(ParameterMode.IN)) {
          mode=ParameterDesc.IN;
        }
 else         if (parameter.getMode().equals(ParameterMode.OUT)) {
          mode=ParameterDesc.OUT;
        }
        parameters[j]=new ParameterDesc(parameter.getName(),mode,parameter.getType());
      }
      service.getServiceDescription().addOperationDesc(new OperationDesc(method.getName().getLocalPart(),parameters,method.getReturnType()));
      buf.append(method.getName().getLocalPart() + ",");
    }
    methodNames=buf.toString();
    methodNames=methodNames.substring(0,methodNames.length() - 1);
  }
 else {
    String[] methodNamesArray=ServiceProxy.getMethodNames(interfaces);
    StringBuffer buf=new StringBuffer(64);
    for (int i=0; i < methodNamesArray.length; i++) {
      buf.append(methodNamesArray[i]).append(",");
    }
    methodNames=buf.toString();
    methodNames=methodNames.substring(0,methodNames.length() - 1);
  }
  String className=interfaces[0].getName();
  String namespace=(String)descriptor.getProperties().get("serviceNamespace");
  if (namespace == null) {
    namespace=Namespaces.makeNamespace(className);
  }
  String wsdlFile=(String)descriptor.getProperties().get("wsdlFile");
  if (wsdlFile != null) {
    service.getServiceDescription().setWSDLFile(wsdlFile);
  }
  setOptionIfNotset(service,JavaProvider.OPTION_WSDL_SERVICEPORT,serviceName);
  setOptionIfNotset(service,JavaProvider.OPTION_CLASSNAME,className);
  setOptionIfNotset(service,JavaProvider.OPTION_SCOPE,"Request");
  if (StringUtils.isNotBlank(namespace)) {
    setOptionIfNotset(service,JavaProvider.OPTION_WSDL_TARGETNAMESPACE,namespace);
  }
  if (methodNames == null) {
    setOptionIfNotset(service,JavaProvider.OPTION_ALLOWEDMETHODS,"*");
  }
 else {
    setOptionIfNotset(service,JavaProvider.OPTION_ALLOWEDMETHODS,methodNames);
  }
  if (style != null) {
    Style s=Style.getStyle(style);
    if (s == null) {
      throw new InitialisationException(new Message(Messages.VALUE_X_IS_INVALID_FOR_X,style,"style"),this);
    }
 else {
      service.setStyle(s);
    }
  }
  if (use != null) {
    Use u=Use.getUse(use);
    if (u == null) {
      throw new InitialisationException(new Message(Messages.VALUE_X_IS_INVALID_FOR_X,use,"use"),this);
    }
 else {
      service.setUse(u);
    }
  }
  service.getServiceDescription().setDocumentation(doc);
  service.setName(serviceName);
  descriptor.addInitialisationCallback(new AxisInitialisationCallback(service));
  if (uri.getScheme().equalsIgnoreCase("servlet")) {
    connector.addServletService(service);
    String endpointUrl=uri.getAddress() + "/" + serviceName;
    endpointUrl.replaceFirst("servlet:","http:");
    service.getServiceDescription().setEndpointURL(endpointUrl);
  }
 else {
    service.getServiceDescription().setEndpointURL(uri.getAddress() + "/" + serviceName);
  }
  if (StringUtils.isNotBlank(namespace)) {
    service.getServiceDescription().setDefaultNamespace(namespace);
  }
  service.init();
  service.stop();
}
