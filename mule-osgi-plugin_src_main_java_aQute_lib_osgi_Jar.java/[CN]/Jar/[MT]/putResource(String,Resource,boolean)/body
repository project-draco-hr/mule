{
  updateModified(resource.lastModified(),path);
  if (path.equals("META-INF/MANIFEST.MF")) {
    manifest=null;
    if (resources.isEmpty())     manifestFirst=true;
  }
  String dir=getDirectory(path);
  Map<String,Resource> s=directories.get(dir);
  if (s == null) {
    s=new TreeMap<String,Resource>();
    directories.put(dir,s);
    int n=dir.lastIndexOf('/');
    while (n > 0) {
      String dd=dir.substring(0,n);
      if (directories.containsKey(dd))       break;
      directories.put(dd,null);
      n=dd.lastIndexOf('/');
    }
  }
  boolean duplicate=s.containsKey(path);
  if (!duplicate || overwrite) {
    resources.put(path,resource);
    s.put(path,resource);
  }
  return duplicate;
}
