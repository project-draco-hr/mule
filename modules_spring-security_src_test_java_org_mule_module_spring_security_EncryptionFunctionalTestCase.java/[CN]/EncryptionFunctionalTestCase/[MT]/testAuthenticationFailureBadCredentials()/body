{
  MuleClient client=new MuleClient(muleContext);
  Map props=new HashMap();
  EncryptionStrategy strategy=muleContext.getSecurityManager().getEncryptionStrategy("PBE");
  String header=MuleCredentials.createHeader("anonX","anonX","PBE",strategy);
  props.put(MuleProperties.MULE_USER_PROPERTY,header);
  try {
    muleContext.getClient().send("vm://my.queue","foo",props);
    fail("Exception expected");
  }
 catch (  Exception e) {
    assertTrue(ExceptionUtils.getRootCause(e) instanceof BadCredentialsException);
  }
}
