{
  getFunctionalTestComponent("serverFlow").setEventCallback(new EventCallback(){
    @Override public void eventReceived(    MuleEventContext context,    Object component) throws Exception {
      requestPayload=getPayloadAsString(context.getMessage());
      requestURI=context.getMessage().getInboundProperty(HTTP_REQUEST_URI);
    }
  }
);
  proxyServer.start();
  MuleEvent event=flowRunner("clientFlow").withPayload(TEST_MESSAGE).withFlowVariable("host",requestHost).withFlowVariable("path",PATH).run();
  assertThat(requestPayload,equalTo(TEST_MESSAGE));
  assertThat(requestURI,equalTo(PATH));
  assertThat(event.getMessage().<Integer>getInboundProperty(HTTP_STATUS_PROPERTY),equalTo(OK.getStatusCode()));
  assertThat(getPayloadAsString(event.getMessage()),equalTo(OK_RESPONSE));
  proxyServer.stop();
}
