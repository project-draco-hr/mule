{
  ContinuationCometdServlet servlet=new MuleAjaxServlet();
  String path=endpoint.getEndpointURI().getPath();
  if (StringUtils.isBlank(path)) {
    path=ROOT;
  }
  ContextHandlerCollection handlerCollection=new ContextHandlerCollection();
  Context root=new Context(handlerCollection,ROOT,Context.NO_SECURITY);
  root.setConnectorNames(new String[]{connector.getName()});
  root.addEventListener(new MuleServletContextListener(muleContext,getName()));
  if (!ROOT.equals(path)) {
    Context resourceContext=new Context(handlerCollection,path,Context.NO_SECURITY);
    populateContext(resourceContext);
  }
 else {
    populateContext(root);
  }
  ServletHolder holder=new ServletHolder();
  holder.setServlet(servlet);
  root.addServlet(holder,AJAX_PATH_SPEC);
  if (getInterval() != INT_VALUE_NOT_SET)   holder.setInitParameter("interval",Integer.toString(getInterval()));
  holder.setInitParameter("JSONCommented",Boolean.toString(isJsonCommented()));
  if (getLogLevel() != INT_VALUE_NOT_SET)   holder.setInitParameter("logLevel",Integer.toString(getLogLevel()));
  if (getMaxInterval() != INT_VALUE_NOT_SET)   holder.setInitParameter("maxInterval",Integer.toString(getMaxInterval()));
  if (getMultiFrameInterval() != INT_VALUE_NOT_SET)   holder.setInitParameter("multiFrameInterval",(Integer.toString(getMultiFrameInterval())));
  if (getTimeout() != INT_VALUE_NOT_SET)   holder.setInitParameter("timeout",Integer.toString(getTimeout()));
  if (getRefsThreshold() != INT_VALUE_NOT_SET)   holder.setInitParameter("refsThreshold",Integer.toString(getRefsThreshold()));
  holder.setInitParameter("requestAvailable",Boolean.toString(isRequestAvailable()));
  this.getHttpServer().addHandler(handlerCollection);
  return servlet;
}
