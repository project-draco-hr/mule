{
  if (deleteProperties != null && deleteProperties.size() > 0) {
    for (Iterator iterator=deleteProperties.iterator(); iterator.hasNext(); ) {
      Object o=iterator.next();
      context.getMessage().removeProperty(o.toString());
    }
  }
  if (addProperties != null && addProperties.size() > 0) {
    for (Iterator iterator=addProperties.entrySet().iterator(); iterator.hasNext(); ) {
      Map.Entry entry=(Map.Entry)iterator.next();
      if (entry.getKey() == null) {
        logger.error("Setting Null property keys is not supported, this entry is being ignored");
      }
 else {
        context.getMessage().setProperty(entry.getKey().toString(),entry.getValue());
      }
    }
  }
  return context.getMessage();
}
