{
  muleContext=Mockito.mock(MuleContext.class,Mockito.RETURNS_DEEP_STUBS);
  when(muleContext.getRegistry().lookupObject(eq(MuleProperties.DEFAULT_USER_OBJECT_STORE_NAME))).thenReturn(accessTokenObjectStore);
  when(muleContext.getRegistry().lookupTransformer(any(DataType.class),any(DataType.class))).thenReturn(transformer);
  manager=spy(new TestOAuth2Manager(objectFactory,adapter));
  manager.setMuleContext(muleContext);
  manager.setHttpUtil(httpUtil);
  manager.setOauthResponseParser(oauthResponseParser);
  manager.setScope(SCOPE);
  manager.setRefreshTokenManager(refreshTokenManager);
  manager.initialise();
  manager.start();
}
