{
  this.muleContext=Mockito.mock(MuleContext.class,Mockito.RETURNS_DEEP_STUBS);
  when(this.muleContext.getRegistry().lookupObject(Mockito.eq(MuleProperties.DEFAULT_USER_OBJECT_STORE_NAME))).thenReturn(this.accessTokenObjectStore);
  when(muleContext.getRegistry().lookupTransformer(Mockito.any(DataType.class),Mockito.any(DataType.class))).thenReturn(this.transformer);
  this.manager=Mockito.spy(new TestOAuth2Manager(this.objectFactory,this.adapter));
  this.manager.setMuleContext(this.muleContext);
  this.manager.setHttpUtil(this.httpUtil);
  this.manager.setOauthResponseParser(this.oauthResponseParser);
  this.manager.setScope(SCOPE);
  this.manager.setRefreshTokenManager(this.refreshTokenManager);
  this.manager.initialise();
  this.manager.start();
}
