{
  Flow flow=(Flow)getFlowConstruct("limitedConnections");
  Thread t1=processAsynchronously(flow);
  messageArrived.await();
  FlowRunner runner=flowRunner("limitedConnections");
  setEventTimeout(runner.buildEvent(),SMALL_RESPONSE_TIMEOUT);
  MessagingException e=runner.runExpectingException();
  assertThat(e,instanceOf(MessagingException.class));
  assertThat(e.getCause(),instanceOf(FilterException.class));
  messageHold.release();
  t1.join();
}
