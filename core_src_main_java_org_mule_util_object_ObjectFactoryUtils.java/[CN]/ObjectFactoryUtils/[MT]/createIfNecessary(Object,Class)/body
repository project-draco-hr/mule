{
  Object result;
  if (source instanceof ObjectFactory) {
    result=((ObjectFactory)source).create();
  }
 else {
    result=source;
  }
  if (null == result || !(clazz.isAssignableFrom(result.getClass()))) {
    throw new IllegalArgumentException("Unexpected instance or factory: " + source + " (expected "+ ClassUtils.getSimpleName(clazz)+ ")");
  }
  return result;
}
