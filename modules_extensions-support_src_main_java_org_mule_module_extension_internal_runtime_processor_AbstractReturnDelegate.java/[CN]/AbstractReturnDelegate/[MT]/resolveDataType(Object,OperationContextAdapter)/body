{
  String mimeType=operationContext.getTypeSafeParameter(MIME_TYPE_PARAMETER_NAME,String.class);
  String encoding=operationContext.getTypeSafeParameter(ENCODING_PARAMETER_NAME,String.class);
  if (encoding == null && mimeType == null) {
    if (value instanceof MuleMessage) {
      return ((MuleMessage)value).getDataType();
    }
    return null;
  }
  if (value == null || value instanceof NullPayload) {
    return null;
  }
  final DataType dataType=DataTypeFactory.create(value.getClass());
  if (encoding != null) {
    dataType.setEncoding(encoding);
  }
  if (mimeType != null) {
    dataType.setMimeType(mimeType);
  }
  return dataType;
}
