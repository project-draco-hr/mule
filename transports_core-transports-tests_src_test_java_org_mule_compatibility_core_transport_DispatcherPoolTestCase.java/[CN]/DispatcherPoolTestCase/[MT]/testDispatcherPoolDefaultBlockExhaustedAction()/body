{
  final TestConnector connector=createConnectorWithSingleObjectDispatcherPool(ThreadingProfile.WHEN_EXHAUSTED_WAIT);
  connector.setDispatcherPoolMaxWait(100);
  assertEquals(1,connector.dispatchers.getMaxActive());
  assertEquals(100,connector.dispatchers.getMaxWait());
  final OutboundEndpoint endpoint=getTestOutboundEndpoint("test","test://test");
  new Thread(new Runnable(){
    @Override public void run(){
      try {
        MessageDispatcher messageDispatcher=(MessageDispatcher)connector.dispatchers.borrowObject(endpoint);
        Thread.sleep(50);
        connector.dispatchers.returnObject(endpoint,messageDispatcher);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
).start();
  Thread.sleep(10);
  assertEquals(1,connector.dispatchers.getNumActive());
  connector.dispatchers.borrowObject(endpoint);
  assertEquals(1,connector.dispatchers.getNumActive());
}
