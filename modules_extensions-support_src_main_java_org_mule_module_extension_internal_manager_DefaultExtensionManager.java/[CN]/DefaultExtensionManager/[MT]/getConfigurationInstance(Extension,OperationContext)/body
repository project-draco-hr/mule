{
  List<ConfigurationInstanceProvider<?>> providers=extensionRegistry.getExtensionState(extension).getConfigurationInstanceProviders();
  int matches=providers.size();
  if (matches == 1) {
    ConfigurationInstanceProvider<?> provider=providers.get(0);
    return (C)provider.get(operationContext);
  }
 else   if (matches > 1) {
    throw new IllegalStateException(String.format("No config-ref was specified for operation '%s' of extension '%s', but %d are registered. Please specify which to use",operationContext.getOperation().getName(),extension.getName(),matches));
  }
 else {
    attemptToCreateImplicitConfigurationInstance(extension,operationContext);
    return getConfigurationInstance(extension,operationContext);
  }
}
