{
  List<ConfigurationProvider<?>> providers=extensionRegistry.getExtensionState(extensionModel).getConfigurationProviders();
  int matches=providers.size();
  if (matches == 1) {
    ConfigurationProvider<?> provider=providers.get(0);
    return new DeclaredConfiguration<>(provider.getName(),provider.getModel(),(C)provider.get(operationContext));
  }
 else   if (matches > 1) {
    throw new IllegalStateException(String.format("No config-ref was specified for operation '%s' of extension '%s', but %d are registered. Please specify which to use",operationContext.getOperationModel().getName(),extensionModel.getName(),matches));
  }
 else {
    if (attemptToCreateImplicitConfiguration(extensionModel,operationContext)) {
      return getConfiguration(extensionModel,operationContext);
    }
    throw new IllegalStateException(String.format("No config-ref was specified for operation '%s' of extension '%s' and no implicit configuration could be inferred. Please define one.",operationContext.getOperationModel().getName(),extensionModel.getName()));
  }
}
