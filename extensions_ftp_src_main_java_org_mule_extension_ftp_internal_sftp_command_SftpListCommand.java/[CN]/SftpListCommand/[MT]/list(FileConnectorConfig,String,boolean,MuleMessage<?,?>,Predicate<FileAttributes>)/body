{
  FileAttributes directoryAttributes=getExistingFile(config,directoryPath);
  Path path=Paths.get(directoryAttributes.getPath());
  if (!directoryAttributes.isDirectory()) {
    throw cannotListFileException(path);
  }
  TreeNode.Builder treeNodeBuilder=forDirectory(directoryAttributes);
  doList(config,directoryAttributes.getPath(),treeNodeBuilder,recursive,message,matcher);
  return treeNodeBuilder.build();
}
