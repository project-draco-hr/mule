{
  super.doInitialise();
  try {
    Map endpointProps=getEndpoint().getProperties();
    String wsdlUrl=(String)endpointProps.get(CxfConstants.WSDL_LOCATION);
    String bindingId=(String)endpointProps.get(CxfConstants.BINDING_ID);
    String frontend=(String)endpointProps.get(CxfConstants.FRONTEND);
    String serviceClassName=(String)endpointProps.get(CxfConstants.SERVICE_CLASS);
    String mtomEnabled=(String)endpointProps.get(CxfConstants.MTOM_ENABLED);
    List<DataBinding> databinding=(List<DataBinding>)endpointProps.get(CxfConstants.DATA_BINDING);
    List<AbstractFeature> features=(List<AbstractFeature>)endpointProps.get(CxfConstants.FEATURES);
    String proxyStr=(String)endpointProps.get(CxfConstants.PROXY);
    applyFiltersToProtocol=BooleanUtils.toBoolean((String)endpointProps.get(CxfConstants.APPLY_FILTERS_TO_PROTOCOL));
    applySecurityToProtocol=BooleanUtils.toBoolean((String)endpointProps.get(CxfConstants.APPLY_SECURITY_TO_PROTOCOL));
    applyTransformersToProtocol=BooleanUtils.toBoolean((String)endpointProps.get(CxfConstants.APPLY_TRANSFORMERS_TO_PROTOCOL));
    Class<?> svcCls=null;
    Class<?> targetCls;
    proxy=BooleanUtils.toBoolean(proxyStr);
    if (proxy) {
      svcCls=ProxyService.class;
      targetCls=svcCls;
      frontend="simple";
    }
 else {
      if (StringUtils.isEmpty(frontend)) {
        frontend=connector.getDefaultFrontend();
      }
      if (!StringUtils.isEmpty(serviceClassName)) {
        svcCls=ClassUtils.loadClass(serviceClassName,getClass());
      }
      targetCls=getTargetClass(svcCls);
      if (svcCls == null) {
        svcCls=targetCls;
      }
    }
    ServerFactoryBean sfb;
    if (CxfConstants.SIMPLE_FRONTEND.equals(frontend)) {
      sfb=new ServerFactoryBean();
      sfb.setDataBinding(new AegisDatabinding());
    }
 else     if (CxfConstants.JAX_WS_FRONTEND.equals(frontend)) {
      sfb=new JaxWsServerFactoryBean();
    }
 else {
      throw new CreateException(CxfMessages.invalidFrontend(frontend),this);
    }
    if (!proxy) {
      if (databinding != null && databinding.size() > 0) {
        sfb.setDataBinding(databinding.get(0));
      }
      if (service.getComponent() instanceof JavaComponent) {
        sfb.setServiceBean(((JavaComponent)service.getComponent()).getObjectFactory().getInstance());
      }
    }
 else {
      sfb.setDataBinding(new StaxDataBinding());
      sfb.getFeatures().add(new StaxDataBindingFeature());
      sfb.setServiceFactory(new ProxyServiceFactoryBean());
    }
    if (bindingId != null) {
      sfb.setBindingId(bindingId);
    }
    if (features != null) {
      sfb.getFeatures().addAll(features);
    }
    if (mtomEnabled != null) {
      Map<String,Object> properties=sfb.getProperties();
      if (properties == null) {
        properties=new HashMap<String,Object>();
        sfb.setProperties(properties);
      }
      properties.put("mtom-enabled",mtomEnabled);
    }
    sfb.setInInterceptors((List<Interceptor>)endpointProps.get("inInterceptors"));
    sfb.setInFaultInterceptors((List<Interceptor>)endpointProps.get("inFaultInterceptors"));
    sfb.setOutInterceptors((List<Interceptor>)endpointProps.get("outInterceptors"));
    sfb.setOutFaultInterceptors((List<Interceptor>)endpointProps.get("outFaultInterceptors"));
    if (sfb.getInInterceptors() == null) {
      sfb.setInInterceptors(new ArrayList<Interceptor>());
    }
    sfb.getInInterceptors().add(new MuleHeadersInInterceptor());
    if (sfb.getOutInterceptors() == null) {
      sfb.setOutInterceptors(new ArrayList<Interceptor>());
    }
    sfb.getOutInterceptors().add(new MuleProtocolHeadersOutInterceptor());
    if (sfb.getOutFaultInterceptors() == null) {
      sfb.setOutFaultInterceptors(new ArrayList<Interceptor>());
    }
    sfb.getOutFaultInterceptors().add(new MuleProtocolHeadersOutInterceptor());
    if (proxy) {
      sfb.getOutInterceptors().add(new OutputPayloadInterceptor());
    }
    sfb.setServiceClass(svcCls);
    sfb.setAddress(getAddressWithoutQuery());
    if (wsdlUrl != null) {
      sfb.setWsdlURL(wsdlUrl);
    }
    ReflectionServiceFactoryBean svcFac=sfb.getServiceFactory();
    addIgnoredMethods(svcFac,Callable.class.getName());
    addIgnoredMethods(svcFac,Initialisable.class.getName());
    addIgnoredMethods(svcFac,Disposable.class.getName());
    addIgnoredMethods(svcFac,ServiceAware.class.getName());
    String name=(String)endpointProps.get(CxfConstants.SERVICE_NAME);
    String namespace=(String)endpointProps.get(CxfConstants.NAMESPACE);
    initServiceName(svcCls,name,namespace,svcFac);
    boolean sync=endpoint.isSynchronous();
    if (endpoint.getEndpointURI().getScheme().startsWith("http") || endpoint.getEndpointURI().getScheme().startsWith("servlet")) {
      sync=true;
    }
    sfb.setInvoker(new MuleInvoker(this,targetCls,sync));
    sfb.setStart(false);
    Bus bus=connector.getCxfBus();
    sfb.setBus(bus);
    initializeServerFactory(sfb);
    Configurer configurer=bus.getExtension(Configurer.class);
    if (null != configurer) {
      configurer.configureBean(sfb.getServiceFactory().getEndpointName().toString(),sfb);
    }
    server=sfb.create();
  }
 catch (  MuleException e) {
    throw new InitialisationException(e,this);
  }
catch (  ClassNotFoundException e) {
    throw new InitialisationException(e,this);
  }
catch (  Exception e) {
    throw new InitialisationException(e,this);
  }
}
