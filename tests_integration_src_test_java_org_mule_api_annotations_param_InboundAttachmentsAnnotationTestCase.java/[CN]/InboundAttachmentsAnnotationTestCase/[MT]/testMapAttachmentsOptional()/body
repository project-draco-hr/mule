{
  Map<String,DataHandler> attachments=new HashMap<String,DataHandler>();
  attachments.put("foo",new DataHandler(new StringDataSource("fooValue")));
  attachments.put("bar",new DataHandler(new StringDataSource("barValue")));
  muleMessage=createMessage(null,attachments);
  MuleClient client=muleContext.getClient();
  MuleMessage message=client.send("vm://attachmentsOptional",muleMessage);
  assertNotNull("return message from MuleClient.send() should not be null",message);
  assertTrue("Message payload should be a Map",message.getPayload() instanceof Map);
  Map<String,DataHandler> result=getMapPayload(message);
  assertEquals(2,result.size());
  assertEquals("fooValue",result.get("foo").getContent());
  assertEquals("barValue",result.get("bar").getContent());
  assertNull(result.get("baz"));
}
