{
  Map<String,DataHandler> attachments=new HashMap<String,DataHandler>();
  attachments.put("foo",new DataHandler(new StringDataSource("fooValue")));
  attachments.put("baz",new DataHandler(new StringDataSource("bazValue")));
  muleMessage=createMessage(null,attachments);
  MuleClient client=muleContext.getClient();
  MuleMessage result=client.send("vm://attachmentsListOptional",muleMessage);
  assertNotNull(result);
  assertNotNull(result.getExceptionPayload());
  assertEquals(RequiredValueException.class,ExceptionUtils.getRootCause(result.getExceptionPayload().getException()).getClass());
}
