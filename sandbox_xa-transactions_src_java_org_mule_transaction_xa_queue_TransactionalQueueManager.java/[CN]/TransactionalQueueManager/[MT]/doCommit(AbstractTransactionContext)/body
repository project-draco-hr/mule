{
  try {
    QueueTransactionContext ctx=(QueueTransactionContext)context;
    if (ctx.added != null) {
      for (Iterator it=ctx.added.entrySet().iterator(); it.hasNext(); ) {
        Map.Entry entry=(Map.Entry)it.next();
        String queueName=(String)entry.getKey();
        List queueAdded=(List)entry.getValue();
        if (queueAdded != null && queueAdded.size() > 0) {
          Queue queue=getQueue(queueName);
          for (Iterator itAdded=queueAdded.iterator(); itAdded.hasNext(); ) {
            Object object=itAdded.next();
            Object id=doStore(queueName,object);
            queue.put(id);
          }
        }
      }
    }
    if (ctx.removed != null) {
      for (Iterator it=ctx.removed.entrySet().iterator(); it.hasNext(); ) {
        Map.Entry entry=(Map.Entry)it.next();
        String queueName=(String)entry.getKey();
        List queueRemoved=(List)entry.getValue();
        if (queueRemoved != null && queueRemoved.size() > 0) {
          for (Iterator itRemoved=queueRemoved.iterator(); itRemoved.hasNext(); ) {
            Object id=itRemoved.next();
            doRemove(queueName,id);
          }
        }
      }
    }
  }
 catch (  IOException e) {
    throw new ResourceManagerException("Could not persist object",e);
  }
}
