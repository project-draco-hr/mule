{
  ChoiceRouter choiceRouter=new ChoiceRouter();
  choiceRouter.addRoute(getAppendingMP("1"),new AcceptAllFilter());
  choiceRouter.addRoute(getAppendingMP("2"),new AcceptAllFilter());
  choiceRouter.addRoute(getAppendingMP("3"),new AcceptAllFilter());
  final DefaultMessageProcessorChain chain=DefaultMessageProcessorChain.from(muleContext,choiceRouter);
  chain.setTemplateMuleContext(muleContext);
  assertThat(process(chain,getTestEventUsingFlow("0")).getMessage().getPayload().getValue(),equalTo("01"));
  assertEquals(isMultipleThreadsUsed() ? 2 : 1,threads);
}
