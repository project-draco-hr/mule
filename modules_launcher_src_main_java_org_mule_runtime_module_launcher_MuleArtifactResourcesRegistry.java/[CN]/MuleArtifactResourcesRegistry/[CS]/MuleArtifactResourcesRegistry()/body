{
  containerClassLoader=new ContainerClassLoaderFactory().createContainerClassLoader(getClass().getClassLoader());
  domainManager=new DefaultDomainManager();
  domainClassLoaderFactory=new DomainClassLoaderFactory(containerClassLoader.getClassLoader());
  domainFactory=new DefaultDomainFactory(domainClassLoaderFactory,domainManager,containerClassLoader);
  artifactPluginFactory=new DefaultArtifactPluginFactory(new ArtifactPluginClassLoaderFactory());
  final ArtifactPluginDescriptorFactory artifactPluginDescriptorFactory=new ArtifactPluginDescriptorFactory(new DefaultArtifactClassLoaderFilterFactory());
  artifactPluginRepository=new DefaultArtifactPluginRepository(artifactPluginDescriptorFactory);
  artifactPluginDescriptorLoader=new ArtifactPluginDescriptorLoader(artifactPluginDescriptorFactory);
  final ApplicationDescriptorFactory applicationDescriptorFactory=new ApplicationDescriptorFactory(artifactPluginDescriptorLoader,artifactPluginRepository);
  MuleApplicationClassLoaderFactory applicationClassLoaderFactory=new MuleApplicationClassLoaderFactory(new DefaultNativeLibraryFinderFactory());
  ApplicationClassLoaderBuilderFactory applicationClassLoaderBuilderFactory=new ApplicationClassLoaderBuilderFactory(applicationClassLoaderFactory,artifactPluginRepository,artifactPluginFactory);
  serviceManager=new MuleServiceManager(new DefaultServiceDiscoverer(new FileSystemServiceProviderDiscoverer(containerClassLoader,new ServiceClassLoaderFactory()),new ReflectionServiceResolver(new ReflectionServiceProviderResolutionHelper())));
  applicationFactory=new DefaultApplicationFactory(applicationClassLoaderBuilderFactory,applicationDescriptorFactory,artifactPluginRepository,domainManager,serviceManager);
  temporaryArtifactClassLoaderBuilderFactory=new TemporaryArtifactClassLoaderBuilderFactory(artifactPluginRepository,artifactPluginFactory);
}
