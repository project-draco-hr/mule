{
  digester.addRule(path,new Rule(){
    public void begin(    String s,    String s1,    Attributes attributes) throws Exception {
      attributes=processAttributes(attributes,s1);
      String clazz=attributes.getValue("factory");
      String name=attributes.getValue("name");
      Object props=digester.peek();
      Object obj=ClassHelper.instanciateClass(clazz,ClassHelper.NO_ARGS);
      if (obj instanceof PropertyFactory) {
        if (props instanceof Map) {
          obj=((PropertyFactory)obj).create((Map)props);
        }
 else {
          obj=((PropertyFactory)obj).create((Map)digester.peek(1));
        }
      }
      if (obj != null) {
        if (props instanceof Map) {
          ((Map)props).put(name,obj);
        }
 else {
          ((List)props).add(obj);
        }
      }
    }
  }
);
}
