{
  if (logger.isDebugEnabled()) {
    logger.debug("Attempting to apply lifecycle phase: " + getName());
  }
  Set duplicates=new HashSet();
  for (Iterator iterator=orderedLifecycleObjects.iterator(); iterator.hasNext(); ) {
    LifecycleObject lo=(LifecycleObject)iterator.next();
    List targets=new LinkedList(CollectionUtils.select(objects,new InstanceofPredicate(lo.getType())));
    if (targets.size() > 0) {
      lo.firePreNotification(MuleServer.getMuleContext());
      for (int retryCount=0; retryCount < RETRY_MAX && targets.size() > 0; ++retryCount) {
        for (Iterator target=targets.iterator(); target.hasNext(); ) {
          Object o=target.next();
          if (duplicates.contains(o)) {
            target.remove();
          }
 else {
            if (logger.isDebugEnabled()) {
              logger.debug("lifecycle phase: " + getName() + " for object: "+ o);
            }
            LifecycleTransitionResult result=applyLifecycle(o);
            if (result.isOk()) {
              target.remove();
              duplicates.add(o);
            }
 else             if (retryCount + 1 == RETRY_MAX) {
              throw (LifecycleException)new LifecycleException(CoreMessages.exceededRetry(getName(),o),o).initCause(result.getThrowable());
            }
 else {
              logger.debug("Retry requested for " + o);
            }
          }
        }
      }
      lo.firePostNotification(MuleServer.getMuleContext());
    }
  }
}
