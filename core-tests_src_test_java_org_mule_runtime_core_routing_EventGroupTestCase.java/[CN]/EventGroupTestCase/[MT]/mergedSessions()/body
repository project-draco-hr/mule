{
  EventGroup eg=new EventGroup(UUID.getUUID(),muleContext);
  eg.initEventsStore(objectStore);
  assertFalse(eg.iterator().hasNext());
  Event event1=eventBuilder().message(InternalMessage.of("foo1")).build();
  Event event2=eventBuilder().message(InternalMessage.of("foo2")).build();
  Event event3=eventBuilder().message(InternalMessage.of("foo3")).build();
  event1.getSession().setProperty("key1","value1");
  event1.getSession().setProperty("key2","value2");
  event2.getSession().setProperty("KEY2","value2NEW");
  event2.getSession().setProperty("key3","value3");
  event3.getSession().setProperty("key4","value4");
  eg.addEvent(event1);
  System.out.println(event1.getSession());
  eg.addEvent(event2);
  System.out.println(event2.getSession());
  eg.addEvent(event3);
  System.out.println(event3.getSession());
  Event result=eg.getMessageCollectionEvent();
  assertEquals("value1",result.getSession().getProperty("key1"));
  assertEquals("value3",result.getSession().getProperty("key3"));
  assertEquals("value4",result.getSession().getProperty("key4"));
}
