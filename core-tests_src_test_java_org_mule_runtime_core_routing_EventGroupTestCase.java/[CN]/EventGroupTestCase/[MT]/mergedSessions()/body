{
  EventGroup eg=new EventGroup(UUID.getUUID(),muleContext);
  eg.initEventsStore(objectStore);
  assertFalse(eg.iterator().hasNext());
  Event event1=getTestEvent("foo1");
  Event event2=getTestEvent("foo2");
  Event event3=getTestEvent("foo3");
  event1.getSession().setProperty("key1","value1");
  event1.getSession().setProperty("key2","value2");
  event2.getSession().setProperty("KEY2","value2NEW");
  event2.getSession().setProperty("key3","value3");
  event3.getSession().setProperty("key4","value4");
  eg.addEvent(event1);
  System.out.println(event1.getSession());
  eg.addEvent(event2);
  System.out.println(event2.getSession());
  eg.addEvent(event3);
  System.out.println(event3.getSession());
  Event result=eg.getMessageCollectionEvent();
  assertEquals("value1",result.getSession().getProperty("key1"));
  assertEquals("value3",result.getSession().getProperty("key3"));
  assertEquals("value4",result.getSession().getProperty("key4"));
}
