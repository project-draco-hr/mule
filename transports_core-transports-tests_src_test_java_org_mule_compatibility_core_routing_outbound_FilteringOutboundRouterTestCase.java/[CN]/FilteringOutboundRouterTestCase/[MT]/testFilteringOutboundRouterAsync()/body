{
  OutboundEndpoint endpoint1=getTestOutboundEndpoint("Test1Provider","test://Test1Provider?exchangePattern=request-response");
  assertNotNull(endpoint1);
  OutboundEndpoint mockEndpoint=RouterTestUtils.createMockEndpoint(endpoint1);
  FilteringOutboundRouter router=new EndpointMulticastingRouter();
  router.setMuleContext(muleContext);
  PayloadTypeFilter filter=new PayloadTypeFilter(String.class);
  router.setMuleContext(muleContext);
  router.setFilter(filter);
  List<Processor> endpoints=new ArrayList<>();
  endpoints.add(mockEndpoint);
  router.setRoutes(endpoints);
  assertTrue(router.isUseTemplates());
  assertEquals(filter,router.getFilter());
  InternalMessage message=InternalMessage.builder().payload("test event").build();
  Event event=eventBuilder().message(message).build();
  assertTrue(router.isMatch(event,mock(Event.Builder.class)));
  when(mockEndpoint.process(any(Event.class))).thenAnswer(new MuleEventCheckAnswer());
  MuleSession session=mock(MuleSession.class);
  router.route(eventBuilder().message(message).session(session).build());
  message=InternalMessage.builder().payload(new Exception("test event")).build();
  event=eventBuilder().message(message).build();
  assertTrue(!router.isMatch(event,mock(Event.Builder.class)));
  router.setTransformers(Arrays.<Transformer>asList(new AbstractTransformer(){
    @Override public Object doTransform(    Object src,    Charset outputEncoding) throws TransformerException {
      return ((Exception)src).getMessage();
    }
  }
));
  event=eventBuilder().message(message).build();
  assertTrue(router.isMatch(event,mock(Event.Builder.class)));
}
