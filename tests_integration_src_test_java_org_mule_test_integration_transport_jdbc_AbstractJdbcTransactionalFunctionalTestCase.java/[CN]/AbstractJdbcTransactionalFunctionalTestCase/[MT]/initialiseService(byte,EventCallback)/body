{
  Flow flow=new Flow("flow",muleContext);
  flow.setExceptionListener(new DefaultMessagingExceptionStrategy(muleContext));
  flow.setMessageProcessors(new ArrayList<MessageProcessor>());
  flow.getMessageProcessors().add(new DefaultJavaComponent(new PrototypeObjectFactory(JdbcFunctionalTestComponent.class)));
  TransactionFactory tf=getTransactionFactory();
  TransactionConfig txConfig=new MuleTransactionConfig(txBeginAction);
  txConfig.setFactory(tf);
  EndpointBuilder endpointBuilder=new EndpointURIEndpointBuilder(getInDest(),muleContext);
  endpointBuilder.setName("testIn");
  endpointBuilder.setConnector(connector);
  endpointBuilder.setTransactionConfig(txConfig);
  InboundEndpoint endpoint=muleContext.getEndpointFactory().getInboundEndpoint(endpointBuilder);
  EndpointBuilder endpointBuilder2=new EndpointURIEndpointBuilder(getOutDest(),muleContext);
  endpointBuilder2.setName("testOut");
  endpointBuilder2.setConnector(connector);
  OutboundEndpoint outProvider=muleContext.getEndpointFactory().getOutboundEndpoint(endpointBuilder2);
  flow.getMessageProcessors().add(outProvider);
  flow.setMessageSource(endpoint);
  muleContext.getRegistry().registerFlowConstruct(flow);
  return flow;
}
