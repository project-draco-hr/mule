{
  try {
    DefaultMuleSession session=new DefaultMuleSession(new DefaultLocalMuleClient.MuleClientFlowConstruct(),muleContext);
    if (user != null) {
      message.setOutboundProperty(MuleProperties.MULE_USER_PROPERTY,MuleCredentials.createHeader(user.getUsername(),user.getPassword()));
    }
    return new DefaultMuleEvent(message,endpoint,session);
  }
 catch (  Exception e) {
    throw new DispatchException(CoreMessages.failedToCreate("Client event"),message,endpoint,e);
  }
}
