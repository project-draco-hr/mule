{
  String ackExpression="some-expression";
  String expressionEvalutaionResult="new payload";
  when(mockUntilSuccessfulConfiguration.getAckExpression()).thenReturn(ackExpression);
  TypedValue mockTypedValue=mock(TypedValue.class);
  when(mockTypedValue.getValue()).thenReturn(expressionEvalutaionResult);
  when(mockUntilSuccessfulConfiguration.getMuleContext().getExpressionManager().evaluate(ackExpression,event)).thenReturn(mockTypedValue);
  final Event result=executeUntilSuccessful();
  waitUntilRouteIsExecuted();
  verify(mockRoute,times(1)).process(any(Event.class));
  verify(mockUntilSuccessfulConfiguration.getMuleContext().getExpressionManager(),times(1)).evaluate(eq(ackExpression),any(Event.class));
  assertThat(result.getMessage().getPayload().getValue(),is(expressionEvalutaionResult));
  verify(mockFlow.getExceptionListener(),never()).handleException(any(MessagingException.class),eq(event));
}
