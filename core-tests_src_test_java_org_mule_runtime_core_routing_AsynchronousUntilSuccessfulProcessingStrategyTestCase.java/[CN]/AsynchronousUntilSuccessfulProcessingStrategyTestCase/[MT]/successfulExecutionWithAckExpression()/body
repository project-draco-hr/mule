{
  String ackExpression="some-expression";
  String expressionEvalutaionResult="new payload";
  when(mockUntilSuccessfulConfiguration.getAckExpression()).thenReturn(ackExpression);
  when(mockUntilSuccessfulConfiguration.getMuleContext().getExpressionLanguage().evaluate(ackExpression,event,null)).thenReturn(expressionEvalutaionResult);
  final MuleEvent result=executeUntilSuccessful();
  waitUntilRouteIsExecuted();
  verify(mockRoute,times(1)).process(any(MuleEvent.class));
  verify(mockUntilSuccessfulConfiguration.getMuleContext().getExpressionLanguage(),times(1)).evaluate(eq(ackExpression),any(MuleEvent.class),eq(null));
  assertThat(result.getMessage().getPayload(),is(expressionEvalutaionResult));
  verify(mockFlow.getExceptionListener(),never()).handleException(any(MessagingException.class),eq(event));
}
