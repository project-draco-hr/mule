{
  String recordDescriptor=(String)endpointUri.getParams().get(DQConnector.RECORD_DESCRIPTOR_PROPERTY);
  if (recordDescriptor == null) {
    if (connector.getFormat() == null) {
      throw new IllegalArgumentException("Property " + DQConnector.RECORD_DESCRIPTOR_PROPERTY + " must be set on the endpoint");
    }
 else {
      if (logger.isDebugEnabled()) {
        logger.debug("Defaulting to connector format: " + connector.getRecordFormat());
      }
      return connector.getFormat();
    }
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Using endpoint-specific format: " + connector.getRecordFormat());
  }
  return DQMessageUtils.getRecordFormat(recordDescriptor,connector.getSystem());
}
