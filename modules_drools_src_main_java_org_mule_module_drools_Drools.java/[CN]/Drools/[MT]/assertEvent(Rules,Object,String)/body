{
  StatefulKnowledgeSession session=((DroolsSessionData)rules.getSessionData()).getSession();
  WorkingMemoryEntryPoint wmEntryPoint;
  if (entryPoint != null) {
    wmEntryPoint=session.getWorkingMemoryEntryPoint(entryPoint);
  }
 else {
    Collection entryPoints=session.getWorkingMemoryEntryPoints();
    if (entryPoints.size() > 1) {
      throw new ConfigurationException(MessageFactory.createStaticMessage("Rules contain more than one entry point but none has been specified"));
    }
    wmEntryPoint=(WorkingMemoryEntryPoint)entryPoints.iterator().next();
  }
  FactHandle handle=session.getFactHandle(event);
  if (handle != null) {
    wmEntryPoint.update(handle,event);
  }
 else {
    handle=wmEntryPoint.insert(event);
  }
  session.fireAllRules();
  return handle;
}
