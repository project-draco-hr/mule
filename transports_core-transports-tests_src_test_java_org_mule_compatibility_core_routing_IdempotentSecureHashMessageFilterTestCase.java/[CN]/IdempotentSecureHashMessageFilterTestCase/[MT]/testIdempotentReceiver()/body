{
  InboundEndpoint endpoint1=getTestInboundEndpoint("Test1Provider","test://Test1Provider?exchangePattern=one-way");
  Flow flow=getTestFlow(muleContext);
  MuleSession session=mock(MuleSession.class);
  IdempotentSecureHashMessageFilter ir=new IdempotentSecureHashMessageFilter();
  ir.setFlowConstruct(flow);
  ir.setThrowOnUnaccepted(false);
  ir.setStorePrefix("foo");
  ir.setStore(new InMemoryObjectStore<String>());
  ir.setMuleContext(muleContext);
  final EventContext context=DefaultEventContext.create(flow,TEST_CONNECTOR);
  InternalMessage okMessage=InternalMessage.builder().payload("OK").build();
  Event event=Event.builder(context).message(okMessage).flow(getTestFlow(muleContext)).session(session).build();
  event=populateFieldsFromInboundEndpoint(event,endpoint1);
  Event processedEvent=ir.process(event);
  assertNotNull(processedEvent);
  okMessage=InternalMessage.builder().payload("OK").build();
  event=Event.builder(context).message(okMessage).flow(getTestFlow(muleContext)).session(session).build();
  event=populateFieldsFromInboundEndpoint(event,endpoint1);
  processedEvent=ir.process(event);
  assertNull(processedEvent);
  okMessage=InternalMessage.builder().payload("Not OK").build();
  event=Event.builder(context).message(okMessage).flow(getTestFlow(muleContext)).session(session).build();
  event=populateFieldsFromInboundEndpoint(event,endpoint1);
  processedEvent=ir.process(event);
  assertNotNull(processedEvent);
}
