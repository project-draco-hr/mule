{
  try {
    if (dataSourceFactory != null) {
      dataSource=(DataSource)dataSourceFactory.getOrCreate();
    }
 else {
      if (dataSource == null) {
        initJndiContext();
        createDataSource();
      }
    }
    if (dataSource != null && dataSource instanceof XADataSource) {
      final TransactionManager tm=managementContext.getTransactionManager();
      if (tm != null) {
        dataSource=new DataSourceWrapper((XADataSource)dataSource,tm);
      }
    }
  }
 catch (  Exception e) {
    throw new InitialisationException(CoreMessages.failedToCreate("Jdbc Connector"),e,this);
  }
}
