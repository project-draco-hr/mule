{
  try {
    if (dataSourceFactory != null) {
      dataSource=(DataSource)dataSourceFactory.getOrCreate();
    }
 else {
      if (dataSource == null) {
        initJndiContext();
        createDataSource();
      }
    }
    if (dataSource != null && dataSource instanceof XADataSource) {
      final TransactionManager tm=managementContext.getTransactionManager();
      if (tm != null) {
        dataSource=new DataSourceWrapper((XADataSource)dataSource,tm);
      }
    }
    if (propertyExtractors.isEmpty()) {
      propertyExtractors=new HashSet();
      ObjectFactory of;
      of=new SimpleObjectFactory(MessagePropertyExtractor.class);
      of.initialise();
      propertyExtractors.add(of);
      of=new SimpleObjectFactory(NowPropertyExtractor.class);
      of.initialise();
      propertyExtractors.add(of);
      of=new SimpleObjectFactory(PayloadPropertyExtractor.class);
      of.initialise();
      propertyExtractors.add(of);
      of=new SimpleObjectFactory(MapPropertyExtractor.class);
      of.initialise();
      propertyExtractors.add(of);
      of=new SimpleObjectFactory(BeanPropertyExtractor.class);
      of.initialise();
      propertyExtractors.add(of);
      if (ClassUtils.isClassOnPath("org.mule.util.properties.Dom4jPropertyExtractor",getClass())) {
        of=new SimpleObjectFactory("org.mule.util.properties.Dom4jPropertyExtractor");
        of.initialise();
        propertyExtractors.add(of);
      }
      if (ClassUtils.isClassOnPath("org.mule.util.properties.JDomPropertyExtractor",getClass())) {
        of=new SimpleObjectFactory("org.mule.util.properties.JDomPropertyExtractor");
        of.initialise();
        propertyExtractors.add(of);
      }
    }
  }
 catch (  Exception e) {
    throw new InitialisationException(CoreMessages.failedToCreate("Jdbc Connector"),e,this);
  }
}
