{
  MuleEvent mockEvent=mock(MuleEvent.class);
  final MuleEvent mockResponse=mock(MuleEvent.class);
  MuleEventKeyGenerator keyGenerator=mock(MuleEventKeyGenerator.class);
  when(keyGenerator.generateKey(mockEvent)).thenReturn(OBJECT_KEY);
  ObjectStore<MuleEvent> objectStore=mock(ObjectStore.class);
  when(objectStore.retrieve(OBJECT_KEY)).thenReturn(null);
  Filter consumablePayloadFilter=mock(Filter.class);
  when(consumablePayloadFilter.accept(Mockito.<MuleMessage>any())).thenReturn(true);
  ObjectStoreCachingStrategy cachingStrategy=new ObjectStoreCachingStrategy();
  cachingStrategy.setKeyGenerator(keyGenerator);
  cachingStrategy.setStore(objectStore);
  cachingStrategy.setConsumableFilter(consumablePayloadFilter);
  MessageProcessor cachedMessageProcessor=mock(MessageProcessor.class);
  when(cachedMessageProcessor.process(mockEvent)).thenReturn(mockResponse);
  MuleEvent response=cachingStrategy.process(mockEvent,cachedMessageProcessor);
  assertSame(mockResponse,response);
  Mockito.verify(objectStore,Mockito.times(1)).store(OBJECT_KEY,mockResponse);
}
