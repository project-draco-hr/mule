{
  MuleClient client=new MuleClient();
  MuleMessage result=client.send("inboundEndpoint","some data",null);
  assertNotNull(result);
  assertEquals("foo header not received",result.getPayloadAsString());
  Map props=new HashMap();
  props.put("foo","bar");
  result=client.send("inboundEndpoint","some data",props);
  assertNotNull(result);
  assertEquals("foo header received",result.getPayloadAsString());
  result=client.request("receivedEndpoint",TIMEOUT);
  assertNotNull(result);
  assertEquals("foo header received",result.getPayloadAsString());
  result=client.request("notReceivedEndpoint",TIMEOUT);
  assertNotNull(result);
  assertEquals("foo header not received",result.getPayloadAsString());
}
