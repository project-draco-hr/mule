{
  this.localUrl=url.replaceFirst(domain,"localhost");
  if (localUrl.indexOf((":" + String.valueOf(remotePort))) == -1) {
    this.localUrl=localUrl.replaceFirst("localhost",("localhost:" + String.valueOf(localPort)));
  }
 else {
    this.localUrl=localUrl.replaceFirst(String.valueOf(remotePort),String.valueOf(localPort));
  }
  String dynamicFlowName=String.format("DynamicFlow-%s",localUrl);
  flowConstruct=new Flow(dynamicFlowName,muleContext);
  flowConstruct.setMessageSource(createHttpInboundEndpoint());
  MessageProcessor messageProcessor;
  if (callbackFlow != null) {
    messageProcessor=new DefaultHttpCallback.FlowRefMessageProcessor();
  }
 else {
    messageProcessor=callbackMessageProcessor;
  }
  if (async) {
    messageProcessor=wrapMessageProcessorInAsyncChain(messageProcessor);
  }
  List<MessageProcessor> messageProcessors=new ArrayList<MessageProcessor>();
  messageProcessors.add(messageProcessor);
  flowConstruct.setMessageProcessors(messageProcessors);
  if (exceptionHandler != null) {
    flowConstruct.setExceptionListener(exceptionHandler);
  }
  flowConstruct.initialise();
  flowConstruct.start();
  LOGGER.debug(String.format("Created flow with http inbound endpoint listening at: %s",url));
}
