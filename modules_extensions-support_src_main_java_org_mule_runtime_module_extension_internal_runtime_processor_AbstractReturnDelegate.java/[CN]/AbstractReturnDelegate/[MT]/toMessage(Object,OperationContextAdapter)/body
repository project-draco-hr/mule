{
  MediaType mediaType=resolveMediaType(value,operationContext);
  if (value instanceof MuleMessage) {
    MuleMessage outputMessage=(MuleMessage)value;
    return MuleMessage.builder().payload(outputMessage.getPayload()).mediaType(mediaType).attributes(resolveAttributes(outputMessage,operationContext)).build();
  }
 else {
    return MuleMessage.builder().payload(value).mediaType(mediaType).attributes(operationContext.getEvent().getMessage().getAttributes()).build();
  }
}
