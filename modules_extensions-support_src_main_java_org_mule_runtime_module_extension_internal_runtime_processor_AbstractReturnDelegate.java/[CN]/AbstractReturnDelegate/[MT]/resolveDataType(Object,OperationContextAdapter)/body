{
  String mimeType=operationContext.getTypeSafeParameter(MIME_TYPE_PARAMETER_NAME,String.class);
  String encoding=operationContext.getTypeSafeParameter(ENCODING_PARAMETER_NAME,String.class);
  if (encoding == null && mimeType == null) {
    if (value instanceof MuleMessage) {
      return ((MuleMessage)value).getDataType();
    }
    return null;
  }
  if (value == null || value instanceof NullPayload) {
    return null;
  }
  return DataTypeFactory.create(value.getClass(),mimeType,encoding);
}
