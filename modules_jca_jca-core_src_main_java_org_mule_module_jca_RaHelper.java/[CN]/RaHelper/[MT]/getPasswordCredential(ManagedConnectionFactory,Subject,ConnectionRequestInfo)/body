{
  if (subject == null) {
    if (info == null) {
      return null;
    }
 else {
      MuleConnectionRequestInfo muleInfo=(MuleConnectionRequestInfo)info;
      if (muleInfo.getUserName() == null || muleInfo.getPassword() == null) {
        return null;
      }
      char[] password=muleInfo.getPassword().toCharArray();
      PasswordCredential pc=new PasswordCredential(muleInfo.getUserName(),password);
      pc.setManagedConnectionFactory(mcf);
      return pc;
    }
  }
 else {
    PasswordCredential pc=(PasswordCredential)AccessController.doPrivileged(new PrivilegedAction(){
      public Object run(){
        Set creds=subject.getPrivateCredentials(PasswordCredential.class);
        Iterator iter=creds.iterator();
        while (iter.hasNext()) {
          PasswordCredential candidate=(PasswordCredential)iter.next();
          if (candidate != null) {
            ManagedConnectionFactory candidatemcf=candidate.getManagedConnectionFactory();
            if (candidatemcf != null && candidatemcf.equals(mcf)) {
              return candidate;
            }
          }
        }
        return null;
      }
    }
);
    if (pc == null) {
      throw new java.lang.SecurityException(CoreMessages.authNoCredentials().getMessage());
    }
 else {
      return pc;
    }
  }
}
