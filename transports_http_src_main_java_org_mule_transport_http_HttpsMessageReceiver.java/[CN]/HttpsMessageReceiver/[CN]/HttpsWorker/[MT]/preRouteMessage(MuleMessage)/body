{
  try {
    long timeout=((HttpsConnector)getConnector()).getSslHandshakeTimeout();
    boolean handshakeComplete=getServerConnection().getSslSocketHandshakeCompleteLatch().await(timeout,TimeUnit.MILLISECONDS);
    if (!handshakeComplete) {
      throw new MessagingException(HttpMessages.sslHandshakeDidNotComplete(),message);
    }
  }
 catch (  InterruptedException e) {
    throw new MessagingException(HttpMessages.sslHandshakeDidNotComplete(),message,e);
  }
  super.preRouteMessage(message);
  if (getServerConnection().getPeerCertificateChain() != null) {
    message.setOutboundProperty(HttpsConnector.PEER_CERTIFICATES,getServerConnection().getPeerCertificateChain());
  }
  if (getServerConnection().getLocalCertificateChain() != null) {
    message.setOutboundProperty(HttpsConnector.LOCAL_CERTIFICATES,getServerConnection().getLocalCertificateChain());
  }
}
