{
  if (transport == null) {
    UMOEndpointURI uri=endpoint.getEndpointURI();
    String host=uri.getHost();
    if (host == null) {
      host=connector.getHost();
    }
    int port=uri.getPort();
    if (port == -1) {
      port=connector.getPort();
    }
    String username=uri.getUsername();
    if (StringUtils.isBlank(username)) {
      username=connector.getUsername();
    }
    String password=uri.getPassword();
    if (StringUtils.isBlank(password)) {
      password=connector.getPassword();
    }
    URLName url=new URLName(connector.getProtocol(),host,port,null,username,password);
    try {
      session=connector.getMailSession(url);
      session.setDebug(logger.isDebugEnabled());
      transport=session.getTransport(url);
      transport.connect(uri.getHost(),uri.getPort(),uri.getUsername(),uri.getPassword());
    }
 catch (    Exception e) {
      throw new EndpointException(org.mule.config.i18n.Message.createStaticMessage("Unable to connect to mail transport."),e);
    }
  }
}
