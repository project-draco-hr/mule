{
  try {
    muleContext.registerListener(this);
  }
 catch (  NotificationException e) {
    throw new InitialisationException(e,this);
  }
  if (xfire == null) {
    xfire=new DefaultXFire();
  }
  if (clientServices != null) {
    ObjectServiceFactory factory=new ObjectServiceFactory();
    configureBindingProvider(factory);
    for (int i=0; i < clientServices.size(); i++) {
      try {
        Class clazz=ClassUtils.loadClass(clientServices.get(i).toString(),this.getClass());
        Service service=factory.create(clazz);
        xfire.getServiceRegistry().register(service);
      }
 catch (      ClassNotFoundException e) {
        throw new InitialisationException(XFireMessages.couldNotInitAnnotationProcessor(clientServices.get(i)),e,this);
      }
    }
  }
  if (serviceFactory == null) {
    if (enableJSR181Annotations) {
      if (!SystemUtils.isJavaVersionAtLeast(150)) {
        throw new InitialisationException(XFireMessages.annotationsRequireJava5(),this);
      }
      try {
        WebAnnotations wa=(WebAnnotations)ClassUtils.instanciateClass(CLASSNAME_ANNOTATIONS,null,this.getClass());
        serviceFactory=new AnnotationServiceFactory(wa,xfire.getTransportManager());
        configureBindingProvider((ObjectServiceFactory)serviceFactory);
      }
 catch (      Exception ex) {
        throw new InitialisationException(XFireMessages.couldNotInitAnnotationProcessor(CLASSNAME_ANNOTATIONS),ex,this);
      }
    }
 else {
      serviceFactory=new MuleObjectServiceFactory(xfire.getTransportManager());
      configureBindingProvider((ObjectServiceFactory)serviceFactory);
    }
  }
  if (serviceFactory instanceof ObjectServiceFactory) {
    ObjectServiceFactory osf=(ObjectServiceFactory)serviceFactory;
    if (osf.getTransportManager() == null) {
      osf.setTransportManager(xfire.getTransportManager());
    }
  }
  UMOWorkManager wm=this.getReceiverThreadingProfile().createWorkManager("xfire-local-transport");
  try {
    wm.start();
  }
 catch (  UMOException e) {
    throw new MuleRuntimeException(CoreMessages.failedToStart("local channel work manager"),e);
  }
  createLocalTransport(wm);
  xfire.getTransportManager().register(transport);
  universalTransport=new MuleUniversalTransport();
  xfire.getTransportManager().register(universalTransport);
}
