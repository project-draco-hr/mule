{
  if (xfireDescriptor == null) {
    xfireDescriptor=(MuleDescriptor)managementContext.getRegistry().lookupModel(ModelHelper.SYSTEM_MODEL).getDescriptor(XFIRE_SERVICE_COMPONENT_NAME + getName());
    if (xfireDescriptor == null) {
      xfireDescriptor=createxfireDescriptor();
    }
 else {
      managementContext.getRegistry().lookupModel(ModelHelper.SYSTEM_MODEL).unregisterComponent(xfireDescriptor);
    }
    if (xfireDescriptor.getProperties().get(XFIRE_PROPERTY) == null) {
      xfireDescriptor.getProperties().put(XFIRE_PROPERTY,xfire);
    }
    if (serviceTransport != null && xfireDescriptor.getProperties().get(XFIRE_TRANSPORT) == null) {
      xfireDescriptor.getProperties().put(XFIRE_TRANSPORT,serviceTransport);
    }
  }
  String serviceName=receiver.getComponent().getDescriptor().getName();
  String endpoint=receiver.getEndpointURI().getAddress();
  String scheme=ep.getScheme().toLowerCase();
  boolean sync=false;
  if (scheme.equals("http") || scheme.equals("https") || scheme.equals("ssl")|| scheme.equals("tcp")|| scheme.equals("servlet")) {
    endpoint+="/" + serviceName;
    receiver.getEndpoint().getProperties().put(HttpConnector.HTTP_METHOD_PROPERTY,"POST");
    receiver.getEndpoint().getProperties().put(HttpConstants.HEADER_CONTENT_TYPE,"text/xml");
    if (!receiver.getEndpoint().isSynchronousSet()) {
      sync=true;
    }
  }
 else {
    sync=receiver.getEndpoint().isSynchronous();
  }
  UMOEndpoint serviceEndpoint=new MuleEndpoint(endpoint,true);
  serviceEndpoint.setSynchronous(sync);
  serviceEndpoint.setName(ep.getScheme() + ":" + serviceName);
  serviceEndpoint.setTransformer(receiver.getEndpoint().getTransformer());
  receiver.getEndpoint().setTransformer(null);
  serviceEndpoint.setResponseTransformer(receiver.getEndpoint().getResponseTransformer());
  receiver.getEndpoint().setResponseTransformer(null);
  serviceEndpoint.setFilter(receiver.getEndpoint().getFilter());
  receiver.getEndpoint().setFilter(null);
  serviceEndpoint.setSecurityFilter(receiver.getEndpoint().getSecurityFilter());
  receiver.getEndpoint().setSecurityFilter(null);
  xfireDescriptor.getInboundRouter().addEndpoint(serviceEndpoint);
}
