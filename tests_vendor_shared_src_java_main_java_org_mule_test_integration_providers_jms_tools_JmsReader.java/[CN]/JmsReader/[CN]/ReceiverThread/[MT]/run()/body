{
  Message message=null;
  while (noOfMessages >= msgCount || !shutdown) {
    try {
      message=consumer.receive(1000);
      if (message != null) {
        logger.info("\n***** onMessage: Message received");
        if (message instanceof TextMessage) {
          logger.info("Message Content is: " + ((TextMessage)message).getText());
        }
 else {
          logger.info("Message is: " + message.toString());
        }
        msgCount++;
      }
 else {
        logger.debug("Receive timed out");
      }
    }
 catch (    JMSException e) {
      logger.error("failed: " + e,e);
      System.exit(0);
    }
  }
  close();
}
