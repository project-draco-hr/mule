{
  boolean persistent=true;
  int capacity=345;
  String queueName="test.service";
  QueueManager queueManager=muleContext.getQueueManager();
  QueueManager mockTransactionalQueueManager=mock(QueueManager.class);
  when(mockTransactionalQueueManager.getQueueSession()).thenReturn(queueManager.getQueueSession());
  muleContext.getRegistry().registerObject(MuleProperties.OBJECT_QUEUE_MANAGER,mockTransactionalQueueManager);
  service.setQueueProfile(new QueueProfile(capacity,persistent));
  try {
    muleContext.getRegistry().registerService(service);
  }
 catch (  RegistrationException e) {
    if (e.getCause().getCause().getCause() instanceof AssertionFailedError) {
      fail("Queue configuration does not match service queue profile");
    }
 else {
      throw e;
    }
  }
  assertEquals(queueName,service.queue.getName());
}
