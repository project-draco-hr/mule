{
  int capacity=345;
  QueueManager queueManager=muleContext.getQueueManager();
  QueueManager mockTransactionalQueueManager=mock(QueueManager.class);
  when(mockTransactionalQueueManager.getQueueSession()).thenReturn(queueManager.getQueueSession());
  muleContext.getRegistry().registerObject(MuleProperties.OBJECT_QUEUE_MANAGER,mockTransactionalQueueManager);
  QueueObjectStore<Serializable> objectStore=muleContext.getRegistry().lookupObject(MuleProperties.QUEUE_STORE_DEFAULT_PERSISTENT_NAME);
  service.setQueueProfile(new QueueProfile(capacity,objectStore));
  try {
    muleContext.getRegistry().registerService(service);
  }
 catch (  RegistrationException e) {
    if (e.getCause().getCause().getCause() instanceof AssertionFailedError) {
      fail("Queue configuration does not match service queue profile");
    }
 else {
      throw e;
    }
  }
}
