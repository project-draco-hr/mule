{
  MessageEnricher enricher=new MessageEnricher();
  enricher.setMuleContext(muleContext);
  enricher.addEnrichExpressionPair(new EnrichExpressionPair("#[header:myHeader]"));
  enricher.setEnrichmentMessageProcessor(new MessageProcessor(){
    @Override public MuleEvent process(    MuleEvent event) throws MuleException {
      throw new MessagingException(CoreMessages.createStaticMessage("Expected"),event);
    }
  }
);
  try {
    SensingNullReplyToHandler nullReplyToHandler=new SensingNullReplyToHandler();
    enricher.process(createNonBlockingEvent(nullReplyToHandler));
    fail("Expected a MessagingException");
  }
 catch (  MessagingException e) {
    assertThat(e.getMessage(),is("Expected."));
  }
  assertThat(RequestContext.getEvent().getReplyToHandler(),instanceOf(ReplyToHandler.class));
}
