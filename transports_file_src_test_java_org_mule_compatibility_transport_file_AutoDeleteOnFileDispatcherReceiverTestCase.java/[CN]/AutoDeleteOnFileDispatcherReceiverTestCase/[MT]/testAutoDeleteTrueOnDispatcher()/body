{
  ((FileConnector)connector).setAutoDelete(true);
  setCurrentEvent(testEvent);
  InternalMessage message=muleContext.getClient().request(getTestEndpointURI() + "/" + tempDirName,50000).getRight().get();
  assertNotNull(message.getPayload().getValue());
  assertTrue(message.getPayload().getValue() instanceof InputStream);
  assertTrue(tempDir.listFiles().length > 0);
  ((InputStream)message.getPayload().getValue()).close();
  Prober prober=new PollingProber(1000,100);
  prober.check(new Probe(){
    @Override public boolean isSatisfied(){
      return tempDir.listFiles().length == 0;
    }
    @Override public String describeFailure(){
      return "File was not deleted from temp directory";
    }
  }
);
  assertTrue(tempDir.listFiles().length == 0);
}
