{
  ((FileConnector)connector).setAutoDelete(true);
  MuleEvent event=getTestEvent("TestData");
  setCurrentEvent(event);
  MuleMessage message=new DefaultMuleEventContext(event).requestEvent(getTestEndpointURI() + "/" + tempDirName,50000);
  assertNotNull(message.getPayload());
  assertTrue(message.getPayload() instanceof InputStream);
  assertTrue(tempDir.listFiles().length > 0);
  ((InputStream)message.getPayload()).close();
  Prober prober=new PollingProber(1000,100);
  prober.check(new Probe(){
    @Override public boolean isSatisfied(){
      return tempDir.listFiles().length == 0;
    }
    @Override public String describeFailure(){
      return "File was not deleted from temp directory";
    }
  }
);
  assertTrue(tempDir.listFiles().length == 0);
}
