{
  DriverManagerDataSource ds=new DriverManagerDataSource();
  ds.setDriverClassName("org.hsqldb.jdbcDriver");
  ds.setUrl("jdbc:hsqldb:mem:db");
  ds.setUsername("sa");
  LocalSessionFactoryBean sfactory=new LocalSessionFactoryBean();
  sfactory.setDataSource(ds);
  sfactory.afterPropertiesSet();
  HibernateTransactionManager tm=new HibernateTransactionManager();
  tm.setDataSource(ds);
  SessionFactory sessionFactory=(SessionFactory)sfactory.getObject();
  tm.setSessionFactory(sessionFactory);
  SpringTransactionFactory factory=new SpringTransactionFactory();
  factory.setManager(tm);
  UMOTransaction tx=factory.beginTransaction();
  TransactionCoordination.getInstance().bindTransaction(tx);
  assertTrue(tx.hasResource(ds));
  assertTrue(tx.hasResource(sessionFactory));
  TransactionCoordination.getInstance().unbindTransaction(tx);
}
