{
  try {
    XmppConnector cnn=(XmppConnector)connector;
    xmppConnection=cnn.findOrCreateXmppConnection(endpoint.getEndpointURI());
    if (endpoint.getFilter() instanceof PacketFilter) {
      xmppConnection.addPacketListener(this,(PacketFilter)endpoint.getFilter());
    }
 else {
      PacketFilter filter=new PacketTypeFilter(Message.class);
      xmppConnection.addPacketListener(this,filter);
    }
  }
 catch (  XMPPException e) {
    throw new ConnectException(new org.mule.config.i18n.Message(Messages.FAILED_TO_CREATE_X,"XMPP Connection"),e,this);
  }
}
