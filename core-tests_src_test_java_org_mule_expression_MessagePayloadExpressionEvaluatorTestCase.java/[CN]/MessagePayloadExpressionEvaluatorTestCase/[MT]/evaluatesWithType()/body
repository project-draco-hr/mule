{
  MessagePayloadExpressionEvaluator evaluator=new MessagePayloadExpressionEvaluator();
  final DataType dataType=DataTypeFactory.create(String.class,JSON);
  dataType.setEncoding(CUSTOM_ENCODING);
  final MuleMessage message=mock(MuleMessage.class);
  when(message.getPayload()).thenReturn(PAYLOAD);
  when(message.getDataType()).thenReturn(dataType);
  final TypedValue typedValue=evaluator.evaluateTyped("",message);
  assertThat((String)typedValue.getValue(),equalTo("test"));
  assertThat(typedValue.getDataType(),like(String.class,JSON,CUSTOM_ENCODING));
}
