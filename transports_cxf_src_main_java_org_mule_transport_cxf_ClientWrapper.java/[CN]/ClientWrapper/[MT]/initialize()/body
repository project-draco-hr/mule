{
  String clientClass=(String)endpoint.getProperty(CxfConstants.CLIENT_CLASS);
  proxy=BooleanUtils.toBoolean((String)endpoint.getProperty(CxfConstants.PROXY));
  if (clientClass != null) {
    createClientFromClass(bus,clientClass);
  }
 else   if (proxy) {
    createClientProxy(bus);
  }
 else {
    createClientFromLocalServer(bus);
  }
  addInterceptors(client.getInInterceptors(),(List<Interceptor>)endpoint.getProperty(CxfConstants.IN_INTERCEPTORS));
  addInterceptors(client.getInFaultInterceptors(),(List<Interceptor>)endpoint.getProperty(CxfConstants.IN_FAULT_INTERCEPTORS));
  addInterceptors(client.getOutInterceptors(),(List<Interceptor>)endpoint.getProperty(CxfConstants.OUT_INTERCEPTORS));
  addInterceptors(client.getOutFaultInterceptors(),(List<Interceptor>)endpoint.getProperty(CxfConstants.OUT_FAULT_INTERCEPTORS));
  MuleUniversalConduit conduit=(MuleUniversalConduit)client.getConduit();
  conduit.setMuleEndpoint(endpoint);
  if (proxy) {
    client.getInInterceptors().add(new CopyAttachmentInInterceptor());
    client.getInInterceptors().add(new StreamClosingInterceptor());
    client.getOutInterceptors().add(new OutputPayloadInterceptor());
    client.getOutInterceptors().add(new CopyAttachmentOutInterceptor());
    conduit.setCloseInput(false);
  }
  String value=(String)endpoint.getProperty(CxfConstants.APPLY_TRANSFORMERS_TO_PROTOCOL);
  applyTransformersToProtocol=isTrue(value,true);
  conduit.setApplyTransformersToProtocol(applyTransformersToProtocol);
  enableHeaders=isTrue((String)endpoint.getProperty(CxfConstants.ENABLE_MULE_SOAP_HEADERS),true);
  List<AbstractFeature> features=(List<AbstractFeature>)endpoint.getProperty(CxfConstants.FEATURES);
  if (features != null) {
    for (    AbstractFeature f : features) {
      f.initialize(client,bus);
    }
  }
  EndpointImpl ep=(EndpointImpl)client.getEndpoint();
  Object mtomEnabled=endpoint.getProperty(CxfConstants.MTOM_ENABLED);
  if (mtomEnabled != null) {
    HashMap<String,Object> props=new HashMap<String,Object>();
    props.put(Message.MTOM_ENABLED,mtomEnabled);
    ep.setProperties(props);
  }
  addMuleInterceptors();
}
