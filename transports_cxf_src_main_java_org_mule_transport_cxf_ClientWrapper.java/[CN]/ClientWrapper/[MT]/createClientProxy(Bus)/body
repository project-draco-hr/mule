{
  String wsdlLocation=(String)endpoint.getProperty(CxfConstants.WSDL_LOCATION);
  ClientProxyFactoryBean cpf=new ClientProxyFactoryBean();
  cpf.setServiceClass(ProxyService.class);
  cpf.setDataBinding(new StaxDataBinding());
  cpf.getFeatures().add(new StaxDataBindingFeature());
  cpf.setAddress(endpoint.getEndpointURI().getAddress());
  cpf.setBus(bus);
  if (wsdlLocation != null) {
    cpf.setWsdlLocation(wsdlLocation);
  }
  this.client=ClientProxy.getClient(cpf.create());
  proxy=true;
  proxyEnvelope=CxfConstants.PAYLOAD_ENVELOPE.equals(endpoint.getProperty(CxfConstants.PAYLOAD));
  Binding binding=this.client.getEndpoint().getBinding();
  CxfUtils.removeInterceptor(binding.getOutInterceptors(),WrappedOutInterceptor.class.getName());
  if (proxyEnvelope) {
    CxfUtils.removeInterceptor(binding.getOutInterceptors(),SoapOutInterceptor.class.getName());
    client.getInInterceptors().add(new ReversibleStaxInInterceptor());
    client.getInInterceptors().add(new ResetStaxInterceptor());
  }
}
