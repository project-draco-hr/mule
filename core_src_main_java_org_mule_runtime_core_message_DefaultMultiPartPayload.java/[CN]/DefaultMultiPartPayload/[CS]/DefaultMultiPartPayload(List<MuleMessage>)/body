{
  final Builder<MuleMessage> builder=ImmutableList.builder();
  for (  MuleMessage part : parts) {
    if (!(part.getAttributes() instanceof PartAttributes)) {
      throw new IllegalArgumentException("Body parts may only have 'PartAttributes' as attributes.");
    }
    if (part.getPayload() instanceof MultiPartPayload) {
      builder.addAll(((MultiPartPayload)part.getPayload()).getParts());
    }
 else {
      builder.add(part);
    }
  }
  this.parts=builder.build();
}
