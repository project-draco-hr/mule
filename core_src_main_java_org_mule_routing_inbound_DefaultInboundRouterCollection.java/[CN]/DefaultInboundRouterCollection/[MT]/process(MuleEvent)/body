{
  if (endpoints.size() > 0 && routers.size() == 0) {
    addRouter(new InboundPassThroughRouter());
  }
  String componentName=event.getSession().getService().getName();
  Map<String,MuleEvent> eventsToRoute=new LinkedHashMap<String,MuleEvent>(2);
  boolean noRoute=true;
  boolean match=false;
  InboundRouter inboundRouter;
  MuleEvent lastEvent=null;
  for (Iterator<?> iterator=getRouters().iterator(); iterator.hasNext(); ) {
    inboundRouter=(InboundRouter)iterator.next();
    if (inboundRouter.isMatch(event)) {
      match=true;
      MuleEvent[] events=inboundRouter.process(event);
      if (events != null) {
        for (        MuleEvent event1 : events) {
          lastEvent=event1;
          eventsToRoute.put(lastEvent.getId(),lastEvent);
        }
      }
      noRoute=(events == null);
      if (!isMatchAll()) {
        break;
      }
    }
  }
  if (!event.isStopFurtherProcessing()) {
    if (noRoute) {
      if (getStatistics().isEnabled()) {
        getStatistics().incrementNoRoutedMessage();
      }
      if (!match) {
        if (getCatchAllStrategy() != null) {
          if (logger.isDebugEnabled()) {
            logger.debug("Message did not match any routers on: " + componentName + " - invoking catch all strategy");
          }
          if (getStatistics().isEnabled()) {
            getStatistics().incrementCaughtMessage();
          }
          MuleMessage result=getCatchAllStrategy().catchMessage(event.getMessage(),event.getSession());
          if (result != null) {
            return new DefaultMuleEvent(result,event);
          }
 else {
            return null;
          }
        }
 else {
          logger.warn("Message did not match any routers on: " + componentName + " and there is no catch all strategy configured on this router.  Disposing message: "+ event);
          if (logger.isDebugEnabled()) {
            try {
              logger.warn("Message fragment is: " + StringMessageUtils.truncate(event.getMessageAsString(),100,true));
            }
 catch (            MuleException e) {
            }
          }
        }
      }
    }
 else {
      try {
        MuleEvent messageResult=null;
        for (Iterator iterator=eventsToRoute.values().iterator(); iterator.hasNext(); ) {
          MuleEvent eventToRoute=(MuleEvent)iterator.next();
          messageResult=listener.process(eventToRoute);
          if (getStatistics().isEnabled()) {
            getStatistics().incrementRoutedMessage(eventToRoute.getEndpoint());
          }
        }
        return messageResult;
      }
 catch (      MuleException e) {
        throw new RoutingException(event.getMessage(),event.getEndpoint(),e);
      }
    }
  }
  if (event.isSynchronous()) {
    return lastEvent;
  }
 else {
    return null;
  }
}
