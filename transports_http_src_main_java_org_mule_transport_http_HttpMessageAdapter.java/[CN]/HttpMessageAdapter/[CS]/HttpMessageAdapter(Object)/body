{
  if (message instanceof Object[]) {
    Object[] messageParts=(Object[])message;
    this.message=messageParts[0];
    Map<Object,Object> headers=new HashMap<Object,Object>();
    if (messageParts.length > 1) {
      Object second=messageParts[1];
      if (second instanceof Map) {
        setupHeadersFromMap(headers,(Map)second);
      }
 else       if (second instanceof Header[]) {
        setupHeadersFromHeaderArray(headers,(Header[])second);
      }
      determineHttpVersion(headers);
      rewriteConnectionAndKeepAliveHeaders(headers);
      addInboundProperties(headers);
    }
  }
 else   if (message instanceof HttpResponse) {
    this.message=message;
    return;
  }
 else {
    this.message=message;
  }
  String contentType=getStringProperty(HttpConstants.HEADER_CONTENT_TYPE,null);
  if (contentType != null) {
    Header contentTypeHeader=new Header(HttpConstants.HEADER_CONTENT_TYPE,contentType);
    HeaderElement values[]=contentTypeHeader.getElements();
    if (values.length == 1) {
      NameValuePair param=values[0].getParameterByName("charset");
      if (param != null) {
        setEncoding(param.getValue());
      }
    }
  }
}
