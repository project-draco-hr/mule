{
  MuleMessageToHttpResponse transformer=getMuleMessageToHttpResponse();
  final String contentType="text/xml";
  final String wrongContentType="text/json";
  Map<String,Serializable> outboundProperties=new HashMap<>();
  outboundProperties.put(HEADER_CONTENT_TYPE,wrongContentType);
  MuleContext muleContext=mock(MuleContext.class,RETURNS_DEEP_STUBS);
  MutableMuleMessage msg=new DefaultMuleMessage(null,outboundProperties,muleContext);
  msg.setOutboundProperty(HEADER_CONTENT_TYPE,wrongContentType);
  msg.setInboundProperty(HEADER_CONTENT_TYPE,wrongContentType);
  msg.setOutboundProperty(HEADER_CONTENT_TYPE,contentType);
  HttpResponse response=transformer.createResponse(null,UTF_8,msg);
  Header[] headers=response.getHeaders();
  boolean hasContentTypeHeader=false;
  for (  Header header : headers) {
    if (HEADER_CONTENT_TYPE.equals(header.getName())) {
      hasContentTypeHeader=true;
      assertThat(header.getValue(),is(equalTo(contentType)));
    }
  }
  assertThat("Missing" + HEADER_CONTENT_TYPE + " header",hasContentTypeHeader,is(true));
}
