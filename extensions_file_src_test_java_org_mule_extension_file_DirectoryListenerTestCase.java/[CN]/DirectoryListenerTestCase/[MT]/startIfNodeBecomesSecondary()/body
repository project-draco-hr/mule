{
  ArgumentCaptor<PrimaryNodeLifecycleNotificationListener> listenerCaptor=ArgumentCaptor.forClass(PrimaryNodeLifecycleNotificationListener.class);
  directoryListener.start();
  verify(mockMuleContext).registerListener(listenerCaptor.capture());
  PrimaryNodeLifecycleNotificationListener listener=listenerCaptor.getValue();
  assertThat(listener,is(notNullValue()));
  listener.onNotification(mock(ServerNotification.class));
  verify(mockMuleContext,times(2)).isPrimaryPollingInstance();
}
