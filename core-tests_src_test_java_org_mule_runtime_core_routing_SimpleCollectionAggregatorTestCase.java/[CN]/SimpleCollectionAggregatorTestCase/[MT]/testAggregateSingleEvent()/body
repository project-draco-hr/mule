{
  Flow flow=getTestFlow("test",Apple.class);
  assertNotNull(flow);
  SimpleCollectionAggregator router=new SimpleCollectionAggregator();
  SensingNullMessageProcessor sensingMessageProcessor=getSensingNullMessageProcessor();
  router.setListener(sensingMessageProcessor);
  router.setMuleContext(muleContext);
  router.setFlowConstruct(flow);
  router.initialise();
  EventContext executionContext=DefaultEventContext.create(flow,TEST_CONNECTOR,"foo");
  InternalMessage message1=InternalMessage.of("test event A");
  Event event1=Event.builder(executionContext).message(message1).groupCorrelation(new GroupCorrelation(1,null)).flow(flow).build();
  Event resultEvent=router.process(event1);
  assertNotNull(sensingMessageProcessor.event);
  assertThat(resultEvent,equalTo(sensingMessageProcessor.event));
  InternalMessage nextMessage=sensingMessageProcessor.event.getMessage();
  assertNotNull(nextMessage);
  assertTrue(nextMessage.getPayload().getValue() instanceof List<?>);
  List<InternalMessage> payload=(List<InternalMessage>)nextMessage.getPayload().getValue();
  assertEquals(1,payload.size());
  assertEquals("test event A",payload.get(0).getPayload().getValue());
}
