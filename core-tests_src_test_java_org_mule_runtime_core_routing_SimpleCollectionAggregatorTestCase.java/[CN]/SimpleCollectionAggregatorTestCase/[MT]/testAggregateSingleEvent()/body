{
  MuleSession session=getTestSession(getTestFlow(),muleContext);
  Flow flow=getTestFlow("test",Apple.class);
  assertNotNull(flow);
  SimpleCollectionAggregator router=new SimpleCollectionAggregator();
  SensingNullMessageProcessor sensingMessageProcessor=getSensingNullMessageProcessor();
  router.setListener(sensingMessageProcessor);
  router.setMuleContext(muleContext);
  router.setFlowConstruct(flow);
  router.initialise();
  MuleMessage message1=MuleMessage.builder().payload("test event A").build();
  DefaultMuleEvent event1=new DefaultMuleEvent(create(flow,message1.getUniqueId()),message1,flow);
  event1.setCorrelation(new Correlation(message1.getUniqueId(),1,null));
  MuleEvent resultEvent=router.process(event1);
  assertSame(VoidMuleEvent.getInstance(),resultEvent);
  assertNotNull(sensingMessageProcessor.event);
  MuleMessage nextMessage=sensingMessageProcessor.event.getMessage();
  assertNotNull(nextMessage);
  assertTrue(nextMessage.getPayload() instanceof List<?>);
  List<MuleMessage> payload=(List<MuleMessage>)nextMessage.getPayload();
  assertEquals(1,payload.size());
  assertEquals("test event A",payload.get(0).getPayload());
}
