{
  InboundEndpoint endpoint=createTestInboundEndpoint(null,new TestSecurityFilter(false),true,null);
  InterceptingMessageProcessor mp=new InboundSecurityFilterMessageProcessor(endpoint);
  TestListener listner=new TestListener();
  mp.setListener(listner);
  MuleEvent inEvent=createTestInboundEvent(endpoint,true);
  RequestContext.setEvent(inEvent);
  MuleEvent resultEvent=mp.process(inEvent);
  assertNull(listner.sensedEvent);
  assertNotNull(resultEvent);
  assertEquals(TestSecurityFilter.SECURITY_EXCEPTION_MESSAGE,resultEvent.getMessageAsString());
  assertNotNull(resultEvent.getMessage().getExceptionPayload());
  assertTrue(resultEvent.getMessage().getExceptionPayload().getException() instanceof TestSecurityFilter.StaticMessageUnauthorisedException);
}
