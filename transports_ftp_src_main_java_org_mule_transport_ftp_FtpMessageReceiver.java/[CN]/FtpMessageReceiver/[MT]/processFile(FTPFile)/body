{
  FTPClient client=null;
  try {
    if (!connector.validateFile(file)) {
      return;
    }
    try {
      client=connector.createFtpClient(endpoint);
    }
 catch (    Exception e) {
      throw new ConnectException(e,this);
    }
    FtpMuleMessageFactory muleMessageFactory=createMuleMessageFactory(client);
    MuleMessage message=muleMessageFactory.create(file,endpoint.getEncoding());
    routeMessage(message);
    postProcess(client,file,message);
  }
  finally {
    if (client != null) {
      connector.releaseFtp(endpoint.getEndpointURI(),client);
    }
  }
}
