{
  DefaultMessageProcessorChainBuilder builder=new DefaultMessageProcessorChainBuilder();
  builder.chain(getAppendingMP("1"),new ResponseMessageProcessorAdapter(DefaultMessageProcessorChain.from(new ResponseMessageProcessorAdapter(getAppendingMP("4")),getAppendingMP("3"))),getAppendingMP("2"));
  process(builder.build(),getTestEventUsingFlow("0")).getMessageAsString();
  assertThat(process(builder.build(),getTestEventUsingFlow("0")).getMessageAsString(),equalTo("01234"));
  assertEquals(isMultipleThreadsUsed() ? 9 : 1,threads);
}
