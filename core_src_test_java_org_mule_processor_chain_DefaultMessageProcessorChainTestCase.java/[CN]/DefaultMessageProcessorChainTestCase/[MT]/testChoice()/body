{
  ChoiceRouter choiceRouter=new ChoiceRouter();
  choiceRouter.addRoute(getAppendingMP("1"),new AcceptAllFilter());
  choiceRouter.addRoute(getAppendingMP("2"),new AcceptAllFilter());
  choiceRouter.addRoute(getAppendingMP("3"),new AcceptAllFilter());
  assertThat(process(DefaultMessageProcessorChain.from(choiceRouter),getTestEventUsingFlow("0")).getMessageAsString(),equalTo("01"));
  assertEquals(isMultipleThreadsUsed() ? 2 : 1,threads);
}
