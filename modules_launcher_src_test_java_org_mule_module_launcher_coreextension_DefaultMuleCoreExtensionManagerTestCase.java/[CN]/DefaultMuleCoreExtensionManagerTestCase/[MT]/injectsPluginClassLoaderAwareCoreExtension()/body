{
  List<MuleCoreExtension> extensions=new LinkedList<MuleCoreExtension>();
  TestPluginClassLoaderManagerAwareExtension extension=mock(TestPluginClassLoaderManagerAwareExtension.class);
  extensions.add(extension);
  when(coreExtensionDiscoverer.discover()).thenReturn(extensions);
  when(coreExtensionDependencyResolver.resolveDependencies(extensions)).thenReturn(extensions);
  PluginClassLoaderManager pluginClassLoaderManager=mock(PluginClassLoaderManager.class);
  coreExtensionManager.setPluginClassLoaderManager(pluginClassLoaderManager);
  coreExtensionManager.initialise();
  verify(extension).setPluginClassLoaderManager(pluginClassLoaderManager);
}
