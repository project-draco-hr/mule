{
  DefaultMuleContext context=(DefaultMuleContext)muleContextFactory.createMuleContext();
  StreamCloserService serviceFromRegistry=context.getRegistry().lookupObject(MuleProperties.OBJECT_MULE_STREAM_CLOSER_SERVICE);
  MuleRegistryHelper registry=spy((MuleRegistryHelper)context.getRegistry());
  context.setMuleRegistry(registry);
  StreamCloserService streamCloserService=context.getStreamCloserService();
  assertNotNull(streamCloserService);
  assertSame(serviceFromRegistry,streamCloserService);
  assertSame(streamCloserService,context.getStreamCloserService());
  verify(registry,times(1)).lookupObject(MuleProperties.OBJECT_MULE_STREAM_CLOSER_SERVICE);
}
