{
  MuleEvent event=MuleEvent.builder(getTestEvent(ROOT_FOO_BAR)).addFlowVariable("foo","bar").build();
  Object result=doEvaluate("xpath3('/root[@foo=$foo]', payload, 'NODE')",event,MuleEvent.builder(event));
  assertThat(result,instanceOf(Node.class));
  assertThat((((Node)result)).getAttributes().getNamedItem("foo").getNodeValue(),equalTo("bar"));
}
