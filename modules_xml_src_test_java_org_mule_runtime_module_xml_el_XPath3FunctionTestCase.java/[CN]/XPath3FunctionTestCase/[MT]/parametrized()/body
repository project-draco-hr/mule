{
  MuleEvent event=getTestEvent(ROOT_FOO_BAR);
  event.setFlowVariable("foo","bar");
  Object result=doEvaluate("xpath3('/root[@foo=$foo]', payload, 'NODE')",event,MuleEvent.builder(event));
  assertThat(result,instanceOf(Node.class));
  assertThat((((Node)result)).getAttributes().getNamedItem("foo").getNodeValue(),equalTo("bar"));
}
