{
  session=removeNonSerializableProperties(session,message.getMuleContext());
  byte[] serializedSession=serialize(message,session);
  String serializedEncodedSession;
  try {
    serializedEncodedSession=Base64.encodeBytes(serializedSession,Base64.DONT_BREAK_LINES);
  }
 catch (  IOException e) {
    throw new SessionException(MessageFactory.createStaticMessage("Unable to serialize MuleSession"),e);
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Adding serialized and base64-encoded Session header to message: " + serializedEncodedSession);
  }
  message.setOutboundProperty(MuleProperties.MULE_SESSION_PROPERTY,serializedEncodedSession);
}
