{
  byte[] data=new byte[100000];
  for (int i=0; i < data.length; i++) {
    data[i]=(byte)(Math.random() * 128);
  }
  File f=FileUtils.newFile("./test/testfile.temp");
  f.createNewFile();
  FileOutputStream fos=new FileOutputStream(f);
  IOUtils.write(data,fos);
  IOUtils.closeQuietly(fos);
  shouldPoll=false;
  ((DefaultMuleContext)muleContext).setPollingController(new PollingController(){
    @Override public boolean isPrimaryPollingInstance(){
      return shouldPoll;
    }
  }
);
  f.renameTo(FileUtils.newFile(f.getPath().replaceAll(".temp",".data")));
  Thread.sleep(5000);
synchronized (this) {
    assertNull(receivedData);
  }
  shouldPoll=true;
  Thread.sleep(5000);
synchronized (this) {
    assertNotNull(receivedData);
    assertTrue(receivedData instanceof byte[]);
    byte[] receivedBytes=(byte[])receivedData;
    assertEquals(data.length,receivedBytes.length);
    assertTrue(Arrays.equals(data,receivedBytes));
  }
}
