{
  MuleClient client=new MuleClient(muleContext);
  RemoteDispatcher dispatcher=client.getRemoteDispatcher("remoteEndpoint");
  dispatcher.setWireFormat(createObject(XStreamWireFormat.class));
  try {
    String[] args=new String[]{"Betty","Rubble"};
    MuleMessage result=dispatcher.sendRemote(getMuleAddress(client,"inMyComponent3") + "/mycomponent3?method=addPerson",args,null);
    assertNotNull(result);
    assertTrue(result.getPayload() instanceof Person);
    assertEquals("Betty",((Person)result.getPayload()).getFirstName());
    assertEquals("Rubble",((Person)result.getPayload()).getLastName());
    result=client.send(getMuleAddress(client,"inMyComponent3") + "/mycomponent3?method=getPerson","Betty",null);
    assertNotNull(result);
    assertTrue(result.getPayload() instanceof Person);
    assertEquals("Betty",((Person)result.getPayload()).getFirstName());
    assertEquals("Rubble",((Person)result.getPayload()).getLastName());
  }
  finally {
    client.dispose();
  }
}
