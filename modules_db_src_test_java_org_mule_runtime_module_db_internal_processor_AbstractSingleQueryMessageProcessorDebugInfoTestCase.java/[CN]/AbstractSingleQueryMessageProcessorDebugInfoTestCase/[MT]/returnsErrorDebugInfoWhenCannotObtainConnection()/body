{
  final SQLException debugInfoError=new SQLException();
  when(dbConnectionFactory.createConnection(TransactionalAction.NOT_SUPPORTED)).thenThrow(debugInfoError);
  when(dbConfigResolver.resolve(event)).thenReturn(dbConfig);
  when(dbConfig.getConnectionFactory()).thenReturn(dbConnectionFactory);
  AbstractSingleQueryDbMessageProcessor processor=createMessageProcessor();
  final List<FieldDebugInfo<?>> debugInfo=processor.getDebugInfo(event);
  assertThat(debugInfo.size(),equalTo(1));
  assertThat(debugInfo,hasItem(fieldLike("Connection",DbConnection.class,debugInfoError)));
}
