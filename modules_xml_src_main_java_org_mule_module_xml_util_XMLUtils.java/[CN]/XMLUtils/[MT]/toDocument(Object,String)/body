{
  SAXReader reader=new SAXReader();
  if (externalSchemaLocation != null) {
    reader.setValidation(true);
    reader.setFeature(APACHE_XML_FEATURES_VALIDATION_SCHEMA,true);
    reader.setFeature(APACHE_XML_FEATURES_VALIDATION_SCHEMA_FULL_CHECKING,true);
    InputStream xsdAsStream=IOUtils.getResourceAsStream(externalSchemaLocation,XMLUtils.class);
    if (xsdAsStream == null) {
      throw new IllegalArgumentException("Couldn't find schema at " + externalSchemaLocation);
    }
    reader.setProperty(JAXP_PROPERTIES_SCHEMA_LANGUAGE,JAXP_PROPERTIES_SCHEMA_LANGUAGE_VALUE);
    reader.setProperty(JAXP_PROPERTIES_SCHEMA_SOURCE,xsdAsStream);
  }
  if (obj instanceof org.dom4j.Document) {
    return (org.dom4j.Document)obj;
  }
 else   if (obj instanceof String) {
    return reader.read(new StringReader((String)obj));
  }
 else   if (obj instanceof byte[]) {
    return reader.read(new StringReader(new String((byte[])obj)));
  }
 else   if (obj instanceof InputStream) {
    return reader.read((InputStream)obj);
  }
 else   if (obj instanceof InputSource) {
    return reader.read((InputSource)obj);
  }
 else   if (obj instanceof File) {
    return reader.read((File)obj);
  }
 else {
    return null;
  }
}
