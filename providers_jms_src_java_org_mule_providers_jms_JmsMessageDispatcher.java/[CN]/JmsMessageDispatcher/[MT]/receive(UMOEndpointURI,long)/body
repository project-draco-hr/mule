{
  UMOTransaction tx=TransactionCoordination.getInstance().getTransaction();
  Session receiveSession=connector.getSession(tx instanceof XaTransaction);
  Destination dest=null;
  boolean topic=false;
  String resourceInfo=endpointUri.getResourceInfo();
  topic=(resourceInfo != null && "topic".equalsIgnoreCase(resourceInfo));
  dest=connector.getJmsSupport().createDestination(receiveSession,endpointUri.getAddress(),topic);
  consumer=connector.getJmsSupport().createConsumer(receiveSession,dest);
  Message message=null;
  try {
    if (timeout == RECEIVE_NO_WAIT) {
      message=consumer.receiveNoWait();
    }
 else     if (timeout == RECEIVE_WAIT_INDEFINITELY) {
      message=consumer.receive();
    }
 else {
      message=consumer.receive(timeout);
    }
    if (message == null)     return null;
    return new MuleMessage(connector.getMessageAdapter(message));
  }
 catch (  Exception e) {
    e.printStackTrace();
    return null;
  }
}
