{
  builder.replaceMessageProcessor(InboundFilterMessageProcessor.class,new InboundFilterMessageProcessor(){
    @Override protected MuleMessage handleUnacceptedFilter(    MuleMessage message,    InboundEndpoint endpoint){
      super.handleUnacceptedFilter(message,endpoint);
      if (message.getPayload() instanceof Message) {
        Message msg=(Message)message.getPayload();
        try {
          msg.setFlag(Flags.Flag.DELETED,endpoint.isDeleteUnacceptedMessages());
        }
 catch (        MessagingException e) {
          logger.error("failed to set message deleted: " + e.getMessage(),e);
        }
      }
      return message;
    }
  }
);
}
