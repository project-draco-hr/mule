{
  final MVELExpressionLanguageContext context=new MVELExpressionLanguageContext(parserConfiguration,muleContext);
  final StaticVariableResolverFactory staticContext=new StaticVariableResolverFactory(parserConfiguration,muleContext);
  final GlobalVariableResolverFactory globalContext=new GlobalVariableResolverFactory(emptyMap(),emptyMap(),parserConfiguration,muleContext);
  final DelegateVariableResolverFactory innerDelegate=new DelegateVariableResolverFactory(globalContext,new VariableVariableResolverFactory(parserConfiguration,muleContext,testEvent,builder));
  final DelegateVariableResolverFactory delegate=new DelegateVariableResolverFactory(staticContext,new MessageVariableResolverFactory(parserConfiguration,muleContext,testEvent,builder,innerDelegate));
  context.setNextFactory(new CachedMapVariableResolverFactory(emptyMap(),delegate));
  return context;
}
