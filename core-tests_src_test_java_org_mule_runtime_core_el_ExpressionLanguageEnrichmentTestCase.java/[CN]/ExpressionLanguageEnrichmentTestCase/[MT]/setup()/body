{
  expressionManager=new DefaultExpressionManager();
  muleContext=mock(MuleContext.class,RETURNS_DEEP_STUBS);
  MuleRegistry muleRegistry=mock(MuleRegistry.class);
  when(muleContext.getConfiguration()).thenReturn(new DefaultMuleConfiguration());
  when(muleContext.getRegistry()).thenReturn(muleRegistry);
  ExpressionLanguage expressionLanguage=getExpressionLanguage();
  if (expressionLanguage instanceof Initialisable) {
    ((Initialisable)expressionLanguage).initialise();
  }
  when(muleContext.getExpressionLanguage()).thenReturn(expressionLanguage);
  when(muleRegistry.lookupObjectsForLifecycle(Mockito.any(Class.class))).thenReturn(Collections.<Object>emptyList());
  expressionManager.setMuleContext(muleContext);
  expressionManager.initialise();
}
