{
  UMOEndpoint endpoint=getEndpoint(t);
  if (endpoint != null) {
    try {
      logger.error("Message being processed is: " + (message == null ? "null" : message.toString()));
      UMOEventContext ctx=RequestContext.getEventContext();
      ExceptionMessage msg=null;
      if (failedEndpoint != null) {
        msg=new ExceptionMessage(message,endpoint,t,ctx);
      }
 else {
        msg=new ExceptionMessage(message,t,ctx);
      }
      ctx.dispatchEvent(msg,endpoint);
      logger.debug("routed Exception message via " + endpoint);
      UMOTransaction tx=TransactionCoordination.getInstance().getTransaction();
      if (tx != null) {
        tx.commit();
      }
    }
 catch (    UMOException e) {
      logFatal(message,e);
    }
  }
}
