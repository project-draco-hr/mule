{
  if (obj instanceof String) {
    return (String)obj;
  }
 else   if (obj instanceof Document) {
    return ((Document)obj).asXML();
  }
  Source src;
  try {
    src=XMLUtils.toXmlSource(xmlInputFactory,useStaxSource,obj);
    if (src == null) {
      return null;
    }
  }
 catch (  Exception e) {
    if (e instanceof TransformerException) {
      throw (TransformerException)e;
    }
    throw new TransformerException(this,e);
  }
  StringWriter writer=new StringWriter();
  StreamResult result=new StreamResult(writer);
  Transformer idTransformer=TransformerFactory.newInstance().newTransformer();
  if (outputEncoding != null) {
    idTransformer.setOutputProperty(OutputKeys.ENCODING,outputEncoding);
  }
  idTransformer.transform(src,result);
  return writer.getBuffer().toString();
}
