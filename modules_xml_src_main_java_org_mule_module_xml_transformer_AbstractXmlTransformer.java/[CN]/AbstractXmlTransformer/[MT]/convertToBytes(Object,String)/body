{
  Source src;
  try {
    src=XMLUtils.toXmlSource(xmlInputFactory,useStaxSource,obj);
    if (src == null) {
      return null;
    }
  }
 catch (  Exception e) {
    if (e instanceof TransformerException) {
      throw (TransformerException)e;
    }
    throw new TransformerException(this,e);
  }
  StringWriter writer=new StringWriter();
  StreamResult result=new StreamResult(writer);
  Transformer idTransformer=XMLUtils.getTransformer();
  idTransformer.setOutputProperty(OutputKeys.ENCODING,outputEncoding);
  idTransformer.transform(src,result);
  return writer.getBuffer().toString();
}
