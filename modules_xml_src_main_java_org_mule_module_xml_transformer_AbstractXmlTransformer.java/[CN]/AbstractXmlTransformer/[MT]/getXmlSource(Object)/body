{
  try {
    if (src instanceof Source) {
      return (Source)src;
    }
 else     if (src instanceof byte[]) {
      ByteArrayInputStream stream=new ByteArrayInputStream((byte[])src);
      return createStreamSource(stream);
    }
 else     if (src instanceof InputStream) {
      return createStreamSource((InputStream)src);
    }
 else     if (src instanceof String) {
      if (useStaxSource) {
        return new StaxSource(xmlInputFactory.createXMLStreamReader(new StringReader((String)src)));
      }
 else {
        return new StreamSource(new StringReader((String)src));
      }
    }
 else     if (src instanceof Document) {
      return new DocumentSource((Document)src);
    }
 else     if (src instanceof XMLStreamReader) {
      XMLStreamReader xsr=(XMLStreamReader)src;
      if (!xsr.isStartElement() && xsr.getEventType() != XMLStreamConstants.START_DOCUMENT) {
        xsr.nextTag();
      }
      return new StaxSource((XMLStreamReader)src);
    }
 else     if (src instanceof org.w3c.dom.Document || src instanceof org.w3c.dom.Element) {
      return new DOMSource((org.w3c.dom.Node)src);
    }
 else     if (src instanceof DelayedResult) {
      DelayedResult result=((DelayedResult)src);
      DOMResult domResult=new DOMResult();
      result.write(domResult);
      return new DOMSource(domResult.getNode());
    }
 else     if (src instanceof OutputHandler) {
      OutputHandler handler=((OutputHandler)src);
      ByteArrayOutputStream output=new ByteArrayOutputStream();
      handler.write(RequestContext.getEvent(),output);
      return createStreamSource(new ByteArrayInputStream(output.toByteArray()));
    }
 else {
      return null;
    }
  }
 catch (  XMLStreamException e) {
    throw new TransformerException(this,e);
  }
catch (  Exception e) {
    if (e instanceof TransformerException) {
      throw (TransformerException)e;
    }
    throw new TransformerException(this,e);
  }
}
