{
  EndpointURIEndpointBuilder builder=new EndpointURIEndpointBuilder("test://test",muleContext);
  builder.setProperty(MessageProcessorPollingMessageReceiver.SOURCE_MESSAGE_PROCESSOR_PROPERTY_NAME,processor);
  builder.setProperty(MessageProcessorPollingMessageReceiver.SCHEDULER_FACTORY_PROPERTY_NAME,schedulerFactory());
  InboundEndpoint inboundEndpoint=muleContext.getEndpointFactory().getInboundEndpoint(builder);
  MessageProcessorPollingMessageReceiver receiver=new MessageProcessorPollingMessageReceiver(inboundEndpoint.getConnector(),Mockito.mock(FlowConstruct.class),inboundEndpoint);
  receiver.initialise();
  return receiver;
}
