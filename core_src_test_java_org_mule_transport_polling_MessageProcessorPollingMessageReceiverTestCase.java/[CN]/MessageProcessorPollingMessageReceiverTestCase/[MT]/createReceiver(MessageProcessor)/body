{
  EndpointURIEndpointBuilder builder=new EndpointURIEndpointBuilder("test://test",muleContext);
  builder.setProperty(MessageProcessorPollingMessageReceiver.SOURCE_MESSAGE_PROCESSOR_PROPERTY_NAME,processor);
  builder.setProperty(MessageProcessorPollingMessageReceiver.SCHEDULER_FACTORY_PROPERTY_NAME,schedulerFactory());
  InboundEndpoint inboundEndpoint=muleContext.getEndpointFactory().getInboundEndpoint(builder);
  FlowConstruct flowConstruct=mock(FlowConstruct.class);
  when(flowConstruct.getMuleContext()).thenReturn(muleContext);
  MessageProcessorPollingMessageReceiver receiver=new MessageProcessorPollingMessageReceiver(inboundEndpoint.getConnector(),flowConstruct,inboundEndpoint);
  receiver.initialise();
  return receiver;
}
