{
  EndpointURI endpointUri=endpoint.getEndpointURI();
  if (endpointUri == null) {
    throw new DispatchException(CoreMessages.objectIsNull("Endpoint"),event,getEndpoint());
  }
  MuleEvent eventToDispatch=MuleEvent.builder(event).session(new DefaultMuleSession(event.getSession())).build();
  final MuleCompatibilityMessageBuilder builder=new MuleCompatibilityMessageBuilder(createInboundMessage(eventToDispatch.getMessage()));
  builder.correlationId(eventToDispatch.getCorrelationId());
  builder.correlationSequence(eventToDispatch.getCorrelation().getSequence().orElse(null));
  builder.correlationGroupSize(eventToDispatch.getCorrelation().getGroupSize().orElse(null));
  final MuleCompatibilityMessage message=builder.build();
  eventToDispatch.clearFlowVariables();
  eventToDispatch.setMessage(createInboundMessage(eventToDispatch.getMessage()));
  QueueSession session=getQueueSession();
  Queue queue=session.getQueue(endpointUri.getAddress());
  if (!queue.offer(message,connector.getQueueTimeout())) {
    throw new DispatchException(VMMessages.queueIsFull(queue.getName(),queue.size()),eventToDispatch,getEndpoint());
  }
  if (logger.isDebugEnabled()) {
    logger.debug("dispatched MuleEvent on endpointUri: " + endpointUri);
  }
}
