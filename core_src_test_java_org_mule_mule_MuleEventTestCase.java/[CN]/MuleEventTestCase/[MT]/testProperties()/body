{
  MuleEvent prevEvent;
  Properties props;
  MuleMessage msg;
  Endpoint endpoint;
  MuleEvent event;
  prevEvent=getTestEvent("payload");
  props=new Properties();
  msg=new DefaultMuleMessage("payload",props);
  endpoint=getTestEndpoint("Test",Endpoint.ENDPOINT_TYPE_SENDER);
  props=new Properties();
  endpoint.setProperties(props);
  event=new DefaultMuleEvent(msg,endpoint,prevEvent.getService(),prevEvent);
  assertNull(event.getMessage().getProperty("prop"));
  prevEvent.getMessage().setProperty("prop","value0");
  event=new DefaultMuleEvent(msg,endpoint,prevEvent.getService(),prevEvent);
  assertEquals("value0",event.getMessage().getProperty("prop"));
  props=new Properties();
  props.put("prop","value1");
  msg=new DefaultMuleMessage("payload",props);
  endpoint=getTestEndpoint("Test",Endpoint.ENDPOINT_TYPE_SENDER);
  event=new DefaultMuleEvent(msg,endpoint,prevEvent.getService(),prevEvent);
  assertEquals("value1",event.getMessage().getProperty("prop"));
  props=new Properties();
  props.put("prop","value1");
  msg=new DefaultMuleMessage("payload",props);
  Properties props2=new Properties();
  props2.put("prop","value2");
  endpoint.setProperties(props2);
  event=new DefaultMuleEvent(msg,endpoint,prevEvent.getService(),prevEvent);
  assertEquals("value1",event.getMessage().getProperty("prop"));
}
