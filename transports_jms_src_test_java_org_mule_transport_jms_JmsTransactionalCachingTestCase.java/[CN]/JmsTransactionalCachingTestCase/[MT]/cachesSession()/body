{
  LocalMuleClient client=muleContext.getClient();
  MuleMessage response=client.send("vm://testInput",TEST_MESSAGE_1,null);
  assertThat(TEST_MESSAGE_1,equalTo(response.getPayloadAsString()));
  response=client.send("vm://testInput",TEST_MESSAGE_2,null);
  assertThat(NullPayload.getInstance(),equalTo(response.getPayload()));
  response=client.send("vm://testInput",TEST_MESSAGE_3,null);
  assertThat(TEST_MESSAGE_3,equalTo(response.getPayloadAsString()));
  Set<String> responses=new HashSet<String>();
  response=client.request("vm://testOut",RECEIVE_TIMEOUT);
  responses.add(response.getPayloadAsString());
  response=client.request("vm://testOut",RECEIVE_TIMEOUT);
  responses.add(response.getPayloadAsString());
  assertThat(responses,hasItems(equalTo(TEST_MESSAGE_1),equalTo(TEST_MESSAGE_3)));
}
