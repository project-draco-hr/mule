{
  LocalMuleClient client=muleContext.getClient();
  final Latch latch=new Latch();
  TestExceptionStrategy systemExceptionListener=(TestExceptionStrategy)muleContext.getExceptionListener();
  systemExceptionListener.setExceptionCallback(new ExceptionCallback(){
    public void onException(    Throwable t){
      systemExceptionCounter.incrementAndGet();
      latch.countDown();
    }
  }
);
  TestExceptionStrategy serviceExceptionListener=(TestExceptionStrategy)muleContext.getRegistry().lookupService("SomeService").getExceptionListener();
  serviceExceptionListener.setExceptionCallback(new ExceptionCallback(){
    public void onException(    Throwable t){
      serviceExceptionCounter.incrementAndGet();
      latch.countDown();
    }
  }
);
  client.send("vm://in","FAIL",null);
  latch.await(1000,TimeUnit.MILLISECONDS);
  assertEquals(1,serviceExceptionCounter.get());
  assertEquals(0,systemExceptionCounter.get());
}
