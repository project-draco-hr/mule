{
  List<QueryParamValue> resolvedParams=paramValueResolver.resolveParams(muleEvent,query.getParamValues());
  QueryTemplate queryTemplate=query.getQueryTemplate();
  if (needsParamTypeResolution(queryTemplate.getParams())) {
    Map<Integer,DbType> paramTypes=getParameterTypes(connection,queryTemplate);
    queryTemplate=resolveQueryTemplate(queryTemplate,paramTypes);
  }
  return new Query(queryTemplate,resolvedParams);
}
