{
  UMOEndpoint endpoint=getEndpointFromName(uriIdentifier);
  if (endpoint == null) {
    endpoint=createEndpointFromUri(new MuleEndpointURI(uriIdentifier),type);
  }
 else {
    if (!endpoint.getType().equals(type) && !endpoint.getType().equals(UMOImmutableEndpoint.ENDPOINT_TYPE_SENDER_AND_RECEIVER)) {
      throw new IllegalArgumentException("Endpoint matching: " + uriIdentifier + " is not of type: "+ type+ ". It is of type: "+ endpoint.getType());
    }
  }
  return endpoint;
}
