{
  String name=uri.getEndpointName();
  UMOEndpoint endpoint=getEndpointFromName(name);
  if (null == endpoint) {
    String address=uri.getAddress();
    if (null != address) {
      Collection endpoints=getEndpoints();
      if (null != name && endpoints.contains(name)) {
        throw new IllegalStateException("Endpoint present, but direct lookup failed");
      }
      Iterator it=endpoints.iterator();
      while (it.hasNext()) {
        Object value=it.next();
        if (value instanceof UMOEndpoint) {
          UMOEndpoint candidate=(UMOEndpoint)value;
          String candidateAddress=candidate.getEndpointURI().getAddress();
          if (null != candidateAddress && address.equals(candidateAddress)) {
            if (null == endpoint) {
              endpoint=candidate;
            }
 else {
              throw new IllegalStateException("Duplicate endpoint URI");
            }
          }
        }
      }
    }
  }
  return endpoint;
}
