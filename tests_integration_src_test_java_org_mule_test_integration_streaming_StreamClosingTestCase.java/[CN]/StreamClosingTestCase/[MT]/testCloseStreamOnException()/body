{
  MuleClient client=new MuleClient();
  String text="\nblah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah " + "\nblah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah " + "\nblah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah "+ "\nblah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah\n\n";
  String basepath=muleContext.getConfiguration().getWorkingDirectory() + "/test-data";
  FileUtils.stringToFile(basepath + "/in/foo.txt",text);
  InputStream stream=new FileInputStream(new File(basepath + "/in/foo.txt"));
  DefaultMessageAdapter adapter=new DefaultMessageAdapter(stream);
  client.dispatch("tcpEndpoint",new DefaultMuleMessage(adapter));
  Thread.sleep(2000);
  try {
    stream.read();
    fail("STREAM SHOULD HAVE BEEN CLOSED");
  }
 catch (  Exception e2) {
  }
}
