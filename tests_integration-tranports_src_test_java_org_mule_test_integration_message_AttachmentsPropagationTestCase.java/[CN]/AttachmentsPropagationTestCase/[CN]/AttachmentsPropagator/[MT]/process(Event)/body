{
  final InternalMessage message=event.getMessage();
  final Builder builder=InternalMessage.builder(message);
  final Set<String> attachmentNames=new TreeSet<>(message.getOutboundAttachmentNames());
  for (  String attachmentName : message.getInboundAttachmentNames()) {
    DataHandler inboundAttachment=message.getInboundAttachment(attachmentName);
    builder.addOutboundAttachment(attachmentName,inboundAttachment);
    attachmentNames.add(attachmentName);
  }
  String attachmentName=flowconstruct.getName();
  DataHandler dataHandler=new DataHandler(new StringDataSource(ATTACHMENT_CONTENT,"doesNotMatter",MediaType.TEXT));
  builder.addOutboundAttachment(attachmentName,dataHandler);
  attachmentNames.add(attachmentName);
  builder.payload(attachmentNames);
  final InternalMessage built=builder.build();
  return Event.builder(event).message(built).build();
}
