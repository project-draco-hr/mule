{
  String basePath=getBasePath(schema.getDocumentBaseURI());
  Collection<List<SchemaReference>> schemaImportsCollection=schema.getImports().values();
  Collection<SchemaReference> schemaIncludesCollection=schema.getIncludes();
  if (!schemaImportsCollection.isEmpty() || !schemaIncludesCollection.isEmpty()) {
    for (    List<SchemaReference> schemaReferences : schemaImportsCollection) {
      fixSchemaReferencesLocations(basePath,schemaReferences);
    }
    fixSchemaReferencesLocations(basePath,schemaIncludesCollection);
    NodeList children=schema.getElement().getChildNodes();
    for (int i=0; i < children.getLength(); i++) {
      Node item=children.item(i);
      if (XML_IMPORT_ELEMENT.equals(item.getLocalName()) || XML_INCLUDE_ELEMENT.equals(item.getLocalName())) {
        NamedNodeMap attributes=item.getAttributes();
        Node namedItem=attributes.getNamedItem(XML_SCHEMA_LOCATION_ATTRIBUTE);
        if (namedItem != null) {
          String schemaLocation=namedItem.getNodeValue();
          if (!schemaLocation.startsWith(basePath)) {
            namedItem.setNodeValue(basePath + schemaLocation);
          }
        }
      }
    }
  }
}
