{
  UMOEndpoint endpoint=managementContext.getRegistry().getOrCreateEndpointForUri(uri,UMOEndpoint.ENDPOINT_TYPE_SENDER);
  UMOConnector connector=endpoint.getConnector();
  if (!connector.isStarted() && managementContext.isStarted()) {
    connector.start();
  }
  try {
    UMOSession session=new MuleSession(message,((AbstractConnector)endpoint.getConnector()).getSessionHandler());
    if (credentials != null) {
      message.setProperty(MuleProperties.MULE_USER_PROPERTY,"Plain " + credentials.getToken());
    }
    return new MuleEvent(message,endpoint,session,synchronous);
  }
 catch (  Exception e) {
    throw new DispatchException(new Message(Messages.FAILED_TO_CREATE_X,"Client event"),message,endpoint,e);
  }
}
