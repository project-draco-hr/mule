{
  MuleMessage msg=new DefaultMuleMessage(ServerHandshake.SERVER_HANDSHAKE_PROPERTY,muleContext);
  MuleMessage result=null;
  MuleEvent resultEvent=syncServerEndpoint.process(new DefaultMuleEvent(msg,MessageExchangePattern.REQUEST_RESPONSE,new MuleClientFlowConstruct(muleContext)));
  if (resultEvent != null && !VoidMuleEvent.getInstance().equals(resultEvent)) {
    result=resultEvent.getMessage();
  }
  if (result == null) {
    throw new RemoteDispatcherException(ClientMessages.failedToDispatchActionNoResponseFromServer("request wire format",5000));
  }
  ServerHandshake handshake;
  try {
    ByteArrayInputStream in=new ByteArrayInputStream(result.getPayloadAsBytes());
    handshake=serializer.deserialize(in);
  }
 catch (  Exception e) {
    throw new RemoteDispatcherException(ClientMessages.failedToDeserializeHandshakeFromServer(),e);
  }
  try {
    WireFormat wf=(WireFormat)ClassUtils.instanciateClass(handshake.getWireFormatClass(),ClassUtils.NO_ARGS,getClass());
    wf.setMuleContext(muleContext);
    return wf;
  }
 catch (  Exception e) {
    throw new UnsupportedWireFormatException(handshake.getWireFormatClass(),e);
  }
}
