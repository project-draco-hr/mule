{
  port=dynamicPort.getNumber();
  host="localhost";
  when(connectionSettings.getPort()).thenReturn(port);
  when(connectionSettings.getHost()).thenReturn(host);
  when(connectionSettings.getInetSocketAddress()).thenReturn(new InetSocketAddress(host,port));
  serverSocketProperties=new TcpServerSocketProperties();
  clientSocketProperties=new TcpClientSocketProperties();
  listenerConnection=new TcpListenerConnection(connectionSettings,new SafeProtocol(),serverSocketProperties,new TcpServerSocketFactory());
  requesterConnection=new TcpRequesterConnection(connectionSettings,new ConnectionSettings(),new SafeProtocol(),clientSocketProperties,new TcpSocketFactory());
}
