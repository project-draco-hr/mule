{
  Thread.sleep(5000);
  MuleMessage result;
  MuleClient client=new MuleClient(muleContext);
  client.dispatch("vm://in",DEFAULT_INPUT_MESSAGE,null);
  result=client.request("vm://out",getTimeout());
  assertNotNull(result);
  result=client.request("vm://out",getTimeout());
  assertNotNull(result);
  result=client.request("vm://out",getTimeout());
  assertNull(result);
  muleContext.getRegistry().lookupConnector(CONNECTOR1_NAME).stop();
  assertEquals(muleContext.getRegistry().lookupConnector(CONNECTOR1_NAME).isStarted(),false);
  logger.info(CONNECTOR1_NAME + " is stopped");
  client.dispatch("vm://in",DEFAULT_INPUT_MESSAGE,null);
  Thread.sleep(1000);
  muleContext.getRegistry().lookupConnector(CONNECTOR1_NAME).start();
  Thread.sleep(1000);
  logger.info(CONNECTOR1_NAME + " is started");
  result=client.request("vm://out",getTimeout());
  assertNotNull(result);
  logger.info("Received " + result.getPayload());
  result=client.request("vm://out",getTimeout());
  assertNotNull(result);
  logger.info("!Received " + result.getPayload());
  result=client.request("vm://out",getSmallTimeout());
  assertNull(result);
}
