{
  final ReentrantLock lock=deploymentService.getLock();
  try {
    if (!lock.tryLock(0,TimeUnit.SECONDS)) {
      return;
    }
    deployListener.onDeployStart(app);
    app.install();
    app.init();
    app.start();
    deployListener.onDeploySuccessful(app);
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
    return;
  }
catch (  Throwable t) {
    deployListener.onDeployFailure(app,t);
    if (t instanceof DeploymentException) {
      throw ((DeploymentException)t);
    }
    final String msg=String.format("Failed to deploy application [%s]",app.getAppName());
    throw new DeploymentException(MessageFactory.createStaticMessage(msg),t);
  }
 finally {
    if (lock.isHeldByCurrentThread()) {
      lock.unlock();
    }
  }
}
