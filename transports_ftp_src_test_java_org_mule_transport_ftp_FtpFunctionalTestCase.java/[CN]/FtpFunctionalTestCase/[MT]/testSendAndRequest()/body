{
  Map properties=new HashMap();
  MuleClient client=new MuleClient();
  client.dispatch("ftp://anonymous:email@localhost:" + PORT,TEST_MESSAGE,properties);
  NamedPayload payload=awaitUpload();
  assertNotNull(payload);
  assertEquals(TEST_MESSAGE,new String(payload.getPayload()));
  logger.info("received message OK!");
  MuleMessage retrieved=client.request("ftp://anonymous:email@localhost:" + PORT,getTimeout());
  assertNotNull(retrieved);
  assertNotNull(retrieved.getProperty(FileConnector.PROPERTY_ORIGINAL_FILENAME));
  assertNotNull(retrieved.getProperty(FileConnector.PROPERTY_FILE_SIZE));
  assertEquals(retrieved.getPayloadAsString(),TEST_MESSAGE);
}
