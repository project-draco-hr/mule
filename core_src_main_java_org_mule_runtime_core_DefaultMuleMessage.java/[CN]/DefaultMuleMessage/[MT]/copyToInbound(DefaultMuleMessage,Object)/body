{
  DefaultMuleMessage newMessage=new DefaultMuleMessage(payload,currentMessage,currentMessage.getMuleContext());
  Map<String,DataHandler> attachments=new HashMap<String,DataHandler>(3);
  for (  String name : currentMessage.getOutboundAttachmentNames()) {
    attachments.put(name,getOutboundAttachment(name));
  }
  Map<String,Serializable> newInboundProperties=new HashMap<>(3);
  for (  String name : currentMessage.getOutboundPropertyNames()) {
    newInboundProperties.put(name,currentMessage.getOutboundProperty(name));
  }
  newMessage.properties.clearProperties(INBOUND);
  newMessage.properties.clearProperties(OUTBOUND);
  for (  Map.Entry<String,Serializable> s : newInboundProperties.entrySet()) {
    DataType<?> propertyDataType=currentMessage.getOutboundPropertyDataType(s.getKey());
    newMessage.setProperty(s.getKey(),s.getValue(),INBOUND,propertyDataType);
  }
  newMessage.inboundAttachments.clear();
  newMessage.outboundAttachments.clear();
  for (  Map.Entry<String,DataHandler> s : attachments.entrySet()) {
    newMessage.addInboundAttachment(s.getKey(),s.getValue());
  }
  newMessage.setCorrelationId(currentMessage.getCorrelationId());
  newMessage.setCorrelationGroupSize(currentMessage.getCorrelationGroupSize());
  newMessage.setCorrelationSequence(currentMessage.getCorrelationSequence());
  newMessage.setReplyTo(currentMessage.getReplyTo());
  newMessage.setEncoding(currentMessage.getEncoding());
  return newMessage;
}
