{
  List paramNames=new ArrayList();
  writeStmt=connector.parseStatement(writeStmt,paramNames);
  Object[] paramValues=connector.getParams(endpoint,paramNames,new DefaultMuleMessage(event.transformMessage()),this.endpoint.getEndpointURI().getAddress());
  Transaction tx=TransactionCoordination.getInstance().getTransaction();
  Connection con=null;
  try {
    con=this.connector.getConnection();
    if ("call".equalsIgnoreCase(writeStmt.substring(0,4))) {
      writeStmt=STORED_PROCEDURE_PREFIX + writeStmt + STORED_PROCEDURE_SUFFIX;
    }
    if (logger.isDebugEnabled()) {
      logger.debug("SQL UPDATE: " + writeStmt + ", params = "+ ArrayUtils.toString(paramValues));
    }
    int nbRows=connector.getQueryRunner().update(con,writeStmt,paramValues);
    if (nbRows != 1) {
      logger.warn("Row count for write should be 1 and not " + nbRows);
    }
    if (tx == null) {
      JdbcUtils.commitAndClose(con);
    }
    logger.debug("MuleEvent dispatched succesfuly");
  }
 catch (  Exception e) {
    logger.debug("Error dispatching event: " + e.getMessage(),e);
    if (tx == null) {
      JdbcUtils.rollbackAndClose(con);
    }
    throw e;
  }
}
