{
  SensingNullReplyToHandler sensingReplyToHandler=new SensingNullReplyToHandler();
  ExceptionHandlingReplyToHandlerDecorator errorHandlingReplyToHandler=new ExceptionHandlingReplyToHandlerDecorator(sensingReplyToHandler,messagingExceptionHandler);
  MessagingException messagingException=new MessagingException(sourceEvent,new RuntimeException());
  when(messagingExceptionHandler.handleException(messagingException,sourceEvent)).thenAnswer(new Answer<MuleEvent>(){
    @Override public MuleEvent answer(    InvocationOnMock invocation) throws Throwable {
      ((MessagingException)invocation.getArguments()[0]).setHandled(true);
      return handledEvent;
    }
  }
);
  errorHandlingReplyToHandler.processExceptionReplyTo(sourceEvent,messagingException,null);
  verify(messagingExceptionHandler,Mockito.times(1)).handleException(messagingException,sourceEvent);
  assertThat(sensingReplyToHandler.exception,nullValue());
  assertThat(sensingReplyToHandler.event,equalTo(handledEvent));
}
