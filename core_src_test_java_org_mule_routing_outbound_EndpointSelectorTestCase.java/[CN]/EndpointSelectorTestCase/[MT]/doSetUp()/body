{
  super.doSetUp();
  session=MuleTestUtils.getMockSession();
  session.matchAndReturn("getFlowConstruct",getTestService());
  dest1=getTestOutboundEndpoint("dest1");
  dest2=getTestOutboundEndpoint("dest2");
  dest3=getTestOutboundEndpoint("dest3");
  mockendpoint1=RouterTestUtils.getMockEndpoint(dest1);
  mockendpoint2=RouterTestUtils.getMockEndpoint(dest2);
  mockendpoint3=RouterTestUtils.getMockEndpoint(dest3);
  List<OutboundEndpoint> endpoints=new ArrayList<OutboundEndpoint>();
  endpoints.add((OutboundEndpoint)mockendpoint1.proxy());
  endpoints.add((OutboundEndpoint)mockendpoint2.proxy());
  endpoints.add((OutboundEndpoint)mockendpoint3.proxy());
  router=new EndpointSelector();
  router.setEndpoints(endpoints);
  router.setMuleContext(muleContext);
  router.initialise();
}
