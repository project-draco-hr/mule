{
  if (wsdlEndpoint == null && lazyInit) {
    initialise();
  }
  UMOMessage message=eventContext.getMessage();
  String httpRequest=((String)message.getProperty(HTTP_REQUEST)).toLowerCase();
  if ((httpRequest.indexOf(WSDL_PARAM_1) != -1) || (httpRequest.indexOf(WSDL_PARAM_2) != -1)) {
    logger.debug("Retrieving WSDL from web service");
    String wsdlString;
    if (this.useFile) {
      eventContext.setStopFurtherProcessing(true);
      return wsdlFileContents;
    }
    UMOManagementContext managementContext=MuleServer.getManagementContext();
    UMOImmutableEndpoint webServiceEndpoint=managementContext.getRegistry().lookupEndpointFactory().getOutboundEndpoint(this.wsdlEndpoint);
    UMOMessage replyWSDL=eventContext.receiveEvent(webServiceEndpoint,eventContext.getTimeout());
    wsdlString=replyWSDL.getPayloadAsString();
    wsdlString=wsdlString.replaceAll(this.urlWebservice,eventContext.getEndpointURI().getAddress());
    MuleMessage modifiedWsdl=new MuleMessage(wsdlString,message);
    logger.debug("WSDL retrieved successfully");
    eventContext.setStopFurtherProcessing(true);
    return modifiedWsdl;
  }
 else {
    logger.debug("Forwarding SOAP message");
    return eventContext.getMessage();
  }
}
