{
  final Builder builder=MuleMessage.builder(event.getMessage());
  if (dataType == null) {
    final TypedValue typedValue=resolveTypedValue(event);
    builder.payload(typedValue.getValue() != null ? typedValue.getValue() : NullPayload.getInstance()).mediaType(typedValue.getDataType().getMediaType());
  }
 else {
    Object value=resolveValue(event);
    final DataTypeParamsBuilder dataTypeBuilder=DataType.builder(dataType).type((value == null || value instanceof NullPayload) ? Object.class : value.getClass());
    builder.payload(value != null ? value : NullPayload.getInstance()).mediaType(dataTypeBuilder.build().getMediaType());
  }
  event.setMessage(builder.build());
  return event;
}
