{
  try {
    final SystemExceptionHandler exceptionListener=muleContext.getExceptionListener();
    muleContext.setExceptionListener(new SystemExceptionHandler(){
      @Override public void handleException(      Exception exception,      RollbackSourceCallback rollbackMethod){
        try {
          numberOfInvocations.incrementAndGet();
          exceptionListener.handleException(exception,rollbackMethod);
        }
  finally {
          exceptionThrownLatch.countDown();
        }
      }
      @Override public void handleException(      Exception exception){
        try {
          numberOfInvocations.incrementAndGet();
          exceptionListener.handleException(exception);
        }
  finally {
          exceptionThrownLatch.countDown();
        }
      }
    }
);
    muleContext.registerListener(new ExceptionNotificationListener<ExceptionNotification>(){
      @Override public void onNotification(      ExceptionNotification notification){
        exceptionNotifications.add(notification);
      }
    }
);
  }
 catch (  NotificationException e) {
    throw new RuntimeException(e);
  }
}
