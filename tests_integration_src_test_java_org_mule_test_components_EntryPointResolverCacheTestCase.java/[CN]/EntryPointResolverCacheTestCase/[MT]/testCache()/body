{
  Event responseEvent=flowRunner("refServiceOne").withPayload("a request").withInboundProperty("method","retrieveReferenceData").run();
  InternalMessage response=responseEvent.getMessage();
  Object payload=response.getPayload().getValue();
  assertThat(payload,instanceOf(String.class));
  assertThat(payload,is("ServiceOne"));
  response=flowRunner("refServiceTwo").withPayload("another request").withInboundProperty("method","retrieveReferenceData").run().getMessage();
  payload=response.getPayload().getValue();
  if ((payload == null) || (responseEvent.getError().isPresent())) {
    Throwable exception=responseEvent.getError().get().getException();
    if (exception != null) {
      fail(exception.getMessage());
    }
 else {
      fail(responseEvent.getError().get().toString());
    }
  }
  assertThat(payload,instanceOf(String.class));
  assertThat(payload,is("ServiceTwo"));
}
