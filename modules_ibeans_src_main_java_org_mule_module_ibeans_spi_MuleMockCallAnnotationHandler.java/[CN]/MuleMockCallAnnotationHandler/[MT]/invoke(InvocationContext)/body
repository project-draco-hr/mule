{
  this.ctx=ctx;
  Method method=ctx.getMethod();
  Object result;
  if (method.getName().startsWith("ibean")) {
    result=method.invoke(this,ctx.getArgs());
  }
 else {
    result=ctx.getMethod().invoke(mock,ctx.getArgs());
  }
  Map<String,Object> props=new HashMap<String,Object>();
  props.put(HttpConstants.HEADER_CONTENT_TYPE,(ctx.getInvocationReturnType() == null ? ctx.getReturnType().getMimeType() : ctx.getInvocationReturnType().getMimeType()));
  Response response=(result instanceof Response ? (Response)result : plugin.createResponse(result,props,null));
  if (callback != null) {
    try {
      callback.onMessage(response);
    }
  finally {
      callback=null;
      this.ctx=null;
    }
  }
  return response;
}
