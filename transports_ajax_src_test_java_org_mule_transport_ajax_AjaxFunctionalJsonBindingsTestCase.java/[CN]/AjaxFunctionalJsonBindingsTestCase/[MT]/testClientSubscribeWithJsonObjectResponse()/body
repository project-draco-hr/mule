{
  final Latch latch=new Latch();
  final AtomicReference<String> data=new AtomicReference<String>();
  client.addListener(new MessageListener(){
    public void deliver(    Client client,    Client client1,    Message message){
      if (message.getData() != null) {
        data.set((message.toString()));
        latch.release();
      }
    }
  }
);
  client.subscribe("/test1");
  MuleClient muleClient=new MuleClient(muleContext);
  muleClient.dispatch("vm://in1","Ross",null);
  latch.await(10,TimeUnit.SECONDS);
  assertNotNull(data.get());
  ObjectMapper mapper=new ObjectMapper();
  Map result=mapper.readValue(data.get(),Map.class);
  assertEquals("/test1",result.get("channel"));
  assertEquals("Ross",((Map)result.get("data")).get("name"));
}
