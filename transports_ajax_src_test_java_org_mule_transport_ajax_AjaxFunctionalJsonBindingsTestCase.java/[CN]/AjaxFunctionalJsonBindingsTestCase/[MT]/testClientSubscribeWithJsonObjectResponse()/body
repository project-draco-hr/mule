{
  final Latch latch=new Latch();
  final AtomicReference<String> data=new AtomicReference<String>();
  client.addListener(new MessageListener(){
    @Override public void deliver(    Client fromClient,    Client toClient,    Message message){
      if (message.getData() != null) {
        data.set(message.toString());
        latch.release();
      }
    }
  }
);
  client.subscribe("/test1");
  MuleClient muleClient=muleContext.getClient();
  muleClient.dispatch("vm://in1","Ross",null);
  assertTrue("data did not arrive on time",latch.await(DEFAULT_TEST_TIMEOUT_SECS,TimeUnit.SECONDS));
  assertNotNull(data.get());
  ObjectMapper mapper=new ObjectMapper();
  Map<?,?> result=mapper.readValue(data.get(),Map.class);
  assertEquals("/test1",result.get("channel"));
  assertEquals("Ross",((Map<?,?>)result.get("data")).get("name"));
}
