{
  try {
    XFire xfire=connector.getXfire();
    String wsdlUrl=endpoint.getEndpointURI().getAddress();
    String serviceName=wsdlUrl.substring(0,wsdlUrl.lastIndexOf('?'));
    Service service=xfire.getServiceRegistry().getService(new QName(serviceName));
    if (service == null) {
      service=new Client(new URL(wsdlUrl)).getService();
      service.setName(new QName(serviceName));
      xfire.getServiceRegistry().register(service);
    }
    try {
      this.client=new Client(new URL(endpoint.getEndpointURI().getAddress()));
      this.client.setXFire(xfire);
      this.client.setEndpointUri(endpoint.getEndpointURI().toString());
    }
 catch (    Exception ex) {
      disconnect();
      throw ex;
    }
  }
 catch (  Exception ex) {
    disconnect();
    throw ex;
  }
}
