{
  final StateDecoder stateDecoder=new StateDecoder(originalState);
  String decodedState=stateDecoder.decodeOriginalState();
  String encodedResourceOwnerId=stateDecoder.decodeResourceOwnerId();
  String resourceOwnerId=encodedResourceOwnerId == null ? ResourceOwnerOAuthContext.DEFAULT_RESOURCE_OWNER_ID : encodedResourceOwnerId;
  final ResourceOwnerOAuthContext stateForUser=getOauthConfig().getUserOAuthContext().getContextForResourceOwner(resourceOwnerId);
  processTokenUrlResponse(tokenUrlResponse,decodedState,stateForUser);
  getOauthConfig().getUserOAuthContext().updateResourceOwnerOAuthContext(stateForUser);
}
