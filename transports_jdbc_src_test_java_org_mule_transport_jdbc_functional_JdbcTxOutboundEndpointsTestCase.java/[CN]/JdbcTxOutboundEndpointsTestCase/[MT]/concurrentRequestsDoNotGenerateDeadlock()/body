{
  ExecutorService executorService=Executors.newFixedThreadPool(2);
  processEvent(executorService,true);
  Latch firstQueryExecutedLatch=muleContext.getRegistry().lookupObject("firstQueryExecutedLatch");
  firstQueryExecutedLatch.await();
  processEvent(executorService,false);
  CountDownLatch finishedLatch=muleContext.getRegistry().lookupObject("finishedLatch");
  assertThat(finishedLatch.await(RECEIVE_TIMEOUT,TimeUnit.MILLISECONDS),is(true));
}
