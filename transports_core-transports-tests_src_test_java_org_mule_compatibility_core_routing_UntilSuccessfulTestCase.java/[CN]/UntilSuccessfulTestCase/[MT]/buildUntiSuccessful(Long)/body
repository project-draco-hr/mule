{
  EndpointDlqUntilSuccessful untilSuccessful=new EndpointDlqUntilSuccessful();
  untilSuccessful.setMuleContext(muleContext);
  untilSuccessful.setMessagingExceptionHandler(muleContext.getDefaultErrorHandler());
  untilSuccessful.setFlowConstruct(getTestFlow());
  untilSuccessful.setMaxRetries(2);
  if (millisBetweenRetries != null) {
    untilSuccessful.setMillisBetweenRetries(millisBetweenRetries);
  }
  objectStore=new SimpleMemoryObjectStore<Event>();
  untilSuccessful.setObjectStore(objectStore);
  targetMessageProcessor=new ConfigurableMessageProcessor();
  untilSuccessful.addRoute(targetMessageProcessor);
  return untilSuccessful;
}
