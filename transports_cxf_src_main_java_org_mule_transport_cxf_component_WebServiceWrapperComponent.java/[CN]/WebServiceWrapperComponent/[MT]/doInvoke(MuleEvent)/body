{
  MuleContext muleContext=event.getMuleContext();
  String tempUrl;
  if (addressFromMessage) {
    tempUrl=event.getMessage().getStringProperty(WS_SERVICE_URL,PropertyScope.INBOUND,null);
    if (tempUrl == null) {
      throw new IllegalArgumentException(CoreMessages.propertyIsNotSetOnEvent(WS_SERVICE_URL).toString());
    }
  }
 else {
    tempUrl=address;
  }
  EndpointBuilder endpointBuilder=new EndpointURIEndpointBuilder("cxf:" + tempUrl,muleContext);
  if (wsdlPort != null) {
    endpointBuilder.setProperty("wsdlPort",wsdlPort);
  }
  if (operation != null) {
    endpointBuilder.setProperty("operation",operation);
  }
  endpointBuilder.setExchangePattern(MessageExchangePattern.REQUEST_RESPONSE);
  OutboundEndpoint endpoint=endpointBuilder.buildOutboundEndpoint();
  MuleEvent responeEvent=endpoint.process(new DefaultMuleEvent(event.getMessage(),endpoint,event.getSession()));
  if (responeEvent != null) {
    return responeEvent.getMessage();
  }
 else {
    return null;
  }
}
