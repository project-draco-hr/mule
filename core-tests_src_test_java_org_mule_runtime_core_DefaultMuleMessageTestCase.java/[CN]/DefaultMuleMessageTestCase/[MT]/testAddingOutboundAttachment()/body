{
  DataHandler handler=new DataHandler("this is the attachment","text/plain");
  MuleMessage message=MuleMessage.builder().payload(TEST_MESSAGE).addOutboundAttachment("attachment",handler).build();
  assertTrue(message.getOutboundAttachmentNames().contains("attachment"));
  assertEquals(handler,message.getOutboundAttachment("attachment"));
  assertEquals(0,message.getInboundAttachmentNames().size());
  message=MuleMessage.builder(message).removeOutboundAttachment("attachment").build();
  assertEquals(0,message.getOutboundAttachmentNames().size());
  message=MuleMessage.builder(message).addOutboundAttachment("spi-props",IOUtils.toDataHandler("spi-props",IOUtils.getResourceAsUrl("test-spi.properties",getClass()),MediaType.TEXT)).build();
  assertTrue(message.getOutboundAttachmentNames().contains("spi-props"));
  handler=message.getOutboundAttachment("spi-props");
  assertEquals(MediaType.TEXT.getPrimaryType(),handler.getContentType().split("/")[0]);
  assertEquals(MediaType.TEXT.getSubType(),handler.getContentType().split("/")[1]);
  assertEquals(1,message.getOutboundAttachmentNames().size());
  message=MuleMessage.builder(message).addOutboundAttachment("dummy",IOUtils.toDataHandler("dummy",IOUtils.getResourceAsUrl("dummy.xml",getClass()),null)).build();
  handler=message.getOutboundAttachment("dummy");
  assertEquals(MediaType.APPLICATION_XML.getPrimaryType(),handler.getContentType().split("/")[0]);
  assertEquals(MediaType.APPLICATION_XML.getSubType(),handler.getContentType().split("/")[1]);
  assertEquals(2,message.getOutboundAttachmentNames().size());
}
