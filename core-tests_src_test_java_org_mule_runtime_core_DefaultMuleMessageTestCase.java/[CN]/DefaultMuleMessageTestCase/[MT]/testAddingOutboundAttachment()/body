{
  MutableMuleMessage message=new DefaultMuleMessage(TEST_MESSAGE,muleContext);
  DataHandler handler=new DataHandler("this is the attachment","text/plain");
  message.addOutboundAttachment("attachment",handler);
  assertTrue(message.getOutboundAttachmentNames().contains("attachment"));
  assertEquals(handler,message.getOutboundAttachment("attachment"));
  assertEquals(0,message.getInboundAttachmentNames().size());
  message.removeOutboundAttachment("attachment");
  assertEquals(0,message.getOutboundAttachmentNames().size());
  message.addOutboundAttachment("spi-props",IOUtils.getResourceAsUrl("test-spi.properties",getClass()),MimeTypes.TEXT);
  assertTrue(message.getOutboundAttachmentNames().contains("spi-props"));
  handler=message.getOutboundAttachment("spi-props");
  assertEquals(MimeTypes.TEXT,handler.getContentType());
  assertEquals(1,message.getOutboundAttachmentNames().size());
  message.addOutboundAttachment("dummy",IOUtils.getResourceAsUrl("dummy.xml",getClass()),null);
  handler=message.getOutboundAttachment("dummy");
  assertEquals(MimeTypes.APPLICATION_XML,handler.getContentType());
  assertEquals(2,message.getOutboundAttachmentNames().size());
}
