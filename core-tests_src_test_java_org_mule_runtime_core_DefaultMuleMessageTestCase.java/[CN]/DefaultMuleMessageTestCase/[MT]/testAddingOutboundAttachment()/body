{
  MutableMuleMessage message=new DefaultMuleMessage(TEST_MESSAGE);
  DataHandler handler=new DataHandler("this is the attachment","text/plain");
  message.addOutboundAttachment("attachment",handler);
  assertTrue(message.getOutboundAttachmentNames().contains("attachment"));
  assertEquals(handler,message.getOutboundAttachment("attachment"));
  assertEquals(0,message.getInboundAttachmentNames().size());
  message.removeOutboundAttachment("attachment");
  assertEquals(0,message.getOutboundAttachmentNames().size());
  message.addOutboundAttachment("spi-props",IOUtils.getResourceAsUrl("test-spi.properties",getClass()),MediaType.TEXT);
  assertTrue(message.getOutboundAttachmentNames().contains("spi-props"));
  handler=message.getOutboundAttachment("spi-props");
  assertEquals(MediaType.TEXT.getPrimaryType(),handler.getContentType().split("/")[0]);
  assertEquals(MediaType.TEXT.getSubType(),handler.getContentType().split("/")[1]);
  assertEquals(1,message.getOutboundAttachmentNames().size());
  message.addOutboundAttachment("dummy",IOUtils.getResourceAsUrl("dummy.xml",getClass()),null);
  handler=message.getOutboundAttachment("dummy");
  assertEquals(MediaType.APPLICATION_XML.getPrimaryType(),handler.getContentType().split("/")[0]);
  assertEquals(MediaType.APPLICATION_XML.getSubType(),handler.getContentType().split("/")[1]);
  assertEquals(2,message.getOutboundAttachmentNames().size());
}
