{
  AbstractBulkUpdateMessageProcessor bulkUpdateMessageProcessor;
  if (query.isDynamic()) {
    bulkUpdateMessageProcessor=new DynamicBulkUpdateMessageProcessor(dbConfigResolver,queryResolver,bulkUpdateExecutorFactory,transactionalAction,validQueryTypes);
  }
 else {
    bulkUpdateMessageProcessor=new PreparedBulkUpdateMessageProcessor(dbConfigResolver,queryResolver,bulkUpdateExecutorFactory,transactionalAction,validQueryTypes,new DynamicParamValueResolver(muleContext.getExpressionManager()));
  }
  bulkUpdateMessageProcessor.setSource(source);
  bulkUpdateMessageProcessor.setTarget(target);
  bulkUpdateMessageProcessor.setQueryMetadataProvider(queryMetadataProvider);
  bulkUpdateMessageProcessor.setAutoGeneratedKeyStrategy(autoGeneratedKeyStrategy);
  bulkUpdateMessageProcessor.setStatementStreamingResultSetCloser(streamingResultSetCloser);
  return bulkUpdateMessageProcessor;
}
