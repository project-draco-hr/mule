{
  MuleContext ctx=ctxBuilder.buildMuleContext();
  ctx.initialise();
  new DefaultsConfigurationBuilder().configure(ctx);
  final AtomicBoolean stoppingNotifFired=new AtomicBoolean(false);
  final AtomicBoolean stoppedNotifFired=new AtomicBoolean(false);
  ctx.registerListener(new MuleContextNotificationListener<MuleContextNotification>(){
    public void onNotification(    MuleContextNotification notification){
      if (notification.getAction() == MuleContextNotification.CONTEXT_STOPPING) {
        stoppingNotifFired.set(true);
      }
      if (notification.getAction() == MuleContextNotification.CONTEXT_STOPPED) {
        stoppedNotifFired.set(true);
      }
    }
  }
);
  ctx.start();
  ctx.dispose();
  assertFalse(ctx.isInitialised());
  assertFalse(ctx.isInitialising());
  assertFalse(ctx.isStarted());
  assertTrue(ctx.isDisposed());
  assertFalse(ctx.isDisposing());
  assertLifecycleManagerDidApplyAllPhases();
  assertTrue("CONTEXT_STOPPING notification never fired",stoppingNotifFired.get());
  assertTrue("CONTEXT_STOPPED notification never fired",stoppedNotifFired.get());
}
