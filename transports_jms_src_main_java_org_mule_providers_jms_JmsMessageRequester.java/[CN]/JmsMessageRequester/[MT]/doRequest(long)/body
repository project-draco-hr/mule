{
  Session session=null;
  MessageConsumer consumer=null;
  try {
    final boolean topic=connector.getTopicResolver().isTopic(endpoint);
    JmsSupport support=connector.getJmsSupport();
    session=connector.getSession(false,topic);
    Destination dest=support.createDestination(session,endpoint.getEndpointURI().getAddress(),topic);
    consumer=support.createConsumer(session,dest,topic);
    try {
      Message message;
      if (timeout == JmsMessageDispatcher.RECEIVE_NO_WAIT) {
        message=consumer.receiveNoWait();
      }
 else       if (timeout == JmsMessageDispatcher.RECEIVE_WAIT_INDEFINITELY) {
        message=consumer.receive();
      }
 else {
        message=consumer.receive(timeout);
      }
      if (message == null) {
        return null;
      }
      message=connector.preProcessMessage(message,session);
      return new MuleMessage(connector.getMessageAdapter(message));
    }
 catch (    Exception e) {
      connector.handleException(e);
      return null;
    }
  }
  finally {
    connector.closeQuietly(consumer);
    connector.closeQuietly(session);
  }
}
