{
  RequestLine requestLine=request.getRequestLine();
  Map headers=new HashMap();
  for (Iterator rhi=request.getHeaderIterator(); rhi.hasNext(); ) {
    Header header=(Header)rhi.next();
    String headerName=header.getName();
    Object headerValue=header.getValue();
    if (headerName.startsWith("X-MULE")) {
      headerName=headerName.substring(2);
    }
 else     if (headerName.equals(HttpConnector.HTTP_COOKIES_PROPERTY)) {
      if (enableCookies) {
        Cookie[] cookies=CookieHelper.parseCookies(header,cookieSpec);
        if (cookies.length > 0) {
          headerValue=cookies;
        }
 else {
          continue;
        }
      }
 else {
        continue;
      }
    }
    headers.put(headerName,headerValue);
  }
  headers.put(HttpConnector.HTTP_METHOD_PROPERTY,requestLine.getMethod());
  headers.put(HttpConnector.HTTP_REQUEST_PROPERTY,requestLine.getUri());
  headers.put(HttpConnector.HTTP_VERSION_PROPERTY,requestLine.getHttpVersion().toString());
  headers.put(HttpConnector.HTTP_COOKIE_SPEC_PROPERTY,cookieSpec);
  return headers;
}
