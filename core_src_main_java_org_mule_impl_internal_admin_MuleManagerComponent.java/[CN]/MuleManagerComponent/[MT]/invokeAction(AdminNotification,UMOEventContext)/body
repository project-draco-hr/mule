{
  String destComponent=null;
  UMOMessage result=null;
  String endpoint=action.getResourceIdentifier();
  if (action.getResourceIdentifier().startsWith("mule:")) {
    destComponent=endpoint.substring(endpoint.lastIndexOf("/") + 1);
  }
 else {
    destComponent=endpoint;
  }
  if (destComponent != null) {
    UMOSession session=new MuleSession(MuleServer.getMuleContext().getRegistry().lookupComponent(destComponent));
    MuleContext muleContext=MuleServer.getMuleContext();
    UMOEndpointBuilder builder=new EndpointURIEndpointBuilder(RequestContext.getEvent().getEndpoint(),muleContext);
    builder.setTransformers(new LinkedList());
    UMOImmutableEndpoint ep=muleContext.getRegistry().lookupEndpointFactory().getInboundEndpoint(builder);
    UMOEvent event=new MuleEvent(action.getMessage(),ep,context.getSession(),context.isSynchronous());
    event=RequestContext.setEvent(event);
    if (context.isSynchronous()) {
      result=session.getComponent().sendEvent(event);
      ByteArrayOutputStream out=new ByteArrayOutputStream();
      wireFormat.write(out,result,getEncoding());
      return out.toByteArray();
    }
 else {
      session.getComponent().dispatchEvent(event);
      return null;
    }
  }
 else {
    return handleException(result,new MuleException(CoreMessages.couldNotDetermineDestinationComponentFromEndpoint(endpoint)));
  }
}
