{
  Set<Throwable> seen=new HashSet<>();
  while (true) {
    if (type.isInstance(ex)) {
      return;
    }
 else     if (ex == null || seen.contains(ex)) {
      fail("Bad exception type");
    }
 else {
      seen.add(ex);
      ex=ex.getCause();
    }
  }
}
