{
  MuleMessage message=context.getMessage();
  Object httpMethod=message.getInboundProperty("http.method");
  if (HttpConstants.METHOD_GET.equals(httpMethod)) {
    assertEquals("/services/Echo?foo=bar",muleContext.getTransformationService().transform(message,DataTypeFactory.create(String.class)).getPayload());
  }
 else   if (HttpConstants.METHOD_POST.equals(httpMethod)) {
    assertEquals("foo=bar",muleContext.getTransformationService().transform(message,DataTypeFactory.create(String.class)).getPayload());
  }
 else {
    fail("invalid HTTP method : " + httpMethod);
  }
  assertEquals("true",message.getInboundProperty(HttpConstants.HEADER_CONNECTION));
  assertEquals("true",message.getInboundProperty(HttpConstants.HEADER_KEEP_ALIVE));
  messageDidArrive.countDown();
}
