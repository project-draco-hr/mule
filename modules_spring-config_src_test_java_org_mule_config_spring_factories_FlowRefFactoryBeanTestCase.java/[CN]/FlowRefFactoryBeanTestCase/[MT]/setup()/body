{
  when(muleContext.getExpressionManager()).thenReturn(expressionManager);
  when(expressionManager.isExpression(Mockito.anyString())).thenReturn(true);
  when(targetFlow.process(Mockito.any(MuleEvent.class))).thenReturn(result);
  when(targetSubFlow.process(Mockito.any(MuleEvent.class))).thenReturn(result);
  when(result.getOutputStream()).thenReturn(Mockito.mock(ResponseOutputStream.class));
  when(result.getMessage()).thenReturn(mock(DefaultMuleMessage.class,withSettings().extraInterfaces(ThreadSafeAccess.class).defaultAnswer(Answers.RETURNS_DEEP_STUBS.get())));
  when(result.newThreadCopy()).thenReturn(resultCopy);
}
