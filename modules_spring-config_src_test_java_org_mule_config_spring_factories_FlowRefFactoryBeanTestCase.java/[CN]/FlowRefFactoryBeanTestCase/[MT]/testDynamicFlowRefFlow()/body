{
  when(expressionManager.isExpression(Mockito.anyString())).thenReturn(true);
  when(expressionManager.parse(Mockito.eq("dynamicReferencedFlow"),Mockito.any(MuleEvent.class))).thenReturn("parsedDynamicReferencedFlow");
  when(applicationContext.getBean(Mockito.eq("parsedDynamicReferencedFlow"))).thenReturn(targetFlow);
  FlowRefFactoryBean flowRefFactoryBean=new FlowRefFactoryBean();
  flowRefFactoryBean.setName("dynamicReferencedFlow");
  flowRefFactoryBean.setApplicationContext(applicationContext);
  flowRefFactoryBean.setMuleContext(muleContext);
  flowRefFactoryBean.initialise();
  Assert.assertNotSame(targetFlow,flowRefFactoryBean.getObject());
  Assert.assertNotSame(targetFlow,flowRefFactoryBean.getObject());
  flowRefFactoryBean.getObject().process(event);
  flowRefFactoryBean.getObject().process(event);
  Mockito.verify(applicationContext,Mockito.times(1)).getBean(Mockito.anyString());
  Mockito.verify(targetFlow,Mockito.times(2)).process(Mockito.any(MuleEvent.class));
  Mockito.verify(targetFlow,Mockito.never()).initialise();
  flowRefFactoryBean.dispose();
  Mockito.verify(targetSubFlow,Mockito.never()).dispose();
}
