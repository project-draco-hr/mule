{
  Mockito.when(expressionManager.isExpression(Mockito.anyString())).thenReturn(true);
  Mockito.when(expressionManager.parse(Mockito.eq("dynamicReferencedFlow"),Mockito.any(MuleEvent.class))).thenReturn("parsedDynamicReferencedFlow");
  Mockito.when(applicationContext.getBean(Mockito.eq("parsedDynamicReferencedFlow"))).thenReturn(target);
  FlowRefFactoryBean flowRefFactoryBean=new FlowRefFactoryBean();
  flowRefFactoryBean.setName("dynamicReferencedFlow");
  flowRefFactoryBean.setApplicationContext(applicationContext);
  flowRefFactoryBean.setMuleContext(muleContext);
  flowRefFactoryBean.initialise();
  Assert.assertNotSame(target,flowRefFactoryBean.getObject());
  Assert.assertSame(result,((MessageProcessor)flowRefFactoryBean.getObject()).process(Mockito.mock(MuleEvent.class)));
}
