{
  Session session=null;
  try {
    ConnectionFactory cf=new ActiveMQConnectionFactory("vm://localhost?broker.persistent=false&broker.useJmx=false");
    session=cf.createConnection().createSession(false,Session.AUTO_ACKNOWLEDGE);
    List data=new ArrayList();
    data.add(new Object());
    try {
      JmsMessageUtils.toMessage(data,session);
      fail("Should've failed with MessageFormatException");
    }
 catch (    MessageFormatException e) {
    }
    data.clear();
    data.add(Boolean.TRUE);
    data.add(new Byte("1"));
    data.add(new Short("2"));
    data.add(new Character('3'));
    data.add(new Integer("4"));
    data.add(new Float("6"));
    data.add(new Double("7"));
    data.add(new String("8"));
    data.add(new byte[]{9,10});
    StreamMessage result=(StreamMessage)JmsMessageUtils.toMessage(data,session);
    result.reset();
    assertEquals(Boolean.TRUE,result.readObject());
    assertEquals(new Byte("1"),result.readObject());
    assertEquals(new Short("2"),result.readObject());
    assertEquals(new Character('3'),result.readObject());
    assertEquals(new Integer("4"),result.readObject());
    assertEquals(new Float("6"),result.readObject());
    assertEquals(new Double("7"),result.readObject());
    assertEquals(new String("8"),result.readObject());
    assertTrue(Arrays.equals(new byte[]{9,10},(byte[])result.readObject()));
  }
  finally {
    if (session != null) {
      session.close();
    }
  }
}
