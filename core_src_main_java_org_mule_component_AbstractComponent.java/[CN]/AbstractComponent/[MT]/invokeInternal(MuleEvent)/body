{
  OptimizedRequestContext.unsafeSetEvent(event);
  if (logger.isTraceEnabled()) {
    logger.trace("Invoking " + this.getClass().getName() + "component for service "+ service.getName());
  }
  if (!(event.getEndpoint() instanceof InboundEndpoint)) {
    throw new IllegalStateException("Unable to process outbound event, components only process incoming events.");
  }
  if (service.getLifecycleManager().getState().isStopping() || !service.getLifecycleManager().getState().isStarted()) {
    throw new LifecycleException(CoreMessages.isStopped(service.getName()),this);
  }
  try {
    fireComponentNotification(event.getMessage(),ComponentMessageNotification.COMPONENT_PRE_INVOKE);
    long startTime=0;
    if (statistics.isEnabled()) {
      startTime=System.currentTimeMillis();
    }
    Object result=doInvoke(event);
    if (statistics.isEnabled()) {
      statistics.addExecutionTime(System.currentTimeMillis() - startTime);
    }
    MuleEvent resultEvent=createResultEvent(event,result);
    fireComponentNotification(resultEvent.getMessage(),ComponentMessageNotification.COMPONENT_POST_INVOKE);
    return resultEvent;
  }
 catch (  MuleException me) {
    throw me;
  }
catch (  Exception e) {
    throw new ServiceException(CoreMessages.failedToInvoke(this.toString()),event.getMessage(),service,e);
  }
}
