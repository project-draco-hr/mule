{
  EndpointURI endpointURI=event.getEndpoint().getEndpointURI();
  Map properties=new HashMap();
  MuleMessage msg=event.getMessage();
  for (  String propertyKey : msg.getOutboundPropertyNames()) {
    Object value=msg.getOutboundProperty(propertyKey);
    properties.put(propertyKey,value);
  }
  properties.put(MuleProperties.MULE_METHOD_PROPERTY,method.getLocalPart());
  properties.put("methodNamespace",method.getNamespaceURI());
  properties.put("address",endpointURI.getAddress());
  properties.put("scheme",endpointURI.getScheme());
  properties.put("host",endpointURI.getHost());
  properties.put("port",String.valueOf(endpointURI.getPort()));
  properties.put("path",endpointURI.getPath());
  properties.put("hostInfo",endpointURI.getScheme() + "://" + endpointURI.getHost()+ (endpointURI.getPort() > -1 ? ":" + String.valueOf(endpointURI.getPort()) : ""));
  if (event.getFlowConstruct() != null) {
    properties.put("serviceName",event.getFlowConstruct().getName());
  }
  TemplateParser tp=TemplateParser.createMuleStyleParser();
  soapAction=tp.parse(properties,soapAction);
  if (logger.isDebugEnabled()) {
    logger.debug("SoapAction for this call is: " + soapAction);
  }
  return soapAction;
}
