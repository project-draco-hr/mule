{
  MuleClient client=muleContext.getClient();
  client.dispatch("inboundEndpoint","some data",null);
  Map<String,Object> props=new HashMap<String,Object>();
  props.put("foo","bar");
  client.dispatch("inboundEndpoint","some data",props);
  MuleMessage result=client.request("receivedEndpoint",TIMEOUT);
  assertNotNull(result);
  assertEquals("foo header received",getPayloadAsString(result));
  result=client.request("notReceivedEndpoint",TIMEOUT);
  assertNotNull(result);
  assertEquals("foo header not received",getPayloadAsString(result));
}
