{
  Map<String,DataHandler> attachments=new HashMap<String,DataHandler>();
  attachments.put("foo",new DataHandler(new StringDataSource("fooValue")));
  attachments.put("bar",new DataHandler(new StringDataSource("barValue")));
  eventContext=createEventContext(null,attachments);
  eventContext.getMessage().removeOutboundAttachment("baz");
  InvocationResult response=invokeResolver("processAttachmentsOptional",eventContext);
  assertTrue("Message payload should be a Map",response.getResult() instanceof Map);
  Map<String,DataHandler> result=(Map<String,DataHandler>)response.getResult();
  assertEquals(2,result.size());
  assertEquals("fooValue",readAttachment(result.get("foo")));
  assertEquals("barValue",readAttachment(result.get("bar")));
  assertNull(result.get("baz"));
}
