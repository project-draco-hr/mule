{
  String uri=getReceiverName(httpServletRequest);
  if (uri == null) {
    throw new EndpointException(HttpMessages.unableToGetEndpointUri(httpServletRequest.getRequestURI()));
  }
  UMOMessageReceiver receiver=(UMOMessageReceiver)getReceivers().get(uri);
  if (receiver == null) {
    int i=uri.lastIndexOf("/");
    if (i > -1) {
      String tempUri=uri.substring(i + 1);
      receiver=(AbstractMessageReceiver)getReceivers().get(tempUri);
    }
    if (receiver == null) {
      receiver=HttpMessageReceiver.findReceiverByStem(connector.getReceivers(),uri);
    }
    if (receiver == null) {
      Map receivers=getReceivers();
      Iterator iter=receivers.keySet().iterator();
      while (iter.hasNext()) {
        String key=iter.next().toString();
        i=key.lastIndexOf("/");
        if (i > -1) {
          String key2=key.substring(i + 1);
          if (key2.equals(uri)) {
            receiver=(AbstractMessageReceiver)receivers.get(key);
            break;
          }
        }
      }
    }
    if (receiver == null) {
      throw new NoReceiverForEndpointException("No receiver found for endpointUri: " + uri);
    }
  }
  ((UMOEndpoint)receiver.getEndpoint()).setEndpointURI(new MuleEndpointURI(getRequestUrl(httpServletRequest)));
  return receiver;
}
