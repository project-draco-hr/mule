{
  muleHome=System.getProperty("mule.home");
  if (muleHome == null || muleHome.trim().length() == 0) {
    throw new IllegalArgumentException("Either MULE_HOME is not set or mule.home system property is missing.");
  }
  try {
    addURL(new URL("file:///" + muleHome + FOLDER_USER+ "/"));
    addURL(new URL("file:///" + muleHome + FOLDER_MULE+ "/"));
    addURL(new URL("file:///" + muleHome + FOLDER_OPT+ "/"));
    File[] muleJars=listJars(FOLDER_USER);
    for (int i=0; i < muleJars.length; i++) {
      File jar=muleJars[i];
      addURL(jar.toURL());
    }
    muleJars=listJars(FOLDER_MULE);
    List muleCoreJars=new LinkedList();
    for (int i=0; i < muleJars.length; i++) {
      File jar=muleJars[i];
      if (jar.getName().indexOf("mule-core") > -1) {
        muleCoreJars.add(0,jar.toURL());
      }
 else {
        muleCoreJars.add(jar.toURL());
      }
    }
    addURLs(muleCoreJars);
    muleJars=listJars(FOLDER_OPT);
    for (int i=0; i < muleJars.length; i++) {
      File jar=muleJars[i];
      addURL(jar.toURL());
    }
  }
 catch (  MalformedURLException e) {
    throw new RuntimeException("Failed to construct a classpath URL",e);
  }
}
