{
  MuleMessage mockMessage=mock(MuleMessage.class);
  MuleMessage transformedMessage=mock(MuleMessage.class,RETURNS_DEEP_STUBS);
  TransformationService transformationService=mock(TransformationService.class);
  muleContext.setTransformationService(transformationService);
  when(transformationService.transform(mockMessage,DataTypeFactory.STRING)).thenReturn(transformedMessage);
  assertSame(transformedMessage.getPayload(),evaluate("message.payloadAs(org.mule.transformer.types.DataTypeFactory.STRING)",mockMessage));
}
