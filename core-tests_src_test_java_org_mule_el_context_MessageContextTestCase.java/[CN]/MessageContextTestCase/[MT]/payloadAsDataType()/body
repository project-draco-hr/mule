{
  String payload=TEST_PAYLOAD;
  MuleMessage transformedMessage=mock(MuleMessage.class,RETURNS_DEEP_STUBS);
  TransformationService transformationService=mock(TransformationService.class);
  when(transformedMessage.getPayload()).thenReturn(TEST_PAYLOAD);
  muleContext.setTransformationService(transformationService);
  when(transformationService.transform(event.getMessage(),DataTypeFactory.STRING)).thenReturn(transformedMessage);
  Object result=evaluate("message.payloadAs(org.mule.transformer.types.DataTypeFactory.STRING)",event);
  assertSame(TEST_PAYLOAD,result);
}
