{
  try {
    if (logger.isDebugEnabled()) {
      logger.debug("Message type received is: " + source.getClass().getName());
    }
    String jmsSpec=JmsConstants.JMS_SPECIFICATION_102B;
    UMOImmutableEndpoint endpoint=this.getEndpoint();
    if (endpoint != null) {
      UMOConnector connector=endpoint.getConnector();
      if (connector instanceof JmsConnector) {
        jmsSpec=((JmsConnector)connector).getSpecification();
      }
    }
    if (source instanceof BytesMessage) {
      byte[] bytes=JmsMessageUtils.toByteArray(source,jmsSpec);
      CompressionStrategy strategy=CompressionHelper.getDefaultCompressionStrategy();
      if (strategy.isCompressed(bytes)) {
        if (logger.isDebugEnabled()) {
          logger.debug("Received Message is compressed");
        }
        return strategy.uncompressByteArray(bytes);
      }
 else {
        return JmsMessageUtils.toObject(source,jmsSpec);
      }
    }
 else {
      return JmsMessageUtils.toObject(source,jmsSpec);
    }
  }
 catch (  Exception e) {
    throw new TransformerException(this,e);
  }
}
