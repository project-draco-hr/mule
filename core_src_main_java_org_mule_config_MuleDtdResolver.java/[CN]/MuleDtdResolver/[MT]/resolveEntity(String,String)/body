{
  logger.debug("Trying to resolve XML entity with public ID: " + publicId + " and system ID: "+ systemId);
  InputSource source=null;
  currentXsl=null;
  if (delegate != null) {
    source=delegate.resolveEntity(publicId,systemId);
  }
  if ((source == null) && StringUtils.isNotBlank(systemId) && systemId.endsWith(".dtd")) {
    String[] tokens=systemId.split("/");
    String dtdFile=tokens[tokens.length - 1];
    logger.debug("Looking on classpath for " + SEARCH_PATH + dtdFile);
    InputStream is=IOUtils.getResourceAsStream(SEARCH_PATH + dtdFile,getClass(),false,false);
    if (is != null) {
      source=new InputSource(is);
      source.setPublicId(publicId);
      source.setSystemId(systemId);
      logger.debug("Found on classpath mule DTD: " + systemId);
      currentXsl=xsl;
      return source;
    }
    logger.debug("Could not find dtd resource on classpath: " + SEARCH_PATH + dtdFile);
  }
  return source;
}
