{
  final CountDownLatch countDown=new CountDownLatch(2);
  receiverIsUp=new CountDownLatch(1);
  EventCallback callback=new EventCallback(){
    public synchronized void eventReceived(    UMOEventContext context,    Object component){
      callbackCalled=true;
      assertNull(context.getCurrentTransaction());
      countDown.countDown();
    }
  }
;
  initialiseComponent(callback);
  managementContext.start();
  MessageConsumer mc;
  if (useTopics()) {
    mc=JmsTestUtils.getTopicSubscriber((TopicConnection)cnn,"replyto");
  }
 else {
    mc=JmsTestUtils.getQueueReceiver((QueueConnection)cnn,"replyto");
  }
  mc.setMessageListener(new MessageListener(){
    public void onMessage(    Message message){
      currentMsg=message;
      countDown.countDown();
    }
  }
);
  logger.debug("Waiting for coutdown isReceiverUp");
  assertTrue(receiverIsUp.await(LOCK_WAIT,TimeUnit.MILLISECONDS));
  receiverIsUp=null;
  send(DEFAULT_MESSAGE,false,Session.AUTO_ACKNOWLEDGE,"replyto");
  assertTrue(countDown.await(LOCK_WAIT,TimeUnit.MILLISECONDS));
  assertNotNull(currentMsg);
  assertTrue(currentMsg instanceof TextMessage);
  assertEquals(DEFAULT_MESSAGE + " Received",((TextMessage)currentMsg).getText());
  assertTrue(callbackCalled);
}
