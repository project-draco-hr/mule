{
  Object payload=execution.getVariable(ProcessConnector.PROCESS_VARIABLE_INCOMING);
  if (endpoint != null) {
    String messageSource=(String)execution.getVariable(ProcessConnector.PROCESS_VARIABLE_INCOMING_SOURCE);
    log.debug("Validating message source = " + messageSource + ", expected = "+ endpoint);
    if (!endpoint.equalsIgnoreCase(messageSource)) {
      throw new JbpmException("Incoming message source is " + messageSource + " but expected source is "+ endpoint);
    }
  }
  if (payloadClass != null) {
    log.debug("Validating message type = " + payload.getClass() + ", expected = "+ payloadClass);
    if (!payloadClass.isAssignableFrom(payload.getClass())) {
      throw new JbpmException("Incoming message is of type " + payload.getClass() + " but expected type is "+ payloadClass);
    }
  }
  if (variableName != null) {
    if (payload != null) {
      log.debug("Storing incoming message to variable " + variableName + ", payload = "+ payload);
      execution.setVariable(variableName,payload);
    }
 else {
      log.info("Synchronous message was sent to endpoint " + endpoint + ", but no response was returned.");
    }
  }
  super.signal(execution,signalName,parameters);
}
