{
  MuleMessage muleMessage=event.getMessage();
  String outPattern=(String)endpoint.getProperty(PROPERTY_OUTPUT_PATTERN);
  if (outPattern == null) {
    if (muleMessage.getPropertyNames(OUTBOUND).contains(PROPERTY_OUTPUT_PATTERN)) {
      outPattern=muleMessage.getProperty(PROPERTY_OUTPUT_PATTERN,OUTBOUND);
    }
 else {
      outPattern=connector.getOutputPattern();
    }
  }
  String filename=connector.getFilenameParser().getFilename(muleMessage,outPattern);
  if (filename == null) {
    filename=(String)event.getMessage().findPropertyInAnyScope(SftpConnector.PROPERTY_FILENAME,null);
  }
  return filename;
}
