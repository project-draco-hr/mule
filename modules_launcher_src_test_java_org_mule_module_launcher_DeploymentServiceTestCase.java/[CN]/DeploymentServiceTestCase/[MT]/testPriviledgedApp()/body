{
  final URL url=getClass().getResource("/priviledged-dummy-app.zip");
  assertNotNull("Test app file not found " + url,url);
  addAppArchive(url);
  deploymentService.start();
  assertTrue("Deployer never invoked",deployLatch.await(LATCH_TIMEOUT,TimeUnit.MILLISECONDS));
  assertAppsDir(NONE,new String[]{"priviledged-dummy-app"},true);
  final Application app=findApp("priviledged-dummy-app",1);
  final Object obj=app.getMuleContext().getRegistry().lookupObject(PriviledgedMuleApplication.REGISTRY_KEY_DEPLOYMENT_SERVICE);
  assertNotNull("Priviledged objects have not been registered",obj);
  assertTrue(((ApplicationWrapper)app).getDelegate() instanceof PriviledgedMuleApplication);
}
