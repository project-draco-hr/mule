{
  final URL url=getClass().getResource("/dummy-app.zip");
  assertNotNull("Test app file not found " + url,url);
  addAppArchive(url);
  deploymentService.start();
  assertTrue("Deployer never invoked",deployLatch.await(LATCH_TIMEOUT,TimeUnit.MILLISECONDS));
  assertAppsDir(NONE,new String[]{"dummy-app"},true);
  final Application app=findApp("dummy-app",1);
  final MuleRegistry registry=app.getMuleContext().getRegistry();
  final Object obj=registry.lookupObject(PriviledgedMuleApplication.REGISTRY_KEY_DEPLOYMENT_SERVICE);
  assertNull(obj);
  assertFalse(((ApplicationWrapper)app).getDelegate() instanceof PriviledgedMuleApplication);
  assertEquals("mule-app.properties should have been loaded.","someValue",registry.get("myCustomProp"));
}
