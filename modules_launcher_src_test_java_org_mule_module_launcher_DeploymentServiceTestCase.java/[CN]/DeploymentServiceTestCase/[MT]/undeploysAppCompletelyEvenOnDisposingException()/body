{
  addPackedAppFromBuilder(emptyAppFileBuilder);
  TestApplicationFactory appFactory=new TestApplicationFactory(new MuleApplicationClassLoaderFactory(new MuleDomainClassLoaderRepository(),new DefaultNativeLibraryFinderFactory()));
  appFactory.setFailOnDisposeApplication(true);
  deploymentService.setAppFactory(appFactory);
  deploymentService.start();
  assertApplicationDeploymentSuccess(applicationDeploymentListener,emptyAppFileBuilder.getId());
  Application app=findApp(emptyAppFileBuilder.getId(),1);
  assertTrue("Unable to remove anchor file",removeAppAnchorFile(emptyAppFileBuilder.getId()));
  assertUndeploymentSuccess(applicationDeploymentListener,emptyAppFileBuilder.getId());
  assertStatus(app,ApplicationStatus.STOPPED);
  assertAppFolderIsDeleted(emptyAppFileBuilder.getId());
}
