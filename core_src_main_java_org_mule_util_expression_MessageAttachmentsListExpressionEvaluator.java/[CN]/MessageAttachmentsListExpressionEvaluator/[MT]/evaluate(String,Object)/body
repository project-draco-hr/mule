{
  boolean required=false;
  if (expression.endsWith("required")) {
    required=true;
    expression=expression.substring(0,expression.length() - 8);
  }
  if (message instanceof MessageAdapter) {
    StringTokenizer tokenizer=new StringTokenizer(expression,DELIM);
    List result=new ArrayList(tokenizer.countTokens());
    while (tokenizer.hasMoreTokens()) {
      String s=tokenizer.nextToken();
      s=s.trim();
      Object val=((MessageAdapter)message).getAttachment(s);
      if (val != null) {
        result.add(val);
      }
 else       if (required) {
        throw new ExpressionRuntimeException(CoreMessages.expressionEvaluatorReturnedNull(NAME,expression));
      }
    }
    if (result.size() == 0) {
      return null;
    }
 else {
      return result;
    }
  }
  return null;
}
