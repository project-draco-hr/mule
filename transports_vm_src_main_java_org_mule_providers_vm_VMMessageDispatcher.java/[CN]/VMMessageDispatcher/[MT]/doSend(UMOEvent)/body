{
  UMOMessage retMessage;
  UMOEndpointURI endpointUri=event.getEndpoint().getEndpointURI();
  VMMessageReceiver receiver=connector.getReceiver(endpointUri);
  if (receiver == null) {
    if (connector.isQueueEvents()) {
      if (logger.isDebugEnabled()) {
        logger.debug("Writing to queue as there is no receiver on connector: " + connector.getName() + ", for endpointUri: "+ event.getEndpoint().getEndpointURI());
      }
      doDispatch(event);
      return null;
    }
 else {
      throw new NoReceiverForEndpointException(VMMessages.noReceiverForEndpoint(connector.getName(),event.getEndpoint().getEndpointURI()));
    }
  }
  if (event.isStreaming()) {
    PipedInputStream in=new PipedInputStream();
    PipedOutputStream out=new PipedOutputStream(in);
    UMOStreamMessageAdapter sma=connector.getStreamMessageAdapter(in,out);
    sma.write(event);
  }
  retMessage=(UMOMessage)receiver.onCall(event);
  if (event.isStreaming() && retMessage != null) {
    InputStream in;
    if (retMessage.getPayload() instanceof InputStream) {
      in=(InputStream)retMessage.getPayload();
    }
 else {
      in=new ByteArrayInputStream((byte[])objectToByteArray.transform(retMessage.getPayload()));
    }
    UMOStreamMessageAdapter sma=connector.getStreamMessageAdapter(in,null);
    retMessage=new MuleMessage(sma,retMessage);
  }
  if (logger.isDebugEnabled()) {
    logger.debug("sent event on endpointUri: " + event.getEndpoint().getEndpointURI());
  }
  return retMessage;
}
