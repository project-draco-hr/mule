{
  try {
    Object result=null;
    if (src instanceof String) {
      Document doc=DocumentHelper.parseText((String)src);
      XPath xpath=doc.createXPath(expression);
      if (namespaces != null) {
        xpath.setNamespaceURIs(namespaces);
      }
      if (outputType == null && singleResult) {
        return xpath.valueOf(doc);
      }
      Object obj=xpath.evaluate(doc);
      if (obj instanceof List) {
        for (int i=0; i < ((List)obj).size(); i++) {
          final Node node=(Node)((List)obj).get(i);
          result=add(result,node);
          if (singleResult) {
            break;
          }
        }
      }
 else {
        result=add(result,obj);
      }
    }
 else {
      JXPathContext context=JXPathContext.newContext(src);
      result=context.getValue(expression);
    }
    return result;
  }
 catch (  Exception e) {
    throw new TransformerException(this,e);
  }
}
