{
  if (folder == null || !folder.isOpen()) {
    String inbox=(String)endpoint.getProperty("folder");
    if (inbox == null || endpoint.getProtocol().toLowerCase().startsWith("pop3")) {
      inbox=Pop3Connector.MAILBOX;
    }
    UMOEndpointURI uri=endpoint.getEndpointURI();
    URLName url=new URLName(uri.getScheme(),uri.getHost(),uri.getPort(),inbox,uri.getUsername(),uri.getPassword());
    session=(Session)connector.getDelegateSession(endpoint,url);
    session.setDebug(logger.isDebugEnabled());
    Store store=session.getStore(url);
    store.connect(uri.getHost(),uri.getPort(),uri.getUsername(),uri.getPassword());
    folder=store.getFolder(inbox);
    if (!folder.isOpen()) {
      try {
        folder.open(Folder.READ_WRITE);
      }
 catch (      MessagingException e) {
        logger.warn("Failed to open folder: " + folder.getFullName(),e);
      }
    }
  }
}
