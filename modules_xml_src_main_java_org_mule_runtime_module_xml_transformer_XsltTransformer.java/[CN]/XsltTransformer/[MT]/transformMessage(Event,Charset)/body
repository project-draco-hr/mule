{
  InternalMessage message=event.getMessage();
  Object src=message.getPayload().getValue();
  try {
    Source sourceDoc=XMLUtils.toXmlSource(getXMLInputFactory(),isUseStaxSource(),src);
    if (sourceDoc == null) {
      return null;
    }
    ResultHolder holder=getResultHolder(getReturnDataType().getType());
    if (holder == null) {
      holder=getResultHolder(src.getClass());
    }
    if (holder == null || DelayedResult.class.equals(getReturnDataType().getType())) {
      return getDelayedResult(event,outputEncoding,sourceDoc);
    }
    doTransform(event,outputEncoding,sourceDoc,holder.getResult());
    return holder.getResultObject();
  }
 catch (  Exception e) {
    throw new TransformerException(this,e);
  }
}
