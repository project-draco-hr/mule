{
  if (manifest == null) {
    manifest=new Manifest();
    InputStream is=null;
    try {
      URL url=AccessController.doPrivileged(new PrivilegedAction<URL>(){
        public URL run(){
          try {
            Enumeration<URL> e=MuleConfiguration.class.getClassLoader().getResources("META-INF/MANIFEST.MF");
            while (e.hasMoreElements()) {
              URL url=e.nextElement();
              if ((url.toExternalForm().indexOf("mule-core") > -1 && url.toExternalForm().indexOf("tests.jar") < 0) || url.toExternalForm().matches(".*mule.*-.*-embedded.*\\.jar.*")) {
                return url;
              }
            }
            String pathSeparator=System.getProperty("file.separator");
            String testManifestPath="core" + pathSeparator + "target"+ pathSeparator+ "test-classes";
            e=MuleConfiguration.class.getClassLoader().getResources("META-INF/MANIFEST.MF");
            while (e.hasMoreElements()) {
              URL url=e.nextElement();
              if ((url.toExternalForm().indexOf(testManifestPath) > -1 && url.toExternalForm().indexOf("tests.jar") < 0) || url.toExternalForm().matches(".*mule.*-.*-embedded.*\\.jar.*")) {
                return url;
              }
            }
          }
 catch (          IOException e1) {
            logger.warn("Failure reading manifest: " + e1.getMessage(),e1);
          }
          return null;
        }
      }
);
      if (url != null) {
        is=url.openStream();
      }
      if (is != null) {
        manifest.read(is);
      }
    }
 catch (    IOException e) {
      logger.warn("Failed to read manifest Info, Manifest information will not display correctly: " + e.getMessage());
    }
  }
  return manifest;
}
