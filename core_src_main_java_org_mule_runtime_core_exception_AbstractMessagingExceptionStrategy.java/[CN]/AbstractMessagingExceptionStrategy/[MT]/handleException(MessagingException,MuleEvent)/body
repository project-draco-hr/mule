{
  try {
    muleContext.getNotificationManager().fireNotification(new ExceptionStrategyNotification(event,flowConstruct,PROCESS_START));
    fireNotification(ex);
    logException(ex,event);
    MuleEvent handledEvent=doHandleException(ex,event);
    if (!(handledEvent instanceof VoidMuleEvent)) {
      event=handledEvent;
    }
    ExceptionPayload exceptionPayload=new DefaultExceptionPayload(ex);
    if (getCurrentEvent() != null) {
      MuleEvent currentEvent=getCurrentEvent();
      currentEvent=MuleEvent.builder(currentEvent).message(MuleMessage.builder(currentEvent.getMessage()).exceptionPayload(exceptionPayload).build()).build();
      setCurrentEvent(currentEvent);
    }
    return MuleEvent.builder(event).message(MuleMessage.builder(event.getMessage()).nullPayload().exceptionPayload(exceptionPayload).build()).build();
  }
  finally {
    muleContext.getNotificationManager().fireNotification(new ExceptionStrategyNotification(event,flowConstruct,PROCESS_END));
  }
}
