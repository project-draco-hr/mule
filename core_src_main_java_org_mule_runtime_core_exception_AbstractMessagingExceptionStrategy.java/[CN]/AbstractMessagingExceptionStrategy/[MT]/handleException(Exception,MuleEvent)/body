{
  try {
    muleContext.getNotificationManager().fireNotification(new ExceptionStrategyNotification(event,ExceptionStrategyNotification.PROCESS_START));
    fireNotification(ex);
    logException(ex,event);
    doHandleException(ex,event);
    ExceptionPayload exceptionPayload=new DefaultExceptionPayload(ex);
    if (getCurrentEvent() != null) {
      MuleEvent currentEvent=getCurrentEvent();
      currentEvent.setMessage(MuleMessage.builder(currentEvent.getMessage()).exceptionPayload(exceptionPayload).build());
      setCurrentEvent(currentEvent);
    }
    event.setMessage(MuleMessage.builder(event.getMessage()).nullPayload().exceptionPayload(exceptionPayload).build());
    return event;
  }
  finally {
    muleContext.getNotificationManager().fireNotification(new ExceptionStrategyNotification(event,ExceptionStrategyNotification.PROCESS_END));
  }
}
