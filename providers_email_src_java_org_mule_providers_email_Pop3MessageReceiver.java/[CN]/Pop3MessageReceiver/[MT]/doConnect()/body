{
  String inbox=null;
  if (connector.getProtocol().equals("imap")) {
    inbox=(String)endpoint.getEndpointURI().getPath();
    if (inbox.length() == 0) {
      inbox=Pop3Connector.MAILBOX;
    }
 else {
      inbox=inbox.substring(1);
    }
  }
 else {
    inbox=Pop3Connector.MAILBOX;
  }
  URLName url=new URLName(endpoint.getEndpointURI().getScheme(),endpoint.getEndpointURI().getHost(),endpoint.getEndpointURI().getPort(),inbox,endpoint.getEndpointURI().getUsername(),endpoint.getEndpointURI().getPassword());
  session=MailUtils.createMailSession(url);
  session.setDebug(logger.isDebugEnabled());
  Store store=session.getStore(url);
  store.connect();
  folder=store.getFolder(inbox);
}
