{
  try {
    String connectionName="jdbc:derby:" + databaseName + ";create=true";
    Driver derbyDriver=(Driver)ClassUtils.instanciateClass(DERBY_DRIVER_CLASS);
    Method connectMethod=derbyDriver.getClass().getMethod("connect",String.class,Properties.class);
    connectMethod.invoke(derbyDriver,connectionName,properties);
    if (creationSql != null) {
      DataSource embeddedDS=(DataSource)ClassUtils.instanciateClass(DERBY_DATASOURCE_CLASS);
      Method m=embeddedDS.getClass().getMethod("setDatabaseName",String.class);
      m.invoke(embeddedDS,databaseName);
      Connection con=null;
      try {
        con=embeddedDS.getConnection();
        Statement st=con.createStatement();
        for (        String aCreationSql : creationSql) {
          st.execute(aCreationSql);
        }
        con.commit();
      }
  finally {
        if (con != null && !con.isClosed()) {
          con.close();
        }
      }
    }
  }
 catch (  Exception ex) {
    throw new RuntimeException("Error creating the database " + databaseName,ex);
  }
}
