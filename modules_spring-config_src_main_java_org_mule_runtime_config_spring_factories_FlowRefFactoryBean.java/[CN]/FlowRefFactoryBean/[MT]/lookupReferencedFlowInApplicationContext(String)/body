{
  final Processor referencedFlow=((Processor)applicationContext.getBean(name));
  if (referencedFlow == null) {
    throw new MuleRuntimeException(CoreMessages.objectIsNull(name));
  }
  if (referencedFlow instanceof FlowConstruct) {
    return new FlowRefMessageProcessor(){
      @Override public void addMessageProcessorPathElements(      MessageProcessorPathElement pathElement){
        NotificationUtils.addMessageProcessorPathElements(referencedFlow,pathElement);
      }
      @Override public Event process(      Event event) throws MuleException {
        return referencedFlow.process(event);
      }
      @Override public Publisher<Event> apply(      Publisher<Event> publisher){
        return from(publisher).transform(referencedFlow);
      }
    }
;
  }
 else {
    if (referencedFlow instanceof AnnotatedObject) {
      ((AnnotatedObject)referencedFlow).setAnnotations(getAnnotations());
    }
    return referencedFlow;
  }
}
