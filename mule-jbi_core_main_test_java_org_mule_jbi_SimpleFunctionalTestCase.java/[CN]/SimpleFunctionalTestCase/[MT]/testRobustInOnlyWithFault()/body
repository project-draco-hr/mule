{
  TestComponent provider=new TestComponent();
  TestComponent consumer=new TestComponent();
  container.getComponentRegistry().registerTransientEngineComponent("provider",provider);
  container.getComponentRegistry().registerTransientEngineComponent("consumer",consumer);
  ServiceEndpoint endpoint=provider.getContext().activateEndpoint(SERVICE_NAME,ENDPOINT_NAME);
  MessageExchangeFactory mef=consumer.getChannel().createExchangeFactory(endpoint);
  RobustInOnly mec=mef.createRobustInOnlyExchange();
  NormalizedMessage m=mec.createMessage();
  m.setContent(new StreamSource(new ByteArrayInputStream(PAYLOAD.getBytes())));
  mec.setInMessage(m);
  consumer.getChannel().send(mec);
  RobustInOnly mep=(RobustInOnly)provider.getChannel().accept(10L);
  assertNotNull(mep);
  assertEquals(ExchangeStatus.ACTIVE,mep.getStatus());
  mep.setStatus(ExchangeStatus.ERROR);
  provider.getChannel().send(mep);
  assertSame(mec,consumer.getChannel().accept(10L));
  assertEquals(ExchangeStatus.ERROR,mec.getStatus());
  mec.setStatus(ExchangeStatus.DONE);
  provider.getChannel().send(mec);
  assertSame(mep,provider.getChannel().accept(10L));
  assertEquals(ExchangeStatus.DONE,mep.getStatus());
  assertNull(consumer.getChannel().accept(10L));
  assertNull(provider.getChannel().accept(10L));
}
