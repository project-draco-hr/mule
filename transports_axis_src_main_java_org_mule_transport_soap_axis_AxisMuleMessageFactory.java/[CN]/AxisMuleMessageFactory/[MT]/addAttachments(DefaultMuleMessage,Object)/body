{
  MessageContext ctx=MessageContext.getCurrentContext();
  if (ctx == null) {
    return;
  }
  try {
    SOAPMessage soapMessage=ctx.getMessage();
    int x=1;
    for (Iterator<?> i=soapMessage.getAttachments(); i.hasNext(); x++) {
      String name=String.valueOf(x);
      AttachmentPart attachmentPart=(AttachmentPart)i.next();
      message.addAttachment(name,attachmentPart.getActivationDataHandler());
    }
  }
 catch (  Exception e) {
    log.fatal("Failed to read attachments",e);
  }
}
