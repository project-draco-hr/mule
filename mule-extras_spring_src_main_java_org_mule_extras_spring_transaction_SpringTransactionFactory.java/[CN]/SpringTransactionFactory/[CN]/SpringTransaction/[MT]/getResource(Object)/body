{
  Object res=TransactionSynchronizationManager.getResource(key);
  if (res != null) {
    if (res instanceof org.springframework.jdbc.datasource.ConnectionHolder) {
      return ((org.springframework.jdbc.datasource.ConnectionHolder)res).getConnection();
    }
    if (res instanceof org.springframework.jms.connection.ConnectionHolder) {
      return ((org.springframework.jms.connection.ConnectionHolder)res).getConnection();
    }
  }
  return res;
}
