{
  String body;
  StringBuilder result=new StringBuilder();
  for (  Map.Entry<?,?> entry : (Set<Map.Entry<?,?>>)((parameters).entrySet())) {
    String paramName=entry.getKey().toString();
    Object paramValue=entry.getValue();
    Iterable paramValues=paramValue instanceof Iterable ? (Iterable)paramValue : Arrays.asList(paramValue);
    for (    Object value : paramValues) {
      try {
        paramName=URLEncoder.encode(paramName,encoding);
        paramValue=value != null ? URLEncoder.encode(value.toString(),encoding) : null;
      }
 catch (      UnsupportedEncodingException e) {
        throw new MuleRuntimeException(e);
      }
      if (result.length() > 0) {
        result.append("&");
      }
      result.append(paramName);
      if (paramValue != null) {
        result.append("=");
        result.append(paramValue);
      }
    }
  }
  body=result.toString();
  return body;
}
