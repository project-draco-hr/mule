{
  MuleMessage message=new DefaultMuleMessage("data",muleContext);
  MuleEvent event=new DefaultMuleEvent(message,getTestInboundEndpoint(""),getTestService());
  Object nonSerializable=new Object();
  message.setProperty("key","value",PropertyScope.SESSION);
  message.setProperty("keyNonSerializable",nonSerializable,PropertyScope.SESSION);
  Flow flowA=(Flow)muleContext.getRegistry().lookupFlowConstruct("OneWaySessionPropertySettingChain");
  flowA.process(event);
  MuleMessage out=muleContext.getClient().request("vm://H-out?connector=VMConnector",RECEIVE_TIMEOUT);
  assertNotNull(out);
  assertEquals("value",out.getProperty("key",PropertyScope.SESSION));
  assertEquals("value1",out.getProperty("key1",PropertyScope.SESSION));
  assertEquals("value2",out.getProperty("key2",PropertyScope.SESSION));
  assertNull(out.getProperty("keyNonSerializable",PropertyScope.SESSION));
}
