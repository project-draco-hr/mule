{
  MuleMessage message=new DefaultMuleMessage("data",muleContext);
  MuleEvent event=new DefaultMuleEvent(message,getTestInboundEndpoint(""),getTestFlow());
  Object nonSerializable=new Object();
  message.setProperty("keyNonSerializable",nonSerializable,PropertyScope.SESSION);
  message.setProperty("keyNonSerializable2",nonSerializable,PropertyScope.SESSION);
  message.setProperty("key","value",PropertyScope.SESSION);
  message.setProperty("key2","value2",PropertyScope.SESSION);
  MessageDispatcher dispatcher=new VMMessageDispatcher(muleContext.getEndpointFactory().getOutboundEndpoint("addSessionPropertiesFlowEndpoint"));
  MuleEvent result=dispatcher.process(event);
  assertNotNull(result);
  assertNotSame(event,result);
  assertEquals("val",result.getSession().getProperty("keyNonSerializable"));
  assertEquals(nonSerializable,result.getSession().getProperty("keyNonSerializable2"));
  assertEquals("value2NEW",result.getSession().getProperty("key2"));
  assertEquals("value3",result.getSession().getProperty("key3"));
  assertNull(result.getMessage().getProperty("nonSerializableBean"));
}
