{
  MuleExpressionEvaluator eval=new MuleExpressionEvaluator();
  eval.setMuleContext(muleContext);
  Object result=eval.evaluate("message.attachments-list(foo, baz)",createMessageWithAttachments());
  assertNotNull(result);
  assertTrue(result instanceof List);
  assertEquals(2,((List)result).size());
  assertTrue(((List)result).get(0) instanceof DataHandler);
  DataHandler dh=(DataHandler)((List)result).get(0);
  ByteArrayOutputStream baos=new ByteArrayOutputStream(4);
  dh.writeTo(baos);
  assertEquals("moo",baos.toString());
  assertTrue(((List)result).get(1) instanceof DataHandler);
  dh=(DataHandler)((List)result).get(1);
  baos=new ByteArrayOutputStream(4);
  dh.writeTo(baos);
  assertEquals("maz",baos.toString());
  result=eval.evaluate("message.attachments-list(fool?)",createMessageWithAttachments());
  assertNotNull(result);
  assertTrue(result instanceof List);
  assertEquals(0,((List)result).size());
  result=eval.evaluate("message.attachments-list(foo?, baz)",createMessageWithAttachments());
  assertNotNull(result);
  assertTrue(result instanceof List);
  assertEquals(2,((List)result).size());
  assertTrue(((List)result).get(0) instanceof DataHandler);
  dh=(DataHandler)((List)result).get(0);
  baos=new ByteArrayOutputStream(4);
  dh.writeTo(baos);
  assertEquals("moo",baos.toString());
  assertTrue(((List)result).get(1) instanceof DataHandler);
  dh=(DataHandler)((List)result).get(1);
  baos=new ByteArrayOutputStream(4);
  dh.writeTo(baos);
  assertEquals("maz",baos.toString());
  result=eval.evaluate("message.attachments-list(fool?)",createMessageWithAttachments());
  assertEquals(0,((List)result).size());
  try {
    eval.evaluate("message.attachments-list(fool)",createMessageWithAttachments());
    fail("Attachment 'fool' is not on the message and not defined as optional");
  }
 catch (  Exception e) {
  }
}
