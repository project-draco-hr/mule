{
  String correlationId=(String)propertyExtractor.getPropertry(MuleProperties.MULE_CORRELATION_ID_PROPERTY,message);
  initialise(message);
  UMOEndpoint endpoint;
  UMOMessage result=null;
  List list=getEndpoints();
  int i=1;
  for (Iterator iterator=list.iterator(); iterator.hasNext(); ) {
    endpoint=(UMOEndpoint)iterator.next();
    message=getMessagePart(message,endpoint);
    if (message == null) {
      logger.warn("Message part is null for endpoint: " + endpoint.getEndpointURI().toString());
    }
    while (message != null) {
      try {
        if (enableCorrelation != ENABLE_CORREATION_NEVER) {
          boolean correlationSet=message.getCorrelationId() != null;
          if (correlationSet && (enableCorrelation == ENABLE_CORREATION_IF_NOT_SET)) {
            logger.debug("CorrelationId is already set, not setting Correlation group size");
          }
 else {
            message.setCorrelationId(correlationId);
            message.setCorrelationGroupSize(list.size());
            message.setCorrelationSequence(i++);
          }
        }
        if (synchronous) {
          result=send(session,message,endpoint);
        }
 else {
          dispatch(session,message,endpoint);
        }
      }
 catch (      UMOException e) {
        throw new CouldNotRouteOutboundMessageException(e.getMessage(),e,message);
      }
      if (!multimatch)       break;
      message=getMessagePart(message,endpoint);
    }
  }
  return result;
}
