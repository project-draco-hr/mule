{
  SftpServer server=new SftpServer(sftpPort.getNumber());
  Latch latch=new Latch();
  try {
    server.setPasswordAuthenticator(new BlockingPasswordAuthenticator(latch));
    server.start();
    MuleClient client=muleContext.getClient();
    MuleMessage result=client.send(url,TEST_MESSAGE,null);
    assertThat(result.getExceptionPayload(),not(nullValue()));
    assertThat((NullPayload)result.getPayload(),is(NullPayload.getInstance()));
  }
  finally {
    latch.release();
    server.stop();
  }
}
