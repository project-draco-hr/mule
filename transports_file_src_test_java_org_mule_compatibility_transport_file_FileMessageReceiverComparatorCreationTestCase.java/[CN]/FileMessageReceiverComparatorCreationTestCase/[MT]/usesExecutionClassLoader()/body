{
  ClassLoader classLoader=spy(new URLClassLoader(new URL[0],muleContext.getExecutionClassLoader()));
  muleContext.setExecutionClassLoader(classLoader);
  InboundEndpoint endpoint=createEndpoint();
  FileMessageReceiver receiver=new FileMessageReceiver(endpoint.getConnector(),mock(Flow.class),endpoint,readFolder.getRoot().getAbsolutePath(),null,null,RECEIVE_TIMEOUT);
  receiver.connect();
  receiver.poll();
  verify(classLoader,timeout(RECEIVE_TIMEOUT)).loadClass(TestFileComparator.class.getName());
}
