{
  if (!initialised.get()) {
    initialising.set(true);
    startDate=System.currentTimeMillis();
    if (workManager == null) {
      ThreadingProfile tp=config.getDefaultThreadingProfile();
      logger.debug("Creating default work manager using default threading profile: " + tp);
      workManager=new MuleWorkManager(tp,"UMOManager");
      workManager.start();
    }
    eventManager=new ServerEventManager(workManager);
    eventManager.registerEventType(ManagerEvent.class,ManagerEventListener.class);
    eventManager.registerEventType(ModelEvent.class,ModelEventListener.class);
    eventManager.registerEventType(ComponentEvent.class,ComponentEventListener.class);
    eventManager.registerEventType(SecurityEvent.class,SecurityEventListener.class);
    eventManager.registerEventType(ManagementEvent.class,ManagementEventListener.class);
    eventManager.registerEventType(AdminEvent.class,AdminEventListener.class);
    eventManager.registerEventType(CustomEvent.class,CustomEventListener.class);
    eventManager.registerEventType(ConnectionEvent.class,ConnectionEventListener.class);
    fireSystemEvent(new ManagerEvent(this,ManagerEvent.MANAGER_INITIALISNG));
    if (id == null) {
      logger.warn("No unique id has been set on this manager");
    }
    try {
      if (securityManager != null) {
        securityManager.initialise();
      }
      if (queueManager == null) {
        try {
          TransactionalQueueManager queueMgr=new TransactionalQueueManager();
          QueuePersistenceStrategy ps=new CachingPersistenceStrategy(getConfiguration().getPersistenceStrategy());
          queueMgr.setPersistenceStrategy(ps);
          queueManager=queueMgr;
        }
 catch (        Exception e) {
          throw new InitialisationException(new Message(Messages.INITIALISATION_FAILURE_X,"QueueManager"),e);
        }
      }
      initialiseConnectors();
      initialiseEndpoints();
      initialiseAgents();
      if (model != null)       model.initialise();
    }
  finally {
      initialised.set(true);
      initialising.set(false);
      fireSystemEvent(new ManagerEvent(this,ManagerEvent.MANAGER_INITIALISED));
    }
  }
}
