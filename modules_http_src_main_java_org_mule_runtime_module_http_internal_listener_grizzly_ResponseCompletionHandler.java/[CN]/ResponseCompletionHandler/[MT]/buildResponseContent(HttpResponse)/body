{
  final HttpEntity body=httpResponse.getEntity();
  Buffer grizzlyBuffer=null;
  if (body != null && !(body instanceof EmptyHttpEntity)) {
    if (body instanceof ByteArrayHttpEntity) {
      grizzlyBuffer=Buffers.wrap(ctx.getMemoryManager(),((ByteArrayHttpEntity)body).getContent());
    }
 else {
      throw new MuleRuntimeException(CoreMessages.createStaticMessage("At this point only a ByteArray entity is allowed"));
    }
  }
  HttpContent.Builder contentBuilder=HttpContent.builder(httpResponsePacket);
  if (httpResponse.getHeaderValueIgnoreCase(CONTENT_LENGTH) != null) {
    contentBuilder.last(true);
  }
  return contentBuilder.content(grizzlyBuffer).build();
}
