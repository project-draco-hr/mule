{
  final Connection connection=ctx.getConnection();
  final HttpRequestPacket requestPacket=HttpRequestPacket.builder().protocol(Protocol.HTTP_1_0).method(Method.CONNECT).uri(AsyncHttpProviderUtils.getAuthority(uri)).build();
  httpCtx.establishingTunnel=true;
  ctx.notifyDownstream(new SSLSwitchingEvent(false,connection));
  final Request request=httpCtx.getAhcRequest();
  addHostHeaderIfNeeded(request,uri,requestPacket);
  addServiceHeaders(requestPacket);
  addAuthorizationHeader(connection,getRealm(request),requestPacket);
  addProxyHeaders(proxy,requestPacket);
  return sendRequest(httpCtx,ctx,requestPacket,null);
}
