{
  return new AbstractRequestResponseMessageProcessor(){
    @Override protected MuleEvent processRequest(    MuleEvent event) throws MuleException {
      MuleMessage message=event.getMessage();
      final MuleEvent.Builder builder=MuleEvent.builder(event);
      if (requestBody != null) {
        message=MuleMessage.builder(event.getMessage()).payload(requestBody).build();
        builder.message(message);
      }
      copyAttachmentsRequest(builder,message);
      return super.processRequest(builder.build());
    }
    @Override protected MuleEvent processNext(    MuleEvent event) throws MuleException {
      try {
        return super.processNext(event);
      }
 catch (      MessagingException e) {
        if (e.getCause() instanceof DispatchException && e.getCause().getCause() instanceof SoapFault) {
          SoapFault soapFault=(SoapFault)e.getCause().getCause();
          event=MuleEvent.builder(e.getEvent()).message(MuleMessage.builder(e.getEvent().getMessage()).payload(soapFault.getDetail() != null ? soapFault.getDetail() : null).build()).build();
          throw new SoapFaultException(event,soapFault,this);
        }
 else {
          throw e;
        }
      }
    }
    @Override protected MuleEvent processResponse(    MuleEvent response,    final MuleEvent request) throws MuleException {
      return super.processResponse(copyAttachmentsResponse(response),request);
    }
  }
;
}
