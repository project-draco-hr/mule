{
  return new AbstractRequestResponseMessageProcessor(){
    @Override protected Event processRequest(    Event event) throws MuleException {
      InternalMessage message=event.getMessage();
      final Event.Builder builder=Event.builder(event);
      if (requestBody != null) {
        message=InternalMessage.builder(event.getMessage()).payload(requestBody).build();
        builder.message(message);
      }
      copyAttachmentsRequest(builder,message);
      return super.processRequest(builder.build());
    }
    @Override protected Event processNext(    Event event) throws MuleException {
      try {
        return super.processNext(event);
      }
 catch (      MessagingException e) {
        if (e.getCause() instanceof DispatchException && e.getCause().getCause() instanceof SoapFault) {
          SoapFault soapFault=(SoapFault)e.getCause().getCause();
          org.mule.runtime.api.message.Message errorMessage=e.getEvent().getMessage();
          if (e.getEvent().getError().isPresent() && e.getEvent().getError().get().getErrorMessage() != null) {
            errorMessage=e.getEvent().getError().get().getErrorMessage();
          }
          SoapFaultException soapFaultException=new SoapFaultException(soapFault);
          throw new WrapperErrorMessageAwareException(InternalMessage.builder(errorMessage).payload(soapFault.getDetail() != null ? soapFault.getDetail() : null).build(),soapFaultException);
        }
 else {
          throw e;
        }
      }
    }
    @Override protected Event processResponse(    Event response,    final Event request) throws MuleException {
      return super.processResponse(copyAttachmentsResponse(response),request);
    }
  }
;
}
