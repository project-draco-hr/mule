{
  DomainClassLoaderRepository domainClassLoaderRepository=new MuleDomainClassLoaderRepository();
  ApplicationClassLoaderFactory applicationClassLoaderFactory=new MuleApplicationClassLoaderFactory(domainClassLoaderRepository);
  applicationClassLoaderFactory=new CompositeApplicationClassLoaderFactory(applicationClassLoaderFactory,pluginClassLoaderManager);
  DefaultDomainFactory domainFactory=new DefaultDomainFactory(domainClassLoaderRepository);
  domainFactory.setDeploymentListener(domainDeploymentListener);
  DefaultApplicationFactory applicationFactory=new DefaultApplicationFactory(applicationClassLoaderFactory,domainFactory);
  applicationFactory.setDeploymentListener(applicationDeploymentListener);
  ArtifactDeployer<Application> applicationMuleDeployer=new DefaultArtifactDeployer<Application>();
  ArtifactDeployer<Domain> domainMuleDeployer=new DefaultArtifactDeployer<Domain>();
  this.applicationDeployer=new DefaultArchiveDeployer(applicationMuleDeployer,applicationFactory,applications,deploymentLock);
  this.applicationDeployer.setDeploymentListener(applicationDeploymentListener);
  this.domainDeployer=new DomainBundleArchiveDeployer(new DefaultArchiveDeployer(domainMuleDeployer,domainFactory,domains,deploymentLock));
  this.domainDeployer.setDeploymentListener(domainDeploymentListener);
  this.deploymentDirectoryWatcher=new DeploymentDirectoryWatcher(domainDeployer,applicationDeployer,domains,applications,deploymentLock);
}
