{
  final AtomicInteger c=new AtomicInteger(0);
  final UMOMessage m1=(UMOMessage)new Mock(UMOMessage.class).proxy();
  final UMOMessage m2=(UMOMessage)new Mock(UMOMessage.class).proxy();
  final UMOMessage m3=(UMOMessage)new Mock(UMOMessage.class).proxy();
  final UMOMessage m4=(UMOMessage)new Mock(UMOMessage.class).proxy();
  final UMOMessage m5=(UMOMessage)new Mock(UMOMessage.class).proxy();
  final UMODescriptor d=(UMODescriptor)new Mock(UMODescriptor.class).proxy();
  InterceptorStack s=new InterceptorStack();
  List interceptors=new ArrayList();
  interceptors.add(new UMOInterceptor(){
    public UMOMessage intercept(    Invocation invocation) throws UMOException {
      assertEquals(0,c.get());
      c.incrementAndGet();
      assertTrue(m1 == invocation.getMessage());
      invocation.setMessage(m2);
      UMOMessage msg=invocation.execute();
      assertEquals(3,c.get());
      c.incrementAndGet();
      assertTrue(m4 == msg);
      assertTrue(d == invocation.getDescriptor());
      return m5;
    }
  }
);
  interceptors.add(new UMOInterceptor(){
    public UMOMessage intercept(    Invocation invocation) throws UMOException {
      assertEquals(1,c.get());
      c.incrementAndGet();
      assertTrue(m2 == invocation.getMessage());
      invocation.setMessage(m3);
      UMOMessage msg=invocation.execute();
      assertEquals(2,c.get());
      c.incrementAndGet();
      assertTrue(m3 == msg);
      assertTrue(d == invocation.getDescriptor());
      return m4;
    }
  }
);
  s.setInterceptors(interceptors);
  UMOMessage r=s.intercept(new DummyInvocation(d,m1));
  assertTrue(r == m5);
  assertEquals(4,c.get());
}
