{
  TestConnector connector=lookupDummyConnector();
  InboundEndpoint endpoint=MuleEndpointTestUtils.getTestInboundEndpoint("foo",muleContext);
  endpoint.getTransactionConfig().setAction(MuleTransactionConfig.ACTION_ALWAYS_BEGIN);
  endpoint.getTransactionConfig().setFactory(new XaTransactionFactory());
  TransportServiceDescriptor serviceDescriptor=connector.getServiceDescriptor();
  MessageReceiver receiver=serviceDescriptor.createMessageReceiver(connector,getTestFlow(muleContext),endpoint);
  assertEquals(TestMessageReceiver.class,receiver.getClass());
}
