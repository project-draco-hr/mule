{
  if (subject == null) {
    if (info == null) {
      return null;
    }
 else {
      MuleConnectionRequestInfo muleInfo=(MuleConnectionRequestInfo)info;
      if (muleInfo.getUsername() == null || muleInfo.getPassword() == null) {
        return null;
      }
      char[] password=muleInfo.getPassword().toCharArray();
      PasswordCredential pc=new PasswordCredential(muleInfo.getUsername(),password);
      pc.setManagedConnectionFactory(mcf);
      return pc;
    }
  }
 else {
    PasswordCredential pc=(PasswordCredential)AccessController.doPrivileged(new PrivilegedAction(){
      public Object run(){
        Set creds=subject.getPrivateCredentials(PasswordCredential.class);
        Iterator iter=creds.iterator();
        while (iter.hasNext()) {
          PasswordCredential temp=(PasswordCredential)iter.next();
          if (temp != null && temp.getManagedConnectionFactory() != null && temp.getManagedConnectionFactory().equals(mcf)) {
            return temp;
          }
        }
        return null;
      }
    }
);
    if (pc == null) {
      throw new java.lang.SecurityException(new Message(Messages.AUTH_NO_CREDENTIALS).getMessage());
    }
 else {
      return pc;
    }
  }
}
