{
  String decl=getXmlDeclaration(encoding);
  logger.debug("Using Xml declaration: " + decl);
  if (doctype == null) {
    doctype=getDefaultDocType();
  }
  if (doctype != null) {
    if (!doctype.startsWith("<!DOCTYPE")) {
      doctype="<!DOCTYPE " + doctype + ">";
    }
    logger.info("Using doctype: " + doctype);
  }
 else {
    doctype="";
  }
  StringReader declaration=new StringReader(decl + Utility.CRLF + doctype);
  ChainedReader reader=new ChainedReader(declaration,configuration);
  configure(reader);
}
