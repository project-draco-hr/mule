{
  if (getXslResource() != null) {
    Transformer transformer=createTransformer(createXslSource());
    DOMResult result=new DOMResult();
    transformer.setParameter("firstContext",new Boolean(isFirstContext()));
    transformer.transform(new DOMSource(document),result);
    if (logger.isDebugEnabled()) {
      try {
        String xml=new DOMReader().read((Document)result.getNode()).asXML();
        logger.debug("Transformed document is:\n" + xml);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
    return (Document)result.getNode();
  }
 else {
    return document;
  }
}
