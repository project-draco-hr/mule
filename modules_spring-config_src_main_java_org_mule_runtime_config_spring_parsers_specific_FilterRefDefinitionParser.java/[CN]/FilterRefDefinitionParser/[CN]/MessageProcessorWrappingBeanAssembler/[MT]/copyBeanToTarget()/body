{
  if (target == null) {
    return;
  }
  String oldName="messageProcessor";
  String newName=bestGuessName(targetConfig,oldName,target.getBeanClassName());
  MutablePropertyValues targetProperties=target.getPropertyValues();
  MutablePropertyValues beanProperties=bean.getBeanDefinition().getPropertyValues();
  Object value=beanProperties.getPropertyValue(newName).getValue();
  RuntimeBeanReference ref=(RuntimeBeanReference)((ManagedList<?>)value).get(0);
  BeanDefinitionBuilder messageFilter=BeanDefinitionBuilder.genericBeanDefinition(MessageFilter.class);
  messageFilter.addPropertyValue(FILTER,ref);
  PropertyValue pv=targetProperties.getPropertyValue(newName);
  Object oldValue=null == pv ? null : pv.getValue();
  if (oldValue == null) {
    oldValue=new ManagedList<Object>();
    pv=new PropertyValue(newName,oldValue);
    targetProperties.addPropertyValue(pv);
  }
  if (targetConfig.isCollection(oldName)) {
    List list=retrieveList(oldValue);
    list.add(messageFilter.getBeanDefinition());
  }
 else {
    targetProperties.addPropertyValue(newName,messageFilter.getBeanDefinition());
  }
}
