{
  HttpServlet servlet;
  if (getReceiverServlet() == null) {
    if (isUseContinuations()) {
      servlet=new JettyContinuationsReceiverServlet();
    }
 else {
      servlet=new JettyReceiverServlet();
    }
  }
 else {
    servlet=getReceiverServlet();
  }
  String path=endpoint.getEndpointURI().getPath();
  if (StringUtils.isBlank(path)) {
    path=ROOT;
  }
  ContextHandlerCollection handlerCollection=new ContextHandlerCollection();
  if (resourceBase != null) {
    ResourceHandler resourceHandler=new ResourceHandler();
    ContextHandler resourceContextHandler=new ContextHandler(handlerCollection,path);
    resourceHandler.setResourceBase(resourceBase);
    resourceContextHandler.setHandler(resourceHandler);
  }
  ServletContextHandler servletContext=new ServletContextHandler(handlerCollection,ROOT,ServletContextHandler.NO_SECURITY);
  servletContext.addEventListener(new MuleServletContextListener(muleContext,getName()));
  ServletHolder holder=new ServletHolder();
  holder.setServlet(servlet);
  servletContext.addServlet(holder,"/*");
  servletContext.addServlet(JarResourceServlet.class,JarResourceServlet.DEFAULT_PATH_SPEC);
  handlerCollection.addHandler(servletContext);
  addHandler(handlerCollection);
  return servlet;
}
