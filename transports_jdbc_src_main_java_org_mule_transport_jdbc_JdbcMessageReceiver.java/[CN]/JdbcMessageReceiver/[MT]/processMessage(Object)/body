{
  Transaction tx=TransactionCoordination.getInstance().getTransaction();
  try {
    MessageAdapter msgAdapter=this.connector.getMessageAdapter(message);
    MuleMessage umoMessage=new DefaultMuleMessage(msgAdapter);
    if (this.ackStmt != null) {
      Object[] ackParams=connector.getParams(endpoint,this.ackParams,umoMessage,this.endpoint.getEndpointURI().getAddress());
      if (logger.isDebugEnabled()) {
        logger.debug("SQL UPDATE: " + ackStmt + ", params = "+ ArrayUtils.toString(ackParams));
      }
      int nbRows=connector.getQueryRunner().update(jdbcConnection,this.ackStmt,ackParams);
      if (nbRows != 1) {
        logger.warn("Row count for ack should be 1 and not " + nbRows);
      }
    }
    routeMessage(umoMessage,tx,tx != null || endpoint.isSynchronous());
  }
 catch (  Exception ex) {
    if (tx == null) {
      jdbcConnection.rollback();
    }
 else {
      tx.setRollbackOnly();
    }
    throw ex;
  }
 finally {
    if (endpoint.getMuleContext().getTransactionManager() != null || tx == null) {
    }
  }
}
