{
  fixProviderUrl(props);
  String cnnFactoryName=props.getProperty(JNDI_TOPIC_CONECTION_NAME_PROPERTY);
  if (cnnFactoryName == null) {
    throw new IOException("You must set the property " + DEFAULT_JNDI_CONECTION_NAME_PROPERTY + "in the JNDI property file");
  }
  Context ctx=new InitialContext(props);
  TopicConnectionFactory tcf=(TopicConnectionFactory)ctx.lookup(cnnFactoryName);
  TopicConnection cnn;
  String username=(String)props.get("username");
  if (username != null) {
    String password=(String)props.get("password");
    cnn=tcf.createTopicConnection(username,password);
  }
 else {
    cnn=tcf.createTopicConnection();
  }
  cnn.start();
  return cnn;
}
