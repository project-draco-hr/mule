{
  startWsProxy();
  testConnector.setRequesterFactory(new AbstractMessageRequesterFactory(){
    @Override public MessageRequester create(    InboundEndpoint endpoint) throws MuleException {
      return new AbstractMessageRequester(endpoint){
        @Override protected MuleMessage doRequest(        long timeout) throws Exception {
          assertEquals("test://test?wsdl",endpoint.getEndpointURI().toString());
          return new DefaultMuleMessage("fake_wsdl localhost",muleContext);
        }
      }
;
    }
  }
);
  final MuleEvent event=MuleTestUtils.getTestEvent("hello",muleContext);
  event.getMessage().setProperty("http.request","test://foo?wsdl",PropertyScope.INBOUND);
  final MuleEvent response=directInboundMessageSource.process(event);
  assertEquals("fake_wsdl " + NetworkUtils.getLocalHost().getHostName(),response.getMessageAsString());
}
