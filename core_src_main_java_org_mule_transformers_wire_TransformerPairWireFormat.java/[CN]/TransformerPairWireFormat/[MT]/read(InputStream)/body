{
  if (inboundTransformer == null) {
    throw new NullPointerException(new Message(Messages.X_IS_NULL,"inboundTransformer").getMessage());
  }
  if (inboundTransformer.isSourceTypeSupported(InputStream.class)) {
    return inboundTransformer.transform(in);
  }
 else {
    try {
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      IOUtils.copy(in,baos);
      return inboundTransformer.transform(baos.toByteArray());
    }
 catch (    IOException e) {
      throw new MuleException(new Message(Messages.FAILED_TO_READ_PAYLOAD),e);
    }
  }
}
