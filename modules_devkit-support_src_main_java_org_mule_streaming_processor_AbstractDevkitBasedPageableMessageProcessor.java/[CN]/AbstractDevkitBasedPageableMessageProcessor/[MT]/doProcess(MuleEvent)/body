{
  PagingDelegate<?> delegate=this.getPagingDelegate(event,this.makeConfiguration());
  if (delegate == null) {
    throw new DefaultMuleException("Obtained paging delegate cannot be null");
  }
  Producer<?> producer=new PagingDelegateProducer(delegate);
  Consumer<?> consumer=null;
  if (this.outputUnit == StreamingOutputUnit.ELEMENT) {
    consumer=new ElementBasedPagingConsumer(producer);
  }
 else   if (this.outputUnit == StreamingOutputUnit.PAGE) {
    consumer=new PagedBasedPagingConsumer(producer);
  }
 else {
    throw new DefaultMuleException("Unsupported outputStrategy " + this.outputUnit);
  }
  event.getMessage().setPayload(new ConsumerIterator(consumer));
  return event;
}
