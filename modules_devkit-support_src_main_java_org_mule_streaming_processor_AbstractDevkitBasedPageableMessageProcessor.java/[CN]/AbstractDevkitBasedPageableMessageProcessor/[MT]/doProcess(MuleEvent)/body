{
  PagingDelegate<?> delegate=this.getPagingDelegate(event,new PagingConfiguration(this.fetchSize,this.firstPage,this.lastPage,this.outputUnit));
  if (delegate == null) {
    event.getMessage().setPayload(new ArrayList<Object>().iterator());
    return event;
  }
  Producer<?> producer=new PagingDelegateProducer(delegate);
  Consumer<?> consumer=null;
  if (this.outputUnit == StreamingOutputUnit.ELEMENT) {
    consumer=new ElementBasedPagingConsumer(producer);
  }
 else   if (this.outputUnit == StreamingOutputUnit.PAGE) {
    consumer=new PagedBasedPagingConsumer(producer);
  }
 else {
    throw new DefaultMuleException("Unsupported outputStrategy " + this.outputUnit);
  }
  event.getMessage().setPayload(new ConsumerIterator(consumer));
  return event;
}
