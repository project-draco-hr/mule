{
  System.out.println("Base Dir is: " + getBasedir());
  MavenEmbedder maven=new MavenEmbedder();
  ClassLoader classLoader=Thread.currentThread().getContextClassLoader();
  maven.setClassLoader(classLoader);
  maven.setLogger(new MavenEmbedderConsoleLogger());
  maven.setOffline(true);
  maven.setLocalRepositoryDirectory(getTestFile("target/local-repo"));
  maven.start();
  File itbasedir=new File(getBasedir(),"tools/mule-transport-archetype");
  MavenProject pom=maven.readProjectWithDependencies(new File(itbasedir,"pom.xml"));
  EventMonitor eventMonitor=new DefaultEventMonitor(new PlexusLoggerAdapter(new MavenEmbedderConsoleLogger()));
  System.setProperty("transportId","xxx");
  System.setProperty("muleVersion",pom.getVersion());
  System.setProperty("interactive","false");
  System.setProperty("basedir","./target");
  maven.execute(pom,Collections.singletonList("org.mule.tools:mule-transport-archetype:" + pom.getVersion() + ":create"),eventMonitor,new ConsoleDownloadMonitor(),null,itbasedir);
  maven.stop();
}
