{
  CopyOnWriteArrayList payload=(CopyOnWriteArrayList)payloads.get();
  for (int i=0; i < payload.size(); i++) {
    Object object=payload.get(i);
    UMOMessage result=new MuleMessage(object,(Map)properties.get());
    if (endpoint.getFilter() == null || endpoint.getFilter().accept(result)) {
      if (logger.isDebugEnabled()) {
        logger.debug("Endpoint filter matched. Routing message over: " + endpoint.getEndpointURI().toString());
      }
      payload.remove(i);
      return result;
    }
  }
  return null;
}
