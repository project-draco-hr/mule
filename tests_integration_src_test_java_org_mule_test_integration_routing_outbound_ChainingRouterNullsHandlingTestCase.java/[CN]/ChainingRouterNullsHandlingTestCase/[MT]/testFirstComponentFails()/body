{
  MuleClient muleClient=new MuleClient();
  MuleMessage message=new DefaultMuleMessage("thePayload",(Map)null,muleContext);
  MuleMessage result=muleClient.send("vm://incomingFirstFail",message);
  assertNotNull("Should be a NullPayload instead.",result);
  assertEquals("Should be a NullPayload instead.",NullPayload.getInstance(),result.getPayload());
  assertNotNull("Should've contained an exception payload",result.getExceptionPayload());
  Throwable exception=result.getExceptionPayload().getException();
  assertNotNull("Exception required",exception);
  assertTrue("Wrong exception",exception instanceof ServiceException);
  String compName=((ServiceException)exception).getService().getName();
  assertEquals("Exception raised in wrong service","component1Fail",compName);
}
