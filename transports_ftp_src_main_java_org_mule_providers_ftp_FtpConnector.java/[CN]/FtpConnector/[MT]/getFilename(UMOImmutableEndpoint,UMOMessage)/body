{
  String filename=(String)message.getProperty(FtpConnector.PROPERTY_FILENAME);
  if (filename == null) {
    String outPattern=(String)endpoint.getProperty(FtpConnector.PROPERTY_OUTPUT_PATTERN);
    if (outPattern == null) {
      outPattern=message.getStringProperty(FtpConnector.PROPERTY_OUTPUT_PATTERN,getOutputPattern());
    }
    filename=generateFilename(message,outPattern);
  }
  if (filename == null) {
    throw new IOException("Filename is null");
  }
  return filename;
}
