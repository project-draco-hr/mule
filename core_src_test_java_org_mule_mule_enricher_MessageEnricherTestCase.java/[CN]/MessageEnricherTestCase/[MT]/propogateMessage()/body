{
  MessageEnricher enricher=new MessageEnricher();
  enricher.setMuleContext(muleContext);
  enricher.addEnrichExpressionPair(new EnrichExpressionPair("#[header:myHeader]"));
  enricher.setEnrichmentMessageProcessor(new MessageProcessor(){
    public MuleEvent process(    MuleEvent event) throws MuleException {
      event.getMessage().setPayload("enriched");
      return event;
    }
  }
);
  MuleEvent in=getTestEvent("");
  in.getMessage().setOutboundProperty("foo","bar");
  MuleEvent out=enricher.process(in);
  Assert.assertSame(in,out);
  Assert.assertSame(in.getMessage(),out.getMessage());
  assertEquals(in.getMessage().getUniqueId(),out.getMessage().getUniqueId());
  assertEquals(in.getMessage().getPropertyNames(),out.getMessage().getPropertyNames());
  assertEquals("bar",out.getMessage().getOutboundProperty("foo"));
  assertEquals(in.getMessage().getPayload(),out.getMessage().getPayload());
}
