{
  ((DefaultMuleConfiguration)muleContext.getConfiguration()).setEnricherPropagatesSessionVariableChanges(true);
  MessageEnricher enricher=new MessageEnricher();
  enricher.setMuleContext(muleContext);
  enricher.addEnrichExpressionPair(new EnrichExpressionPair("#[header:myHeader]"));
  enricher.setEnrichmentMessageProcessor(new MessageProcessor(){
    public MuleEvent process(    MuleEvent event) throws MuleException {
      event.getSession().setProperty("sessionFoo","bar");
      return event;
    }
  }
);
  MuleEvent in=getTestEvent("");
  MuleEvent out=enricher.process(in);
  assertEquals("bar",out.getSession().getProperty("sessionFoo"));
}
