{
  MessageEnricher enricher=new MessageEnricher();
  enricher.setMuleContext(muleContext);
  enricher.addEnrichExpressionPair(new EnrichExpressionPair("#[sessionVars['foo']]"));
  SensingNullMessageProcessor sensingNullMessageProcessor=new SensingNullMessageProcessor();
  enricher.setEnrichmentMessageProcessor(sensingNullMessageProcessor);
  ReplyToHandler nullReplyToHandler=new SensingNullReplyToHandler();
  Flow flow=mock(Flow.class);
  when(flow.getProcessingStrategy()).thenReturn(new NonBlockingProcessingStrategy());
  MuleEvent in=new DefaultMuleEvent(new DefaultMuleMessage(TEST_MESSAGE,muleContext),MessageExchangePattern.REQUEST_RESPONSE,nullReplyToHandler,flow);
  MuleEvent out=enricher.process(in);
  assertThat(in.isAllowNonBlocking(),is(true));
  assertThat(out,is(sameInstance(in)));
  assertThat(sensingNullMessageProcessor.event,not(sameInstance(in)));
}
