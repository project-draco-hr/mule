{
  muleContext.getRegistry().registerObject("appender",new StringAppendTransformer(" append"));
  MessageEnricher enricher=new MessageEnricher();
  enricher.setMuleContext(muleContext);
  enricher.addEnrichExpressionPair(new EnrichExpressionPair("#[process:appender:#[header:header1]]","#[header:myHeader]"));
  enricher.setEnrichmentMessageProcessor(new MessageProcessor(){
    @Override public MuleEvent process(    MuleEvent event) throws MuleException {
      event.getMessage().setOutboundProperty("header1","test");
      return event;
    }
  }
);
  MuleEvent event=getTestEvent("");
  RequestContext.setEvent(event);
  assertEquals("test append",enricher.process(getTestEvent("")).getMessage().getOutboundProperty("myHeader"));
}
