{
  shouldFail=true;
  latch=new Latch();
  MuleEvent event=getTestEvent("");
  muleContext.getClient().dispatch("vm://recover",event.getMessage());
  assertTrue(latch.await(TIMEOUT,SECONDS));
  muleContext.dispose();
  muleContext=null;
  TemporaryFolder originalWorkingDirectory=workingDirectory;
  workingDirectory=new TemporaryFolderWrapper(workingDirectory);
  latch=new Latch();
  shouldFail=false;
  try {
    setUpMuleContext();
    assertTrue(latch.await(TIMEOUT,MILLISECONDS));
    assertNotNull(muleContext.getClient().request("vm://success",TIMEOUT));
  }
  finally {
    workingDirectory=originalWorkingDirectory;
  }
}
