{
  String myDirName="myout";
  String myFileName="out.txt";
  FileInputStream myFileStream=null;
  File myDir=FileUtils.newFile(myDirName);
  if (myDir.isDirectory()) {
    File[] files=myDir.listFiles();
    for (int i=0; i < files.length; i++) {
      assertTrue(files[i].delete());
    }
    assertTrue(myDir.delete());
  }
  try {
    assertFalse(FileUtils.newFile(myDir,myFileName).exists());
    MuleClient client=new MuleClient();
    client.send("vm://fileappend","Hello1",null);
    client.send("vm://fileappend","Hello2",null);
    myFileStream=new FileInputStream(FileUtils.newFile(myDir,myFileName));
    assertEquals("Hello1Hello2",IOUtils.toString(myFileStream));
  }
  finally {
    IOUtils.closeQuietly(myFileStream);
    assertTrue(FileUtils.newFile(myDir,myFileName).delete());
    assertTrue(myDir.delete());
  }
}
