{
  Credential returnedCredential=super.validate(credential,data);
  AssertionWrapper assertion=credential.getAssertion();
  if (!"www.example.com".equals(assertion.getIssuerString())) {
    throw new WSSecurityException(WSSecurityException.FAILURE,"invalidSAMLsecurity");
  }
  if (assertion.getSaml2() == null) {
    throw new WSSecurityException(WSSecurityException.FAILURE,"invalidSAMLsecurity");
  }
  String confirmationMethod=assertion.getConfirmationMethods().get(0);
  if (confirmationMethod == null) {
    throw new WSSecurityException(WSSecurityException.FAILURE,"invalidSAMLsecurity");
  }
  if (requireSenderVouches && !OpenSAMLUtil.isMethodSenderVouches(confirmationMethod)) {
    throw new WSSecurityException(WSSecurityException.FAILURE,"invalidSAMLsecurity");
  }
 else   if (!requireSenderVouches && !OpenSAMLUtil.isMethodHolderOfKey(confirmationMethod)) {
    throw new WSSecurityException(WSSecurityException.FAILURE,"invalidSAMLsecurity");
  }
  if (!"uid=joe,ou=people,ou=saml-demo,o=example.com".equals(assertion.getSaml2().getSubject().getNameID().getValue())) {
    throw new WSSecurityException(WSSecurityException.FAILURE,"invalidSAMLsecurity");
  }
  return returnedCredential;
}
