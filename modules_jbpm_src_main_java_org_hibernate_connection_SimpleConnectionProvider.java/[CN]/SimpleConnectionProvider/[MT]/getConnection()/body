{
  if (log.isTraceEnabled())   log.trace("total checked-out connections: " + checkedOut);
synchronized (pool) {
    if (!pool.isEmpty()) {
      int last=pool.size() - 1;
      if (log.isTraceEnabled()) {
        log.trace("using pooled JDBC connection, pool size: " + last);
        checkedOut++;
      }
      Connection pooled=(Connection)pool.remove(last);
      if (isolation != null)       pooled.setTransactionIsolation(isolation.intValue());
      if (pooled.getAutoCommit() != autocommit)       pooled.setAutoCommit(autocommit);
      return pooled;
    }
  }
  log.debug("opening new JDBC connection");
  Connection conn=driver.connect(url,connectionProps);
  if (isolation != null)   conn.setTransactionIsolation(isolation.intValue());
  if (conn.getAutoCommit() != autocommit)   conn.setAutoCommit(autocommit);
  if (log.isDebugEnabled()) {
    log.debug("created connection to: " + url + ", Isolation Level: "+ conn.getTransactionIsolation());
  }
  if (log.isTraceEnabled())   checkedOut++;
  return conn;
}
