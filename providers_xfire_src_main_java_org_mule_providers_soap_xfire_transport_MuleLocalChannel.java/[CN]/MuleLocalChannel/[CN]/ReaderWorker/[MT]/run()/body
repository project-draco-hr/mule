{
  try {
    final XMLStreamReader reader=STAXUtils.createXMLStreamReader(stream,message.getEncoding(),context);
    final InMessage inMessage=new InMessage(reader,uri);
    inMessage.setEncoding(message.getEncoding());
    channel.receive(context,inMessage);
    reader.close();
    stream.close();
  }
 catch (  Exception e) {
    throw new XFireRuntimeException("Couldn't read stream.",e);
  }
 finally {
    semaphore.release();
  }
}
