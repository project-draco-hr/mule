{
  try {
    to.setReceiveBufferSize(1);
    from.setSendBufferSize(1);
    from.setSoLinger(false,0);
    to.setSoLinger(false,0);
    to.setTcpNoDelay(false);
    from.setTcpNoDelay(false);
    from.getOutputStream().write(1);
    from.getOutputStream().write(2);
    from.getOutputStream().write(3);
    from.close();
    if (null != server) {
      server.close();
    }
    Thread.sleep(100);
    if (null != server) {
      ServerSocket another=new ServerSocket();
      another.bind(new InetSocketAddress(LOCALHOST,SERVER_PORT));
      another.setReuseAddress(true);
      Socket another2=new Socket(LOCALHOST,SERVER_PORT);
      Socket another3=another.accept();
      another2.getOutputStream().write(9);
      assertEquals(9,another3.getInputStream().read());
      another3.close();
      another2.close();
      another.close();
    }
    return 1 == to.getInputStream().read() && 2 == to.getInputStream().read() && 3 == to.getInputStream().read();
  }
  finally {
    to.close();
    if (!from.isClosed()) {
      from.close();
    }
  }
}
