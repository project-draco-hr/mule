{
  OnNoTokenPolicyAware policyAware=mock(OnNoTokenPolicyAware.class);
  when(policyAware.getOnNoTokenPolicy()).thenReturn(OnNoTokenPolicy.STOP_FLOW);
  DevkitBasedMessageProcessor processor=new UnauthorizedProcessor("forbidden");
  processor.setModuleObject(policyAware);
  MuleEvent event=mock(MuleEvent.class,RETURNS_DEEP_STUBS);
  MuleEvent responseEvent=processor.process(event);
  assertThat("event should be filtered because STOP_FLOW was used",responseEvent,is(nullValue()));
}
