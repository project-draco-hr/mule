{
  MuleMessage returnMessage=null;
  try {
    MuleMessage message=createMuleMessage(packet,endpoint.getEncoding());
    final SocketAddress clientAddress=socket.getRemoteSocketAddress();
    if (clientAddress != null) {
      message.setProperty(MuleProperties.MULE_REMOTE_CLIENT_ADDRESS,clientAddress,PropertyScope.INBOUND);
    }
    MuleEvent event=routeMessage(message);
    returnMessage=event == null ? null : event.getMessage();
    if (endpoint.getExchangePattern().hasResponse() && returnMessage != null) {
      byte[] data=returnMessage.getPayloadAsBytes();
      DatagramPacket result=new DatagramPacket(data,data.length,packet.getAddress(),packet.getPort());
      socket.send(result);
    }
  }
 catch (  Exception e) {
    if (!disposing.get()) {
      getEndpoint().getMuleContext().getExceptionListener().handleException(e);
    }
  }
 finally {
    dispose();
  }
}
