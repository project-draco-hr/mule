{
  muleContext=mock(MuleContext.class,withSettings().defaultAnswer(RETURNS_DEEP_STUBS));
  when(muleContext.getStatistics()).thenReturn(new AllStatistics());
  when(muleContext.getConfiguration()).thenReturn(new DefaultMuleConfiguration());
  when(muleContext.getRegistry()).thenReturn(new MuleRegistryHelper(new DefaultRegistryBroker(muleContext),muleContext));
  when(muleContext.getDefaultThreadingProfile()).thenReturn(new ChainedThreadingProfile());
  notificationManager=mock(ServerNotificationManager.class);
  when(muleContext.getNotificationManager()).thenReturn(notificationManager);
  pipeline=new TestPipeline(pipelineName,muleContext);
  when(muleContext.getTransformationService()).thenReturn(new TransformationService(muleContext));
  context=DefaultEventContext.create(pipeline,TEST_CONNECTOR);
}
