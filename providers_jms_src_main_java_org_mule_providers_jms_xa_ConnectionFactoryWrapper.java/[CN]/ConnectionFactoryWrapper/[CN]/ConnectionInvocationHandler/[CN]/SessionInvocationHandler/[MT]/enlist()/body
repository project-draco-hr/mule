{
  if (logger.isDebugEnabled()) {
    logger.debug("Enlistment request: " + this);
  }
  if (tx == null && tm != null) {
    tx=tm.getTransaction();
    if (tx != null) {
      if (logger.isDebugEnabled()) {
        logger.debug("Enlisting resource in xa transaction: " + xares);
      }
      XAResource xares=(XAResource)Proxy.newProxyInstance(XAResource.class.getClassLoader(),new Class[]{XAResource.class},new XAResourceInvocationHandler());
      tx.enlistResource(xares);
    }
  }
}
