{
  try {
    endpointsCache.clear();
    if (applicationContext.containsBean(EVENT_MULTICASTER_DESCRIPTOR_NAME)) {
      descriptor=(UMODescriptor)applicationContext.getBean(EVENT_MULTICASTER_DESCRIPTOR_NAME);
    }
    if (applicationContext.containsBean("muleManager")) {
      registerMulticasterDescriptor();
      return;
    }
    UMOManager manager=MuleManager.getInstance();
    if (!manager.isStarted()) {
      MuleManager.getConfiguration().setSynchronous(!asynchronous);
      registerEndpointMappings();
    }
    SpringContainerContext containerContext=new SpringContainerContext();
    containerContext.setBeanFactory(applicationContext);
    manager.setContainerContext(null);
    manager.setContainerContext(containerContext);
    registerConnectors();
    registerTransformers();
    registerGlobalEndpoints();
    registerMulticasterDescriptor();
    if (!manager.isStarted())     manager.start();
  }
 catch (  UMOException e) {
    throw new MuleRuntimeException(new Message("spring",1),e);
  }
}
