{
  AroundPolicy ap=new TestPolicy("test around policy");
  DefaultMessageProcessorChain chain=new DefaultMessageProcessorChain(new StringAppendTransformer("first"),new StringAppendTransformer(" second"));
  initialiseObject(chain);
  assertEquals("No policies should have been registered.",0,chain.getPolicies().listActive().size());
  chain.getPolicies().add(ap);
  assertSame("Policy has not been registered.",ap,chain.getPolicies().listActive().iterator().next());
  System.out.println(chain);
  final MuleEvent result=chain.process(getTestEvent("payload "));
  assertNotNull(result);
  final MuleMessage message=result.getMessage();
  assertNotNull(message);
  assertEquals("payload {before} first second {after}",message.getPayload());
  final AroundPolicy policy=chain.getPolicies().removePolicy(ap.getName());
  assertSame("Wrong policy returned?",ap,policy);
  assertEquals("No policies should have been registered.",0,chain.getPolicies().listActive().size());
}
