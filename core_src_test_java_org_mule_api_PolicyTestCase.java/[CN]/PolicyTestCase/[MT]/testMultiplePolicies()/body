{
  MessageProcessorChain chain=new DefaultMessageProcessorChainBuilder().chain(new StringAppendTransformer("first"),new StringAppendTransformer(" second")).build();
  initialiseObject(chain);
  assertEquals("No policies should have been registered.",0,chain.getPolicies().list().size());
  AroundPolicy policy1=new TestPolicy("test around policy 1");
  chain.getPolicies().add(policy1);
  final TestPolicy policy2=new TestPolicy("test around policy 2");
  chain.getPolicies().add(policy2);
  assertEquals("Wrong policies count.",2,chain.getPolicies().list().size());
  System.out.println(chain);
  final MuleEvent result=chain.process(getTestEvent("payload "));
  assertNotNull(result);
  final MuleMessage message=result.getMessage();
  assertNotNull(message);
  assertEquals("payload {before} {before} first second {after} {after}",message.getPayload());
  final AroundPolicy policy=chain.getPolicies().remove(policy1.getName());
  assertSame("Wrong policy returned?",policy1,policy);
  chain.getPolicies().remove(policy2.getName());
  assertEquals("No policies should have been registered.",0,chain.getPolicies().list().size());
}
