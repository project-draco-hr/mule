{
  super(capacity);
  this.muleContext=muleContext;
  File queuesDirectory=new File(workingDirectory + File.separator + QUEUE_STORE_DIRECTORY);
  if (!queuesDirectory.exists()) {
    Preconditions.checkState(queuesDirectory.mkdirs(),"Could not create queue store directory " + queuesDirectory.getAbsolutePath());
  }
  File queueStoreFile1=getFirstQueueFile(queueName,workingDirectory);
  File queueStoreFile2=getSecondQueueFile(queueName,workingDirectory);
  randomAccessFileQueueStore1=new RandomAccessFileQueueStore(queueStoreFile1);
  randomAccessFileQueueStore2=new RandomAccessFileQueueStore(queueStoreFile2);
  writeFile=randomAccessFileQueueStore1;
  readFile=randomAccessFileQueueStore1;
  if (logger.isDebugEnabled()) {
    logger.debug(String.format("Queue %s has %s messages",queueName,getSize()));
  }
  filesLock=new ReentrantReadWriteLock();
}
