{
  final Builder builder=MuleMessage.builder(event.getMessage());
  if (dataType == null) {
    final TypedValue typedValue=resolveTypedValue(event);
    builder.payload(typedValue.getValue()).mediaType(typedValue.getDataType().getMediaType());
  }
 else {
    Object value=resolveValue(event);
    final DataTypeParamsBuilder dataTypeBuilder=DataType.builder(dataType).type(value == null ? Object.class : value.getClass());
    builder.payload(value).mediaType(dataTypeBuilder.build().getMediaType());
  }
  event.setMessage(builder.build());
  return event;
}
