{
  if (data instanceof InputStream) {
    if (streamOk) {
      copyStream((InputStream)data,os);
    }
 else {
      throw new IOException("TCP protocol " + ClassUtils.getSimpleName(getClass()) + " cannot handle streaming");
    }
  }
 else   if (data instanceof UMOMessageAdapter) {
    write(os,((UMOMessageAdapter)data).getPayload());
  }
 else   if (data instanceof byte[]) {
    writeByteArray(os,(byte[])data);
  }
 else   if (data instanceof String) {
    String s=(String)data;
    writeByteArray(os,s.getBytes(getStringEncoding(s)));
  }
 else   if (data instanceof Serializable) {
    writeByteArray(os,SerializationUtils.serialize((Serializable)data));
  }
 else {
    throw new IllegalArgumentException("Cannot serialize data: " + data);
  }
}
