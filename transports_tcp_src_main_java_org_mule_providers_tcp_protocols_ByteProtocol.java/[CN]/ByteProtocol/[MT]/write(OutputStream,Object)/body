{
  if (data instanceof UMOMessageAdapter) {
    data=((UMOMessageAdapter)data).getPayload();
  }
  if (data instanceof byte[]) {
    writeByteArray(os,(byte[])data);
  }
 else   if (data instanceof String) {
    writeByteArray(os,((String)data).getBytes());
  }
 else   if (data instanceof Serializable) {
    writeByteArray(os,SerializationUtils.serialize((Serializable)data));
  }
 else {
    throw new IllegalArgumentException("Cannot serialize data: " + data);
  }
}
