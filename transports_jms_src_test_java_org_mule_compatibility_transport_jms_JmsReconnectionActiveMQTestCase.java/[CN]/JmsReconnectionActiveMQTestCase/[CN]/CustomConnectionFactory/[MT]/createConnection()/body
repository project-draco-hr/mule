{
  if (returnInvalidConnections) {
    Connection invalidConnection=Mockito.mock(Connection.class,Mockito.RETURNS_DEEP_STUBS);
    Mockito.doThrow(new JMSException("Fail to start connection")).when(invalidConnection).start();
    return invalidConnection;
  }
 else {
    return super.createConnection();
  }
}
