{
  final String domainOriginal="TEST_DOMAIN_1";
  final Flow flow=new Flow("TEST_SERVICE",muleContext);
  SingletonObjectFactory factory=new SingletonObjectFactory(Object.class);
  final DefaultJavaComponent component=new DefaultJavaComponent(factory);
  component.setMuleContext(muleContext);
  flow.setMessageProcessors(new ArrayList<MessageProcessor>());
  flow.getMessageProcessors().add(component);
  muleContext.getRegistry().registerFlowConstruct(flow);
  muleContext.start();
  final FlowConstructService jmxService=new FlowConstructService("TEST_SERVICE",flow.getName(),muleContext,null);
  final ObjectName name=ObjectName.getInstance(domainOriginal + ":type=TEST_SERVICE");
  mBeanServer.registerMBean(jmxService,name);
  Set mbeans=mBeanServer.queryMBeans(ObjectName.getInstance(domainOriginal + ":*"),null);
  assertEquals("Unexpected number of components registered in the domain.",2,mbeans.size());
  mBeanServer.unregisterMBean(name);
  mbeans=mBeanServer.queryMBeans(ObjectName.getInstance(domainOriginal + ":*"),null);
  assertEquals("There should be no MBeans left in the domain",0,mbeans.size());
}
