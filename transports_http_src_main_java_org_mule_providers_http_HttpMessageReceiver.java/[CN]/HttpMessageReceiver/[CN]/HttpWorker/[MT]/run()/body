{
  try {
    do {
      conn.setKeepAlive(false);
      HttpRequest request=conn.readRequest();
      if (request == null) {
        break;
      }
      conn.writeResponse(processRequest(request));
    }
 while (conn.isKeepAlive());
  }
 catch (  Exception e) {
    handleException(e);
  }
 finally {
    logger.info("Closing HTTP connection.");
    conn.close();
    conn=null;
  }
}
