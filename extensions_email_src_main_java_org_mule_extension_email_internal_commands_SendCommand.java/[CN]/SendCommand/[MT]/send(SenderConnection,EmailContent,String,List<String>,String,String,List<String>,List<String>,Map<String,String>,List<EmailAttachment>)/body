{
  try {
    Message message=MessageBuilder.newMessage(connection.getSession()).withSentDate(Calendar.getInstance().getTime()).fromAddresses(fromAddress).to(toAddresses).cc(ccAddresses).bcc(bccAddresses).withSubject(subject).withAttachments(attachments != null ? attachments : new ArrayList<>()).withContent(content.getBody(),content.getContentType(),content.getCharset() == null ? defaultEncoding : content.getCharset()).withHeaders(headers).build();
    Transport.send(message);
  }
 catch (  MessagingException e) {
    throw new EmailSenderException(e);
  }
}
