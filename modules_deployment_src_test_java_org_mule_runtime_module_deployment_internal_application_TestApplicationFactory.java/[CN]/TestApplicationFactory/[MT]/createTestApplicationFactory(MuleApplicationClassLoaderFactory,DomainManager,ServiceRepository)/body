{
  ArtifactClassLoaderFilterFactory classLoaderFilterFactory=new ArtifactClassLoaderFilterFactory();
  ArtifactPluginDescriptorFactory artifactPluginDescriptorFactory=new ArtifactPluginDescriptorFactory();
  ArtifactPluginDescriptorLoader artifactPluginDescriptorLoader=new ArtifactPluginDescriptorLoader(artifactPluginDescriptorFactory);
  TestEmptyApplicationPluginRepository applicationPluginRepository=new TestEmptyApplicationPluginRepository();
  ApplicationDescriptorFactory applicationDescriptorFactory=new ApplicationDescriptorFactory(artifactPluginDescriptorLoader,applicationPluginRepository);
  final DefaultClassLoaderManager artifactClassLoaderManager=new DefaultClassLoaderManager();
  ApplicationClassLoaderBuilderFactory applicationClassLoaderBuilderFactory=new ApplicationClassLoaderBuilderFactory(applicationClassLoaderFactory,applicationPluginRepository,new TrackingArtifactClassLoaderFactory<>(artifactClassLoaderManager,new ArtifactPluginClassLoaderFactory()));
  return new TestApplicationFactory(applicationClassLoaderBuilderFactory,applicationDescriptorFactory,applicationPluginRepository,domainManager,serviceRepository,artifactClassLoaderManager);
}
