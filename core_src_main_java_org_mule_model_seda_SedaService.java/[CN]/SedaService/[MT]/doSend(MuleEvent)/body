{
  MuleMessage result=null;
  try {
    if (logger.isDebugEnabled()) {
      logger.debug(MessageFormat.format("{0} : got proxy for {1} = {2}",this,event.getId(),component));
    }
    Object replyTo=event.getMessage().getReplyTo();
    ReplyToHandler replyToHandler=getReplyToHandler(event.getMessage(),(InboundEndpoint)event.getEndpoint());
    event.getMessage().setReplyTo(null);
    result=invokeComponent(event);
    result=sendToOutboundRouter(event,result);
    result=processAsyncReplyRouter(result);
    if (result != null && !BooleanUtils.toBoolean((String)result.getProperty(MuleProperties.MULE_REPLY_TO_STOP_PROPERTY))) {
      processReplyTo(event,result,replyToHandler,replyTo);
    }
  }
 catch (  Exception e) {
    event.getSession().setValid(false);
    if (e instanceof MessagingException) {
      handleException(e);
    }
 else {
      handleException(new MessagingException(CoreMessages.eventProcessingFailedFor(getName()),event.getMessage(),e));
    }
    if (result == null) {
      result=new DefaultMuleMessage(NullPayload.getInstance(),RequestContext.getEvent().getMessage(),muleContext);
    }
    ExceptionPayload exceptionPayload=result.getExceptionPayload();
    if (exceptionPayload == null) {
      exceptionPayload=new DefaultExceptionPayload(e);
    }
    result.setExceptionPayload(exceptionPayload);
  }
  return result;
}
