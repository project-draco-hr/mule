{
  checkDisposed();
  if (endpoint == null) {
    throw new IllegalArgumentException("Endpoint must not be null");
  }
  if (!supportsProtocol(endpoint.getConnector().getProtocol())) {
    throw new IllegalArgumentException(new Message(Messages.CONNECTOR_SCHEME_X_INCOMPATIBLE_WITH_ENDPOINT_SCHEME_X,getProtocol(),endpoint.getEndpointURI().toString()).getMessage());
  }
  if (dispatchers == null) {
    throw new IllegalStateException("Dispatchers are null for connector: " + name);
  }
synchronized (endpoint) {
    String endpointUriKey=endpoint.getEndpointURI().toString();
    UMOMessageDispatcher dispatcher=(UMOMessageDispatcher)dispatchers.get(endpointUriKey);
    if (dispatcher == null || dispatcher.isDisposed()) {
      dispatcher=createDispatcher(endpoint);
      dispatchers.put(endpointUriKey,dispatcher);
    }
    return dispatcher;
  }
}
