{
  Transformer t=transformerCache.get(source.toString() + result.toString());
  if (t != null) {
    return t;
  }
  try {
    JAXBContext jaxb=getContextResolver().resolve(JAXBContext.class,source,result,muleContext);
    if (jaxb == null) {
      return null;
    }
    boolean marshal=false;
    Class annotatedType=null;
    if (getContextResolver().getMatchingClasses().contains(result.getType())) {
      annotatedType=result.getType();
      marshal=false;
    }
 else {
      if (getContextResolver().getMatchingClasses().contains(source.getType())) {
        annotatedType=source.getType();
        marshal=true;
      }
    }
    if (annotatedType == null) {
      annotatedType=result.getType();
      boolean isJAXB=hasJaxbAnnotations(annotatedType);
      if (!isJAXB) {
        marshal=true;
        annotatedType=source.getType();
        isJAXB=hasJaxbAnnotations(annotatedType);
      }
      if (!isJAXB) {
        return null;
      }
    }
    List<Transformer> ts=muleContext.getRegistry().lookupTransformers(source,result);
    if (ts.size() == 1 && !(ts.get(0) instanceof ObjectToString)) {
      t=ts.get(0);
    }
 else {
      if (marshal) {
        t=new JAXBMarshallerTransformer(jaxb,result);
      }
 else {
        t=new JAXBUnmarshallerTransformer(jaxb,result);
      }
    }
    transformerCache.put(source.toString() + result.toString(),t);
    return t;
  }
 catch (  Exception e) {
    throw new ResolverException(CoreMessages.createStaticMessage("Failed to unmarshal"),e);
  }
}
