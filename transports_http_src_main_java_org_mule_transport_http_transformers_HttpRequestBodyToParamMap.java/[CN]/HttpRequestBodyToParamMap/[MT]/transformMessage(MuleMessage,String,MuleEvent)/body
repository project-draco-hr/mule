{
  Map<String,Object> paramMap=new HashMap<String,Object>();
  try {
    String httpMethod=message.getOutboundProperty("http.method");
    String contentType=message.getOutboundProperty("Content-Type");
    boolean isGet=HttpConstants.METHOD_GET.equalsIgnoreCase(httpMethod);
    boolean isPost=HttpConstants.METHOD_POST.equalsIgnoreCase(httpMethod);
    boolean isUrlEncoded=false;
    if (contentType != null) {
      isUrlEncoded=contentType.startsWith("application/x-www-form-urlencoded");
    }
    if (!(isGet || (isPost && isUrlEncoded))) {
      throw new Exception("The HTTP method or content type is unsupported!");
    }
    String queryString=null;
    if (isGet) {
      URI uri=new URI(message.getPayloadAsString(encoding));
      queryString=uri.getQuery();
    }
 else     if (isPost) {
      queryString=new String(message.getPayloadAsBytes());
    }
    if (StringUtils.isNotBlank(queryString)) {
      String[] pairs=queryString.split("&");
      for (      String pair : pairs) {
        String[] nameValue=pair.split("=");
        if (nameValue.length == 2) {
          String key=URLDecoder.decode(nameValue[0],encoding);
          String value=URLDecoder.decode(nameValue[1],encoding);
          addToParameterMap(paramMap,key,value);
        }
      }
    }
  }
 catch (  Exception e) {
    throw new TransformerMessagingException(event,this,e);
  }
  return paramMap;
}
