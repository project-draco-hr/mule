{
  UMOEndpointURI endpointURI=event.getEndpoint().getEndpointURI();
  Map properties=new HashMap();
  UMOMessage msg=event.getMessage();
  for (Iterator iterator=msg.getPropertyNames().iterator(); iterator.hasNext(); ) {
    String propertyKey=(String)iterator.next();
    properties.put(propertyKey,msg.getProperty(propertyKey));
  }
  properties.put(MuleProperties.MULE_METHOD_PROPERTY,method.getLocalPart());
  properties.put("methodNamespace",method.getNamespaceURI());
  properties.put("address",endpointURI.getAddress());
  properties.put("scheme",endpointURI.getScheme());
  properties.put("host",endpointURI.getHost());
  properties.put("port",String.valueOf(endpointURI.getPort()));
  properties.put("path",endpointURI.getPath());
  properties.put("hostInfo",endpointURI.getScheme() + "://" + endpointURI.getHost()+ (endpointURI.getPort() > -1 ? ":" + String.valueOf(endpointURI.getPort()) : ""));
  if (event.getComponent() != null) {
    properties.put("serviceName",event.getComponent().getDescriptor().getName());
  }
  TemplateParser tp=TemplateParser.createSquareBracesStyleParser();
  soapAction=tp.parse(properties,soapAction);
  if (logger.isDebugEnabled()) {
    logger.debug("SoapAction for this call is: " + soapAction);
  }
  return soapAction;
}
