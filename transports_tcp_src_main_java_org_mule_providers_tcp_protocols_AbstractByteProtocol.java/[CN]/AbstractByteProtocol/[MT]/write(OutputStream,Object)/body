{
  if (data instanceof InputStream) {
    if (streamOk) {
      IOUtils.copy((InputStream)data,os);
      os.flush();
      os.close();
    }
 else {
      throw new IOException("TCP protocol " + ClassUtils.getSimpleName(getClass()) + " cannot handle streaming");
    }
  }
 else   if (data instanceof UMOMessageAdapter) {
    write(os,((UMOMessageAdapter)data).getPayload());
  }
 else   if (data instanceof byte[]) {
    writeByteArray(os,(byte[])data);
  }
 else   if (data instanceof String) {
    writeByteArray(os,((String)data).getBytes());
  }
 else   if (data instanceof Serializable) {
    writeByteArray(os,SerializationUtils.serialize((Serializable)data));
  }
 else {
    throw new IllegalArgumentException("Cannot serialize data: " + data);
  }
}
