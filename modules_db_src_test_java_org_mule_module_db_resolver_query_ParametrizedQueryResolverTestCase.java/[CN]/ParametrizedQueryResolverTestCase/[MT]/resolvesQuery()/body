{
  ParamValueResolver paramValueResolver=mock(ParamValueResolver.class);
  QueryResolver queryResolver=new ParametrizedQueryResolver(resolvedTemplateQuery,paramValueResolver);
  List<QueryParamValue> resolvedParams=Collections.singletonList(new QueryParamValue("param1","foo"));
  when(paramValueResolver.resolveParams(muleEvent,resolvedTemplateQuery.getParamValues())).thenReturn(resolvedParams);
  Query resolvedQuery=queryResolver.resolve(null,muleEvent);
  assertThat(resolvedTemplateQuery,not(sameInstance(resolvedQuery)));
  assertThat(resolvedTemplateQuery.getQueryTemplate(),sameInstance(resolvedQuery.getQueryTemplate()));
  assertThat(resolvedParams,sameInstance(resolvedQuery.getParamValues()));
  assertThat((String)resolvedParams.get(0).getValue(),equalTo("foo"));
}
