{
  MuleMessage retMessage;
  EndpointURI endpointUri=event.getEndpoint().getEndpointURI();
  final VMMessageReceiver receiver=connector.getReceiver(endpointUri);
  if (receiver == null) {
    throw new NoReceiverForEndpointException(VMMessages.noReceiverForEndpoint(connector.getName(),event.getEndpoint().getEndpointURI()));
  }
  event.transformMessage();
  MuleMessage message=event.getMessage();
  connector.getSessionHandler().storeSessionInfoToMessage(event.getSession(),message);
  TransactionTemplate tt=new TransactionTemplate(receiver.getEndpoint().getTransactionConfig(),connector.getExceptionListener(),event.getMuleContext());
  TransactionCallback cb=new TransactionCallback(){
    public Object doInTransaction() throws Exception {
      return receiver.onCall(event.getMessage(),true);
    }
  }
;
  retMessage=(MuleMessage)tt.execute(cb);
  if (logger.isDebugEnabled()) {
    logger.debug("sent event on endpointUri: " + event.getEndpoint().getEndpointURI());
  }
  return retMessage;
}
