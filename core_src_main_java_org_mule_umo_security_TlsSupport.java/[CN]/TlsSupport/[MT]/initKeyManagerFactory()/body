{
  KeyStore store;
  try {
    Security.addProvider(getProvider());
    store=KeyStore.getInstance(keystoreType);
    InputStream is=IOUtils.getResourceAsStream(getKeyStore(),getClass());
    if (is == null) {
      throw new FileNotFoundException(new Message(Messages.CANT_LOAD_X_FROM_CLASSPATH_FILE,"Keystore: " + getKeyStore()).getMessage());
    }
    store.load(is,getStorePassword().toCharArray());
  }
 catch (  Exception e) {
    throw new InitialisationException(new Message(Messages.FAILED_LOAD_X,"KeyStore: " + getKeyStore()),e,this);
  }
  try {
    keyManagerFactory=KeyManagerFactory.getInstance(getKeyManagerAlgorithm());
    keyManagerFactory.init(store,getKeyPassword().toCharArray());
  }
 catch (  Exception e) {
    throw new InitialisationException(new Message(Messages.FAILED_LOAD_X,"Key Manager"),e,this);
  }
}
