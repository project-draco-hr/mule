{
  MuleClient client=new MuleClient();
  Customer c=new Customer("Ross Mason",1234);
  CustomerQuoteRequest[] requests=new CustomerQuoteRequest[3];
  requests[0]=new CustomerQuoteRequest(c,100000,48);
  requests[1]=new CustomerQuoteRequest(c,1000,12);
  requests[2]=new CustomerQuoteRequest(c,10,24);
  long start=System.currentTimeMillis();
  int numRequests=getNumberOfRequests();
  int i=0;
  UMOMessage result;
  try {
    for (i=0; i < numRequests; i++) {
      client.dispatch("CustomerRequests",requests[i % 3],null);
    }
    for (i=0; i < numRequests; i++) {
      result=client.receive("CustomerResponses",getDelay() * numRequests);
      assertNotNull("Result is null",result);
      assertFalse("Result is null",result.getPayload() instanceof NullPayload);
      assertTrue("Result should be LoanQuote but is " + result.getPayload().getClass().getName(),result.getPayload() instanceof LoanQuote);
      LoanQuote quote=(LoanQuote)result.getPayload();
      assertTrue(quote.getInterestRate() > 0);
    }
  }
  finally {
    long el=System.currentTimeMillis() - start;
    System.out.println("Total running time was: " + el + "ms");
    System.out.println("Requests processed was: " + i);
    int mps=(int)(numRequests / ((double)el / (double)1000));
    System.out.println("Msg/sec: " + mps + " (no warm up)");
  }
}
