{
  ProcessConnector connector=(ProcessConnector)muleContext.getRegistry().lookupConnector("bpmConnector");
  BPMS bpms=connector.getBpms();
  assertNotNull(bpms);
  MuleClient client=new MuleClient(muleContext);
  try {
    MuleMessage response=client.send("bpm://simple","data",null);
    Object process=response.getPayload();
    String processId=(String)bpms.getId(process);
    assertFalse(processId == null);
    assertEquals("dummyState",bpms.getState(process));
    response=client.send("bpm://simple/" + processId,null,null);
    process=response.getPayload();
    assertTrue(bpms.hasEnded(process));
  }
  finally {
    client.dispose();
  }
}
