{
  if (tm == null) {
    if (!properties.containsKey(Environment.OBJECTSTORE_DIR)) {
      final String muleInternalDir=MuleServer.getMuleContext().getConfiguration().getWorkingDirectory();
      arjPropertyManager.propertyManager.setProperty(Environment.OBJECTSTORE_DIR,muleInternalDir + "/transaction-log");
    }
    for (Iterator i=properties.entrySet().iterator(); i.hasNext(); ) {
      Map.Entry entry=(Map.Entry)i.next();
      arjPropertyManager.propertyManager.setProperty((String)entry.getKey(),(String)entry.getValue());
    }
    tm=com.arjuna.ats.jta.TransactionManager.transactionManager();
  }
  return tm;
}
