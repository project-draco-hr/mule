{
  if (_contexts == null)   throw new IllegalArgumentException("No HandlerContainer");
  Resource r=Resource.newResource(_webAppDir);
  if (!r.exists())   throw new IllegalArgumentException("No such webapps resource " + r);
  if (!r.isDirectory())   throw new IllegalArgumentException("Not directory webapps resource " + r);
  String[] files=r.list();
  files:   for (int f=0; files != null && f < files.length; f++) {
    String context=files[f];
    if (context.equalsIgnoreCase("CVS/") || context.equalsIgnoreCase("CVS") || context.startsWith("."))     continue;
    Resource app=r.addPath(r.encode(context));
    if (context.toLowerCase().endsWith(".war") || context.toLowerCase().endsWith(".jar")) {
      context=context.substring(0,context.length() - 4);
      Resource unpacked=r.addPath(context);
      if (unpacked != null && unpacked.exists() && unpacked.isDirectory())       continue;
    }
 else     if (!app.isDirectory())     continue;
    if (context.equalsIgnoreCase("root") || context.equalsIgnoreCase("root/"))     context=URIUtil.SLASH;
 else     context="/" + context;
    if (context.endsWith("/") && context.length() > 0)     context=context.substring(0,context.length() - 1);
    if (!_allowDuplicates) {
      Handler[] installed=_contexts.getChildHandlersByClass(ContextHandler.class);
      for (int i=0; i < installed.length; i++) {
        ContextHandler c=(ContextHandler)installed[i];
        if (context.equals(c.getContextPath()))         continue files;
        try {
          String path=null;
          if (c instanceof WebAppContext)           path=Resource.newResource(((WebAppContext)c).getWar()).getFile().getAbsolutePath();
 else           if (c.getBaseResource() != null)           path=c.getBaseResource().getFile().getAbsolutePath();
          if (path != null && path.equals(app.getFile().getAbsolutePath()))           continue files;
        }
 catch (        Exception e) {
          Log.ignore(e);
        }
      }
    }
    WebAppContext wah=null;
    if (_contexts instanceof ContextHandlerCollection && WebAppContext.class.isAssignableFrom(((ContextHandlerCollection)_contexts).getContextClass())) {
      try {
        wah=(WebAppContext)((ContextHandlerCollection)_contexts).getContextClass().newInstance();
      }
 catch (      Exception e) {
        throw new Error(e);
      }
    }
 else {
      wah=new WebAppContext();
    }
    wah.setContextPath(context);
    if (_configurationClasses != null)     wah.setConfigurationClasses(_configurationClasses);
    if (_defaultsDescriptor != null)     wah.setDefaultsDescriptor(_defaultsDescriptor);
    wah.setExtractWAR(_extract);
    wah.setWar(app.toString());
    wah.setParentLoaderPriority(_parentLoaderPriority);
    if (serverClasses != null) {
      wah.setServerClasses(serverClasses);
    }
    if (systemClasses != null) {
      wah.setSystemClasses(systemClasses);
    }
    if (connector != null) {
      connector.addHandler(wah);
    }
    _deployed.add(wah);
    if (_contexts.isStarted())     _contexts.start();
  }
}
