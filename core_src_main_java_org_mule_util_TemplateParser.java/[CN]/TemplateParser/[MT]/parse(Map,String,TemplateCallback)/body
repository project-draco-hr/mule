{
  String result=template;
  Matcher m=pattern.matcher(template);
  String match, propname;
  while (m.find()) {
    Object value=null;
    match=m.group();
    propname=match.substring(pre,match.length() - post);
    if (callback != null) {
      value=callback.match(propname);
    }
 else     if (props != null) {
      value=props.get(propname);
    }
    if (value == null) {
      if (logger.isWarnEnabled()) {
        logger.warn("Value " + propname + " not found in context");
      }
    }
 else {
      match=escape(match);
      String escapedValue=value.toString().replaceAll("\\\\","\\\\\\\\");
      result=result.replaceAll(match,escapedValue);
    }
  }
  return result;
}
