{
  InboundEndpoint endpoint=(InboundEndpoint)inboundEndpointCache.get(uri + ":" + mep.toString());
  if (endpoint == null) {
    EndpointBuilder endpointBuilder=muleContext.getRegistry().lookupEndpointFactory().getEndpointBuilder(uri);
    endpointBuilder.setExchangePattern(mep);
    endpoint=muleContext.getEndpointFactory().getInboundEndpoint(endpointBuilder);
    InboundEndpoint concurrentlyAddedEndpoint=(InboundEndpoint)inboundEndpointCache.putIfAbsent(uri + ":" + mep.toString(),endpoint);
    if (concurrentlyAddedEndpoint != null) {
      return concurrentlyAddedEndpoint;
    }
  }
  return endpoint;
}
