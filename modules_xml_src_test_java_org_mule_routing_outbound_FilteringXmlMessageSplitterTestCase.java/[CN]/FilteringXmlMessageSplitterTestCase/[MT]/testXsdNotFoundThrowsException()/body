{
  final String invalidSchemaLocation="non-existent.xsd";
  Mock session=MuleTestUtils.getMockSession();
  Endpoint endpoint1=getTestEndpoint("Test1Endpoint",Endpoint.ENDPOINT_TYPE_SENDER);
  endpoint1.setEndpointURI(new MuleEndpointURI("test://endpointUri.1"));
  FilteringXmlMessageSplitter splitter=new FilteringXmlMessageSplitter();
  splitter.setValidateSchema(true);
  splitter.setExternalSchemaLocation(invalidSchemaLocation);
  String payload=IOUtils.getResourceAsString("purchase-order.xml",getClass());
  MuleMessage message=new DefaultMuleMessage(payload);
  assertTrue(splitter.isMatch(message));
  try {
    splitter.route(message,(MuleSession)session.proxy(),false);
    fail("Should have thrown an exception, because XSD is not found.");
  }
 catch (  IllegalArgumentException iaex) {
    assertTrue("Wrong exception?",iaex.getMessage().indexOf("Couldn't find schema at " + invalidSchemaLocation) != -1);
  }
  session.verify();
}
