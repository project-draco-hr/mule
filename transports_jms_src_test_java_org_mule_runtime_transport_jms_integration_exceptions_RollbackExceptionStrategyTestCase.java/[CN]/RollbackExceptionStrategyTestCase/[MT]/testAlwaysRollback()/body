{
  final CountDownLatch latch=new CountDownLatch(EXPECTED_DELIVERED_TIMES);
  MuleClient client=muleContext.getClient();
  muleContext.registerListener(new ExceptionNotificationListener<ExceptionNotification>(){
    @Override public void onNotification(    ExceptionNotification notification){
      latch.countDown();
    }
  }
);
  client.dispatch("vm://in","some message",null);
  if (!latch.await(TIMEOUT,TimeUnit.MILLISECONDS)) {
    fail("message should have been delivered at least 5 times");
  }
}
