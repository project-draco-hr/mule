{
  ImmutableEndpoint endpoint=getImmutableEndpoint(endpointName);
  EndpointURI endpointURI=endpoint.getEndpointURI();
  SftpClient client=new SftpClient(endpointURI.getHost());
  client.setPort(endpointURI.getPort());
  SftpConnector sftpConnector=(SftpConnector)endpoint.getConnector();
  if (sftpConnector.getIdentityFile() != null) {
    try {
      client.login(endpointURI.getUser(),sftpConnector.getIdentityFile(),sftpConnector.getPassphrase());
    }
 catch (    Exception e) {
      fail("Login failed: " + e);
    }
  }
 else {
    try {
      client.login(endpointURI.getUser(),endpointURI.getPassword());
    }
 catch (    Exception e) {
      fail("Login failed: " + e);
    }
  }
  return client;
}
