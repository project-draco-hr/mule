{
  Object connectionLock=getConnectionLock(connection);
synchronized (connectionLock) {
    Set<ResultSet> resultSets=connectionResultSets.get(connection);
    if (resultSets == null) {
      resultSets=new HashSet<ResultSet>();
      connectionResultSets.put(connection,resultSets);
    }
    resultSets.add(resultSet);
  }
}
