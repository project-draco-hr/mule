{
  if (LOGGER.isDebugEnabled()) {
    LOGGER.debug("Expanding installation archive");
  }
  File unzip=new File(dir,"unzip");
  IOUtils.unzip(file,unzip);
  if (LOGGER.isDebugEnabled()) {
    LOGGER.debug("Loading jbi descriptor");
  }
  File jbiFile=new File(unzip,JBI_DESCRIPTOR);
  if (!jbiFile.isFile()) {
    throw new JBIException("Jar has no jbi.xml");
  }
  Jbi jbi=JbiDocument.Factory.parse(jbiFile).getJbi();
  if (!"1.0".equals(jbi.getVersion().toString())) {
    throw new JBIException("version attribute should be '1.0'");
  }
  if (!jbi.isSetComponent()) {
    throw new JBIException("component should be set");
  }
  String name=jbi.getComponent().getIdentification().getName();
  if (this.container.getComponentRegistry().getComponent(name) != null) {
    throw new JBIException("component already installed");
  }
  if (this.installers.get(name) != null) {
    throw new JBIException("an installer has already been created");
  }
  com.sun.java.xml.ns.jbi.ComponentDocument.Component.SharedLibrary[] libs=jbi.getComponent().getSharedLibraryArray();
  for (int i=0; i < libs.length; i++) {
    String libName=libs[i].getDomNode().getFirstChild().getNodeValue();
    if (this.container.getComponentRegistry().getSharedLibrary(libName) == null) {
      throw new JBIException("Component requires a missing shared library: " + libName);
    }
  }
  File installDir=new File(cmpDir,name);
  if (!unzip.renameTo(installDir)) {
    throw new IOException("Could not rename directory: " + unzip);
  }
  Installer installer=new Installer(this.container,installDir,jbi);
  installer.init();
  ObjectName objName=createComponentInstallerName(name);
  StandardMBean mbean=new StandardMBean(installer,InstallerMBean.class);
  this.container.getMBeanServer().registerMBean(mbean,objName);
  this.installers.put(name,installer);
  return objName;
}
