{
  FTPClient client=new FTPClient();
  try {
    if (uri.getPort() > 0) {
      client.connect(uri.getHost(),uri.getPort());
    }
 else {
      client.connect(uri.getHost());
    }
    if (!FTPReply.isPositiveCompletion(client.getReplyCode())) {
      throw new IOException("Ftp error: " + client.getReplyCode());
    }
    if (!client.login(uri.getUsername(),uri.getPassword())) {
      throw new IOException("Ftp error: " + client.getReplyCode());
    }
    if (!client.setFileType(FTP.BINARY_FILE_TYPE)) {
      throw new IOException("Ftp error. Couldn't set BINARY transfer type.");
    }
  }
 catch (  Exception e) {
    if (client.isConnected()) {
      client.disconnect();
    }
    throw e;
  }
  return client;
}
