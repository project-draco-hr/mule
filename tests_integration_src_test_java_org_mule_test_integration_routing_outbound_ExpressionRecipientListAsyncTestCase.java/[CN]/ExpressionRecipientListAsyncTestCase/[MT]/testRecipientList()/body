{
  String message="test";
  MuleClient client=new MuleClient();
  Map<String,Object> props=new HashMap<String,Object>(3);
  props.put("recipient1","vm://service1.queue");
  props.put("recipient2","vm://service2.queue");
  props.put("recipient3","vm://service3.queue");
  client.dispatch("vm://distributor.queue",message,props);
  List<Object> results=new ArrayList<Object>(3);
  MuleMessage result=client.request("vm://collector.queue",5000);
  assertNotNull(result);
  results.add(result.getPayload());
  result=client.request("vm://collector.queue",3000);
  assertNotNull(result);
  results.add(result.getPayload());
  result=client.request("vm://collector.queue",3000);
  assertNotNull(result);
  results.add(result.getPayload());
  assertTrue(results.contains("test 1 Received"));
  assertTrue(results.contains("test 2 Received"));
  assertTrue(results.contains("test 3 Received"));
}
