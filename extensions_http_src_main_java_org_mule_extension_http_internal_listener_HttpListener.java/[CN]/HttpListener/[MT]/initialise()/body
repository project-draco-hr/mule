{
  if (allowedMethods != null) {
    parsedAllowedMethods=extractAllowedMethods();
    methodRequestMatcher=new MethodRequestMatcher(parsedAllowedMethods);
  }
  if (responseBuilder == null) {
    responseBuilder=new HttpListenerResponseBuilder();
  }
  initialiseIfNeeded(responseBuilder);
  if (errorResponseBuilder == null) {
    errorResponseBuilder=new HttpListenerResponseBuilder();
  }
  initialiseIfNeeded(errorResponseBuilder);
  path=HttpParser.sanitizePathWithStartSlash(path);
  listenerPath=config.getFullListenerPath(path);
  path=listenerPath.getResolvedPath();
  muleEventToHttpResponse=new MuleEventToHttpResponse(responseStreamingMode,muleContext);
  validatePath();
  parseRequest=config.resolveParseRequest(parseRequest);
  try {
    requestHandlerManager=server.addRequestHandler(new ListenerRequestMatcher(methodRequestMatcher,path),getRequestHandler());
  }
 catch (  Exception e) {
    throw new InitialisationException(e,this);
  }
  ErrorTypeRepository errorTypeRepository=muleContext.getErrorTypeRepository();
  knownErrors=Lists.newArrayList(errorTypeRepository.lookupErrorType(SECURITY));
}
