{
  Flow flow=getTestFlow();
  MuleSession session=mock(MuleSession.class);
  IdempotentMessageFilter ir=new IdempotentMessageFilter();
  ir.setIdExpression("#[message.inboundProperties.id]");
  ir.setFlowConstruct(flow);
  ir.setThrowOnUnaccepted(false);
  ir.setStorePrefix("foo");
  ir.setStore(new InMemoryObjectStore<String>());
  MuleMessage okMessage=new DefaultMuleMessage("OK",muleContext);
  okMessage.setOutboundProperty("id","1");
  MuleEvent event=new DefaultMuleEvent(okMessage,getTestFlow(),session);
  event=ir.process(event);
  assertNotNull(event);
  okMessage=new DefaultMuleMessage("OK",muleContext);
  okMessage.setOutboundProperty("id","1");
  event=new DefaultMuleEvent(okMessage,getTestFlow(),session);
  event=ir.process(event);
  assertNull(event);
}
