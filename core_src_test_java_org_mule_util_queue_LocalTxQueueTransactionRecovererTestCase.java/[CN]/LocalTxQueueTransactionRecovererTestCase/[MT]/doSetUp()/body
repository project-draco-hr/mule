{
  ((DefaultMuleConfiguration)muleContext.getConfiguration()).setWorkingDirectory(temporaryFolder.getRoot().getAbsolutePath());
  txLog=new LocalTxQueueTransactionJournal(temporaryFolder.getRoot().getAbsolutePath(),muleContext);
  inQueue=new DefaultQueueStore(QUEUE_NAME,muleContext,new DefaultQueueConfiguration(0,true));
  persistentTransactionContext=new PersistentQueueTransactionContext(txLog,createQueueProvider(inQueue));
  queueTransactionRecoverer=new LocalTxQueueTransactionRecoverer(txLog,createQueueProvider(inQueue));
}
