{
  try {
    wrapper=new ClientWrapper(){
      @Override public void initialize() throws Exception, IOException {
        String wsdlUrl=endpoint.getEndpointURI().getAddress();
        String serviceName=endpoint.getEndpointURI().getAddress();
        String portName=null;
        if (endpoint.getProperty("wsdlLocation") != null && StringUtils.isNotBlank(endpoint.getProperty("wsdlLocation").toString())) {
          wsdlUrl=(String)endpoint.getProperty("wsdlLocation");
        }
        if (endpoint.getProperty("service") != null && StringUtils.isNotBlank(endpoint.getProperty("service").toString())) {
          serviceName=(String)endpoint.getProperty("service");
        }
 else         if (serviceName.indexOf("?") > -1) {
          serviceName=serviceName.substring(0,serviceName.lastIndexOf('?'));
        }
        if (endpoint.getProperty("port") != null && StringUtils.isNotBlank(endpoint.getProperty("port").toString())) {
          portName=(String)endpoint.getProperty("port");
        }
        try {
          DynamicClientFactory cf=DynamicClientFactory.newInstance(bus);
          this.client=cf.createClient(wsdlUrl,QName.valueOf(serviceName),(portName == null ? null : QName.valueOf(portName)));
        }
 catch (        Exception ex) {
          disconnect();
          throw ex;
        }
      }
    }
;
    wrapper.setBus(connector.getCxfBus());
    wrapper.setEndpoint(endpoint);
    wrapper.initialize();
  }
 catch (  Exception ex) {
    disconnect();
    throw ex;
  }
}
