{
  innerFlowLatch=new Latch();
  exceptionLatch=new Latch();
  eventPropagated=true;
  isSameMessage=true;
  MuleClient client=muleContext.getClient();
  MuleMessage result=client.send(getUrl(endpoint),getTestMuleMessage("Original Message")).getRight();
  boolean innerFlowCalled=innerFlowLatch.await(3,TimeUnit.SECONDS);
  assertThat(innerFlowCalled,is(true));
  boolean exceptionHandled=exceptionLatch.await(3,TimeUnit.SECONDS);
  assertThat(exceptionHandled,is(true));
  assertThat(isSameMessage,is(true));
  assertThat(eventPropagated,is(true));
  assertThat(result,notNullValue(MuleMessage.class));
}
