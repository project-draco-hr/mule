{
  char sep;
  if (url.indexOf("?") > -1) {
    sep='&';
  }
 else {
    sep='?';
  }
  for (Iterator iterator=args.entrySet().iterator(); iterator.hasNext(); ) {
    Map.Entry entry=(Map.Entry)iterator.next();
    String name=(String)entry.getKey();
    String exp=(String)entry.getValue();
    Object value=propertyExtractor.getProperty(exp,msg);
    if (value == null && !optional) {
      throw new IllegalArgumentException(new Message(Messages.X_PROPERTY_IS_NOT_SET_ON_EVENT,exp).toString());
    }
    url.append(sep);
    sep='&';
    url.append(name).append('=').append(value);
  }
  if (!optional && payloadParameterName != null) {
    url.append(sep).append(payloadParameterName).append('=').append(body.toString());
  }
}
