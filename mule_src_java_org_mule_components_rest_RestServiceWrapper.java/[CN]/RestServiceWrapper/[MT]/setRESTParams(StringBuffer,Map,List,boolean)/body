{
  char sep;
  if (url.indexOf("?") > -1) {
    sep='&';
  }
 else {
    sep='?';
  }
  String arg;
  Object value;
  for (Iterator iterator=args.iterator(); iterator.hasNext(); ) {
    arg=(String)iterator.next();
    value=params.get(arg);
    if (value == null && !optional) {
      throw new IllegalArgumentException(new Message(Messages.X_PROPERTY_IS_NOT_SET_ON_EVENT,arg).toString());
    }
    url.append(sep);
    sep='&';
    url.append(arg).append("=").append(value);
  }
  if (!optional && payloadParameterName != null) {
    url.append(sep).append(payloadParameterName).append("=").append(params.get(payloadParameterName));
  }
}
