{
  final DataType expectedDataType=DataTypeFactory.create(Map.class,UNKNOWN);
  expectedDataType.setEncoding(CUSTOM_ENCODING);
  MuleEvent testEvent=getTestEvent(TEST_MESSAGE);
  final Map<String,String> propertyValue=new HashMap<>();
  propertyValue.put(INNER_PROPERTY_NAME,TEST_MESSAGE);
  testEvent.getMessage().setProperty(PROPERTY_NAME,propertyValue,scope,expectedDataType);
  CompiledExpression compiledExpression=compileMelExpression(expression,testEvent);
  dataTypePropagator.propagate(testEvent.getMessage(),new TypedValue(propertyValue,DataType.STRING_DATA_TYPE),compiledExpression);
  assertThat(testEvent.getMessage().getPropertyDataType(PROPERTY_NAME,scope),like(Map.class,UNKNOWN,CUSTOM_ENCODING));
}
