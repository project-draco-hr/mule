{
  InputStream is=null;
  if (context.getMessage().getPayload() instanceof InputStream) {
    is=(InputStream)context.getMessage().getPayload();
  }
 else   if (context.getMessage().getAdapter() instanceof StreamMessageAdapter) {
    StreamMessageAdapter sma=(StreamMessageAdapter)context.getMessage().getAdapter();
    if (sma.getInput() != null) {
      is=sma.getInput();
    }
 else {
      is=sma.getResponse();
    }
  }
 else {
    is=new ByteArrayInputStream(context.getMessageAsBytes());
  }
  return is;
}
