{
  final DomainClassLoaderRepository domainClassLoaderRepository=mock(DomainClassLoaderRepository.class);
  when(domainClassLoaderRepository.getDomainClassLoader(DOMAIN_NAME)).thenReturn(domainCL);
  final NativeLibraryFinderFactory nativeLibraryFinderFactory=mock(NativeLibraryFinderFactory.class);
  MuleApplicationClassLoaderFactory classLoaderFactory=new MuleApplicationClassLoaderFactory(domainClassLoaderRepository,nativeLibraryFinderFactory);
  final ApplicationDescriptor descriptor=new ApplicationDescriptor();
  descriptor.setName(APP_NAME);
  descriptor.setDomain(DOMAIN_NAME);
  final Set<PluginDescriptor> plugins=new HashSet<>();
  final PluginDescriptor pluginDescriptor=new PluginDescriptor();
  pluginDescriptor.setName("plugin1");
  plugins.add(pluginDescriptor);
  descriptor.setPlugins(plugins);
  descriptor.setSharedPluginLibs(new URL[]{jarFile.toURI().toURL()});
  final MuleApplicationClassLoader artifactClassLoader=(MuleApplicationClassLoader)classLoaderFactory.create(descriptor);
  assertThat(artifactClassLoader.getURLs(),is(equalTo(artifactClassLoader.getURLs())));
  assertThat(artifactClassLoader.getParent(),is(instanceOf(CompositeClassLoader.class)));
  assertThat(artifactClassLoader.getParent().getParent(),is(instanceOf(GoodCitizenClassLoader.class)));
  assertThat(artifactClassLoader.getParent().getParent().getParent(),is(domainCL));
}
