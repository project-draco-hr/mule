{
  Flow flow=(Flow)muleContext.getRegistry().lookupFlowConstruct("et");
  Map<String,Object> props=new HashMap<String,Object>();
  props.put("foo","moo");
  props.put("bar","mar");
  MuleMessage message=new DefaultMuleMessage(new FruitBowl(new Apple(),new Banana()),props,muleContext);
  MuleEvent resultEvent=flow.process(new DefaultMuleEvent(message,getTestInboundEndpoint(""),getTestService(),getTestSession(null,muleContext)));
  assertNotNull(resultEvent);
  assertNotNull(resultEvent.getMessage().getPayload());
  Object payload=resultEvent.getMessage().getPayload();
  assertFalse(payload.getClass().isArray());
  assertTrue(payload instanceof List<?>);
  List<?> list=(List<?>)payload;
  assertTrue(list.contains("moo"));
  assertTrue(list.contains("mar"));
}
