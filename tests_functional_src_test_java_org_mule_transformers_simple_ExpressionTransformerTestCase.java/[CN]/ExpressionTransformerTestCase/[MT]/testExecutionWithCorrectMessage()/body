{
  ExpressionTransformer transformer=(ExpressionTransformer)RegistryContext.getRegistry().lookupTransformer("testTransformer");
  Properties props=new Properties();
  props.setProperty("foo","moo");
  props.setProperty("bar","mar");
  MuleMessage message=new DefaultMuleMessage(new FruitBowl(new Apple(),new Banana()),props);
  Object result=transformer.transform(message);
  assertNotNull(result);
  assertTrue(result.getClass().isArray());
  Object o1=((Object[])result)[0];
  assertTrue(o1 instanceof FruitBasket);
  Object o2=((Object[])result)[1];
  assertTrue(o2 instanceof Map);
  assertEquals(2,((Map)o2).size());
  assertEquals("moo",((Map)o2).get("foo"));
  assertEquals("mar",((Map)o2).get("bar"));
}
