{
  ImmutableEndpoint ep=(ImmutableEndpoint)key;
  DatagramSocket socket;
  if (ep.isInbound()) {
    int port=ep.getEndpointURI().getPort();
    String host=ep.getEndpointURI().getHost();
    if (port > 0) {
      if ("null".equalsIgnoreCase(host)) {
        socket=createSocket(port);
      }
 else {
        socket=createSocket(port,InetAddress.getByName(host));
      }
    }
 else {
      socket=createSocket();
    }
  }
 else {
    socket=createSocket();
  }
  UdpConnector connector=(UdpConnector)ep.getConnector();
  if (connector.getReceiveBufferSize() != Connector.INT_VALUE_NOT_SET && socket.getReceiveBufferSize() != connector.getReceiveBufferSize()) {
    socket.setReceiveBufferSize(connector.getReceiveBufferSize());
  }
  if (connector.getSendBufferSize() != Connector.INT_VALUE_NOT_SET && socket.getSendBufferSize() != connector.getSendBufferSize()) {
    socket.setSendBufferSize(connector.getSendBufferSize());
  }
  if (connector.getReceiveTimeout() != Connector.INT_VALUE_NOT_SET && socket.getSoTimeout() != connector.getReceiveTimeout()) {
    socket.setSoTimeout(connector.getSendTimeout());
  }
  socket.setBroadcast(connector.isBroadcast());
  return socket;
}
