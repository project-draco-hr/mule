{
  MuleEvent event=getTestEvent(input);
  event.setFlowVariable("books",books);
  event.setFlowVariable("cities",cities);
  Flow flow=(Flow)getFlowConstruct(flowName);
  List<Element> elements=(List<Element>)flow.process(event).getMessage().getPayload();
  assertThat(elements,hasSize(1));
  NodeList childNodes=elements.get(0).getChildNodes();
  assertThat(childNodes.getLength(),greaterThan(0));
  NamedNodeMap firstChildAttributes=childNodes.item(0).getAttributes();
  assertThat(firstChildAttributes.getNamedItem("title").getNodeValue(),equalTo("Pride and Prejudice"));
  assertThat(firstChildAttributes.getNamedItem("city").getNodeValue(),equalTo("milan"));
}
