{
  HttpClient client=new HttpClient();
  client.getParams().setAuthenticationPreemptive(true);
  PostMethod post=new PostMethod("http://localhost:" + getPorts().get(0) + "/services/Echo");
  post.setDoAuthentication(false);
  StringRequestEntity requestEntity=new StringRequestEntity(soapRequest,"text/xml","UTF-8");
  post.setRequestEntity(requestEntity);
  try {
    int status=client.executeMethod(post);
    assertEquals(HttpConstants.SC_UNAUTHORIZED,status);
    assertEquals("Registered authentication is set to org.mule.module.acegi.filters.http.HttpBasicAuthenticationFilter " + "but there was no security context on the session. Authentication denied on " + "endpoint http://localhost:" + getPorts().get(0) + "/services/Echo. Message payload is of type: "+ "ContentLengthInputStream",post.getResponseBodyAsString());
  }
  finally {
    post.releaseConnection();
  }
}
