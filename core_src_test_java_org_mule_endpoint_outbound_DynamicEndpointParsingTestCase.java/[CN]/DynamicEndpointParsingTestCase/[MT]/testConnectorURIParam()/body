{
  TestConnector tc=new TestConnector(muleContext);
  tc.setName("myTestConnector");
  muleContext.getRegistry().registerConnector(tc);
  OutboundEndpoint endpoint=createEndpoint("test://#[header:host]:#[header:port]?connectorName=myTestConnector");
  assertTrue(endpoint instanceof DynamicOutboundEndpoint);
  assertTrue(endpoint.getConnector() instanceof NullConnector);
  MuleEvent event=getTestEvent("test");
  event.getMessage().setOutboundProperty("port",12345);
  event.getMessage().setOutboundProperty("host","localhost");
  endpoint.process(event);
  assertTrue(endpoint.getConnector() instanceof TestConnector);
  assertEquals("myTestConnector",endpoint.getConnector().getName());
}
