{
  when(delegate.createConnection(USERNAME,PASSWORD)).thenReturn(connection).thenReturn(null);
  Session session=mock(Session.class);
  when(connection.createSession(false,Session.AUTO_ACKNOWLEDGE)).thenReturn(session).thenReturn(null);
  CustomCachingConnectionFactory cachingConnectionFactory=new CustomCachingConnectionFactory(delegate,USERNAME,PASSWORD);
  Connection connection1=cachingConnectionFactory.createConnection();
  Session session1=connection1.createSession(false,Session.AUTO_ACKNOWLEDGE);
  session1.close();
  Session session2=connection1.createSession(false,Session.AUTO_ACKNOWLEDGE);
  assertThat(session1,equalTo(session2));
}
