{
  Service service=muleContext.getRegistry().lookupService("TestPersistentQueueService");
  final TestJMSMessageListener listener=createTestJMSConsumer();
  populateSedaQueue(service,NUM_MESSAGES);
  muleContext.stop();
  assertNoLostMessages(NUM_MESSAGES,service,listener);
  assertSedaQueueNotEmpty(service);
  muleContext.start();
  reregisterTestJMSConsumer(listener);
  assertTrue(listener.countdownLatch.await(LATCH_WAIT_TIME_MILLIS,TimeUnit.MILLISECONDS));
  assertNoLostMessages(NUM_MESSAGES,service,listener);
  assertSedaQueueEmpty(service);
}
