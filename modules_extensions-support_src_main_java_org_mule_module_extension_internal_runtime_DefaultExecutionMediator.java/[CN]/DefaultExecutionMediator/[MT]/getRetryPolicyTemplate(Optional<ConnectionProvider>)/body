{
  if (optionalConnectionProvider.isPresent()) {
    final ConnectionProvider connectionProvider=optionalConnectionProvider.get();
    if (ConnectionProviderWrapper.class.isAssignableFrom(connectionProvider.getClass())) {
      return ((ConnectionProviderWrapper)connectionProvider).getRetryPolicyTemplate();
    }
  }
  return connectionManager.getDefaultRetryPolicyTemplate();
}
