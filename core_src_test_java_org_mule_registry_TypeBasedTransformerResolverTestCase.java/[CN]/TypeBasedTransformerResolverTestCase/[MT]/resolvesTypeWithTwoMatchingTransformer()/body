{
  MuleRegistry muleRegistry=mock(MuleRegistry.class);
  when(muleContext.getRegistry()).thenReturn(muleRegistry);
  Transformer aToBConverter=createMockConverter(1,dataTypeA,dataTypeB);
  Transformer betterAToBConverter=createMockConverter(2,dataTypeA,dataTypeB);
  ArrayList<Transformer> transformers=new ArrayList<Transformer>();
  transformers.add(aToBConverter);
  transformers.add(betterAToBConverter);
  when(muleRegistry.lookupTransformers(dataTypeA,dataTypeB)).thenReturn(transformers);
  TypeBasedTransformerResolver resolver=new TypeBasedTransformerResolver();
  resolver.setMuleContext(muleContext);
  Transformer resolvedTransformer=resolver.resolve(dataTypeA,dataTypeB);
  assertEquals(betterAToBConverter,resolvedTransformer);
}
