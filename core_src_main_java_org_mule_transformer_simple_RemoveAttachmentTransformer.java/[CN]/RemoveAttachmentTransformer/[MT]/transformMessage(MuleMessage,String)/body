{
  try {
    if (!nameEvaluator.isRegularExpression()) {
      String keyValue=nameEvaluator.resolveStringValue(message);
      if (keyValue != null) {
        String name=keyValue.toString();
        message.removeOutboundAttachment(name);
      }
 else {
        logger.info("Attachment key expression return null, no attachment will be removed");
      }
    }
 else {
      final Set<String> attachmentNames=new HashSet<String>(message.getOutboundAttachmentNames());
      for (      String attachmentName : attachmentNames) {
        if (nameEvaluator.matches(attachmentName)) {
          message.removeOutboundAttachment(attachmentName);
        }
      }
    }
    return message;
  }
 catch (  Exception e) {
    throw new TransformerException(this,e);
  }
}
