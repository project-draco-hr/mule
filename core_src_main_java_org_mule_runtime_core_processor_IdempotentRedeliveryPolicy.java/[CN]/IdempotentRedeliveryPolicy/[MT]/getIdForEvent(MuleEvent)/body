{
  if (useSecureHash) {
    Object payload=event.getMessage().getPayload();
    byte[] bytes=(byte[])objectToByteArray.transform(payload);
    if (payload instanceof InputStream) {
      event.setMessage(MuleMessage.builder(event.getMessage()).payload(bytes).build());
    }
    MessageDigest md=MessageDigest.getInstance(messageDigestAlgorithm);
    byte[] digestedBytes=md.digest(bytes);
    return (String)byteArrayToHexString.transform(digestedBytes);
  }
 else {
    return event.getMuleContext().getExpressionManager().parse(idExpression,event,true);
  }
}
