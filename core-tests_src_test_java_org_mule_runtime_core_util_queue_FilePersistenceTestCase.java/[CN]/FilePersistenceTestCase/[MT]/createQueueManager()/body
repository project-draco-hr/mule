{
  TransactionalQueueManager mgr=new TransactionalQueueManager();
  MuleConfiguration mockConfiguration=Mockito.mock(MuleConfiguration.class);
  when(mockConfiguration.getWorkingDirectory()).thenReturn(temporaryFolder.getRoot().getAbsolutePath());
  when(mockConfiguration.getMaxQueueTransactionFilesSizeInMegabytes()).thenReturn(100);
  ((DefaultMuleContext)muleContext).setMuleConfiguration(mockConfiguration);
  mgr.setMuleContext(muleContext);
  mgr.initialise();
  mgr.setDefaultQueueConfiguration(new DefaultQueueConfiguration(0,true));
  return mgr;
}
