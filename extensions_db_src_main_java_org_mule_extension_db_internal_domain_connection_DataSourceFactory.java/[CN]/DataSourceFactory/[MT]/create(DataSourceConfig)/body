{
  DataSource dataSource;
  if (dataSourceConfig.getPoolingProfile() == null) {
    dataSource=createSingleDataSource(dataSourceConfig);
  }
 else {
    dataSource=createPooledDataSource(dataSourceConfig);
  }
  if (dataSourceConfig.isUseXaTransactions()) {
    dataSource=decorateDataSource(dataSource,dataSourceConfig.getPoolingProfile());
  }
  if (!(dataSourceConfig.getPoolingProfile() == null || dataSourceConfig.isUseXaTransactions())) {
    pooledDataSources.add(dataSource);
  }
 else   if (dataSource instanceof Disposable) {
    disposableDataSources.add((Disposable)dataSource);
  }
  return dataSource;
}
