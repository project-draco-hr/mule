{
  UUID id=getId(obj);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  if (obj instanceof byte[]) {
    baos.write(STORE_BYTES_BYTE);
    baos.write(id.asByteArray());
    baos.write((byte[])obj);
  }
 else   if (obj instanceof String) {
    baos.write(STORE_STRING_BYTE);
    baos.write(id.asByteArray());
    baos.write(((String)obj).getBytes());
  }
 else {
    baos.write(STORE_OBJ_BYTE);
    baos.write(id.asByteArray());
    ObjectOutputStream oos=new ObjectOutputStream(baos);
    oos.writeObject(obj);
    oos.close();
  }
  Packet packet=new ByteArrayPacket(baos.toByteArray());
  RecordLocation loc=journal.write(packet,false);
  objects.put(id,obj);
synchronized (markLock) {
    marks.put(id,loc);
    pendingMarks.add(loc);
  }
  return id;
}
