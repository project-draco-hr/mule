{
  if (args.length < 1) {
    throw new IllegalArgumentException("Missing expected arguments from the Service Wrapper.");
  }
  String wrapperCommand=args[args.length - 1];
  String[] remainingArgs=new String[args.length - 1];
  System.arraycopy(args,0,remainingArgs,0,args.length - 1);
  CommandLine commandLine=parseCommandLine(remainingArgs);
  remainingArgs=commandLine.getArgs();
  String mainClassName=commandLine.getOptionValue("main");
  if (commandLine.hasOption("osgi")) {
    boolean startGui=wrapperCommand.startsWith("console") && !commandLine.hasOption("nogui");
    System.out.println("Starting the OSGi Framework...");
    WrapperManager.start(new OsgiFrameworkWrapper(startGui),remainingArgs);
  }
 else   if (mainClassName == null || mainClassName.equals(MAIN_CLASS_MULE_SERVER)) {
    configureClasspath();
    System.out.println("Starting the Mule Server...");
    WrapperManager.start((WrapperListener)Class.forName(MAIN_CLASS_MULE_SERVER).newInstance(),remainingArgs);
  }
 else {
    String[] appArgs=new String[remainingArgs.length + 1];
    appArgs[0]=mainClassName;
    System.arraycopy(remainingArgs,0,appArgs,1,remainingArgs.length);
    configureClasspath();
    System.out.println("Starting class " + mainClassName + "...");
    WrapperSimpleApp.main(appArgs);
  }
}
