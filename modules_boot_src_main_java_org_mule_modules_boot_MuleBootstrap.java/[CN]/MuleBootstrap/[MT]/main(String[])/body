{
  File muleHome=null;
  String muleHomeVar=System.getProperty("mule.home");
  if (muleHomeVar != null && !muleHomeVar.trim().equals("")) {
    muleHome=new File(muleHomeVar);
  }
  if (muleHome == null || !muleHome.exists() || !muleHome.isDirectory()) {
    throw new IllegalArgumentException("Either MULE_HOME is not set or does not contain a valid directory.");
  }
  DefaultMuleClassPathConfig classPath=new DefaultMuleClassPathConfig(muleHome);
  addLibrariesToClasspath(classPath.getURLs());
  if (!ClassUtils.isClassOnPath("javax.activation.DataSource",MuleBootstrap.class)) {
    LibraryDownloader downloader=new LibraryDownloader(muleHome);
    addLibrariesToClasspath(downloader.downloadLibraries());
  }
  String mainClassName=SystemUtils.getCommandLineOption("-main",args);
  if (mainClassName == null) {
    mainClassName=MuleServer.class.getName();
  }
  String[] appArgs=new String[args.length + 1];
  appArgs[0]=mainClassName;
  System.arraycopy(args,0,appArgs,1,args.length);
  WrapperSimpleApp.main(appArgs);
}
