{
  getTransformer().initialize(getInputStream().getOut());
  boolean finishWriting=false;
  while (!finishWriting && !isClosed) {
    writeSemaphore.acquire();
    finishWriting=getTransformer().write(getInputStream().getOut(),getBytesRequested());
  }
}
