{
  final ContentType currentContentType=getCurrentContentType(operationContext);
  String encoding=operationContext.getTypeSafeParameter(ENCODING_PARAMETER_NAME,String.class);
  String mimeType=operationContext.getTypeSafeParameter(MIME_TYPE_PARAMETER_NAME,String.class);
  boolean contentTypeFixed=!StringUtils.isBlank(encoding) || !StringUtils.isBlank(mimeType);
  ContentMetadata contentMetadata=contentTypeFixed ? new FixedContextMetadata(currentContentType,new ContentType(encoding,mimeType)) : new MutableContentMetadata(currentContentType);
  ((OperationContextAdapter)operationContext).setVariable(CONTENT_METADATA,contentMetadata);
  return contentMetadata;
}
