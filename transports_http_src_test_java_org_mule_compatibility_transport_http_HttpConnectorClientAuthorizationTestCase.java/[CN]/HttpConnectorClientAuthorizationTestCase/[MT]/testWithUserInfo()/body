{
  URI uri=new URI(URI_WITH_CREDENTIALS);
  when(mockMuleEvent.getMessageSourceURI()).thenReturn(uri);
  when(mockMuleEvent.getMessage()).thenReturn(message);
  when(mockMuleEvent.getCredentials()).thenReturn(null);
  when(mockImmutableEndpoint.getProperty(HEADER_AUTHORIZATION)).thenReturn(null);
  when(mockImmutableEndpoint.getEncoding()).thenReturn(encoding);
  when(mockImmutableEndpoint.getEndpointURI()).thenReturn(new MuleEndpointURI(URI_WITH_CREDENTIALS,muleContext));
  connector.setupClientAuthorization(mockMuleEvent,mockHttpMethod,mockHttpClient,mockImmutableEndpoint);
  verify(mockHttpMethod,atLeast(1)).addRequestHeader(eq(HEADER_AUTHORIZATION),anyString());
}
