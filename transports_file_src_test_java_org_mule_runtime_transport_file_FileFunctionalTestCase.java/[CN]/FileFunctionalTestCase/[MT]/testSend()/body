{
  File target=File.createTempFile("mule-file-test-",".txt");
  target.deleteOnExit();
  FileConnector connector=(FileConnector)muleContext.getRegistry().lookupObject("sendConnector");
  connector.setWriteToDirectory(target.getParent());
  Map<String,Object> props=new HashMap<String,Object>();
  props.put(TARGET_FILE,target.getName());
  MuleClient client=muleContext.getClient();
  client.dispatch("send",TEST_MESSAGE,props);
  waitForFileSystem();
  String result=new BufferedReader(new FileReader(target)).readLine();
  assertEquals(TEST_MESSAGE,result);
}
