{
  if (getStreamMessageAdapter() == null) {
    if (logger.isDebugEnabled()) {
      logger.debug("No stream.message.adapter set in service description, defaulting to: " + streamMessageAdapter);
    }
    throw new TransportServiceException(new Message(Messages.X_NOT_SET_IN_SERVICE_X,"stream.message.adapter",getProtocol() + " service descriptor"));
  }
  try {
    if (out == null) {
      return (UMOStreamMessageAdapter)ClassUtils.instanciateClass(streamMessageAdapter,new Object[]{in});
    }
 else {
      return (UMOStreamMessageAdapter)ClassUtils.instanciateClass(streamMessageAdapter,new Object[]{in,out});
    }
  }
 catch (  Exception e) {
    throw new TransportServiceException(new Message(Messages.FAILED_TO_CREATE_X_WITH_X,"Message Adapter",streamMessageAdapter),e);
  }
}
