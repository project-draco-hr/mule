{
  TreeMap listeners;
  String subscription=null;
  Class listenerClass=null;
  Map.Entry entry=null;
  for (Iterator iterator=eventsMap.entrySet().iterator(); iterator.hasNext(); ) {
    entry=(Map.Entry)iterator.next();
    Class eventClass=(Class)entry.getValue();
    if (event.getClass().isAssignableFrom(eventClass)) {
      listenerClass=(Class)entry.getKey();
      break;
    }
  }
  if (listenerClass == null) {
    throw new IllegalArgumentException(new Message(Messages.EVENT_TYPE_X_NOT_RECOGNISED,event.getClass().getName()).getMessage());
  }
  listeners=getListeners(listenerClass);
  UMOServerEventListener l;
synchronized (listeners) {
    for (Iterator iterator=listeners.keySet().iterator(); iterator.hasNext(); ) {
      l=(UMOServerEventListener)iterator.next();
      subscription=(String)listeners.get(l);
      if (subscription == null) {
        subscription=NULL_SUBSCRIPTION;
      }
      if (NULL_SUBSCRIPTION.equals(subscription) || new WildcardFilter(subscription).accept(event.getResourceIdentifier())) {
        l.onEvent(event);
      }
 else {
        logger.trace("Resource id '" + subscription + "' for listener "+ l.getClass().getName()+ " does not match Resource id '"+ event.getResourceIdentifier()+ "' for event, not firing event for this listener");
      }
    }
  }
}
