{
  if (obj == null) {
    logger.warn("Applying JaxenFilter to null object.");
    return false;
  }
  if (pattern == null) {
    logger.warn("Expression for JaxenFilter is not set.");
    return false;
  }
  if (expectedValue == null) {
    if (pattern.endsWith("= null") || pattern.endsWith("=null")) {
      expectedValue="null";
      pattern=pattern.substring(0,pattern.lastIndexOf("="));
    }
 else {
      if (logger.isInfoEnabled()) {
        logger.info("Expected value for JaxenFilter is not set, using 'true' by default");
      }
      expectedValue=Boolean.TRUE.toString();
    }
  }
  Object xpathResult=null;
  boolean accept=false;
  if (obj instanceof Document) {
    xpathResult=getDom4jXPath().valueOf((Document)obj);
  }
 else   if (obj instanceof DOMSource) {
    xpathResult=getDOMXPath().valueOf(obj);
  }
 else   if (obj instanceof org.w3c.dom.Document) {
    xpathResult=getDOMXPath().valueOf(obj);
  }
 else {
    if (logger.isDebugEnabled()) {
      logger.debug("Passing object of type " + obj.getClass().getName() + " to JaxenContext");
    }
    xpathResult=getJavaBeanXPath().valueOf(obj);
  }
  if (logger.isDebugEnabled()) {
    logger.debug("JaxenFilter Expression result = '" + xpathResult + "' -  Expected value = '"+ expectedValue+ "'");
  }
  if (xpathResult != null) {
    accept=xpathResult.toString().equals(expectedValue);
  }
 else {
    if (expectedValue.equals("null")) {
      accept=true;
    }
 else {
      logger.warn("JaxenFilter expression evaluates to null: " + pattern);
    }
  }
  if (logger.isDebugEnabled()) {
    logger.debug("JaxenFilter accept object  : " + accept);
  }
  return accept;
}
