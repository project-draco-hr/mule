{
  Object data=event.getMessage().getPayload();
  OutputStream out=connector.getOutputStream(getEndpoint(),event);
  try {
    if (data instanceof InputStream) {
      InputStream is=((InputStream)data);
      IOUtils.copy(is,out);
      is.close();
    }
 else     if (data instanceof OutputHandler) {
      ((OutputHandler)data).write(event,out);
    }
 else {
      byte[] dataBytes;
      if (data instanceof byte[]) {
        dataBytes=(byte[])data;
      }
 else {
        dataBytes=data.toString().getBytes(event.getEncoding());
      }
      IOUtils.write(dataBytes,out);
    }
  }
  finally {
    out.close();
  }
}
