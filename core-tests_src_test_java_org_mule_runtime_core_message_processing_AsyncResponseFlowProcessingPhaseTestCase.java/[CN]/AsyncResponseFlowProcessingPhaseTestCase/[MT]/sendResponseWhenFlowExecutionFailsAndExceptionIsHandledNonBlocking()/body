{
  when(mockTemplate.routeEvent(any(MuleEvent.class))).thenThrow(mockMessagingException);
  when(mockMessagingException.handled()).thenReturn(true);
  final Latch latch=new Latch();
  when(mockMuleEvent.isAllowNonBlocking()).thenReturn(true);
  phase.runPhase(mockTemplate,mockContext,mockNotifier);
  verify(mockTemplate).sendResponseToClient(any(MuleEvent.class),any(ResponseCompletionCallback.class));
  verifyOnlySuccessfulWasCalled();
}
