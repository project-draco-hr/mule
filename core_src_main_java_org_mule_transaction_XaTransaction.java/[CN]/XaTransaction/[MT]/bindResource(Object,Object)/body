{
synchronized (this) {
    if (resources == null) {
      resources=new HashMap();
    }
    if (resources.containsKey(key)) {
      throw new IllegalTransactionStateException(new Message(Messages.TX_RESOURCE_ALREADY_LISTED_FOR_KEY_X,key));
    }
    resources.put(key,resource);
  }
}
