{
  UMOEndpoint endpoint=getEndpoint(t);
  if (endpoint != null) {
    try {
      logger.error("Message being processed is: " + (message == null ? "null" : message.toString()));
      UMOEventContext ctx=RequestContext.getEventContext();
      String component="Unknown";
      UMOEndpointURI endpointUri=null;
      if (ctx != null) {
        component=ctx.getComponentDescriptor().getName();
        endpointUri=ctx.getEndpointURI();
      }
 else       if (failedEndpoint != null) {
        endpointUri=failedEndpoint.getEndpointURI();
      }
      ExceptionMessage msg=null;
      msg=new ExceptionMessage(getErrorMessagePayload(message),t,component,endpointUri);
      UMOMessage exceptionMessage=null;
      if (ctx == null) {
        exceptionMessage=new MuleMessage(msg);
      }
 else {
        exceptionMessage=new MuleMessage(msg,ctx.getMessage());
      }
      UMOEvent exceptionEvent=new MuleEvent(exceptionMessage,endpoint,new MuleSession(exceptionMessage,new MuleSessionHandler()),true);
      RequestContext.setEvent(exceptionEvent);
      endpoint.getConnector().getDispatcher(endpoint).send(exceptionEvent);
      if (logger.isDebugEnabled()) {
        logger.debug("routed Exception message via " + endpoint);
      }
    }
 catch (    UMOException e) {
      logFatal(message,e);
    }
  }
 else {
    markTransactionForRollback();
  }
}
