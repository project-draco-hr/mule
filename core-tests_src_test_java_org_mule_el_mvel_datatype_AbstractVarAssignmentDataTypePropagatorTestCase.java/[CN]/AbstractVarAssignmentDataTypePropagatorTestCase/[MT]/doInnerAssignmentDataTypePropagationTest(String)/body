{
  final DataType expectedDataType=DataTypeFactory.create(Map.class,UNKNOWN);
  expectedDataType.setEncoding(CUSTOM_ENCODING);
  MuleEvent testEvent=getTestEvent(TEST_MESSAGE);
  final Map<String,String> propertyValue=new HashMap<>();
  propertyValue.put(INNER_PROPERTY_NAME,TEST_MESSAGE);
  setVariable(testEvent,propertyValue,expectedDataType);
  CompiledExpression compiledExpression=compileMelExpression(expression,testEvent);
  dataTypePropagator.propagate(testEvent,new TypedValue(propertyValue,DataType.STRING_DATA_TYPE),compiledExpression);
  assertThat(getVariableDataType(testEvent),like(Map.class,UNKNOWN,CUSTOM_ENCODING));
}
