{
  Object cId=getReplyAggregateIdentifier(event.getMessage());
  if (cId == null || cId.equals("-1")) {
    throw new RoutingException(new Message(Messages.NO_CORRELATION_ID),event.getMessage(),event.getEndpoint());
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Adding event to response aggregator group: " + cId);
  }
  EventGroup eg=(EventGroup)eventGroups.get(cId);
  if (eg == null) {
    eg=createEventGroup(cId,event);
    EventGroup previous=(EventGroup)eventGroups.putIfAbsent(eg.getGroupId(),eg);
    if (previous != null) {
      eg=previous;
    }
  }
  eg.addEvent(event);
  return eg;
}
