{
  tm=muleContext.getTransactionManager();
  tm.begin();
  MuleClient client=muleContext.getClient();
  client.send("vm://entry?connector=vm-normal","OK",null);
  tm.commit();
  assertThat(client.request("queue2",WAIT).getRight().isPresent(),is(false));
  try {
    client.send("vm://entry?connector=vm-normal","OK",null);
    fail("Exception expected");
  }
 catch (  Exception e) {
    assertTrue(ExceptionUtils.getRootCause(e) instanceof IllegalTransactionStateException);
  }
}
