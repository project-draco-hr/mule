{
  for (int i=0; i < endpoints.size(); i++) {
    UMOEndpoint endpoint=(UMOEndpoint)endpoints.get(i);
    try {
      if (endpoint.getFilter() == null || endpoint.getFilter().accept(message)) {
        if (logger.isDebugEnabled()) {
          logger.debug("Endpoint filter matched for node " + i + ". Routing message over: "+ endpoint.getEndpointURI().toString());
        }
        return endpoint;
      }
 else {
        if (logger.isDebugEnabled()) {
          logger.debug("Endpoint filter did not match");
        }
      }
    }
 catch (    Exception e) {
      logger.error("Unable to create message for node at position " + i,e);
      return null;
    }
  }
  return null;
}
