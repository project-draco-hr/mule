{
  String cnnFactoryName=props.getProperty(JNDI_XAQUEUE_CONECTION_NAME_PROPERTY);
  if (cnnFactoryName == null) {
    throw new IOException("You must set the property " + JNDI_XAQUEUE_CONECTION_NAME_PROPERTY + "in the JNDI property file");
  }
  Context ctx=new InitialContext(props);
  XAQueueConnectionFactory qcf=(XAQueueConnectionFactory)lookupObject(ctx,cnnFactoryName);
  XAQueueConnection cnn;
  String username=(String)props.get("username");
  if (username != null) {
    String password=(String)props.get("password");
    cnn=qcf.createXAQueueConnection(username,password);
  }
 else {
    cnn=qcf.createXAQueueConnection();
  }
  cnn.start();
  return cnn;
}
