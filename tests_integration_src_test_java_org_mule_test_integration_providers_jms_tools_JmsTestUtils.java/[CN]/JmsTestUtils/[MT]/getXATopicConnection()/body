{
  Properties props=getJmsProperties();
  String cnnFactoryName=props.getProperty(JNDI_XATOPIC_CONECTION_NAME_PROPERTY);
  if (cnnFactoryName == null) {
    throw new IOException("You must set the property " + JNDI_XAQUEUE_CONECTION_NAME_PROPERTY + "in the JNDI property file");
  }
  Context ctx=new InitialContext(props);
  XATopicConnectionFactory tcf=(XATopicConnectionFactory)lookupObject(ctx,cnnFactoryName);
  XATopicConnection cnn;
  String username=(String)props.get("username");
  if (username != null) {
    String password=(String)props.get("password");
    cnn=tcf.createXATopicConnection(username,password);
  }
 else {
    cnn=tcf.createXATopicConnection();
  }
  cnn.start();
  return cnn;
}
