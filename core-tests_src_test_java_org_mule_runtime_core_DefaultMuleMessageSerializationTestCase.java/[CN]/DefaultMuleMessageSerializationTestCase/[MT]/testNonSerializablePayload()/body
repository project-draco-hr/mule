{
  muleContext.getRegistry().registerTransformer(new NonSerializableToByteArray());
  final InternalMessage message=InternalMessage.builder().payload(new NonSerializable()).addOutboundProperty("foo","bar").build();
  Flow flow=getTestFlow();
  setCurrentEvent(Event.builder(DefaultEventContext.create(flow,TEST_CONNECTOR)).message(message).flow(flow).build());
  InternalMessage deserializedMessage=serializationRoundtrip(message);
  assertTrue(deserializedMessage.getPayload().getValue() instanceof byte[]);
  assertEquals(INNER_TEST_MESSAGE,getPayloadAsString(deserializedMessage));
}
