{
  InputStream stream=new ByteArrayInputStream(TEST_MESSAGE.getBytes());
  MutableMuleMessage message=new DefaultMuleMessage(stream);
  message.setOutboundProperty("foo","bar");
  RequestContext.setEvent(new DefaultMuleEvent(message,getTestFlow()));
  MuleMessage deserializedMessage=serializationRoundtrip(message);
  assertEquals(byte[].class,deserializedMessage.getPayload().getClass());
  byte[] payload=(byte[])deserializedMessage.getPayload();
  assertTrue(Arrays.equals(TEST_MESSAGE.getBytes(),payload));
}
