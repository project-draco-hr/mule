{
  InputStream stream=new ByteArrayInputStream(TEST_MESSAGE.getBytes());
  final InternalMessage message=InternalMessage.builder().payload(stream).addOutboundProperty("foo","bar").build();
  Flow flow=getTestFlow();
  setCurrentEvent(Event.builder(DefaultEventContext.create(flow,TEST_CONNECTOR)).message(message).flow(flow).build());
  InternalMessage deserializedMessage=serializationRoundtrip(message);
  assertEquals(byte[].class,deserializedMessage.getPayload().getDataType().getType());
  byte[] payload=(byte[])deserializedMessage.getPayload().getValue();
  assertTrue(Arrays.equals(TEST_MESSAGE.getBytes(),payload));
}
