{
  ManagedMap managedMap=new ManagedMap();
  List<Element> childDomElements=DomUtils.getChildElementsByTagName(element,childElementName);
  if (childDomElements.size() == 0) {
    childDomElements=DomUtils.getChildElements(element);
  }
  for (  Element childDomElement : childDomElements) {
    Object key=null;
    if (hasAttribute(childDomElement,"key-ref")) {
      key=new RuntimeBeanReference(childDomElement.getAttribute("key-ref"));
    }
 else {
      if (hasAttribute(childDomElement,"key")) {
        key=childDomElement.getAttribute("key");
      }
 else {
        key=childDomElement.getTagName();
      }
    }
    if (hasAttribute(childDomElement,"value-ref")) {
      if (!isMuleExpression(childDomElement.getAttribute("value-ref"))) {
        managedMap.put(key,new RuntimeBeanReference(childDomElement.getAttribute("value-ref")));
      }
 else {
        managedMap.put(key,childDomElement.getAttribute("value-ref"));
      }
    }
 else {
      managedMap.put(key,parserDelegate.parse(childDomElement));
    }
  }
  return managedMap;
}
