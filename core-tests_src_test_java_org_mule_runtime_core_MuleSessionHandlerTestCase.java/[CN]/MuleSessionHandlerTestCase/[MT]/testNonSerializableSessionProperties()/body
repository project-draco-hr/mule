{
  MuleMessage message=MuleMessage.builder().payload("Test Message").build();
  MuleEvent event=new DefaultMuleEvent(message,MuleTestUtils.getTestFlow(muleContext));
  SessionHandler handler=new SerializeAndEncodeSessionHandler();
  NotSerializableClass clazz=new NotSerializableClass();
  event.getSession().setProperty("foo",clazz);
  message=handler.storeSessionInfoToMessage(event.getSession(),event.getMessage(),muleContext);
  event.setMessage(message);
  Serializable s=removeProperty(event);
  message=MuleMessage.builder(event.getMessage()).addInboundProperty(MULE_SESSION_PROPERTY,s).build();
  MuleSession session=handler.retrieveSessionInfoFromMessage(message,muleContext);
  assertNull(session.getProperty("foo"));
}
