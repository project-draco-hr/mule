{
  if (expression == null) {
    return null;
  }
  boolean required;
  if (expression.endsWith(OPTIONAL_ARGUMENT)) {
    expression=expression.substring(expression.length() - OPTIONAL_ARGUMENT.length());
    required=false;
  }
 else {
    required=true;
  }
  DataHandler dh=message.getAttachment(expression);
  if (dh == null && required) {
    throw new RequiredValueException(CoreMessages.expressionEvaluatorReturnedNull(NAME,expression));
  }
  return dh;
}
