{
  File tmpDir=File.createTempFile("mule-file-test-","-dir");
  tmpDir.delete();
  tmpDir.mkdir();
  tmpDir.deleteOnExit();
  File target=File.createTempFile("mule-file-test-",".txt",tmpDir);
  Writer out=new FileWriter(target);
  out.write(TEST_MESSAGE);
  out.close();
  target.deleteOnExit();
  FileConnector connector=(FileConnector)muleContext.getRegistry().lookupConnector("receiveConnector");
  connector.setReadFromDirectory(tmpDir.getAbsolutePath());
  logger.debug("Directory is " + connector.getReadFromDirectory());
  waitForFileSystem();
  return target;
}
