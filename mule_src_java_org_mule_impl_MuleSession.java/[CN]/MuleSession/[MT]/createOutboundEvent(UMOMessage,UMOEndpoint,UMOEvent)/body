{
  logger.debug("Creating event with data: " + message.getPayload().getClass().getName() + ", for endpoint: "+ endpoint.toString());
  if (endpoint == null) {
    throw new MuleException("When creating an event the proivder cannot be null");
  }
  if (message == null) {
    throw new MuleException("When creating an event the data and/or the properties must be set");
  }
  if (endpoint.getTransformer() == null) {
    if (endpoint.getConnector() instanceof AbstractConnector) {
      endpoint.setTransformer(((AbstractConnector)endpoint.getConnector()).getDefaultOutboundTransformer());
      logger.debug("Using default connector outbound transformer: " + endpoint.getTransformer());
    }
  }
  try {
    UMOEvent event;
    if (previousEvent != null) {
      event=new MuleEvent(message,endpoint,component,previousEvent);
    }
 else {
      event=new MuleEvent(message,endpoint,this,false,null);
    }
    return event;
  }
 catch (  Exception e) {
    throw new MuleException("Failed to create event using endpoint: " + endpoint.getConnector().getClass().getName(),e);
  }
}
