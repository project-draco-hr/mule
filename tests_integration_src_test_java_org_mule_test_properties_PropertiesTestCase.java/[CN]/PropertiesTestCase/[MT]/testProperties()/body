{
  MuleClient client=new MuleClient(muleContext);
  Map<String,FunctionalTestComponent> components=muleContext.getRegistry().lookupByType(FunctionalTestComponent.class);
  Map properties=new HashMap();
  properties.put("outbound1","yes");
  properties.put("outbound2","no");
  MuleMessage response=client.send("vm://in","OK",properties);
  assertEquals(response.getPayloadAsString(),"OK(success)");
  assertNull(response.getInboundProperty("outbound1"));
  assertNull(response.getInboundProperty("outbound2"));
  assertNull(response.getOutboundProperty("outbound1"));
  assertNull(response.getOutboundProperty("outbound2"));
  assertEquals("123",response.getInboundProperty("outbound3"));
  assertEquals("456",response.getInboundProperty("outbound4"));
  client.dispatch("vm://inQueue","OK",properties);
  Thread.sleep(1000);
  response=client.request("vm://outQueue",0);
  assertEquals(response.getPayloadAsString(),"OK");
  assertEquals("yes",response.getInboundProperty("outbound1"));
  assertEquals("no",response.getInboundProperty("outbound2"));
  assertNull(response.getOutboundProperty("outbound1"));
  assertNull(response.getOutboundProperty("outbound2"));
}
