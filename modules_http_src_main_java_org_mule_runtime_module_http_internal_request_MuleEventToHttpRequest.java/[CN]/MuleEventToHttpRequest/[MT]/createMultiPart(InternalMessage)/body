{
  Map<String,DataHandler> attachments=Maps.newHashMap();
  for (  String outboundAttachmentName : msg.getOutboundAttachmentNames()) {
    attachments.put(outboundAttachmentName,msg.getOutboundAttachment(outboundAttachmentName));
  }
  if (msg.getPayload().getValue() instanceof MultiPartContent) {
    for (    org.mule.runtime.api.message.Message part : ((MultiPartContent)msg.getPayload().getValue()).getParts()) {
      final String partName=((PartAttributes)part.getAttributes()).getName();
      attachments.put(partName,toDataHandler(partName,part.getPayload().getValue(),part.getPayload().getDataType().getMediaType()));
    }
  }
  return new MultipartHttpEntity(HttpPartDataSource.createFrom(attachments));
}
