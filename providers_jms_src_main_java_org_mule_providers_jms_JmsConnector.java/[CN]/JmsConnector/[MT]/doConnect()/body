{
  try {
    if (connectionFactoryClass != null) {
      connectionFactory=(ConnectionFactory)ClassUtils.instanciateClass(connectionFactoryClass,ClassUtils.NO_ARGS);
    }
    if (connectionFactory == null || jndiInitialFactory != null) {
      initJndiContext();
    }
 else {
      jndiDestinations=false;
      forceJndiDestinations=false;
    }
    if (jmsSupport == null) {
      if (JmsConstants.JMS_SPECIFICATION_102B.equals(specification)) {
        jmsSupport=new Jms102bSupport(this,jndiContext,jndiDestinations,forceJndiDestinations);
      }
 else {
        jmsSupport=new Jms11Support(this,jndiContext,jndiDestinations,forceJndiDestinations);
      }
    }
    if (connectionFactory == null) {
      connectionFactory=createConnectionFactory();
    }
    if (connectionFactoryProperties != null && !connectionFactoryProperties.isEmpty()) {
      BeanUtils.populateWithoutFail(connectionFactory,connectionFactoryProperties,true);
    }
  }
 catch (  Exception e) {
    throw new ConnectException(new Message(Messages.FAILED_TO_CREATE_X,"Jms Connector"),e,this);
  }
  try {
    connection=createConnection();
    if (started.get()) {
      connection.start();
    }
  }
 catch (  Exception e) {
    throw new ConnectException(e,this);
  }
}
