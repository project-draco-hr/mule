{
  OutboundEndpoint endpoint=null;
  try {
    if (recipient instanceof EndpointURI) {
      endpoint=getRecipientEndpointFromUri((EndpointURI)recipient);
    }
 else     if (recipient instanceof String) {
      endpoint=getRecipientEndpointFromString(message,(String)recipient);
    }
    if (null == endpoint) {
      throw new RegistrationException("Failed to create endpoint for: " + recipient);
    }
    OutboundEndpoint existingEndpoint=(OutboundEndpoint)recipientCache.putIfAbsent(recipient,endpoint);
    if (existingEndpoint != null) {
      endpoint=existingEndpoint;
    }
  }
 catch (  MuleException e) {
    throw new RoutingException(message,endpoint,e);
  }
  return endpoint;
}
