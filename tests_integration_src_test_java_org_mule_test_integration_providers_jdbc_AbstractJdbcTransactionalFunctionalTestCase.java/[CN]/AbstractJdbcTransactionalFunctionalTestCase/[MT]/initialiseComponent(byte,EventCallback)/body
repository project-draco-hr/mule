{
  UMODescriptor descriptor=new MuleDescriptor();
  descriptor.setExceptionListener(new DefaultExceptionStrategy());
  descriptor.setName("testComponent");
  descriptor.setServiceFactory(new SimpleObjectFactory(JdbcFunctionalTestComponent.class));
  UMOTransactionFactory tf=getTransactionFactory();
  UMOTransactionConfig txConfig=new MuleTransactionConfig();
  txConfig.setFactory(tf);
  txConfig.setAction(txBeginAction);
  UMOEndpointBuilder endpointBuilder=new EndpointURIEndpointBuilder(getInDest(),managementContext);
  endpointBuilder.setName("testIn");
  endpointBuilder.setConnector(connector);
  endpointBuilder.setTransactionConfig(txConfig);
  UMOImmutableEndpoint endpoint=managementContext.getRegistry().lookupEndpointFactory().getInboundEndpoint(endpointBuilder,managementContext);
  UMOEndpointBuilder endpointBuilder2=new EndpointURIEndpointBuilder(getOutDest(),managementContext);
  endpointBuilder2.setName("testOut");
  endpointBuilder2.setConnector(connector);
  UMOImmutableEndpoint outProvider=managementContext.getRegistry().lookupEndpointFactory().getOutboundEndpoint(endpointBuilder2,managementContext);
  descriptor.setOutboundRouter(new OutboundRouterCollection());
  OutboundPassThroughRouter router=new OutboundPassThroughRouter();
  router.addEndpoint(outProvider);
  descriptor.getOutboundRouter().addRouter(router);
  descriptor.setInboundRouter(new InboundRouterCollection());
  descriptor.getInboundRouter().addEndpoint(endpoint);
  HashMap props=new HashMap();
  props.put("eventCallback",callback);
  descriptor.setProperties(props);
  descriptor.setModelName(model.getName());
  managementContext.getRegistry().registerService(descriptor);
  UMOComponent component=model.getComponent(descriptor.getName());
  return component;
}
