{
  final AtomicBoolean called=new AtomicBoolean(false);
  EventCallback callback=new EventCallback(){
    public void eventReceived(    UMOEventContext context,    Object component) throws Exception {
      try {
        called.set(true);
        currentTx=context.getCurrentTransaction();
        assertNotNull(currentTx);
        assertTrue(currentTx.isBegun());
        currentTx.setRollbackOnly();
      }
  finally {
synchronized (called) {
          called.notifyAll();
        }
      }
    }
  }
;
  initialiseComponent(UMOTransactionConfig.ACTION_ALWAYS_BEGIN,callback);
  muleContext.start();
  execSqlUpdate("INSERT INTO TEST(TYPE, DATA, ACK, RESULT) VALUES (1, '" + DEFAULT_MESSAGE + "', NULL, NULL)");
synchronized (called) {
    called.wait(20000);
  }
  assertTrue(called.get());
  Thread.sleep(1000);
  assertTrue(rollbacked);
  Object[] obj=execSqlQuery("SELECT COUNT(*) FROM TEST WHERE TYPE = 2");
  assertNotNull(obj);
  assertEquals(1,obj.length);
  assertEquals(new Integer(0),obj[0]);
  obj=execSqlQuery("SELECT ACK FROM TEST WHERE TYPE = 1");
  assertNotNull(obj);
  assertEquals(1,obj.length);
  assertNull(obj[0]);
}
