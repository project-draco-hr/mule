{
  if (counter != null) {
    return counter;
  }
  boolean counterExists=store.contains(messageId);
  if (counterExists) {
    return store.retrieve(messageId);
  }
  if (create) {
    try {
      counter=new AtomicInteger();
      store.store(messageId,counter);
    }
 catch (    ObjectAlreadyExistsException e) {
      counter=store.retrieve(messageId);
    }
  }
  return counter;
}
