{
  MuleMessageCollection parentCollection=new DefaultMessageCollection(muleContext);
  MuleMessageCollection childCollection1=new DefaultMessageCollection(muleContext);
  MuleMessageCollection childCollection2=new DefaultMessageCollection(muleContext);
  MuleMessage msg;
  msg=new DefaultMuleMessage("a1",muleContext);
  childCollection1.addMessage(msg);
  msg=new DefaultMuleMessage("a2",muleContext);
  childCollection1.addMessage(msg);
  msg=new DefaultMuleMessage("a3",muleContext);
  childCollection1.addMessage(msg);
  msg=new DefaultMuleMessage("b1",muleContext);
  childCollection2.addMessage(msg);
  msg=new DefaultMuleMessage("b2",muleContext);
  childCollection2.addMessage(msg);
  msg=new DefaultMuleMessage("c1",muleContext);
  childCollection2.addMessage(msg);
  parentCollection.addMessage(childCollection1);
  parentCollection.addMessage(childCollection2);
  nestedForeach.process(getTestEvent(parentCollection));
  assertNestedProcessedMessages();
}
