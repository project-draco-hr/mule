{
  if (collectionExpression != null) {
    ExpressionConfig config=new ExpressionConfig();
    config.setExpression(checkEvaluator(collectionExpression));
    splitter=new ExpressionSplitter(config);
    if (collectionExpression.startsWith(XPATH_PREFIX)) {
      DataType<Document> docType=new SimpleDataType<Document>(Document.class);
      try {
        xml2dom=muleContext.getRegistry().lookupTransformer(DataTypeFactory.XML_STRING,docType);
        dom2xml=muleContext.getRegistry().lookupTransformer(docType,DataTypeFactory.XML_STRING);
      }
 catch (      TransformerException e) {
        throw new InitialisationException(e,this);
      }
    }
  }
 else {
    splitter=new CollectionMapSplitter();
  }
  splitter.setBatchSize(batchSize);
  splitter.setCounterVariableName(counterVariableName);
  splitter.setMuleContext(muleContext);
  messageProcessors.add(0,splitter);
  try {
    this.ownedMessageProcessor=new DefaultMessageProcessorChainBuilder().chain(messageProcessors).build();
  }
 catch (  MuleException e) {
    throw new InitialisationException(e,this);
  }
  super.initialise();
}
