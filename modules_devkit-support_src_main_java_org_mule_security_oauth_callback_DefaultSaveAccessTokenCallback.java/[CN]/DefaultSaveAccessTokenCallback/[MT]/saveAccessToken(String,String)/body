{
  MuleEvent event=RequestContext.getEvent();
  if (accessToken != null) {
    event.getMessage().setInvocationProperty("OAuthAccessToken",accessToken);
  }
  if (accessTokenSecret != null) {
    event.getMessage().setInvocationProperty("OAuthAccessTokenSecret",accessTokenSecret);
  }
  if (messageProcessor instanceof MuleContextAware) {
    ((MuleContextAware)messageProcessor).setMuleContext(RequestContext.getEventContext().getMuleContext());
  }
  if (messageProcessor instanceof FlowConstructAware) {
    ((FlowConstructAware)messageProcessor).setFlowConstruct(RequestContext.getEventContext().getFlowConstruct());
  }
  if (!hasBeenInitialized) {
    if (messageProcessor instanceof Initialisable) {
      try {
        ((Initialisable)messageProcessor).initialise();
      }
 catch (      Exception e) {
        logger.error(e.getMessage(),e);
      }
    }
    hasBeenInitialized=true;
  }
  if (!hasBeenStarted) {
    if (messageProcessor instanceof Startable) {
      try {
        ((Startable)messageProcessor).start();
      }
 catch (      Exception e) {
        logger.error(e.getMessage(),e);
      }
    }
    hasBeenStarted=true;
  }
  try {
    messageProcessor.process(event);
  }
 catch (  Exception e) {
    logger.error(e.getMessage(),e);
  }
}
