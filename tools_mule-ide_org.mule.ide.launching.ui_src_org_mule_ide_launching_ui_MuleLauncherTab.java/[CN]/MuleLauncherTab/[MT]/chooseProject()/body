{
  IProject[] projects;
  projects=getWorkspaceRoot().getProjects();
  ILabelProvider labelProvider=new WorkbenchLabelProvider();
  ElementListSelectionDialog dialog=new ElementListSelectionDialog(getShell(),labelProvider);
  dialog.setTitle("Choose Project");
  dialog.setMessage("Select the project containing the classes you wish to launch a Mule configuration for.");
  dialog.setElements(projects);
  IProject aProject=getProject();
  if (aProject != null) {
    dialog.setInitialSelections(new Object[]{aProject});
  }
  if (dialog.open() == Window.OK) {
    IProject project=(IProject)dialog.getFirstResult();
    try {
      if (!project.hasNature(MuleConfigNature.NATURE_ID)) {
        if (MessageDialog.openQuestion(getShell(),"Choose project","The selected project is not associated with Mule. Would you like to associate '" + project.getName() + "' with Mule?")) {
          MuleCorePlugin.getDefault().setMuleNature(project,true);
        }
      }
    }
 catch (    CoreException e) {
      MessageDialog.openError(getShell(),"Set project nature","Unable to set project nature: " + e.getLocalizedMessage());
    }
    return project;
  }
  return null;
}
