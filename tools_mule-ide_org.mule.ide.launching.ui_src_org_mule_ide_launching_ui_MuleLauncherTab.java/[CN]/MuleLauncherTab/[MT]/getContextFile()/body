{
  IWorkbenchWindow window=PlatformUI.getWorkbench().getActiveWorkbenchWindow();
  if (window == null)   return null;
  IWorkbenchPage page=window.getActivePage();
  if (page == null)   return null;
  ISelection selection=page.getSelection();
  IResource aFile=null;
  if (selection instanceof IStructuredSelection) {
    IStructuredSelection ss=(IStructuredSelection)selection;
    if (!ss.isEmpty()) {
      Object obj=ss.getFirstElement();
      if (obj instanceof IResource) {
        aFile=(IResource)obj;
      }
    }
  }
  IEditorPart part=page.getActiveEditor();
  if (part != null) {
    IEditorInput input=part.getEditorInput();
    aFile=(IResource)input.getAdapter(IResource.class);
  }
  return aFile;
}
