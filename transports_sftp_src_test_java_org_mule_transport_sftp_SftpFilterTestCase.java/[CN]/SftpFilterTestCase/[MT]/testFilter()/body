{
  MuleClient muleClient=new MuleClient(muleContext);
  HashMap<String,Object> txtProps=new HashMap<String,Object>();
  txtProps.put(SftpConnector.PROPERTY_FILENAME,FILENAME);
  muleClient.dispatch(getAddressByEndpoint(muleClient,INBOUND_ENDPOINT_NAME),TEST_MESSAGE,txtProps);
  DispatchParameters dp=new DispatchParameters(INBOUND_ENDPOINT_NAME,OUTBOUND_ENDPOINT_NAME);
  dp.setFilename("file.xml");
  dispatchAndWaitForDelivery(dp);
  SftpClient outboundSftpClient=getSftpClient(muleClient,OUTBOUND_ENDPOINT_NAME);
  ImmutableEndpoint outboundEndpoint=(ImmutableEndpoint)muleClient.getProperty(OUTBOUND_ENDPOINT_NAME);
  SftpClient inboundSftpClient=getSftpClient(muleClient,INBOUND_ENDPOINT_NAME);
  ImmutableEndpoint inboundEndpoint=(ImmutableEndpoint)muleClient.getProperty(INBOUND_ENDPOINT_NAME);
  assertFalse("The xml file should not be left in the inbound directory",verifyFileExists(inboundSftpClient,inboundEndpoint.getEndpointURI().getPath(),"file.xml"));
  assertTrue("The xml file should be in the outbound directory",verifyFileExists(outboundSftpClient,outboundEndpoint.getEndpointURI().getPath(),"file.xml"));
  assertTrue("The txt file should be left in the inbound directory",verifyFileExists(inboundSftpClient,inboundEndpoint.getEndpointURI().getPath(),FILENAME));
  assertFalse("The txt file should not be in the outbound directory",verifyFileExists(outboundSftpClient,outboundEndpoint.getEndpointURI().getPath(),FILENAME));
}
