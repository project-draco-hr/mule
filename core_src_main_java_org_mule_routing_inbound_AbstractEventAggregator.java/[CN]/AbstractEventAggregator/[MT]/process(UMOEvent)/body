{
  UMOEvent[] result=null;
  if (this.isMatch(event)) {
    boolean miss=false;
    final Object groupId=this.getEventGroupIdForEvent(event);
    while (true) {
      if (miss) {
        try {
          Thread.sleep(1);
        }
 catch (        InterruptedException interrupted) {
          Thread.currentThread().interrupt();
        }
      }
      EventGroup group=this.getEventGroup(groupId);
      if (group == null) {
        group=this.addEventGroup(this.createEventGroup(event,groupId));
      }
synchronized (group) {
        if (group != this.getEventGroup(groupId)) {
          miss=true;
          continue;
        }
        group.addEvent(event);
        if (this.shouldAggregateEvents(group)) {
          UMOMessage returnMessage=this.aggregateEvents(group);
          UMOEndpoint endpoint=new MuleEndpoint(event.getEndpoint());
          endpoint.setTransformer(null);
          endpoint.setName(this.getClass().getName());
          UMOEvent returnEvent=new MuleEvent(returnMessage,endpoint,event.getComponent(),event);
          result=new UMOEvent[]{returnEvent};
          this.removeEventGroup(group);
        }
        break;
      }
    }
  }
  return result;
}
