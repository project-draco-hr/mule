{
  FTPClient client=null;
  try {
    client=connector.createFtpClient(endpoint);
    FTPFile fileToProcess=findFileToProcess(client);
    if (fileToProcess == null) {
      return null;
    }
    fileToProcess=prepareFile(client,fileToProcess);
    FtpMuleMessageFactory muleMessageFactory=createMuleMessageFactory(client);
    return muleMessageFactory.create(fileToProcess,endpoint.getEncoding());
  }
  finally {
    connector.releaseFtp(endpoint.getEndpointURI(),client);
  }
}
