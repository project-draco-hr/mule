{
  if (factoryProperties == null) {
    factoryProperties=new Properties();
  }
  factoryProperties.setProperty("org.quartz.threadPool.class","org.quartz.simpl.SimpleThreadPool");
  factoryProperties.setProperty("org.quartz.threadPool.threadCount",String.valueOf(getReceiverThreadingProfile().getMaxThreadsActive()));
  String instanceName=factoryProperties.getProperty(QUARTZ_INSTANCE_NAME_PROPERTY);
  if (instanceName == null) {
    factoryProperties.setProperty(QUARTZ_INSTANCE_NAME_PROPERTY,"scheduler-" + muleContext.getConfiguration().getId());
  }
 else {
    ensureUniqueInstanceNameBetweenMuleApps(instanceName);
  }
  try {
    if (quartzScheduler == null) {
      SchedulerFactory factory=new StdSchedulerFactory(factoryProperties);
      quartzScheduler=factory.getScheduler();
    }
    quartzScheduler.getContext().put(MuleProperties.MULE_CONTEXT_PROPERTY,muleContext);
  }
 catch (  Exception e) {
    throw new InitialisationException(CoreMessages.initialisationFailure("Quartz connector"),e,this);
  }
}
