{
  MuleClient client=new MuleClient(muleContext);
  MuleMessage message=client.send("vm://allAnnotated",muleMessage);
  assertNotNull("return message from MuleClient.send() should not be null",message);
  assertTrue("Message payload should be a Map",message.getPayload() instanceof Map);
  Map<?,?> result=(Map<?,?>)message.getPayload();
  assertEquals(3,result.size());
  assertEquals("test",result.get("payload"));
  assertNotNull(result.get("inboundHeaders"));
  Map<?,?> headers=(Map<?,?>)result.get("inboundHeaders");
  assertEquals(2,headers.size());
  assertEquals("fooValue",headers.get("foo"));
  assertEquals("barValue",headers.get("bar"));
  assertNotNull(result.get("inboundAttachments"));
  Map<?,?> attachments=(Map<?,?>)result.get("inboundAttachments");
  assertEquals(3,attachments.size());
  assertNotNull(attachments.get("foo"));
  assertNotNull(attachments.get("bar"));
  assertNotNull(attachments.get("baz"));
}
