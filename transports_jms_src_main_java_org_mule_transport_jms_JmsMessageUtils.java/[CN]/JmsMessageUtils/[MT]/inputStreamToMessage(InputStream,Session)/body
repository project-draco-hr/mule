{
  StreamMessage streamMessage=session.createStreamMessage();
  byte[] buffer=new byte[4096];
  int len;
  try {
    while ((len=value.read(buffer)) != -1) {
      streamMessage.writeBytes(buffer,0,len);
    }
  }
 catch (  IOException e) {
    throw new JMSException("Failed to read input stream to create a stream message: " + e);
  }
 finally {
    IOUtils.closeQuietly(value);
  }
  return streamMessage;
}
