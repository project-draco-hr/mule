{
  MuleEvent restoredEvent=this.restoreOriginalEvent(event);
  this.notifyCallbackReception(event);
  try {
    OAuth2Adapter oauthAdapter=this.oauthManager.createAdapter(((String)event.getMessage().getInvocationProperty(OAuthProperties.VERIFIER)));
    if (oauthAdapter.getAccessTokenUrl() == null) {
      oauthAdapter.setAccessTokenUrl(this.getAccessTokenUrl());
    }
    oauthAdapter.fetchAccessToken(this.getRedirectUri());
    String transformedAccessTokenId=StringUtils.isBlank(this.getAccessTokenId()) ? this.oauthManager.getDefaultUnauthorizedConnector().getName() : this.getAccessTokenId();
    transformedAccessTokenId=(String)this.evaluateAndTransform(event.getMuleContext(),event,String.class,null,transformedAccessTokenId);
    this.oauthManager.getAccessTokenPoolFactory().passivateObject(transformedAccessTokenId,oauthAdapter);
    restoredEvent.getMessage().setInvocationProperty(OAuthProperties.VERIFIER,event.getMessage().getInvocationProperty(OAuthProperties.VERIFIER));
    restoredEvent.getMessage().setInvocationProperty(OAuthProperties.ACCESS_TOKEN_ID,transformedAccessTokenId);
  }
 catch (  Exception e) {
    throw new MessagingException(MessageFactory.createStaticMessage("Unable to fetch access token"),event,e);
  }
  return restoredEvent;
}
