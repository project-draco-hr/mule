{
  OutboundEndpoint endpoint1=getTestOutboundEndpoint("Test1Provider","test://test");
  assertNotNull(endpoint1);
  OutboundEndpoint endpoint2=getTestOutboundEndpoint("Test2Provider","test://test");
  assertNotNull(endpoint2);
  endpoints.clear();
  endpoints.add(endpoint1);
  endpoints.add(endpoint2);
  router.setEndpoints(endpoints);
  MuleMessage message=new DefaultMuleMessage("test event",muleContext);
  assertTrue(router.isMatch(message));
  message=new DefaultMuleMessage("test event",muleContext);
  session.expectAndReturn("sendEvent",C.eq(message,endpoints.get(0)),message);
  session.expectAndReturn("dispatchEvent",C.eq(message,endpoints.get(1)),message);
  final MuleMessage result=router.route(message,(MuleSession)session.proxy());
  assertNull("Async call shouldn't return any result.",result);
  session.verify();
}
