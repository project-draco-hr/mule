{
  if (bytes == null || bytes.length == 0 || isCompressed(bytes)) {
    return bytes;
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Compressing message of size: " + bytes.length);
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  GZIPOutputStream gos=new GZIPOutputStream(baos);
  gos.write(bytes,0,bytes.length);
  gos.finish();
  gos.close();
  byte[] compressedByteArray=baos.toByteArray();
  if (logger.isDebugEnabled()) {
    logger.debug("Compressed message to size: " + compressedByteArray.length);
  }
  return compressedByteArray;
}
