{
  TcpConnector tcpConnector=(TcpConnector)muleContext.getRegistry().lookupConnector("connectorWithException");
  assertNotNull(tcpConnector);
  MuleClient client=muleContext.getClient();
  try {
    client.send("clientWithExceptionEndpoint",TEST_MESSAGE,null);
    fail("Dispatch exception was expected");
  }
 catch (  DispatchException e) {
  }
  assertEquals(0,tcpConnector.getSocketsPoolNumActive());
}
