{
  String filename=message.getOutboundProperty(FtpConnector.PROPERTY_FILENAME);
  String outPattern=(String)endpoint.getProperty(FtpConnector.PROPERTY_OUTPUT_PATTERN);
  if (outPattern == null) {
    outPattern=message.getOutboundProperty(FtpConnector.PROPERTY_OUTPUT_PATTERN,getOutputPattern());
  }
  if (outPattern != null || filename == null) {
    filename=generateFilename(message,outPattern);
  }
  if (filename == null) {
    throw new IOException("Filename is null");
  }
  return filename;
}
