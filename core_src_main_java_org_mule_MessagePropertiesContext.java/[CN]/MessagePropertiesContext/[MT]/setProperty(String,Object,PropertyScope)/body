{
  if (scope == null) {
    setProperty(key,value);
    return;
  }
  if (PropertyScope.SESSION.equals(scope)) {
    if (RequestContext.getEvent() != null) {
      RequestContext.getEvent().getSession().setProperty(key,value);
    }
 else {
      logger.warn(String.format("Detected an attempt to set a session property, " + "but MuleEvent isn't available in this thread. Key/value: %s=%s",key,value));
    }
  }
 else {
    getScopedProperties(scope).put(key,value);
    keySet.add(key);
  }
}
