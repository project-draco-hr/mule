{
synchronized (BitronixTransactionManagerFactory.class) {
    if (!transactionManagerUsedByThisApp) {
      transactionManagerUsedByThisApp=true;
      numberOfAppsUsingTm++;
    }
    if (transactionManager != null) {
      return transactionManager;
    }
    configureTransactionLogsDirectory();
    configureUniqueServerId();
    transactionManager=TransactionManagerServices.getTransactionManager();
    registerMuleQueuesXaResource();
    transactionManager=new TransactionManagerWrapper(transactionManager,defaultXaSessionResourceProducer);
    return transactionManager;
  }
}
