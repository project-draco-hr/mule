{
  MuleClient client=muleContext.getClient();
  TestInputStream testInputStream=new TestInputStream(streamLatch);
  client.dispatch("vm://streamingDefaultIn",testInputStream,null);
  assertTrue("Request was never received in the server",requestReceivedLatch.await(RECEIVE_TIMEOUT,TimeUnit.MILLISECONDS));
  assertThat(transferEncodingHeader,equalTo("chunked"));
  MuleMessage message=client.request("vm://streamingDefaultOut",RECEIVE_TIMEOUT);
  assertTrue(message.getPayload() instanceof InputStream);
  assertThat(message.getPayloadAsString(),equalTo(DEFAULT_RESPONSE));
}
