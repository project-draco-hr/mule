{
  FTPClient client=new FTPClient();
  if (config.getConnectionTimeout() != null && config.getConnectionTimeoutUnit() != null) {
    client.setConnectTimeout(new Long(config.getConnectionTimeoutUnit().toMillis(config.getConnectionTimeout())).intValue());
  }
  try {
    if (config.getPort() != null) {
      client.connect(config.getHost(),config.getPort());
    }
 else {
      client.connect(config.getHost());
    }
    if (!FTPReply.isPositiveCompletion(client.getReplyCode())) {
      throw new IOException("Ftp connect failed: " + client.getReplyCode());
    }
    if (!client.login(username,password)) {
      throw new IOException("Ftp login failed: " + client.getReplyCode());
    }
  }
 catch (  Exception e) {
    throw new ConnectionException("Could not establish FTP connection",e);
  }
  return client;
}
