{
  String endpointName;
  if (extractorEnabled) {
    if (null == getPropertyExtractor()) {
      throw new IllegalArgumentException("No property extractor specified");
    }
    Object property=getPropertyExtractor().getProperty(getSelectorProperty(),message);
    if (!(property instanceof String)) {
      throw new IllegalArgumentException("No property for " + getSelectorProperty());
    }
    endpointName=(String)property;
  }
 else {
    endpointName=message.getStringProperty(getSelectorProperty(),null);
  }
  if (endpointName == null) {
    throw new IllegalArgumentException("selectorProperty '" + getSelectorProperty() + "' must be set on message in order to route it.");
  }
  UMOEndpoint ep=lookupEndpoint(endpointName);
  if (ep == null) {
    throw new CouldNotRouteOutboundMessageException(MessageFactory.createStaticMessage("No endpoint found with the name " + endpointName),message,ep);
  }
  try {
    if (synchronous) {
      return send(session,message,ep);
    }
 else {
      dispatch(session,message,ep);
      return null;
    }
  }
 catch (  UMOException e) {
    throw new CouldNotRouteOutboundMessageException(message,ep,e);
  }
}
