{
  if (outputType == null) {
    return getPayload();
  }
  Class inputCls=getPayload().getClass();
  if (Proxy.isProxyClass(inputCls)) {
    inputCls=inputCls.getInterfaces()[0];
  }
  if (outputType.isAssignableFrom(inputCls)) {
    return getPayload();
  }
  Transformer transformer;
  transformer=MuleServer.getMuleContext().getRegistry().lookupTransformer(inputCls,outputType);
  if (transformer == null) {
    throw new TransformerException(CoreMessages.noTransformerFoundForMessage(inputCls,outputType));
  }
  Object result=transformer.transform(this);
  if (!outputType.isAssignableFrom(result.getClass())) {
    throw new TransformerException(CoreMessages.transformOnObjectNotOfSpecifiedType(outputType.getName(),result.getClass()));
  }
  if (isPayloadConsumed(inputCls)) {
    setPayload(result);
  }
  return result;
}
