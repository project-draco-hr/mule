{
  Event muleEvent=getTestEvent("");
  NestedProcessorValueResolver resolver=new NestedProcessorValueResolver(messageProcessor);
  resolver.setMuleContext(muleContext);
  NestedProcessor nestedProcessor=resolver.resolve(muleEvent);
  Object response=nestedProcessor.process();
  assertThat((String)response,is(sameInstance(RESPONSE)));
  ArgumentCaptor<Event> captor=ArgumentCaptor.forClass(Event.class);
  verify(messageProcessor).process(captor.capture());
  Event capturedEvent=captor.getValue();
  assertThat(capturedEvent,is(muleEvent));
}
