{
  MuleEvent muleEvent=getTestEvent("");
  NestedProcessorValueResolver resolver=new NestedProcessorValueResolver(messageProcessor);
  NestedProcessor nestedProcessor=resolver.resolve(muleEvent);
  Object response=nestedProcessor.process();
  assertThat((String)response,is(sameInstance(RESPONSE)));
  ArgumentCaptor<MuleEvent> captor=ArgumentCaptor.forClass(MuleEvent.class);
  verify(messageProcessor).process(captor.capture());
  MuleEvent capturedEvent=captor.getValue();
  assertThat(capturedEvent.getId(),is(muleEvent.getId()));
}
