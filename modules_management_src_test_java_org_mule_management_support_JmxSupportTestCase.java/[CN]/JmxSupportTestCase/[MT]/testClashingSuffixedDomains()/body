{
  final String managerId="Test_Instance";
  int numOriginalDomains=mBeanServer.getDomains().length;
  final String testDomain=JmxModernSupport.DEFAULT_JMX_DOMAIN_PREFIX + "." + managerId;
  ObjectName name=ObjectName.getInstance(testDomain + ":name=TestDuplicates");
  mBeanServer.registerMBean(new StatisticsService(),name);
  name=ObjectName.getInstance(testDomain + ".1" + ":name=TestDuplicates");
  mBeanServer.registerMBean(new StatisticsService(),name);
  assertEquals("Wrong number of domains created.",numOriginalDomains + 2,mBeanServer.getDomains().length);
  UMOManager manager=getManager(true);
  manager.setId(managerId);
  JmxAgent agent=new JmxAgent();
  MuleManager.getRegistry().registerAgent(agent);
  manager.start();
  List domains=Arrays.asList(mBeanServer.getDomains());
  assertEquals("Wrong number of domains created.",numOriginalDomains + 3,domains.size());
  assertTrue("Should have contained an original domain.",domains.contains(testDomain));
  assertTrue("Should have contained an original suffixed domain.",domains.contains(testDomain + ".1"));
  assertTrue("Should have contained a new domain.",domains.contains(testDomain + ".2"));
}
