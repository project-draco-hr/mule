{
  int numOriginalDomains=mBeanServer.getDomains().length;
  ObjectName name=ObjectName.getInstance(TEST_DOMAIN + ":name=TestDuplicates");
  mBeanServer.registerMBean(new StatisticsService(),name);
  name=ObjectName.getInstance(TEST_DOMAIN + ".1" + ":name=TestDuplicates");
  mBeanServer.registerMBean(new StatisticsService(),name);
  assertEquals("Wrong number of domains created.",numOriginalDomains + 2,mBeanServer.getDomains().length);
  muleContext.getConfiguration().setId(MANAGER_ID);
  JmxAgent agent=new JmxAgent();
  agent.setMuleContext(muleContext);
  agent.initialise();
  muleContext.getRegistry().registerAgent(agent);
  muleContext.start();
  List domains=Arrays.asList(mBeanServer.getDomains());
  assertEquals("Wrong number of domains created.",numOriginalDomains + 3,domains.size());
  assertTrue("Should have contained an original domain.",domains.contains(TEST_DOMAIN));
  assertTrue("Should have contained an original suffixed domain.",domains.contains(TEST_DOMAIN + ".1"));
  assertTrue("Should have contained a new domain.",domains.contains(TEST_DOMAIN + ".2"));
}
