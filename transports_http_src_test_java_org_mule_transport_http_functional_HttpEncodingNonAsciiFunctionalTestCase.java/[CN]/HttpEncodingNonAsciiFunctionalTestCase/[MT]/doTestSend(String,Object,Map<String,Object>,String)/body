{
  CountDownLatch cdl=new CountDownLatch(1);
  setupAssertIncomingMessage(method,cdl,expectedContentType);
  MuleClient client=new MuleClient(muleContext);
  MuleMessage reply=client.send("vm://sendBy" + method,messagePayload,messageProperties);
  assertNotNull(reply);
  assertEquals("200",reply.getProperty(HttpConnector.HTTP_STATUS_PROPERTY));
  assertEquals("text/plain;charset=EUC-JP",reply.getProperty(HttpConstants.HEADER_CONTENT_TYPE).toString());
  assertEquals("EUC-JP",reply.getEncoding());
  assertEquals(getTestMessage(Locale.JAPAN) + " Received",reply.getPayloadAsString());
  cdl.await(RECEIVE_TIMEOUT,TimeUnit.MILLISECONDS);
}
