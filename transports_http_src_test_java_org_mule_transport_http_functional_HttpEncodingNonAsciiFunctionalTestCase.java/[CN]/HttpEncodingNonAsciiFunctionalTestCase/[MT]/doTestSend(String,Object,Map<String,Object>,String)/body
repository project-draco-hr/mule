{
  Latch latch=new Latch();
  setupAssertIncomingMessage(method,latch,expectedContentTypeHeader);
  MuleClient client=new MuleClient(muleContext);
  MuleMessage reply=client.send("vm://sendBy" + method,messagePayload,messageProperties);
  assertTrue(latch.await(RECEIVE_TIMEOUT,TimeUnit.MILLISECONDS));
  assertNotNull(reply);
  assertEquals(expectedContentTypeHeader,reply.getInvocationProperty(HttpConstants.HEADER_CONTENT_TYPE));
  assertEquals("EUC-JP",reply.getEncoding());
  assertEquals(getTestMessage(Locale.JAPAN) + " Received",reply.getPayloadAsString());
}
