{
  logger.info("================================");
  logger.info("Running test: " + this.getName());
  logger.info("================================");
  final TransactionalQueueManager mgr=createQueueManager();
  mgr.start();
  final Latch latch=new Latch();
  Thread t=new Thread(){
    public void run(){
      try {
        latch.release();
        Thread.sleep(200);
        QueueSession s=mgr.getQueueSession();
        Queue q=s.getQueue("queue1");
        assertEquals(0,q.size());
        s.begin();
        q.put("String1");
        s.rollback();
        s.begin();
        q.put("String2");
        s.commit();
      }
 catch (      Exception e) {
      }
    }
  }
;
  t.start();
  latch.acquire();
  long t0=System.currentTimeMillis();
  QueueSession s=mgr.getQueueSession();
  Queue q=s.getQueue("queue1");
  assertEquals(0,q.size());
  Object o=q.take();
  long t1=System.currentTimeMillis();
  t.join();
  assertNotNull(o);
  assertEquals("String2",o);
  assertEquals(0,q.size());
  assertTrue(t1 - t0 > 100);
  mgr.stop(AbstractResourceManager.SHUTDOWN_MODE_NORMAL);
}
