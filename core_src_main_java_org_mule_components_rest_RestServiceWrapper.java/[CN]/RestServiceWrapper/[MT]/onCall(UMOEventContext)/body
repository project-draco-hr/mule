{
  String tempUrl;
  Object request=eventContext.getTransformedMessage();
  Object requestBody=request;
  if (urlFromMessage) {
    tempUrl=eventContext.getMessage().getStringProperty(REST_SERVICE_URL,null);
    if (tempUrl == null) {
      throw new IllegalArgumentException(CoreMessages.propertyIsNotSetOnEvent(REST_SERVICE_URL).toString());
    }
  }
 else {
    tempUrl=serviceUrl;
  }
  StringBuffer urlBuffer=new StringBuffer(tempUrl);
  if (payloadParameterName != null) {
    requestBody=NullPayload.getInstance();
  }
 else   if (request instanceof Map) {
    requestBody=NullPayload.getInstance();
  }
  setRESTParams(urlBuffer,eventContext.getMessage(),request,requiredParams,false);
  setRESTParams(urlBuffer,eventContext.getMessage(),request,optionalParams,true);
  tempUrl=urlBuffer.toString();
  logger.info("Invoking REST service: " + tempUrl);
  UMOEndpointURI endpointURI=new MuleEndpointURI(tempUrl);
  eventContext.getMessage().setProperty("http.method",httpMethod);
  UMOMessage result=eventContext.sendEvent(new MuleMessage(requestBody,eventContext.getMessage()),endpointURI);
  if (isErrorPayload(result)) {
    handleException(new RestServiceException(CoreMessages.failedToInvokeRestService(tempUrl),result),result);
  }
  return result;
}
