{
  char sep;
  if (url.indexOf("?") > -1) {
    sep='&';
  }
 else {
    sep='?';
  }
  for (Iterator iterator=args.entrySet().iterator(); iterator.hasNext(); ) {
    Map.Entry entry=(Map.Entry)iterator.next();
    String name=(String)entry.getKey();
    String exp=(String)entry.getValue();
    Object value=propertyExtractor.getProperty(exp,msg);
    if (value == null) {
      if (!optional) {
        throw new IllegalArgumentException(CoreMessages.propertyIsNotSetOnEvent(exp).toString());
      }
    }
 else {
      url.append(sep);
      sep='&';
      url.append(name).append('=').append(value);
    }
  }
  if (!optional && payloadParameterName != null) {
    url.append(sep).append(payloadParameterName).append('=').append(body.toString());
  }
}
