{
  configureProperties();
  jmxAgent.setCredentials(getValidCredentials());
  muleContext.getRegistry().registerAgent(jmxAgent);
  muleContext.start();
  JMXConnector connector=null;
  try {
    Map props=Collections.singletonMap(JMXConnector.CREDENTIALS,VALID_AUTH_TOKEN);
    connector=JMXConnectorFactory.connect(serviceUrl,props);
    MBeanServerConnection connection=connector.getMBeanServerConnection();
    assertTrue(Arrays.asList(connection.getDomains()).toString(),Arrays.asList(connection.getDomains()).contains("Mule." + DOMAIN));
  }
  finally {
    if (connector != null) {
      connector.close();
    }
  }
}
